<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>pwncone.io</title>
    <link rel="stylesheet" href="../../../../css/style.css">
  </head>

<body>

<section>

    <writeup>
        <h1><strong>#Protostar x64 - VM Setup</strong></h1>
        The original Protostar VM is Debian 6, which was released in 2011.<br>
        Debian is awkward to download/setup, so I used Ubuntu 12.04.<br>
        <br>
        <img alt="images\1-1.png" src="images/1-1.png"><br>
        <br>
        Credentials (same as original Protostar):<br>
        <code>root / godmode</code><br>
        <code>user / user</code><br>
        <br>
        1. Disable ASLR<br>
            <div class="codebox">
                user@ubuntu:~$&nbsp;sudo&nbsp;su<br>
                root@ubuntu:/home/user<span style="color:#0088ff;font-weight:400">#&nbsp;echo&nbsp;0&nbsp;&gt;&nbsp;/proc/sys/kernel/randomize_va_space&nbsp;</span><br>
                root@ubuntu:/home/user<span style="color:#0088ff;font-weight:400">#&nbsp;cat&nbsp;/proc/sys/kernel/randomize_va_space&nbsp;</span><br>
                <span style="color:#ff0044;font-weight:400">0</span>
            </div>
        </div><br>
        <br>
        2. Install and start SSH<br>
            <div class="codebox">
                root@ubuntu:/home/user<span style="color:#0088ff;font-weight:400">#&nbsp;apt-get&nbsp;install&nbsp;ssh</span><br>
                [...]<br>
                root@ubuntu:/home/user<span style="color:#0088ff;font-weight:400">#&nbsp;service&nbsp;ssh&nbsp;start</span>
            </div>
        </div><br>
        <br>
        We want to compile the binaries without protoections.<br>
        <code>-fno-stack-protector</code> disables stack canaries.<br>
        <code>-D_FORTIFY_SOURCE=0</code> disables fortify.<br>
        <code>-z execstack</code> allows for code on the stack to be executed.<br>
        <br>
        3. As root, compile stack0-5 with no protections<br>
            <div class="codebox">
                user@ubuntu<span style="color:#ff9d00;font-weight:700">:</span>~$&nbsp;<span style="color:#ff9d00;font-weight:700">mkdir</span>&nbsp;-p&nbsp;protostar64<span style="color:#ff9d00;font-weight:700">/</span>bin<br>
                user@ubuntu<span style="color:#ff9d00;font-weight:700">:</span>~$&nbsp;<span style="color:#ff9d00;font-weight:700">cd</span>&nbsp;protostar64<span style="color:#ff9d00;font-weight:700">/</span>bin<span style="color:#ff9d00;font-weight:700">/</span><br>
                user@ubuntu<span style="color:#ff9d00;font-weight:700">:</span>~<span style="color:#ff9d00;font-weight:700">/</span>protostar64<span style="color:#ff9d00;font-weight:700">/</span>bin$&nbsp;<span style="color:#ff9d00;font-weight:700">sudo</span>&nbsp;<span style="color:#ff9d00;font-weight:700">su</span><br>
                root@ubuntu<span style="color:#ff9d00;font-weight:700">:/</span>home<span style="color:#ff9d00;font-weight:700">/</span>user<span style="color:#ff9d00;font-weight:700">/</span>protostar64<span style="color:#ff9d00;font-weight:700">/</span>bin#&nbsp;nano&nbsp;stack0<br>
                root@ubuntu<span style="color:#ff9d00;font-weight:700">:/</span>home<span style="color:#ff9d00;font-weight:700">/</span>user<span style="color:#ff9d00;font-weight:700">/</span>protostar64<span style="color:#ff9d00;font-weight:700">/</span>bin#&nbsp;<span style="color:#ff9d00;font-weight:700">gcc</span>&nbsp;stack0.c&nbsp;-o&nbsp;stack0&nbsp;-fno-stack-protector&nbsp;-D_FORTIFY_SOURCE=0&nbsp;-z&nbsp;execstack<br>
                &lt;command-line&gt;<span style="color:#ff9d00;font-weight:700">:</span>0<span style="color:#ff9d00;font-weight:700">:</span>0<span style="color:#ff9d00;font-weight:700">:</span>&nbsp;warning<span style="color:#ff9d00;font-weight:700">:</span>&nbsp;<span style="color:#3ad900;font-weight:400">"_FORTIFY_SOURCE"</span>&nbsp;redefined&nbsp;[enabled&nbsp;by&nbsp;default]<br>
                &lt;built-in&gt;<span style="color:#ff9d00;font-weight:700">:</span>0<span style="color:#ff9d00;font-weight:700">:</span>0<span style="color:#ff9d00;font-weight:700">:</span>&nbsp;note<span style="color:#ff9d00;font-weight:700">:</span>&nbsp;this&nbsp;is&nbsp;the&nbsp;location&nbsp;of&nbsp;the&nbsp;previous&nbsp;definition<br>
                [...]
            </div>
        </div><br>
        <br>
        4. Still as root, compile stack6 and stack7 with NX (no-executable stack) protection<br>
            <div class="codebox">
                root@ubuntu<span style="color:#ff9d00;font-weight:700">:/</span>home<span style="color:#ff9d00;font-weight:700">/</span>user<span style="color:#ff9d00;font-weight:700">/</span>protostar64<span style="color:#ff9d00;font-weight:700">/</span>bin#&nbsp;nano&nbsp;stack6.c<br>
                root@ubuntu<span style="color:#ff9d00;font-weight:700">:/</span>home<span style="color:#ff9d00;font-weight:700">/</span>user<span style="color:#ff9d00;font-weight:700">/</span>protostar64<span style="color:#ff9d00;font-weight:700">/</span>bin#&nbsp;<span style="color:#ff9d00;font-weight:700">gcc</span>&nbsp;stack6.c&nbsp;-o&nbsp;stack6&nbsp;-fno-stack-protector&nbsp;-D_FORTIFY_SOURCE=0<br>
                [...]<br>
                root@ubuntu<span style="color:#ff9d00;font-weight:700">:/</span>home<span style="color:#ff9d00;font-weight:700">/</span>user<span style="color:#ff9d00;font-weight:700">/</span>protostar64<span style="color:#ff9d00;font-weight:700">/</span>bin#&nbsp;nano&nbsp;stack7.c<br>
                root@ubuntu<span style="color:#ff9d00;font-weight:700">:/</span>home<span style="color:#ff9d00;font-weight:700">/</span>user<span style="color:#ff9d00;font-weight:700">/</span>protostar64<span style="color:#ff9d00;font-weight:700">/</span>bin#&nbsp;<span style="color:#ff9d00;font-weight:700">gcc</span>&nbsp;stack7.c&nbsp;-o&nbsp;stack7&nbsp;-fno-stack-protector&nbsp;-D_FORTIFY_SOURCE=0<br>
                [...]
            </div>
        </div><br>
        <br>
        5. Move all the source files to a separate directory (for clean-ups sake)<br>
            <div class="codebox">
                root@ubuntu<span style="color:#ff9d00;font-weight:700">:/</span>home<span style="color:#ff9d00;font-weight:700">/</span>user<span style="color:#ff9d00;font-weight:700">/</span>protostar64<span style="color:#ff9d00;font-weight:700">/</span>bin#&nbsp;<span style="color:#ff9d00;font-weight:700">cd</span>&nbsp;..<span style="color:#ff9d00;font-weight:700">/</span><br>
                root@ubuntu<span style="color:#ff9d00;font-weight:700">:/</span>home<span style="color:#ff9d00;font-weight:700">/</span>user<span style="color:#ff9d00;font-weight:700">/</span>protostar64#&nbsp;<span style="color:#ff9d00;font-weight:700">mkdir</span>&nbsp;<span style="color:#ff9d00;font-weight:700">source</span><br>
                root@ubuntu<span style="color:#ff9d00;font-weight:700">:/</span>home<span style="color:#ff9d00;font-weight:700">/</span>user<span style="color:#ff9d00;font-weight:700">/</span>protostar64#&nbsp;<span style="color:#ff9d00;font-weight:700">mv</span>&nbsp;bin<span style="color:#ff9d00;font-weight:700">/</span>*.c&nbsp;<span style="color:#ff9d00;font-weight:700">source</span><br>
                root@ubuntu<span style="color:#ff9d00;font-weight:700">:/</span>home<span style="color:#ff9d00;font-weight:700">/</span>user<span style="color:#ff9d00;font-weight:700">/</span>protostar64#&nbsp;<span style="color:#ff9d00;font-weight:700">ls</span>&nbsp;-alh&nbsp;<span style="color:#ff9d00;font-weight:700">source</span><br>
                total&nbsp;40K<br>
                drwxr-xr<span style="color:#ffdd00;font-weight:400">-x</span>&nbsp;2&nbsp;root&nbsp;root&nbsp;4.0K&nbsp;Dec&nbsp;15&nbsp;08<span style="color:#ff9d00;font-weight:700">:</span>07&nbsp;.<br>
                drwxrwxr<span style="color:#ffdd00;font-weight:400">-x</span>&nbsp;4&nbsp;user&nbsp;user&nbsp;4.0K&nbsp;Dec&nbsp;15&nbsp;08<span style="color:#ff9d00;font-weight:700">:</span>07&nbsp;..<br>
                -rw<span style="color:#ffdd00;font-weight:400">-r</span>--r--&nbsp;1&nbsp;root&nbsp;root&nbsp;&nbsp;301&nbsp;Dec&nbsp;15&nbsp;07<span style="color:#ff9d00;font-weight:700">:</span>35&nbsp;stack0.c<br>
                -rw<span style="color:#ffdd00;font-weight:400">-r</span>--r--&nbsp;1&nbsp;root&nbsp;root&nbsp;&nbsp;450&nbsp;Dec&nbsp;15&nbsp;07<span style="color:#ff9d00;font-weight:700">:</span>54&nbsp;stack1.c<br>
                -rw<span style="color:#ffdd00;font-weight:400">-r</span>--r--&nbsp;1&nbsp;root&nbsp;root&nbsp;&nbsp;514&nbsp;Dec&nbsp;15&nbsp;07<span style="color:#ff9d00;font-weight:700">:</span>55&nbsp;stack2.c<br>
                -rw<span style="color:#ffdd00;font-weight:400">-r</span>--r--&nbsp;1&nbsp;root&nbsp;root&nbsp;&nbsp;344&nbsp;Dec&nbsp;15&nbsp;07<span style="color:#ff9d00;font-weight:700">:</span>56&nbsp;stack3.c<br>
                -rw<span style="color:#ffdd00;font-weight:400">-r</span>--r--&nbsp;1&nbsp;root&nbsp;root&nbsp;&nbsp;214&nbsp;Dec&nbsp;15&nbsp;07<span style="color:#ff9d00;font-weight:700">:</span>57&nbsp;stack4.c<br>
                -rw<span style="color:#ffdd00;font-weight:400">-r</span>--r--&nbsp;1&nbsp;root&nbsp;root&nbsp;&nbsp;152&nbsp;Dec&nbsp;15&nbsp;07<span style="color:#ff9d00;font-weight:700">:</span>57&nbsp;stack5.c<br>
                -rw<span style="color:#ffdd00;font-weight:400">-r</span>--r--&nbsp;1&nbsp;root&nbsp;root&nbsp;&nbsp;422&nbsp;Dec&nbsp;15&nbsp;07<span style="color:#ff9d00;font-weight:700">:</span>58&nbsp;stack6.c<br>
                -rw<span style="color:#ffdd00;font-weight:400">-r</span>--r--&nbsp;1&nbsp;root&nbsp;root&nbsp;&nbsp;452&nbsp;Dec&nbsp;15&nbsp;08<span style="color:#ff9d00;font-weight:700">:</span>01&nbsp;stack7.c<br>
                root@ubuntu<span style="color:#ff9d00;font-weight:700">:/</span>home<span style="color:#ff9d00;font-weight:700">/</span>user<span style="color:#ff9d00;font-weight:700">/</span>protostar64#&nbsp;<span style="color:#ff9d00;font-weight:700">ls</span>&nbsp;-alh&nbsp;bin<br>
                total&nbsp;104K<br>
                drwxrwxr<span style="color:#ffdd00;font-weight:400">-x</span>&nbsp;2&nbsp;user&nbsp;user&nbsp;4.0K&nbsp;Dec&nbsp;15&nbsp;08<span style="color:#ff9d00;font-weight:700">:</span>07&nbsp;.<br>
                drwxrwxr<span style="color:#ffdd00;font-weight:400">-x</span>&nbsp;4&nbsp;user&nbsp;user&nbsp;4.0K&nbsp;Dec&nbsp;15&nbsp;08<span style="color:#ff9d00;font-weight:700">:</span>07&nbsp;..<br>
                -rwxr-xr<span style="color:#ffdd00;font-weight:400">-x</span>&nbsp;1&nbsp;root&nbsp;root&nbsp;8.3K&nbsp;Dec&nbsp;15&nbsp;07<span style="color:#ff9d00;font-weight:700">:</span>37&nbsp;stack0<br>
                -rwxr-xr<span style="color:#ffdd00;font-weight:400">-x</span>&nbsp;1&nbsp;root&nbsp;root&nbsp;8.4K&nbsp;Dec&nbsp;15&nbsp;07<span style="color:#ff9d00;font-weight:700">:</span>55&nbsp;stack1<br>
                -rwxr-xr<span style="color:#ffdd00;font-weight:400">-x</span>&nbsp;1&nbsp;root&nbsp;root&nbsp;8.4K&nbsp;Dec&nbsp;15&nbsp;07<span style="color:#ff9d00;font-weight:700">:</span>55&nbsp;stack2<br>
                -rwxr-xr<span style="color:#ffdd00;font-weight:400">-x</span>&nbsp;1&nbsp;root&nbsp;root&nbsp;8.4K&nbsp;Dec&nbsp;15&nbsp;07<span style="color:#ff9d00;font-weight:700">:</span>56&nbsp;stack3<br>
                -rwxr-xr<span style="color:#ffdd00;font-weight:400">-x</span>&nbsp;1&nbsp;root&nbsp;root&nbsp;8.3K&nbsp;Dec&nbsp;15&nbsp;07<span style="color:#ff9d00;font-weight:700">:</span>57&nbsp;stack4<br>
                -rwxr-xr<span style="color:#ffdd00;font-weight:400">-x</span>&nbsp;1&nbsp;root&nbsp;root&nbsp;8.2K&nbsp;Dec&nbsp;15&nbsp;07<span style="color:#ff9d00;font-weight:700">:</span>57&nbsp;stack5<br>
                -rwxr-xr<span style="color:#ffdd00;font-weight:400">-x</span>&nbsp;1&nbsp;root&nbsp;root&nbsp;8.5K&nbsp;Dec&nbsp;15&nbsp;07<span style="color:#ff9d00;font-weight:700">:</span>58&nbsp;stack6<br>
                -rwxr-xr<span style="color:#ffdd00;font-weight:400">-x</span>&nbsp;1&nbsp;root&nbsp;root&nbsp;8.5K&nbsp;Dec&nbsp;15&nbsp;08<span style="color:#ff9d00;font-weight:700">:</span>02&nbsp;stack7
            </div>
        </div><br>
        <br>
        6. Give all the exploit binaries a SUID bit<br>
            <div class="codebox">
                root@ubuntu<span style="color:#ff9d00;font-weight:700">:/</span>home<span style="color:#ff9d00;font-weight:700">/</span>user<span style="color:#ff9d00;font-weight:700">/</span>protostar64#&nbsp;<span style="color:#ff9d00;font-weight:700">cd</span>&nbsp;bin<br>
                root@ubuntu<span style="color:#ff9d00;font-weight:700">:/</span>home<span style="color:#ff9d00;font-weight:700">/</span>user<span style="color:#ff9d00;font-weight:700">/</span>protostar64<span style="color:#ff9d00;font-weight:700">/</span>bin#&nbsp;<span style="color:#ff9d00;font-weight:700">chmod</span>&nbsp;+s&nbsp;*<br>
                root@ubuntu<span style="color:#ff9d00;font-weight:700">:/</span>home<span style="color:#ff9d00;font-weight:700">/</span>user<span style="color:#ff9d00;font-weight:700">/</span>protostar64<span style="color:#ff9d00;font-weight:700">/</span>bin#&nbsp;<span style="color:#ff9d00;font-weight:700">ls</span>&nbsp;-alh<br>
                total&nbsp;104K<br>
                drwxrwxr<span style="color:#ffdd00;font-weight:400">-x</span>&nbsp;2&nbsp;user&nbsp;user&nbsp;4.0K&nbsp;Dec&nbsp;15&nbsp;08<span style="color:#ff9d00;font-weight:700">:</span>07&nbsp;.<br>
                drwxrwxr<span style="color:#ffdd00;font-weight:400">-x</span>&nbsp;4&nbsp;user&nbsp;user&nbsp;4.0K&nbsp;Dec&nbsp;15&nbsp;08<span style="color:#ff9d00;font-weight:700">:</span>07&nbsp;..<br>
                -rwsr-sr<span style="color:#ffdd00;font-weight:400">-x</span>&nbsp;1&nbsp;root&nbsp;root&nbsp;8.3K&nbsp;Dec&nbsp;15&nbsp;07<span style="color:#ff9d00;font-weight:700">:</span>37&nbsp;stack0<br>
                -rwsr-sr<span style="color:#ffdd00;font-weight:400">-x</span>&nbsp;1&nbsp;root&nbsp;root&nbsp;8.4K&nbsp;Dec&nbsp;15&nbsp;07<span style="color:#ff9d00;font-weight:700">:</span>55&nbsp;stack1<br>
                -rwsr-sr<span style="color:#ffdd00;font-weight:400">-x</span>&nbsp;1&nbsp;root&nbsp;root&nbsp;8.4K&nbsp;Dec&nbsp;15&nbsp;07<span style="color:#ff9d00;font-weight:700">:</span>55&nbsp;stack2<br>
                -rwsr-sr<span style="color:#ffdd00;font-weight:400">-x</span>&nbsp;1&nbsp;root&nbsp;root&nbsp;8.4K&nbsp;Dec&nbsp;15&nbsp;07<span style="color:#ff9d00;font-weight:700">:</span>56&nbsp;stack3<br>
                -rwsr-sr<span style="color:#ffdd00;font-weight:400">-x</span>&nbsp;1&nbsp;root&nbsp;root&nbsp;8.3K&nbsp;Dec&nbsp;15&nbsp;07<span style="color:#ff9d00;font-weight:700">:</span>57&nbsp;stack4<br>
                -rwsr-sr<span style="color:#ffdd00;font-weight:400">-x</span>&nbsp;1&nbsp;root&nbsp;root&nbsp;8.2K&nbsp;Dec&nbsp;15&nbsp;07<span style="color:#ff9d00;font-weight:700">:</span>57&nbsp;stack5<br>
                -rwsr-sr<span style="color:#ffdd00;font-weight:400">-x</span>&nbsp;1&nbsp;root&nbsp;root&nbsp;8.5K&nbsp;Dec&nbsp;15&nbsp;07<span style="color:#ff9d00;font-weight:700">:</span>58&nbsp;stack6<br>
                -rwsr-sr<span style="color:#ffdd00;font-weight:400">-x</span>&nbsp;1&nbsp;root&nbsp;root&nbsp;8.5K&nbsp;Dec&nbsp;15&nbsp;08<span style="color:#ff9d00;font-weight:700">:</span>02&nbsp;stack7
            </div>
        </div><br>
        <br>
        Done!<br>
        We're good :)<br>
    </writeup>
</section>

</body>
</html>