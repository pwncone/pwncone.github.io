<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Raw Key to PLAINTEXTKEY blob</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><strong><h1># Raw Key to PLAINTEXTKEY blob struct</h1></strong><br />A raw key is just the raw bytes of the key as plaintext (not encrypted or anything)<br />A blob is just a key format.<br /><br />Structures:<br />• <a href="https://docs.microsoft.com/en-us/previous-versions/windows/desktop/legacy/jj650836(v%3Dvs.85)">https://docs.microsoft.com/en-us/previous-versions/windows/desktop/legacy/jj650836(v%3Dvs.85)</a> - PLAINTEXTKEYBLOB struct<br />• <a href="https://docs.microsoft.com/en-us/windows/win32/api/wincrypt/ns-wincrypt-publickeystruc">https://docs.microsoft.com/en-us/windows/win32/api/wincrypt/ns-wincrypt-publickeystruc</a> - BLOBHEADER struct<br /><br />Examples:<br />• <a href="https://stackoverflow.com/questions/56530195/what-is-wrong-with-this-simple-code-meant-to-decrypt-with-aes-256-bit-key-using">https://stackoverflow.com/questions/56530195/what-is-wrong-with-this-simple-code-meant-to-decrypt-with-aes-256-bit-key-using</a><br />• <a href="https://stackoverflow.com/questions/51839466/winapi-cryptdecrypt-not-working-properly-in-aes-256">https://stackoverflow.com/questions/51839466/winapi-cryptdecrypt-not-working-properly-in-aes-256</a><br />• <a href="https://docs.microsoft.com/en-us/windows/win32/seccrypto/example-c-program--importing-a-plaintext-key">https://docs.microsoft.com/en-us/windows/win32/seccrypto/example-c-program--importing-a-plaintext-key</a><br /><br />Personal example:<br /><div class="codebox"><div class="codebox">/*<br />Example&nbsp;of&nbsp;creating&nbsp;key&nbsp;blob&nbsp;for&nbsp;AES128&nbsp;and&nbsp;importing&nbsp;it.<br />Make&nbsp;sure&nbsp;to&nbsp;change&nbsp;to&nbsp;the&nbsp;rgbKeyData&nbsp;size&nbsp;if&nbsp;using&nbsp;something&nbsp;else<br />e.g.&nbsp;to&nbsp;32&nbsp;if&nbsp;using&nbsp;AES256<br />*/<br /><br />typedef&nbsp;struct&nbsp;KEYBLOB_&nbsp;{<br />	BLOBHEADER&nbsp;hdr;<br />	DWORD&nbsp;key_size;<br />	BYTE&nbsp;rgbKeyData[16];<br />}&nbsp;KEYBLOB;<br /><br />int&nbsp;main()<br /><span style="color:#000000;font-weight:400">{</span><br />	BOOL&nbsp;b&nbsp;=&nbsp;FALSE;<br /><br />	//&nbsp;...&nbsp;main&nbsp;code...<br />	<br />	//&nbsp;Configure&nbsp;crypto<br />	HCRYPTKEY&nbsp;h_key&nbsp;=&nbsp;0;<br />	HCRYPTPROV&nbsp;h_provider&nbsp;=&nbsp;0;<br />	unsigned&nbsp;char&nbsp;key[16]&nbsp;=&nbsp;{&nbsp;0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15&nbsp;};<br />	unsigned&nbsp;char&nbsp;iv[16]&nbsp;=&nbsp;{&nbsp;0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15&nbsp;};<br /><br />	KEYBLOB&nbsp;keyblob&nbsp;=&nbsp;{&nbsp;0&nbsp;};<br />	keyblob.hdr.bType&nbsp;=&nbsp;PLAINTEXTKEYBLOB;<br />	keyblob.hdr.bVersion&nbsp;=&nbsp;CUR_BLOB_VERSION;<br />	keyblob.hdr.reserved&nbsp;=&nbsp;0;<br />	keyblob.hdr.aiKeyAlg&nbsp;=&nbsp;CALG_AES_128;<br />	keyblob.key_size&nbsp;=&nbsp;16;<br />	strcpy_s(keyblob.rgbKeyData,&nbsp;16,&nbsp;key);<br />	//stncpy(keyblob.rgbKeyData,&nbsp;key,&nbsp;16);		//&nbsp;atlernatively&nbsp;use&nbsp;strncpy&nbsp;to&nbsp;specify&nbsp;N&nbsp;bytes&nbsp;to&nbsp;copy<br /><br />	b&nbsp;=&nbsp;CryptAcquireContextA(&amp;h_provider,&nbsp;NULL,&nbsp;MS_ENH_RSA_AES_PROV_A,&nbsp;PROV_RSA_AES,&nbsp;0);<br />	if&nbsp;(b&nbsp;==&nbsp;FALSE)<br />	{<br />		if&nbsp;(GetLastError()&nbsp;==&nbsp;NTE_BAD_KEYSET)<br />		{<br />			b&nbsp;=&nbsp;CryptAcquireContextA(&amp;h_provider,&nbsp;NULL,&nbsp;MS_ENH_RSA_AES_PROV_A,&nbsp;PROV_RSA_AES,&nbsp;CRYPT_NEWKEYSET);<br />			if&nbsp;(b&nbsp;==&nbsp;FALSE)<br />				return&nbsp;1;<br />		}<br />		else<br />			return&nbsp;1;<br />	}<br /><br />	CryptImportKey(h_provider,&nbsp;(BYTE*)&amp;keyblob,&nbsp;sizeof(keyblob),&nbsp;0,&nbsp;0,&nbsp;&amp;h_key);<br />	<br />	//&nbsp;rest&nbsp;of&nbsp;main...<br /><span style="color:#000000;font-weight:400">}</span></div></div><br /><br /></div>
</body>
</html>
