<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Get process path from PID</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><strong><h1># Get process path from PID</h1></strong><br />• <a href="https://github.com/umerov1999/metasploit-payloads/blob/e48f3432ff5b673c5b6bf1893c2cccf2974f084d/c/meterpreter/source/extensions/stdapi/server/sys/process/ps.c#L189">https://github.com/umerov1999/metasploit-payloads/blob/e48f3432ff5b673c5b6bf1893c2cccf2974f084d/c/meterpreter/source/extensions/stdapi/server/sys/process/ps.c#L189</a><br /><br />• <code>QueryFullProcessImageNameA</code> (Windows Vista/2008/7)<br />• <code>GetProcessImageFileNameA</code> (Windows XP/2003/Vista/2008/7 - returns native path)<br />• Read the path from the process&#39;s PEB. (Windows NT4 and above)<br /><br /><strong><h2>## GetModuleFileNameEx</h2></strong><br />• <a href="https://docs.microsoft.com/en-us/windows/win32/api/psapi/nf-psapi-getmodulefilenameexa">https://docs.microsoft.com/en-us/windows/win32/api/psapi/nf-psapi-getmodulefilenameexa</a><br />Cant get 64bit process paths from a 32bit process.<br /><br />Grab a handle to the process via its PID with <code>OpenProcess</code><br />And then get its filename.<br /><div class="codebox"><div class="codebox">HANDLE&nbsp;h_process&nbsp;=&nbsp;NULL;<br />DWORD&nbsp;i_ret&nbsp;=&nbsp;0;<br />char&nbsp;process_name[1024]&nbsp;=&nbsp;{&nbsp;0&nbsp;};<br /><br />h_process&nbsp;=&nbsp;OpenProcess(PROCESS_QUERY_INFORMATION&nbsp;|&nbsp;PROCESS_VM_READ,&nbsp;FALSE,&nbsp;process_ids[i]);<br />i_ret&nbsp;=&nbsp;GetModuleFileNameExA(h_process,&nbsp;NULL,&nbsp;process_name,&nbsp;1024);<br /><br />printf(&quot;\t&nbsp;%s&nbsp;\n&quot;,&nbsp;process_name);</div></div><br /></div>
</body>
</html>
