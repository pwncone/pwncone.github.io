<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Recon</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><strong><h1># Recon</h1></strong><br />This is all manual system recon that you can do in a shell.<br /><br /><strong><h2>## System Info</h2></strong><br /><code>cat /etc/issue; uname -mrs; hostname</code><br />• Distro<br />   ◇ Check for exploits<br />• Kernel version<br />   ◇ Check for exploits<br />      ▪ 4.4 - 4.13 - get_rekt<br />      ▪ memodipper<br />      ▪ reiserfs<br />      ▪ full-nelson<br />      ▪ rds<br />      ▪ etc.<br />• Architecture<br />• Check ld.so version - <code>2.17</code><br />   ◇ 2.12.2 and below vulnerable to glibic $ORIGIN Priv-Esc exploit<br />   ◇ <code>ldd --version</code><br />• Hostname<br />• IP<br /><br /><strong><h2>## Current user/you</h2></strong><br />Get a picture of who the current user is, what they do, what they can access etc.<br />I STRONGLY advise re-running these commands whenever you switch to a new user on the system.<br /><br />• Who are you?<br />   ◇ <code>id</code><br />• Are you part of any weird groups?<br />   ◇ <code>groups</code><br />      ▪ video<br />      ▪ disk<br />      ▪ adm<br />• Sudo or OpenBSD Doas?<br />   ◇ Test with no password and with password<br />   ◇ <code>sudo -l</code><br />      ▪ apt update &amp;&amp; apt upgrade<br />      ▪ sudoedit &lt;file&gt;<br />   ◇ <code>cat /etc/doas.conf</code><br />• What&#39;s in your /home?<br />   ◇ <code>tree -a /home/user</code> (best option if installed)<br />   ◇ <code>ls -alh -R /home</code> (horrible output)<br />• Check your history and history files<br />   ◇ <code>history</code><br />   ◇ <code>cat /home/&lt;user&gt;/.*_history</code><br />• Any private/interesting info in environment variables?<br />   ◇ <code>env</code><br />• Find all files the user currently owns<br />   ◇ <code>find / -user &lt;user&gt; -not -path &quot;/proc/*&quot; -not -path &quot;/sys/*&quot; -not -path &quot;/run/*&quot; 2&gt;/dev/null</code><br />• Find files you can write to<br />   ◇ <code>find  / \! -type l -writable -not -path &quot;/proc/*&quot; -not -path &quot;/sys/*&quot; -not -path &quot;/dev/*&quot; -not -path &quot;/run/*&quot; 2&gt;/dev/null</code><br />• Anything weird in your PATH?<br />   ◇ <code>echo $PATH</code><br />      ▪ . (dot) is significant<br />• Anything in the user&#39;s clipboard?<br />   ◇ <code>xclip -o -selection clipboard</code><br />   ◇ <code>xsel -ob</code><br />• Any highlighted text?<br />   ◇ <code>xclip -o</code><br />   ◇ <code>xsel -o</code><br /><br /><strong><h2>## Dumb checks</h2></strong><br />• Are there any hashes in /etc/passwd?<br />   ◇ <code>cat /etc/passwd</code> <br />• Do you have read/write permissions to any protected files?<br />   ◇ <code>ls -alh /etc/passwd /etc/shadow /etc/sudoers /etc/group /var/backups/*.bak /etc/security/opasswd</code><br />• Can you read /root?<br />   ◇ <code>ls -alh /root</code><br /><br /><strong><h2>## Other users</h2></strong><br />See who else interacts with the system, who you might laterally priv-esc to, how the system gets used<br /><br />• Users on the system?<br />   ◇ <code>cat /etc/passwd</code><br />   ◇ List super users - <code>awk -F: &#39;($3 == &quot;0&quot;) {print}&#39; /etc/passwd</code><br />   ◇ List users with a shell - <code>cat /etc/passwd | grep &quot;sh$&quot;</code><br />• Check their home folders<br />   ◇ <code>ls -alh /home/*</code><br />• Can you read anyone&#39;s history files?<br />   ◇ <code>cat /home/*/.*_history</code><br />• Try to su to every user<br />   ◇ <code>su &lt;user&gt;</code><br />   ◇ Try no password<br />   ◇ Try username as password<br />   ◇ Try &lt;username&gt;1 as password<br />   ◇ Try hostname as password<br />• Check for user&#39;s mail<br />   ◇ <code>ls -alh /var/mail</code><br />   ◇ <code>ls -alh /var/spool/mail</code><br />• Who&#39;s currently logged in?<br />   ◇ <code>w</code><br />• When did users last log in?<br />   ◇ <code>lastlog</code><br />• View logs of users logging in (who logs in a lot? what times?)<br />   ◇ <code>last</code><br /><br /><strong><h2>## Groups</h2></strong><br />• Check the groups on the system<br />   ◇ <code>cat /etc/group</code><br />   ◇ <code>cat /etc/groups</code><br />• Check for files owned by weird groups<br />   ◇ <code>find / -group &lt;group&gt; -not -path &quot;/proc/*&quot; 2&gt;/dev/null</code><br /><br /><strong><h2>## Processes</h2></strong><br />• Running as root<br />   ◇ <code>ps aux | grep root</code><br />      ▪ spamassassin<br />      ▪ MySQL<br />      ▪ Xvnc / VNC<br />• Running not as root<br />   ◇ <code>ps aux | grep -v root</code><br />• Find hidden/speedy processes<br />   ◇ pspy - <a href="https://github.com/DominicBreuker/pspy">https://github.com/DominicBreuker/pspy</a><br /><br /><strong><h2>## Files</h2></strong><br />• Any weird files/directories in / ?<br />   ◇ <code>ls -alh /</code><br />• Anything in /tmp?<br />   ◇ <code>ls -alh /tmp</code><br />• Find files that were edited in the last 10 minutes<br />   ◇ <code>find / -mmin -10 2&gt;/dev/null | grep -Ev &quot;^/proc&quot;</code><br />• Any weird custom stuff in /opt?<br />   ◇ <code>ls -alh /opt</code><br /><br /><strong><h2>## Web Files</h2></strong><br />• <code>ls -alh /var/www</code><br />• Have for look for config files, stuff you couldn&#39;t access on the site, anything intresting<br /><br /><strong><h2>## System info</h2></strong><br />• Filesystem stats<br />   ◇ <code>df</code><br />• Check ld.so version<br />   ◇ 2.12.2 and below vulnerable to glibic $ORIGIN Priv-Esc exploit<br />   ◇ <code>ldd --version</code><br />• List available shells<br />   ◇ <code>cat /etc/shells</code><br />• List available compilers<br />   ◇ <code>dpkg --list 2&gt;/dev/null| grep compiler |grep -v decompiler 2&gt;/dev/null &amp;&amp; yum list installed &#39;gcc*&#39; 2&gt;/dev/null| grep gcc 2&gt;/dev/null</code><br /><br /><strong><h2>## Cron Jobs</h2></strong><br />chkrootkit<br /><br />• Current user cron jobs<br />   ◇ <code>crontab -l</code><br />• System-wide cron jobs<br />   ◇ <code>cat /etc/crontab</code><br />• List all cron jobs<br />   ◇ <code>ls -alh /etc/cron*</code><br />• Check for cron jobs in weird places<br />   ◇ <code>cat /etc/cron* /etc/at* /etc/anacrontab /var/spool/cron/crontabs/root /var/spool/anacron</code><br />• Check that you can&#39;t read the cron jobs of other users<br />   ◇ <code>crontab -l root</code><br />   ◇ <code>crontab -l USER</code><br /><br /><strong><h2>## Timers</h2></strong><br />• <code>export TERM=xterm-256color &gt; watch -n 1 &#39;systemctl list-timers&#39;</code><br />• <code>systemctl list-timers --all</code><br /><br /><strong><h2>## Network Info</h2></strong><br />• Check for local ports<br />   ◇ Anything weird? Anything running on 127.0.0.1 (i.e. only on localhost) is interesting<br />      ▪ Connect to it and have a look - <code>nc localhost &lt;port&gt;</code><br />   ◇ <code>netstat -panut</code> or <code>ss --nutlp</code> (if netstat not available)<br />• Talking to any other machines?<br />   ◇ <code>arp -a</code><br />• Is tcpdump available? Sniff for traffic, connections, etc.<br />   ◇ <code>which tcpdump</code><br />• Hosts and DNS<br />   ◇ <code>cat /etc/hosts</code><br />   ◇ <code>cat /etc/resolv.conf</code><br />      ▪ nameserver 10.3.3.44<br />   ◇ <code>dnsdomainname</code><br />• Network neighbours<br />   ◇ <code>ip neigh</code><br />• Network adapters<br />   ◇ <code>ifconfig</code><br />   ◇ <code>/sbin/ifconfig</code> (if ifconfig not available)<br />• Any wifi connections files?<br />   ◇ <code>ls -alh /etc/NetworkManager/system-connections</code><br />• Routing table<br />   ◇ <code>route -n</code><br />• Firewall/IPtables rules<br />   ◇ <code>iptables -L</code><br />   ◇ <code>cat /etc/iptables/*</code><br /><br /><strong><h2>## Disks &amp; Devices</h2></strong><br />• Check what devices are/aren&#39;t mounted. Unmounted devices are interesting.<br />   ◇ <code>mount | column -t</code><br />   ◇ <code>mount -l</code> (less readable output of above)<br />• sd* disks in /dev<br />   ◇ <code>ls /dev 2&gt;/dev/null | grep -i &quot;sd&quot;</code><br />• Check mounted/unmounted devices in /etc/fstab<br />   ◇ <code>cat /etc/fstab | grep -v &quot;^#&quot;</code><br /><br /><strong><h2>## SUID and SGID</h2></strong><br />• SUID<br />   ◇ <code>find / -perm -4000 2&gt;/dev/null</code><br />      ▪ systemctl<br />      ▪ pkexec<br />• SGID<br />   ◇ <code>find / -perm -2000 2&gt;/dev/null</code><br /><br /><strong><h2>## Capabilities</h2></strong><br />• Any binaries with capabilities?<br />   ◇ <code>getcap -r / 2&gt;/dev/null</code><br />      ▪ openssl<br /><br /><strong><h2>## World-writable</h2></strong><br />• Directories<br />   ◇ <code>find / -xdev -type d \( -perm -0002 -a ! -perm -1000 \) -print 2&gt;/dev/null</code><br />• Files<br />   ◇ <code>find / -xdev -type f \( -perm -0002 -a ! -perm -1000 \) -print 2&gt;/dev/null</code><br />      ▪ /etc/passwd<br /><br /><strong><h2>## Installed Software</h2></strong><br />• firefox<br />• logstash<br />• Vault<br /><br /><strong><h2>## Interesting Files</h2></strong><br />• Any mail?<br />   ◇ <code>find /var/mail/ /var/spool/mail/ -type f</code><br />• Any backup files?<br />   ◇ <code>find /var /etc /bin /sbin /home /usr/local/bin /usr/local/sbin /usr/bin /usr/games /usr/sbin /root /tmp -type f \( -name &quot;*backup*&quot; -o -name &quot;*\.bak&quot; -o -name &quot;*\.bak\.*&quot; -o -name &quot;*\.bck&quot; -o -name &quot;*\.bck\.*&quot; -o -name &quot;*\.bk&quot; -o -name &quot;*\.bk\.*&quot; -o -name &quot;*\.old&quot; -o -name &quot;*\.old\.*&quot; \) 2&gt;/dev/null</code><br />• Any SSH files anywhere?<br />   ◇ <code>find /home /usr /root /etc /opt /var /mnt \( -name &quot;id_dsa*&quot; -o -name &quot;id_rsa*&quot; -o -name &quot;known_hosts&quot; -o -name &quot;authorized_hosts&quot; -o -name &quot;authorized_keys&quot; \) 2&gt;/dev/null</code><br />• Search for VNC files<br />   ◇ <code>find /home /root -type d -name .vnc</code><br />• Any VPN files? Have a look in them for passwords<br />   ◇ <code>find /etc /usr /home /root -name .ovpn</code><br />• Any cloud credentials keys?<br />   ◇ <code>find /var /etc /home /root /tmp /usr /opt -type f -name &quot;credentials&quot; -o \( -name &quot;credentials.db&quot; \) -o \( -name &quot;legacy_credentials.db&quot; \) -o \( -name &quot;access_tokens.db&quot; \) -o \( -name &quot;accessTokens.json&quot; \) o \( -name &quot;azureProfile.json&quot; \) 2&gt;/dev/null</code><br />• Check for knockd to imply whether there&#39;s port knocking going on. If so, read the config file<br />   ◇ <code>find /etc/init.d -name &quot;knockd&quot; 2&gt;/dev/null</code><br />• Any cached Active Directory hashes?<br />   ◇ <code>ls &quot;/var/lib/samba/private/secrets.tdb&quot; &quot;/var/lib/samba/passdb.tdb&quot; &quot;/var/opt/quest/vas/authcache/vas_auth.vdb&quot; &quot;/var/lib/sss/db/cache_*&quot; 2&gt;/dev/null</code><br />• Any dovecot credentials?<br />   ◇ <code>grep -r &quot;PLAIN&quot; /etc/dovecot</code><br />• Mosquitto.conf?<br />   ◇ <code>find /var /etc /home /root /tmp /usr /opt -type f -name &quot;mosquitto.conf&quot; 2&gt;/dev/null</code><br /><br /><strong><h2>## Search for passwords</h2></strong><br />• Search whole system<br />   ◇ <code>grep --color=auto -rnw &#39;/&#39; -ie &quot;PASSWORD&quot; --color=always 2&gt; /dev/null</code><br />   ◇ <code>find / -type f -exec grep -i -I &quot;PASSWORD&quot; {} /dev/null \;</code><br />• /var/www/html<br />   ◇ <code>grep -r password /var/www/html</code><br />• Passwords in memory<br />   ◇ <code>strings /dev/mem -n 10 | grep -i PASS</code><br />• Find sensitive files named ‘password’<br />   ◇ <code>locate password | more</code><br /><br /><strong><h2>## Services</h2></strong><br />• Anything weird? Outdated?<br />   ◇ [+] means started, [-] means not started<br />   ◇ The different commands are for different distros<br />   ◇ <code>service --status-all<br /></code>   ◇ <code>chkconfig --list<br /></code>   ◇ <code>rc-status</code><br />• Network File System (NFS)<br />   ◇ Read the exports file<br />      ▪ <code>cat /etc/exports</code><br /><br /><strong><h2>## Databases</h2></strong><br />• MySQL<br />   ◇ Vulnerable version?<br />      ▪ <code>mysql --version</code><br />   ◇ Are credentials in a config file anywhere?<br />      ▪ You&#39;ll have to look yourself :/<br />   ◇ Can you connect to mysql with credentials?<br />      ▪ <code>root / root</code><br />      ▪ <code>root / &lt;blank password&gt;</code><br />      ▪ <code>root / toor</code><br />      ▪ <code>root / &lt;user password&gt;</code><br />      ▪ <code>username / &lt;user password&gt;</code><br />• PostgreSQL<br />   ◇ Vulnerable version?<br />      ▪ <code>psql -V</code><br />   ◇ Can you find a config file?<br />      ▪ pgadmin.db<br />   ◇ Can you connect to psql with credentials?<br />      ▪ refer above<br />• Couchdb<br />   ◇ Any couchdb files?<br />      ▪ <code>find /var /etc /home /root /tmp /usr /opt -type d -name &quot;couchdb&quot; 2&gt;/dev/null</code><br />• Redis<br />   ◇ redis.conf anywhere?<br />      ▪ <code>find /var /etc /home /root /tmp /usr /opt -type f -name &quot;redis.conf&quot; 2&gt;/dev/null</code><br /><br /><strong><h2>## Extras</h2></strong><br />• Check for Logstash files<br />   ◇ <code>find /var /etc /home /root /tmp /usr /opt -type d -name logstash 2&gt;/dev/null</code><br />• Check for Elasticsearch files<br />   ◇ <code>find /var /etc /home /root /tmp /usr /opt -name &quot;elasticsearch.y*ml&quot; 2&gt;/dev/null</code><br />• Check Vault ssh files<br />   ◇ <code>find /etc /usr /home /root -name vault-ssh-helper.hcl 2&gt;/dev/null</code><br />• Any Kabana files?<br />   ◇ <code>find /var /etc /home /root /tmp /usr /opt -name &quot;kibana.y*ml&quot; 2&gt;/dev/null</code><br /><br /></div>
</body>
</html>
