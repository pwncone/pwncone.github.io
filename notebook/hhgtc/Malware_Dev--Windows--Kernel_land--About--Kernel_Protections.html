<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Kernel Protections</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><strong><h1># Kernel Protections</h1></strong><br />It&#39;s gotten better recently.<br /><br /><strong><h2>## PatchGuard</h2></strong><br />• <a href="https://en.wikipedia.org/wiki/Kernel_Patch_Protection">https://en.wikipedia.org/wiki/Kernel_Patch_Protection</a><br /><br />Also known as Kernel Patch Protection.<br />PatchGuard prevents patching the kernel.<br />PatchGuard only exists on x64. Kernel patching is possible on x86, which AV vendors use.<br /><br />Device drivers are expected to not modify or <em>patch</em> core system structures within the kernel.<br />PatchGuard periodically checks that protected system structures in the kernel have not been modified.<br />If a modification is detected, then Windows will initiate a bug check and shut down the system.<br />Bugcheck: <code>0x109 - CRITICAL_STRUCTURE_CORRUPTION</code><br /><br />Prohibited modifications include:<br />• Modifying system service tables<br />• Modifying the interrupt descriptor table<br />• Modifying the global descriptor table<br />• Using kernel stacks not allocated by the kernel<br />• Modifying or patching code contained within the kernel itself, or the HAL or NDIS kernel libraries<br /><br />Kernel Patch Protection only defends against device drivers modifying the kernel. <br />It does not offer any protection against one device driver patching another.<br /><br />KPP has highly obfuscated code.<br />It employs security through obscurity to hinder attempts to bypass it.<br /><br /><h3>### Defeating PatchGuard</h3><br />• <a href="https://github.com/Mattiwatti/EfiGuard">https://github.com/Mattiwatti/EfiGuard</a>btb<br /><br /><strong><h2>## DSE</h2></strong><br />• <a href="https://docs.microsoft.com/en-us/windows-hardware/drivers/install/kernel-mode-code-signing-policy--windows-vista-and-later-">https://docs.microsoft.com/en-us/windows-hardware/drivers/install/kernel-mode-code-signing-policy--windows-vista-and-later-</a><br /><br />DSE is Driver Signature Encforcement.<br />If you want to install a Kernel Driver, it has to be signed by Microsoft.<br />Legit companies with Kernel Drivers will have their driver signed by Microsoft.<br /><br />You can bypass it:<br />• <a href="https://github.com/hfiref0x/DSEFix">https://github.com/hfiref0x/DSEFix</a> - disable it<br />• <a href="https://github.com/hfiref0x/TDL">https://github.com/hfiref0x/TDL</a> - bypass<br />• <a href="https://www.unknowncheats.me/forum/anti-cheat-bypass/252685-drvmap-driver-manual-mapper-using-capcom.html">https://www.unknowncheats.me/forum/anti-cheat-bypass/252685-drvmap-driver-manual-mapper-using-capcom.html</a> - manually map your own driver using vulnerable Capcom driver<br /><br />Checking loading section for more info.<br /><br /><h2>## SMEP</h2><br />• <a href="https://www.coresecurity.com/sites/default/files/2020-06/Windows%20SMEP%20bypass%20U%20equals%20S_0.pdf">https://www.coresecurity.com/sites/default/files/2020-06/Windows%20SMEP%20bypass%20U%20equals%20S_0.pdf</a><br /><br /><h3>### Check for SMEP</h3><br />• <a href="https://www.unknowncheats.me/forum/general-programming-and-reversing/342738-smep-smap-windows-10-a.html">https://www.unknowncheats.me/forum/general-programming-and-reversing/342738-smep-smap-windows-10-a.html</a> - From usermode<br />• <a href="https://www.unknowncheats.me/forum/2502644-post4.html">https://www.unknowncheats.me/forum/2502644-post4.html</a> - Top code block</div>
</body>
</html>
