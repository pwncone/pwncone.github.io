<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Nmap</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><strong><h1># Nmap</h1></strong><br />• <a href="https://svn.nmap.org/nmap/docs/nmap.usage.txt">https://svn.nmap.org/nmap/docs/nmap.usage.txt</a> - Nmap official usage docs<br />• <a href="https://gist.github.com/rsperl/321aac3d529aa8f8c7924fd12d581b67">https://gist.github.com/rsperl/321aac3d529aa8f8c7924fd12d581b67</a> - cheat sheet<br />• <a href="https://nullsec.us/top-1-000-tcp-and-udp-ports-nmap-default/">https://nullsec.us/top-1-000-tcp-and-udp-ports-nmap-default/</a> - top 100 / 1000 ports<br /><br />Scan a network and find some ports.<br /><br /><strong><h2>## About</h2></strong><br />Nmap&#39;s quite a deep program.<br /><br /><strong><h3>### A word on traffic</h3></strong><br />A default 1000 port scan (TCP) generates ~72 KB of traffic<br />Probing all 65535 ports (TCP) generates ~4.5 MB of traffic<br />If you scanned a class C network (254 hosts) you would be sending over 1000 MB of traffic<br /><br />Considering the huge amount of data you could be sending, you should balance traffic restrictions with the need to discover additional open ports/services.<br /><br /><strong><h3>### Scan Types</h3></strong><br />Refer to the subnode for detailed info.<br /><br />• TCP SYN - <code>-sS</code> - default. sends SYN, if ACK received -&gt; nmap marks port as open<br />• TCP Connect - <code>-sT</code> - sends SYN, and fully connects if ACK received. highly likely IDS notices/server logs connection<br />• UDP - <code>-sU</code> - slow. uses ICMP error codes and correct data to enumerate ports<br />• ICMP - <code>-PE</code> - sends type 8 echo request. nobody allows pings anymore, so generally useless<br /><br /><strong><h3>### Timing Parmeters</h3></strong><br />• <a href="https://nmap.org/book/man-performance.html">https://nmap.org/book/man-performance.html</a><br />Timing parameters are used to specify how aggressively you want to scan a network.<br /><br /><strong>T0 - Paranoid</strong><br />• Scans one port at a time and waits 5 minutes between sending each probe.<br />• Used for IDS evasion.<br />• Snort detect port scans by checking the rate at which hosts receive packets and correlating it with port scanners&#39; default timings.<br />   ◇ Can sometimes be better to set the exact timing values you need rather than rely on the -T0 and -T1 values.<br /><br /><strong>T1 - Sneaky</strong><br />• Scans one port at a time and waits 15 seconds between sending each probe.<br />• Used for IDS evasion.<br /><br /><strong>T2 - Polite</strong><br />• Uses less bandwidth and target machine&#39;s resources.<br />• Scans one port at a time and watchs 0.4 seconds between probes.<br />• Slow (10x longer than T3)<br /><br /><strong>T3 - Normal</strong><br />• This is default<br /><br /><strong>T4 - Aggressive</strong><br />• Same as normal but speeds up scans<br />• Use if you&#39;re on a fast/reliable network<br /><br /><strong>T5 - Insane</strong><br />• Assumes you&#39;re on a super fast network and are willing to sacrifice accuracy for speed<br />• Too aggressive for author&#39;s taste<br /><br /><strong><h2>## Scan Styles</h2></strong><br /><strong><h3>### Me</h3></strong><br />I&#39;ve only ever played CTF, so I only know how to scan challenge boxes.<br />This is my usual approach.<br /><br /><code>mkdir nmap</code><br /><code>nmap -sC -sV -O -oN nmap/initial.txt 192.168.1.5</code> - quick version<br /><br />1. Quick scan/find all open tcp ports<br /><code>nmap -p- -T4 -oN nmap/tcp-all.txt &lt;ip&gt;</code><br /><br />2. Grep the output for the open ports<br /><code>grep ^[0-9] nmap/tcp-all.txt | cut -d &#39;/&#39; -f 1 | tr &#39;\n&#39; &#39;,&#39; | sed s/,$// &gt; nmap/tcp-openlist.txt</code><br /><br />3. Run service detection, default scripts and OS detection against the open ports<br /><code>nmap -p $(cat nmap/tcp-openlist.txt) -T4 -sV -sC -O -oN nmap/tcp-open.txt &lt;ip&gt;</code><br /><br />4. Run a vuln scan against the open ports<br /><code>nmap -p $(cat namp/tcp-openlist.txt) -T4 -sV --script vuln -oN nmap/tcp-vuln.txt &lt;ip&gt;</code> <br /><br />5. UDP scan top 1000 ports (or top 100 if it&#39;s too slow)<br /><code>nmap -sU -T4 -oN nmap/udp-top1000.txt &lt;ip&gt;</code><br /><br /><strong><h3>### IppSec</h3></strong><br />Dude runs:<br /><code>nmap -sC -sV -oA nmap/initial &lt;ip address&gt;</code><br /><em>every single time</em> and it works pretty damn well.<br /><br /><strong><h2>## Troubleshooting</h2></strong><br /><strong><h3>### Slow scan</h3></strong><br />Try changing <code>--max-retries</code> to <code>1</code> or <code>0</code><br />Default retries is 10 because Nmap wants to make sure that it&#39;s completely accurate.<br /><br /><strong><h3>### Nmap over a VPN</h3></strong><br />If you&#39;re running Nmap over a VPN, Nmap&#39;s default TCP SYN scan will fail.<br />You have to use <code>-sT</code> to run a full TCP CONNECT scan.<br /><br /><code>nmap -p- -sT -T4 10.10.10.116</code><br /><br /><strong><h3>### Testing hardened environments</h3></strong><br />• Use the <code>-Pn</code> flag (treat all hosts as online) to force scanning of each address<br />• Use a slower timing policy (such as <code>-T2</code>) <br />   ◇ because an aggressive policy might trigger SYN flood protection and cause packets to be dropped<br /><br /></div>
</body>
</html>
