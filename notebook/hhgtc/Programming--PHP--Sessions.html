<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Sessions</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><strong><h1># Sessions</h1></strong><br />Sessions persist across the entire site.<br />A session creates a temp directory on the server where registered session variables and their values get stored.<br /><code>php.ini</code>&#39;s <code>session.save_path</code> determines the where the session is saved.<br />    by default (on ubuntu), it&#39;s <code>/var/lib/php/sessions</code><br /><br />When a session is created<br />1. PHP creates a unique identifier for the session - a 32 hex numbers e.g. <code>3c7foj34c3jj973hjkop2fc937e3443</code><br />2. A <code>PHPSESSID</code> cookie is set on the client&#39;s computer<br />3. File gets created on server with sess_ID e.g. <code>sess_3c7foj34c3jj973hjkop2fc937e3443</code><br /><br />Validation is done by comparing client&#39;s submitted session ID with the ID stored in directory<br /><br /><strong><h2>## Starting a session</h2></strong><br />Create with <code>session_start()</code><br />Session variables are stored in associative array <code>$_SESSION[]</code><br /><br />Below example creates a session, then creates a &#39;<code>counter</code>&#39; variable within the session<br /><div class="codebox"><div class="codebox">&lt;?php<br />&nbsp;&nbsp;&nbsp;session_start();<br />&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;if(&nbsp;isset(&nbsp;$_SESSION[&#39;counter&#39;]&nbsp;)&nbsp;)&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$_SESSION[&#39;counter&#39;]&nbsp;+=&nbsp;1;<br />&nbsp;&nbsp;&nbsp;else&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$_SESSION[&#39;counter&#39;]&nbsp;=&nbsp;1;<br /><br />&nbsp;&nbsp;&nbsp;$msg&nbsp;=&nbsp;&quot;You&nbsp;have&nbsp;visited&nbsp;this&nbsp;page&nbsp;&quot;.&nbsp;&nbsp;$_SESSION[&#39;counter&#39;];<br />&nbsp;&nbsp;&nbsp;$msg&nbsp;.=&nbsp;&quot;in&nbsp;this&nbsp;session.&quot;;<br />?&gt;<br /><br />&lt;html&gt;<br />&nbsp;&nbsp;&nbsp;&lt;head&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;title&gt;Setting&nbsp;up&nbsp;a&nbsp;PHP&nbsp;session&lt;/title&gt;<br />&nbsp;&nbsp;&nbsp;&lt;/head&gt;<br />&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&lt;body&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;?php&nbsp;&nbsp;echo&nbsp;(&nbsp;$msg&nbsp;);&nbsp;?&gt;<br />&nbsp;&nbsp;&nbsp;&lt;/body&gt;<br /><span style="color:#000000;font-weight:400">&lt;</span>/html<span style="color:#000000;font-weight:400">&gt;</span></div></div><br /><br />The session is stored in <code>/var/lib/php/sessions</code><br />The contents of the file looks like this:<br /><div class="codebox"><div class="codebox">count|i:4;</div></div><br /><br /><strong><h2>## Destroying a PHP session</h2></strong><br />Use <code>session_destroy()</code><br />To destory a single session variable, use <code>unset()</code><br /><br /><code>session_destroy();</code><br /><code>unset($_SESSION[&#39;counter&#39;]);</code><br /><br /><strong><h2>## Auto Session</h2></strong><br />Can automatically create sessions for users that visit your site in <code>php.ini</code><br />Set <code>session.auto_start</code> to <code>1</code><br /><br /><strong><h2>## Sessions without Cookies</h2></strong><br />Sometimes users block cookies from being stored on their machine.<br />This would break PHP sessions.<br /><br />If a session gets started, the <code>SID</code> constant gets defined.<br />If no session cookie is sent by the client (they&#39;re blocking cookies), it will look like this: <code>session_name=session_id</code><br /><br />You can then submit the <code>SID</code> to the next page to continue their session<br /><div class="codebox"><div class="codebox">&lt;?php<br />&nbsp;&nbsp;&nbsp;session_start();<br />&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;if&nbsp;(isset($_SESSION[&#39;counter&#39;]))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$_SESSION[&#39;counter&#39;]&nbsp;=&nbsp;1;<br />&nbsp;&nbsp;&nbsp;}else&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$_SESSION[&#39;counter&#39;]++;<br />&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;$msg&nbsp;=&nbsp;&quot;You&nbsp;have&nbsp;visited&nbsp;this&nbsp;page&nbsp;&quot;.&nbsp;&nbsp;$_SESSION[&#39;counter&#39;];<br />&nbsp;&nbsp;&nbsp;$msg&nbsp;.=&nbsp;&quot;in&nbsp;this&nbsp;session.&quot;;<br />&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;echo&nbsp;(&nbsp;$msg&nbsp;);<br />?&gt;<br /><br />&lt;p&gt;<br />&nbsp;&nbsp;&nbsp;To&nbsp;continue&nbsp;&nbsp;click&nbsp;following&nbsp;link&nbsp;&lt;br&nbsp;/&gt;<br />&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&lt;a&nbsp;&nbsp;href&nbsp;=&nbsp;&quot;nextpage.php?&lt;?php&nbsp;echo&nbsp;htmlspecialchars(SID);&nbsp;?&gt;&quot;&gt;<br />&lt;/p</div></div><br /><br /><br /></div>
</body>
</html>
