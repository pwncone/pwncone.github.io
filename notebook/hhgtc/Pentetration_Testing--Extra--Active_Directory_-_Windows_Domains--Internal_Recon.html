<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Internal Recon</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><strong><h1># Internal Reconnaissance</h1></strong><br />Internal reconnaissance is recon that CAN ONLY BE DONE WHEN THE COMPUTER YOU&#39;RE ON IS PART OF THE DOMAIN.<br />Being inside the network/the same subnet isn&#39;t enough, your computer needs to be an authorised computer within the domain.<br /><br />I&#39;ve made both Linux and Windows checklists because both have very different ways of exploring Active Directory. <br /><br />On Linux, you enumerate quite generically with universal Active Directory info-gathering tools (ldapsearch, etc.).<br />On Windows, you can browse Active Directory from more of a Windows perspective.<br /><br /><strong><h2>## Linux Checklist</h2></strong><br />&lt;Fill in later&gt;<br /><br /><strong><h2>## Windows Checklist</h2></strong><br />Most of the commands in here are <code>PowerView</code>,<br />but interchange with the ActiveDirectory powershell module if that&#39;s all you have access to.<br /><br />Alternatively, you could skip all of this and just use BloodHound.<br /><br /><strong><h3>### Check DNS</h3></strong><br /><code>nslookup</code><br /><code>ls -d contoso.local</code> - DNS zone transfer<br /><br /><strong><h3>### Users &amp; Groups - Quick</h3></strong><br /><code>net user /domain</code><br /><code>net user bob /domain</code> - get user info<br /><code>net group /domain</code><br /><code>net group &quot;domain admins&quot; /domain</code><br /><code>net group &quot;enterprise admins&quot; /domain</code><br /><br /><strong><h3>### What domain are you currently in?</h3></strong><br />• Find current domain you&#39;re in<br />   ◇ <code>Get-NetDomain</code><br />• Find domain controller<br />   ◇ <code>Get-NetDomainController</code><br />• List all domain trusts for current domain<br />   ◇ <code>Get-NetDomainTrust</code><br />• Get group policy for current host (cmd command. can take a while to run)<br />   ◇ <code>gpresult /r</code><br />		<br /><strong><h3>### Learn about the forest you&#39;re in</h3></strong><br />• Get details about current forest<br />   ◇ <code>Get-NetForest</code><br />• List all domains in current forest (can take a while to run)<br />   ◇ <code>Get-NetForestDomain</code><br />• Map trusts of a forest (any weird ones? no results = not trusting other forests)<br />   ◇ <code>Get-NetForestTrust</code><br /><br /><strong><h3>### Get info about other domains you&#39;ve seen</h3></strong><br />   ◇ <code>Get-NetDomain -Domain umbrella.local</code><br />• Find domain controllers for other domains you&#39;ve seen<br />   ◇ <code>Get-NetDomainController -Domain umbrella.local</code><br /><br /><strong><h3>### Get a sense for how current domain is organised</h3></strong><br />• Get OUs in current domain<br />   ◇ <code>Get-NetOU -FullData</code><br />• Policies in current domain<br />   ◇ <code>Get-DomainPolicy</code><br />• Get Computers in current domain<br />   ◇ <code>Get-NetComputer</code><br />   ◇ <code>Get-NetComputer -OperatingSystem &quot;*Server*&quot;</code><br />• Group Policy - Any interesting GPOs in current domain?<br />   ◇ <code>Get-NetGPO | select displayname</code><br /><br /><strong><h3>### Find high value targets</h3></strong><br />   ◇ <code>Get-NetFileServer</code> - Look for servers that have the &#39;fileserver&#39; role installed on them<br />   ◇ <code>Get-NetGPOGroup</code> - Get GPOs which use Restricted Groups or groups.xml (no info if no Restricted Groups exist)<br /><br /><strong><h3>### Users in current domain</h3></strong><br />• Enumerate users<br />   ◇ <code>Get-NetUser | select logoncount, cn, samaccountname, description, memberof</code><br />• Check for honeypot users or high-value users/targets<br />      ▪ pwdlastset - pwd set ages ago could be honeypot user<br />      ▪ badpwdcount - real users always fat-finger their passwords<br />      ▪ logoncount - low logons = honeypot user or probably low-value target<br />   ◇ <code>Get-NetUser | select samaccountname, badpwdcount, logoncount, pwdlastset</code><br />• Who&#39;s currently logged in on REMOTE machine? (need Admin rights on target)<br />   ◇ <code>Get-NetLoggedon -ComputerName &lt;host name&gt;</code><br />• Who last logged in to a specific machine? (need Admin rights &amp; remote registry on target)<br />   ◇ <code>Get-LastLoggedon -ComputerName &lt;host name&gt;</code><br />       <br /><strong><h3>### Groups in current domain</h3></strong><br />   ◇ <code>Get-NetGroup</code><br />   ◇ <code>Get-NetGroup *admin*</code> - Find all groups with &quot;admin&quot; in the group name<br />• Find members of interesting groups<br />   ◇ <code>Get-NetGroupMember -GroupName &quot;Domain Admins&quot;</code><br /><br /><strong><h3>### Shares &amp; files in current domain</h3></strong><br />• Query domain controller to find who&#39;s currently logged on to which PCs<br />   ◇ <code>NetSess.exe dc1.contoso.local</code><br /><br />• Find shares on hosts in current domain<br />   ◇ <code>Invoke-ShareFinder -Verbose</code><br />   ◇ <code>Invoke-ShareFinder -Verbose -ExcludeStandard -CheckShareAccess -NoPing -Threads 20 | Out-file shares.txt</code><br />• Find sensitive files on hosts in current domain<br />   ◇ <code>Invoke-FileFinder -Verbose</code><br />		<br /><strong><h3>### Access Control</h3></strong><br />• Search for Access Control Entries where we have modify permissions<br />   ◇ <code>Invoke-ACLScanner -ResolveGUIDs</code><br />		<br /><strong><h3>### Noisy lateral-movement hunting</h3></strong><br />• Find all machines on the current domain where the current user has local admin access<br />   ◇ Uses RPC and SMB ports to check Administrator access (which might be blocked)<br />   ◇ <code>Find-LocalAdminAccess -Verbose</code><br />• Find all local admins on all machines<br />   ◇ Needs Administrator privs to run on non-DC machines<br />   ◇ <code>Invoke-EnumerateLocalAdmin -Verbose</code><br />• Find computers where a domain admin or specified user/group currently has a session<br />   ◇ LOOK FOR A MACHINE WHERE A Domain Admin token/session is available.<br />   ◇ We can extract credentials of the Domain Admin - TGPs, NTLM, AES keys, etc. <br />   <br />   ◇ <code>Invoke-UserHunter -CheckAccess</code><br />   ◇ <code>Invoke-UserHunter -GroupName &quot;RDPUsers&quot;</code><br />   ◇ <code>Invoke-UserHunter -Stealth</code> - stealth version that only searches for high-value targets (admins etc.)<br /><br /><br /></div>
</body>
</html>
