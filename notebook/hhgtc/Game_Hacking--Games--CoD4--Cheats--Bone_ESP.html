<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Bone ESP</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><strong><h1># Bone ESP</h1></strong><br />Bones are tags in the CoD engine (there are tags for things other than bones too).<br />Each tag has a name and a corresponding number.<br />e.g. <code>j_head</code> is the name of the head bone, and its tag ID is <code>456</code><br /><br />All tags are 2 bytes long - a <code>short</code> or <code>WORD</code> data type<br /><br />There&#39;s a tag struct in the game which stores the tag IDs of a lot of the tags, BUT NOT ALL.<br />Therefore, I&#39;d recommend against using it.<br /><a href="https://www.unknowncheats.me/wiki/Register_Tags_Struct_CoD4">https://www.unknowncheats.me/wiki/Register_Tags_Struct_CoD4</a><br /><br /><strong>Links</strong><br />• <a href="https://www.unknowncheats.me/forum/call-of-duty-4-modern-warfare/56687-getting-bones.html">https://www.unknowncheats.me/forum/call-of-duty-4-modern-warfare/56687-getting-bones.html</a> - Example of getting the bones and drawing bone ESP. Missing the GetEntityTag function though which makes the code a little useless<br />• <a href="https://www.unknowncheats.me/wiki/Bone_ESP_CoD5">https://www.unknowncheats.me/wiki/Bone_ESP_CoD5</a> - Same as above just slightly different<br />• <a href="https://www.unknowncheats.me/forum/call-of-duty-4-modern-warfare/57492-bone-names.html">https://www.unknowncheats.me/forum/call-of-duty-4-modern-warfare/57492-bone-names.html</a> - More bone names. Not very useful<br />• <a href="https://www.unknowncheats.me/forum/call-duty-4-modern-warfare/67459-cod4-esp-yet-again-d.html">https://www.unknowncheats.me/forum/call-duty-4-modern-warfare/67459-cod4-esp-yet-again-d.html</a> - Example bone ESP<br /><br /><strong><h2>## Grabbing the bone tag</h2></strong><br />Every bone in the game has the same name<br />e.g. <code>j_helmet</code>, <code>j_head</code>, <code>neck</code>, <code>j_clavicle_ri</code>, etc.<br /><br />However, the bone tags (bone number) is different for each model in the game.<br />Therefore, you will have to use the bone name to grab the bone tag.<br />To do this, you can use the game&#39;s internal function <code>RegisterTag</code><br /><br />(refer to Internal Functions subnode)<br /><br /><strong><h2>## Grabbing the bone position</h2></strong><br />With the bone tag, you can grab the bone&#39;s position.<br />For this you can use another internal function: <code>GetTagPos</code><br /><br />(refer to the Internal Functions subnode)<br /><br /><strong><h2>## Draw Bones</h2></strong><br />I store the bone names for each limb in an array, and create an array that stores all of the limbs.<br />I then loop through the array, grab the position of j_helmet and j_head, and then draw line between them.<br />Repeat this for all bones.<br /><br /><div class="codebox"><div class="codebox">//-----------------------------------------------------------------------------<br />//&nbsp;Bones<br />/*<br />The&nbsp;bone&nbsp;names&nbsp;remain&nbsp;consistent&nbsp;(j_helmet,&nbsp;j_head,&nbsp;etc.)<br />but&nbsp;the&nbsp;bone&nbsp;tags&nbsp;are&nbsp;different&nbsp;for&nbsp;every&nbsp;model&nbsp;in&nbsp;the&nbsp;game.<br />Therefore,&nbsp;it&#39;s&nbsp;best&nbsp;to&nbsp;use&nbsp;the&nbsp;bone&nbsp;names&nbsp;and&nbsp;to&nbsp;grab&nbsp;the&nbsp;bone&nbsp;tag.<br />There&nbsp;are&nbsp;some&nbsp;bone&nbsp;tags&nbsp;that&nbsp;stay&nbsp;consistent&nbsp;e.g.&nbsp;j_head&nbsp;=&nbsp;456<br />*/<br />//-----------------------------------------------------------------------------<br />//&nbsp;Bones&nbsp;(that&nbsp;are&nbsp;consistent&nbsp;between&nbsp;enemy&nbsp;models)<br />short&nbsp;j_head_tag&nbsp;=&nbsp;456;<br /><br />//&nbsp;Limbs<br />char*&nbsp;head_to_pelvis[]&nbsp;=&nbsp;{&nbsp;&quot;j_helmet&quot;,&nbsp;&quot;j_head&quot;,&nbsp;&quot;neck&quot;,&nbsp;&quot;j_spineupper&quot;,&nbsp;&quot;j_spinelower&quot;,&nbsp;&quot;pelvis&quot;&nbsp;};<br />char*&nbsp;right_arm[]&nbsp;=&nbsp;{&nbsp;&quot;neck&quot;,&nbsp;&quot;j_clavicle_ri&quot;,&nbsp;&quot;j_shoulder_ri&quot;,&nbsp;&quot;j_elbow_ri&quot;,&nbsp;&quot;j_wrist_ri&quot;&nbsp;};<br />char*&nbsp;left_arm[]&nbsp;=&nbsp;{&nbsp;&quot;neck&quot;,&nbsp;&quot;j_clavicle_le&quot;,&nbsp;&quot;j_shoulder_le&quot;,&nbsp;&quot;j_elbow_le&quot;,&nbsp;&quot;j_wrist_le&quot;&nbsp;};<br />char*&nbsp;right_leg[]&nbsp;=&nbsp;{&nbsp;&quot;pelvis&quot;,&nbsp;&quot;j_knee_ri&quot;,&nbsp;&quot;j_ankle_ri&quot;&nbsp;};<br />char*&nbsp;left_leg[]&nbsp;=&nbsp;{&nbsp;&quot;pelvis&quot;,&nbsp;&quot;j_knee_le&quot;,&nbsp;&quot;j_ankle_le&quot;&nbsp;};<br /><br />//&nbsp;Array&nbsp;of&nbsp;limbs<br />char**&nbsp;limbs[5]&nbsp;=&nbsp;{&nbsp;head_to_pelvis,&nbsp;right_arm,&nbsp;left_arm,&nbsp;right_leg,&nbsp;left_leg&nbsp;};<br />//&nbsp;Number&nbsp;of&nbsp;bones&nbsp;in&nbsp;each&nbsp;limb&nbsp;array&nbsp;<br />//&nbsp;[0]&nbsp;is&nbsp;head_to_pelvis,&nbsp;[1]&nbsp;is&nbsp;right_arm,&nbsp;etc.<br />int&nbsp;bones_in_limbs[5]&nbsp;=&nbsp;{&nbsp;6,&nbsp;5,&nbsp;5,&nbsp;3,&nbsp;3&nbsp;};<br /><br />//-----------------------------------------------------------------------------<br />//&nbsp;In-game&nbsp;functions&nbsp;(addresses&nbsp;for&nbsp;CoD4&nbsp;1.7.568)<br />//-----------------------------------------------------------------------------<br />unsigned&nbsp;int&nbsp;RegisterTag_addr&nbsp;=&nbsp;0x00518290;<br />unsigned&nbsp;int&nbsp;GetTagPos_addr&nbsp;=&nbsp;0x004024B0;<br /><br />/*<br />Registers&nbsp;a&nbsp;tag&nbsp;on&nbsp;an&nbsp;entity&nbsp;(if&nbsp;not&nbsp;already)&nbsp;and&nbsp;returns&nbsp;the&nbsp;tag&nbsp;number.<br />Mainly&nbsp;used&nbsp;for&nbsp;grabbing&nbsp;the&nbsp;tag&nbsp;number.<br />Code&nbsp;from&nbsp;Rave.waveLight&#39;s&nbsp;CoD4&nbsp;base.&nbsp;How&nbsp;it&nbsp;returns&nbsp;a&nbsp;value&nbsp;I&nbsp;don&#39;t&nbsp;know&nbsp;:shrug:<br />*/<br />WORD&nbsp;Intrnl_RegisterTag(char*&nbsp;tag_name,&nbsp;int&nbsp;entity_type,&nbsp;size_t&nbsp;tag_name_len)<br />{<br />	__asm<br />	{<br />		push&nbsp;tag_name_len;<br />		push&nbsp;entity_type;<br />		push&nbsp;tag_name;<br />		mov&nbsp;eax,&nbsp;RegisterTag_addr;<br />		call&nbsp;eax;<br />		add&nbsp;esp,&nbsp;0xC;<br />	}<br />}<br /><br />/*<br />Grabs&nbsp;the&nbsp;bone&nbsp;position&nbsp;of&nbsp;a&nbsp;tag&nbsp;on&nbsp;an&nbsp;entity.<br />From&nbsp;Rave.waveLight&#39;s&nbsp;CoD4&nbsp;base&nbsp;on&nbsp;UnknownCheats.<br />*/<br />void&nbsp;Intrnl_GetTagPos(short&nbsp;tag,&nbsp;centity_t*&nbsp;entity,&nbsp;OUT&nbsp;vec3*&nbsp;position)<br />{<br />	__asm<br />	{<br />		push	position;<br />		movzx	esi,&nbsp;tag;<br />		mov	ecx,&nbsp;entity;<br />		movzx	eax,&nbsp;byte&nbsp;ptr[ecx&nbsp;+&nbsp;4];<br />		mov	edi,&nbsp;GetTagPos_addr;<br />		call	edi;<br />		add	esp,&nbsp;4;<br />	}<br /><br />	return;<br />}<br /><br />//-----------------------------------------------------------------------------<br />//&nbsp;In-game&nbsp;functions&nbsp;(addresses&nbsp;for&nbsp;CoD4&nbsp;1.7.568)<br />//-----------------------------------------------------------------------------<br />void&nbsp;DrawBoneESP(int&nbsp;index)<br /><span style="color:#000000;font-weight:400">{</span><br />	//&nbsp;Grab&nbsp;entity&nbsp;info<br />	centity_t*&nbsp;entity&nbsp;=&nbsp;GetEntityByIndex(index);<br />	clientInfo_t*&nbsp;client&nbsp;=&nbsp;GetClientInfoByIndex(index);<br /><br />	if&nbsp;(IsEntityValidEnemy(entity,&nbsp;client)&nbsp;==&nbsp;true)<br />	{<br />		//&nbsp;Loop&nbsp;through&nbsp;limbs&nbsp;in&nbsp;body(right&nbsp;arm,&nbsp;left&nbsp;arm,&nbsp;etc.)<br />		int&nbsp;num_of_limbs&nbsp;=&nbsp;sizeof(limbs)&nbsp;/&nbsp;sizeof(limbs[0]);<br />		for&nbsp;(int&nbsp;i&nbsp;=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;num_of_limbs;&nbsp;i++)<br />		{<br />			//&nbsp;Get&nbsp;number&nbsp;of&nbsp;bones&nbsp;in&nbsp;limb<br />			//&nbsp;Not&nbsp;possible&nbsp;to&nbsp;get&nbsp;size&nbsp;of&nbsp;char*&nbsp;array&nbsp;in&nbsp;char**&nbsp;array,&nbsp;so&nbsp;using&nbsp;a&nbsp;separate&nbsp;array&nbsp;to&nbsp;store&nbsp;the&nbsp;number&nbsp;of&nbsp;bones&nbsp;in&nbsp;each&nbsp;array<br />			int&nbsp;num_of_bones&nbsp;=&nbsp;bones_in_limbs[i];<br /><br />			//&nbsp;Loop&nbsp;through&nbsp;bones&nbsp;in&nbsp;limb&nbsp;(clavicle,&nbsp;shoulder,&nbsp;elbow,&nbsp;wrist,&nbsp;etc.)&nbsp;and&nbsp;draw&nbsp;them<br />			//&nbsp;(bone_count&nbsp;-&nbsp;1)&nbsp;because&nbsp;we&#39;re&nbsp;using&nbsp;2&nbsp;bones&nbsp;at&nbsp;once,&nbsp;meaning&nbsp;we&nbsp;can&nbsp;loop&nbsp;1&nbsp;less&nbsp;time<br />			for&nbsp;(int&nbsp;j&nbsp;=&nbsp;0;&nbsp;j&nbsp;&lt;&nbsp;(num_of_bones&nbsp;-&nbsp;1);&nbsp;j++)<br />			{<br />				//&nbsp;Get&nbsp;the&nbsp;bone&nbsp;names&nbsp;from&nbsp;char&nbsp;array&nbsp;&amp;&nbsp;get&nbsp;tags&nbsp;of&nbsp;bones<br />				char*&nbsp;bone1_name&nbsp;=&nbsp;limbs[i][j];<br />				char*&nbsp;bone2_name&nbsp;=&nbsp;limbs[i][j&nbsp;+&nbsp;1];<br />				short&nbsp;bone1&nbsp;=&nbsp;Intrnl_RegisterTag(bone1_name,&nbsp;1,&nbsp;strlen(bone1_name)&nbsp;+&nbsp;1);<br />				short&nbsp;bone2&nbsp;=&nbsp;Intrnl_RegisterTag(bone2_name,&nbsp;1,&nbsp;strlen(bone2_name)&nbsp;+&nbsp;1);<br /><br />				//&nbsp;Get&nbsp;3d&nbsp;positions&nbsp;of&nbsp;the&nbsp;two&nbsp;bones<br />				vec3&nbsp;bone1_pos3d,&nbsp;bone2_pos3d;<br />				Intrnl_GetTagPos(bone1,&nbsp;entity,&nbsp;&amp;bone1_pos3d);<br />				Intrnl_GetTagPos(bone2,&nbsp;entity,&nbsp;&amp;bone2_pos3d);<br /><br />				//&nbsp;Get&nbsp;2d&nbsp;positions&nbsp;of&nbsp;the&nbsp;two&nbsp;bones<br />				vec2&nbsp;bone1_pos2d,&nbsp;bone2_pos2d;<br />				WorldToScreen(bone1_pos3d,&nbsp;&amp;bone1_pos2d,&nbsp;refdef);<br />				WorldToScreen(bone2_pos3d,&nbsp;&amp;bone2_pos2d,&nbsp;refdef);<br /><br />				//&nbsp;Draw&nbsp;the&nbsp;bone<br />				DrawLine(bone1_pos2d,&nbsp;bone2_pos2d,&nbsp;1.0f,&nbsp;d3d_white);<br />			}<br />		}<br />	}<br /><br />	return;<br /><span style="color:#000000;font-weight:400">}</span></div></div></div>
</body>
</html>
