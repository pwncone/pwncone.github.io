<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Find Direct3d Device</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><strong><h1># Find the Direct3d Device</h1></strong><br /><br /><strong><h2>## Manually</h2></strong><br />• <a href="https://guidedhacking.com/threads/how-to-find-pdevice-in-directx-9-games.10383/">https://guidedhacking.com/threads/how-to-find-pdevice-in-directx-9-games.10383/</a><br /><br /><strong><h2>## Create a dummy device</h2></strong><br />• Part 3 Chapter 8 <em>Finding the Direct3D Device</em> from <em>Game Hacking</em> by Nick Cano<br />• <a href="https://guidedhacking.com/threads/get-direct3d9-and-direct3d11-devices-dummy-device-method.11867/">https://guidedhacking.com/threads/get-direct3d9-and-direct3d11-devices-dummy-device-method.11867/</a><br />• <a href="https://bananamafia.dev/post/d3dhook/">https://bananamafia.dev/post/d3dhook/</a><br />• <a href="https://www.youtube.com/watch?v=7QDkceeykbI">https://www.youtube.com/watch?v=7QDkceeykbI</a><br /><br />Create a dummy Direct3d device to grab the game&#39;s Direct3d device VTable.<br />EndScene is at vtable[42];<br />Hook EndScene and grab the game&#39;s Direct3d device at the start of the hook.<br /><br /><div class="codebox"><div class="codebox">#include&nbsp;&lt;stdio.h&gt;<br />#include&nbsp;&lt;Windows.h&gt;<br />#include&nbsp;&lt;d3d9.h&gt;<br /><br />#pragma&nbsp;comment(lib,&nbsp;&quot;d3d9.lib&quot;)<br /><br />void*&nbsp;d3dDevice_VTable[119]&nbsp;=&nbsp;{&nbsp;0&nbsp;};<br />LPDIRECT3DDEVICE9&nbsp;my_d3dDevice&nbsp;=&nbsp;NULL;<br /><br />/*<br />Create&nbsp;our&nbsp;own&nbsp;Direct3d9&nbsp;device<br />and&nbsp;use&nbsp;it&nbsp;to&nbsp;grab&nbsp;the&nbsp;address&nbsp;of&nbsp;the&nbsp;game&#39;s&nbsp;Direct3d9&nbsp;device&nbsp;VTable.<br />*/<br />BOOL&nbsp;GetD3D9DeviceVTable()<br />{<br />	//&nbsp;Create&nbsp;our&nbsp;own&nbsp;Direct3d&nbsp;interface<br />	IDirect3D9*&nbsp;d3d&nbsp;=&nbsp;Direct3DCreate9(D3D_SDK_VERSION);<br />	HWND&nbsp;h_gamewindow&nbsp;=&nbsp;FindWindowA(NULL,&nbsp;&quot;Counter-Strike:&nbsp;Global&nbsp;Offensive&quot;);<br />	D3DPRESENT_PARAMETERS&nbsp;d3dpp&nbsp;=&nbsp;{&nbsp;0&nbsp;};<br />	d3dpp.Windowed&nbsp;=&nbsp;FALSE;<br />	d3dpp.SwapEffect&nbsp;=&nbsp;D3DSWAPEFFECT_DISCARD;<br />	d3dpp.hDeviceWindow&nbsp;=&nbsp;h_gamewindow;<br /><br />	//&nbsp;Create&nbsp;our&nbsp;own&nbsp;Direct3d&nbsp;device&nbsp;<br />	HRESULT&nbsp;hres&nbsp;=&nbsp;0;<br />	IDirect3DDevice9*&nbsp;d3d_dummy_device&nbsp;=&nbsp;NULL;<br />	hres&nbsp;=&nbsp;IDirect3D9_CreateDevice(d3d,&nbsp;D3DADAPTER_DEFAULT,&nbsp;D3DDEVTYPE_HAL,&nbsp;d3dpp.hDeviceWindow,&nbsp;D3DCREATE_SOFTWARE_VERTEXPROCESSING,&nbsp;&amp;d3dpp,&nbsp;&amp;d3d_dummy_device);<br />	//&nbsp;If&nbsp;device&nbsp;creation&nbsp;failed,&nbsp;try&nbsp;again&nbsp;in&nbsp;the&nbsp;opposite&nbsp;Windowed&nbsp;mode&nbsp;(fullscreen&nbsp;/&nbsp;windowed)<br />	if&nbsp;(hres&nbsp;!=&nbsp;S_OK)<br />	{<br />		printf(&quot;[-]&nbsp;Failed&nbsp;to&nbsp;create&nbsp;dummy&nbsp;D3D&nbsp;device.&nbsp;Trying&nbsp;again&nbsp;in&nbsp;Windowed&nbsp;mode&nbsp;\n&quot;);<br />		d3dpp.Windowed&nbsp;=&nbsp;!d3dpp.Windowed;<br />		hres&nbsp;=&nbsp;IDirect3D9_CreateDevice(d3d,&nbsp;D3DADAPTER_DEFAULT,&nbsp;D3DDEVTYPE_HAL,&nbsp;d3dpp.hDeviceWindow,&nbsp;D3DCREATE_SOFTWARE_VERTEXPROCESSING,&nbsp;&amp;d3dpp,&nbsp;&amp;d3d_dummy_device);<br />		if&nbsp;(hres&nbsp;!=&nbsp;S_OK)<br />		{<br />			IDirect3D9_Release(d3d);<br />			printf(&quot;[-]&nbsp;Failed&nbsp;to&nbsp;create&nbsp;dummy&nbsp;D3D&nbsp;device&nbsp;\n&quot;);<br />			return&nbsp;FALSE;<br />		}<br />	}<br /><br />	/*<br />	Grab&nbsp;the&nbsp;address&nbsp;of&nbsp;the&nbsp;game&#39;s&nbsp;Direct3d&nbsp;device&nbsp;VTable&nbsp;using&nbsp;our&nbsp;dummy&nbsp;device&nbsp;-&nbsp;`*(void***)d3d_dummy_device`<br />	and&nbsp;copy&nbsp;the&nbsp;entire&nbsp;contents&nbsp;of&nbsp;the&nbsp;VTable&nbsp;into&nbsp;our&nbsp;own&nbsp;variable.<br />	At&nbsp;vtable[42]&nbsp;is&nbsp;the&nbsp;address&nbsp;of&nbsp;EndScene().<br />	*/<br />	memcpy(d3dDevice_VTable,&nbsp;*(void***)d3d_dummy_device,&nbsp;sizeof(d3dDevice_VTable));<br />	printf(&quot;[*]&nbsp;EndScene&nbsp;@&nbsp;0x%p&nbsp;\n&quot;,&nbsp;d3dDevice_VTable[42]);<br /><br />	//&nbsp;Destroy&nbsp;the&nbsp;d3d&nbsp;interface&nbsp;and&nbsp;device.&nbsp;We&nbsp;don&#39;t&nbsp;need&nbsp;it&nbsp;anymore<br />	IDirect3D9_Release(d3d_dummy_device);<br />	IDirect3D9_Release(d3d);<br /><br />	return&nbsp;TRUE;<br />}<br /><br />HRESULT&nbsp;WINAPI&nbsp;hooked_EndScene(LPDIRECT3DDEVICE9&nbsp;orig_d3dDevice)<br /><span style="color:#000000;font-weight:400">{</span><br />	/*<br />	Save&nbsp;the&nbsp;game&#39;s&nbsp;D3D&nbsp;device&nbsp;in&nbsp;our&nbsp;own&nbsp;variable<br />	so&nbsp;that&nbsp;we&nbsp;can&nbsp;use&nbsp;it&nbsp;to&nbsp;draw&nbsp;stuff.<br />	*/<br />	if&nbsp;(my_d3dDevice&nbsp;==&nbsp;NULL)<br />	{<br />		my_d3dDevice&nbsp;=&nbsp;orig_d3dDevice;<br />		printf(&quot;[*]&nbsp;Direct3d&nbsp;device&nbsp;@&nbsp;0x%p&nbsp;\n&quot;,&nbsp;my_d3dDevice);<br />	}<br /><br />	return&nbsp;orig_EndScene(my_d3dDevice);<br /><span style="color:#000000;font-weight:400">}</span></div></div></div>
</body>
</html>
