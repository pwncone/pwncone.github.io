<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Exception Hooking</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><strong><h1># Exception Hooking</h1></strong><br />• <a href="https://guidedhacking.com/threads/veh-hooking-aka-pageguard-hooking-an-in-depth-look.7164/">https://guidedhacking.com/threads/veh-hooking-aka-pageguard-hooking-an-in-depth-look.7164/</a><br />• <a href="https://medium.com/@fsx30/vectored-exception-handling-hooking-via-forced-exception-f888754549c6">https://medium.com/@fsx30/vectored-exception-handling-hooking-via-forced-exception-f888754549c6</a><br /><br />This also gets referred to VEH Hooking.<br />VEH stands for Vectored Exception Handler.<br />VEH hooking is where you create a custom exception handler to handle exceptions (errors in the program), cause an error near or at the address where you want to hook, and use your custom handler to redirect execution flow to your hook code.<br /><br />The variety in this technique is in how you trigger an exception, <br />and there are multiple ways to do it.<br /><br /><strong><h2>## int3 - Software Breakpoint</h2></strong><br />int3 - <code>\xCC</code> - is a software breakpoint.<br />Inserting an int3 instruction at the address you want to hook will cause an exception.<br />e.g. at the start address of <code>MessageBoxA</code><br /><br />You can handle this exception with your custom exception handler and pass execution to your hook code.<br /><br />Because you&#39;re modifying bytes (and thus the .text section of the PE), this method is easily detected just like hotpatch hooking and inline hooking (because the .text section in memory is different to the one on disk).<br /><br /><strong><h2>## Set Hardware Breakpoint in EFLAGS register for a Thread</h2></strong><br />Refer to the <strong>- HWBP Hooking -</strong> section on this thread:<br /><a href="http://www.rohitab.com/discuss/topic/41855-tutorial-the-different-ways-of-hooking/">http://www.rohitab.com/discuss/topic/41855-tutorial-the-different-ways-of-hooking/</a><br /><br /><strong><h2>## PAGE_NOACCESS</h2></strong><br />Very similar to PAGE_GUARD (check subnode).<br />Causes a <code>STATUS_ACCESS_VIOLATION</code> exception which you can catch and use to redirect to your hook code.<br /><a href="https://docs.microsoft.com/en-us/windows/win32/memory/memory-protection-constants">https://docs.microsoft.com/en-us/windows/win32/memory/memory-protection-constants</a></div>
</body>
</html>
