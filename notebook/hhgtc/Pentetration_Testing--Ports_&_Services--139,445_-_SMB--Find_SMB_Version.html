<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Find SMB Version</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><strong><h1># Find SMB Version</h1></strong><br />Getting the version number can be a little unreliable, use multiple tools to makre sure you&#39;ve got the right version.<br />Make sure to searchsploit the version number you find.<br /><br /><strong><h2>## Nmap</h2></strong><br /><code>nmap -sV -p 139 --script=smb-os-discovery 10.11.1.22</code><br />• If SMB is 3.x and higher, Nmap will report the version number<br />• If Nmap <em>doesn&#39;t</em> report the version number, then SMB is verison 2.2.x and lower<br /><br /><strong><h2>## Metasploit</h2></strong><br />A good way to get the samba version is using metasploit:<br /><code>use auxiliary/scanner/smb/smb_version</code><br /><br /><strong><h2>## smbver.sh</h2></strong><br />ONLY WORKS FOR FINDING LINUX SMB VERSION<br />Written by <code>rewardone</code> from PWK forums.<br />Found here - <a href="https://0xdf.gitlab.io/2018/12/02/pwk-notes-smb-enumeration-checklist-update1.html">https://0xdf.gitlab.io/2018/12/02/pwk-notes-smb-enumeration-checklist-update1.html</a><br /><div class="codebox"><div class="codebox">#!/bin/sh<br />#Author:&nbsp;rewardone<br />#Description:<br />#&nbsp;Requires&nbsp;root&nbsp;or&nbsp;enough&nbsp;permissions&nbsp;to&nbsp;use&nbsp;tcpdump<br />#&nbsp;Will&nbsp;listen&nbsp;for&nbsp;the&nbsp;first&nbsp;7&nbsp;packets&nbsp;of&nbsp;a&nbsp;null&nbsp;login<br />#&nbsp;and&nbsp;grab&nbsp;the&nbsp;SMB&nbsp;Version<br />#Notes:<br />#&nbsp;Will&nbsp;sometimes&nbsp;not&nbsp;capture&nbsp;or&nbsp;will&nbsp;print&nbsp;multiple<br />#&nbsp;lines.&nbsp;May&nbsp;need&nbsp;to&nbsp;run&nbsp;a&nbsp;second&nbsp;time&nbsp;for&nbsp;success.<br />if&nbsp;[&nbsp;-z&nbsp;$1&nbsp;];&nbsp;then&nbsp;echo&nbsp;&quot;Usage:&nbsp;./smbver.sh&nbsp;RHOST&nbsp;{RPORT}&quot;&nbsp;&amp;&amp;&nbsp;exit;&nbsp;else&nbsp;rhost=$1;&nbsp;fi<br />if&nbsp;[&nbsp;!&nbsp;-z&nbsp;$2&nbsp;];&nbsp;then&nbsp;rport=$2;&nbsp;else&nbsp;rport=139;&nbsp;fi<br />tcpdump&nbsp;-s0&nbsp;-n&nbsp;-i&nbsp;tap0&nbsp;src&nbsp;$rhost&nbsp;and&nbsp;port&nbsp;$rport&nbsp;-A&nbsp;-c&nbsp;7&nbsp;2&gt;/dev/null&nbsp;|&nbsp;grep&nbsp;-i&nbsp;&quot;samba\|s.a.m&quot;&nbsp;|&nbsp;tr&nbsp;-d&nbsp;&#39;.&#39;&nbsp;|&nbsp;grep&nbsp;-oP&nbsp;&#39;UnixSamba.*[0-9a-z]&#39;&nbsp;|&nbsp;tr&nbsp;-d&nbsp;&#39;\n&#39;&nbsp;&amp;&nbsp;echo&nbsp;-n&nbsp;&quot;$rhost:&nbsp;&quot;&nbsp;&amp;<br />echo&nbsp;&quot;exit&quot;&nbsp;|&nbsp;smbclient&nbsp;-L&nbsp;$rhost&nbsp;1&gt;/dev/null&nbsp;2&gt;/dev/null<br />sleep&nbsp;0.5&nbsp;&amp;&amp;&nbsp;echo&nbsp;&quot;&quot;</div></div><br /><br /><strong><h2>## samba_version.py</h2></strong><br />Does the same as above I think.<br /><a href="https://github.com/amitn322/smb-version">https://github.com/amitn322/smb-version</a><br /><br /><strong><h2>## Capture Packets</h2></strong><br />This is the manual way of finding the samba version<br />• Open wireshark, listen on interface<br />• Connect to smb share/send data to it<br />• View packet response and check for samba version in packet<br />   ◇ (this is what most scripts do, like the ones above)</div>
</body>
</html>
