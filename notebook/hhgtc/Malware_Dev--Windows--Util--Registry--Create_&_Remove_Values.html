<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Create & Remove Values</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><strong><h1># Create &amp; Remove Registry Values</h1></strong><br />Keys are the path - <code>&quot;Software\\Microsoft\\Windows\\CurrentVersion\\Run&quot;</code><br />Values are the entries (in the picture below - <code>(Default)</code> and <code>OneDrive</code>)<br /><a href=""><img src="images/1578-1.png" alt="images/1578-1.png" /></a><br /><br /><strong><h2>## Create Value</h2></strong><br /><div class="codebox"><div class="codebox">int&nbsp;InstallRunPersistence(void)<br /><span style="color:#000000;font-weight:400">{</span><br />	BOOL&nbsp;okay&nbsp;=&nbsp;TRUE;<br />	LSTATUS&nbsp;lstat_ret&nbsp;=&nbsp;0;<br />	HKEY&nbsp;h_key&nbsp;=&nbsp;NULL;<br />	char&nbsp;exe_path[MAX_PATH]&nbsp;=&nbsp;{&nbsp;0&nbsp;};<br /><br />	//&nbsp;get&nbsp;path&nbsp;to&nbsp;current&nbsp;exe<br />	GetModuleFileNameA(NULL,&nbsp;exe_path,&nbsp;MAX_PATH);<br /><br />	//&nbsp;create&nbsp;key<br />	lstat_ret&nbsp;=&nbsp;RegCreateKeyA(HKEY_CURRENT_USER,&nbsp;&quot;Software\\Microsoft\\Windows\\CurrentVersion\\Run&quot;,&nbsp;&amp;h_key);<br />	if&nbsp;(lstat_ret&nbsp;!=&nbsp;ERROR_SUCCESS)<br />		goto&nbsp;cleanup;<br /><br />	//&nbsp;set&nbsp;Run&nbsp;key<br />	lstat_ret&nbsp;=&nbsp;RegSetValueExA(h_key,&nbsp;&quot;persist&quot;,&nbsp;0,&nbsp;REG_SZ,&nbsp;(BYTE*)exe_path,&nbsp;sizeof(exe_path));<br />	if&nbsp;(lstat_ret&nbsp;!=&nbsp;ERROR_SUCCESS)<br />		goto&nbsp;cleanup;<br /><br />cleanup:<br />	if&nbsp;(h_key)&nbsp;RegCloseKey(h_key);<br /><br />	return&nbsp;lstat_ret;<br /><span style="color:#000000;font-weight:400">}</span></div></div><br /><br /><strong><h2>## Remove Value</h2></strong><br /><div class="codebox"><div class="codebox">int&nbsp;RemoveRunPersistence(void)<br /><span style="color:#000000;font-weight:400">{</span><br />	BOOL&nbsp;okay&nbsp;=&nbsp;TRUE;<br />	LSTATUS&nbsp;lstat_ret&nbsp;=&nbsp;0;<br />	HKEY&nbsp;h_key&nbsp;=&nbsp;NULL;<br /><br />	//&nbsp;open&nbsp;key&nbsp;(KEY_SET_VALUE&nbsp;perms&nbsp;needed&nbsp;for&nbsp;deletion)<br />	lstat_ret&nbsp;=&nbsp;RegOpenKeyExA(HKEY_CURRENT_USER,&nbsp;&quot;Software\\Microsoft\\Windows\\CurrentVersion\\Run&quot;,&nbsp;0,&nbsp;KEY_SET_VALUE,&nbsp;&amp;h_key);<br />	if&nbsp;(lstat_ret&nbsp;!=&nbsp;ERROR_SUCCESS)<br />		goto&nbsp;cleanup;<br /><br />	//&nbsp;delete&nbsp;&quot;persist&quot;&nbsp;key<br />	lstat_ret&nbsp;=&nbsp;RegDeleteValueA(h_key,&nbsp;&quot;persist&quot;);<br />	if&nbsp;(lstat_ret&nbsp;!=&nbsp;ERROR_SUCCESS)<br />		goto&nbsp;cleanup;<br /><br />cleanup:<br />	if&nbsp;(h_key)&nbsp;RegCloseKey(h_key);<br /><br />	return&nbsp;lstat_ret;<br /><span style="color:#000000;font-weight:400">}</span></div></div></div>
</body>
</html>
