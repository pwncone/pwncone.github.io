<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>PowerView</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><strong><h1># Internal Recon - of the Domain - with PowerView</h1></strong><br /><br /><strong>General domain Info</strong><br /><code>Get-NetDomain</code> - get current domain<br /><code>Get-NetDomain -Domain umbrella.local</code> - get object of another domain<br /><code>Get-DomainSID</code> - get domain SID for the current domain<br /><br /><strong>Find Domain Controller</strong><br /><code>Get-NetDomainController</code> - get domain controllers for current domain<br /><code>Get-NetDomainController -Domain moneycorp.local</code> - get domain controllers for another domain<br /><br /><strong>Enumerate Organisation Units</strong><br /><code>Get-NetOU</code> - get OUs in a domain<br /><code>Get-NetOU -FullData</code><br /><br />Get GPO applied on an OU (read GPOname from gplink attribute from Get-NetOU output)<br /><code>Get-NetGPO -GPOname &quot;{AB306569-220D-43FF-B03B-83E8F4EF8081}&quot;</code><br /><br /><strong>Policies</strong><br /><code>Get-DomainPolicy</code> - get policy for the current domain<br />    <code>Get-DomainPolicy.&quot;system access&quot;</code> - Password policy<br />    <code>Get-DomainPolicy.&quot;Kerberos Policy&quot;</code> - Kerberos policy (golden ticket attacks, etc.)<br /><code>(Get-DomainPolicy -domain moneycorp.local).&quot;system access&quot;</code> - get policy for another domain<br /><br /><strong>Enumerate Users</strong><br /><code>Get-NetUser</code> - list users in the current domain &amp; default info<br />    <code>Get-NetUser | select logoncount, cn, samaccountname, description</code><br />    <code>Get-NetUser -Username student1</code> - specific user with samaccoutname<br /><br />Find samaccountname from DistinguishedName<br /><code>Get-NetUser -ADSpath &quot;LDAP://CN=Oswell Spencer,CN=Users,DC=tokyo,DC=umbrella,DC=local&quot;</code><br /><br /><code>Get-NetGroup -UserName &quot;student1&quot;</code> - get a user&#39;s group membership<br /><br /><code>Get-UserProperty</code> - list all properties for users in the current domain<br />    <code>Get-UserProperty -Properties pwdlastset</code><br />    <br />    Can help you identify which users to attack.<br /><br />    • <code>pwdlastset</code><br />       ◇ A password last set years ago is probably a honeypot user<br />    • <code>badpwdcount</code> - how many times they input their password incorrectly<br />       ◇ Real users will always fat-finger their passwords<br />       ◇ A <code>badpwdcount</code> of 0 is probably a honeypot user<br />    • <code>logoncount</code><br />       ◇ Low logon = probably a honeypot user (or just a low users)<br />       ◇ High logon count = probably a real user<br /><br />Search for a string in a user&#39;s attributes:<br /><code>Find-UserField -SearchField Description -SearchTerm &quot;built&quot;</code><br /><br /><strong>Enumerate User Log-ins</strong><br />REMOTE<br />Get currently logged-in users on a computer - NEEDS ADMIN RIGHTS ON TARGET<br /><code>Get-NetLoggedon -ComputerName &lt;host name&gt;</code><br /><br />Get last-logged in on a computer - NEEDS ADMIN RIGHTS &amp; REMOTE REGISTRY ON TARGET<br /><code>Get-LastLoggedOn -ComputerName &lt;host name&gt;</code><br /><br />LOCAL - Get locally logged-in users - NEEDS REMOTE REGISTRY ON TARGET (started by default on Windows Server)<br /><code>Get-LoggedonLocal -ComputerName dcorp-dc.dollarcorp.moneycorp.local</code><br /><br /><strong>Enumerate Groups</strong><br />• Enterprise groups are only available on the forest root<br /><br /><code>Get-NetGroup</code><br /><code>Get-NetGroup -Domain &lt;target domain&gt;</code><br /><br /><code>Get-NetGroup -FullData</code><br /><code>Get-NetGroup &#39;Domain Admins&#39; -FullData</code> - specific group<br /><br /><code>Get-NetGroup *admin*</code> - get all groups with &quot;admin&quot; in the group name<br /><br /><strong>Enumerate Group Members</strong><br /><code>Get-NetGroupMember -GroupName &quot;Domain Admins&quot;</code><br /><code>Get-NetGroupMember -GroupName &quot;Domain Admins&quot; -Recurse</code><br /><code>Get-NetGroupMember -Domain umbrella.local -GroupName &quot;Domain Admins&quot;</code><br /><br />Look at the <code>MemberName</code> entry.<br /><br /><strong>Enumerate Local Groups</strong><br />List local groups on a machine - NEEDS ADMIN PRIVS IF NOT ON DOMAIN CONTROLLER<br /><code>Get-NetLocalGroup -ComputerName dcorp-dc.dollarcorp.moneycorp.local -ListGroups</code><br /><br />Get members of the local groups on the machine - NEEDS ADMIN PRIVS IF NOT ON DOMAIN CONTROLLER<br /><code>Get-NetLocalGroup -ComputerName dcorp-dc.dollarcorp.moneycorp.local -Recurse</code><br /><br /><strong>Enumerate Systems</strong><br />• Even if an object is listed, it doesn&#39;t necessarily mean there&#39;s a system attached to that object<br />   ◇ Domain Admins can create empty objects<br /><br /><code>Get-NetComputer</code><br /><code>Get-NetComputer -OperatingSystem &quot;*Server 2016*&quot;</code><br /><code>Get-NetComputer -Ping</code><br /><code>Get-NetComputer -FullData</code><br /><br /><strong>Shares and Files</strong><br /><code>Invoke-ShareFinder -Verbose</code> - find shares on hosts in current domain<br /><code>Invoke-ShareFinder -Verbose -ExcludeStandard -ExcludePrint -ExcludeIPC</code> - exclude some shares<br /><br /><code>Invoke-FileFinder -Verbose</code> - find sensitive files on hosts in current domain<br /><br /><code>Get-NetFileServer</code> - looks for servers that have the &#39;fileserver&#39; role installed on them -&gt; finds high value targets basically</div>
</body>
</html>
