<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Structs</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><h1># Structs</h1><br />Used to read client/entity info.<br /><br /><strong><h2>## Pad it</h2></strong><br />This is the classic method of prepping your Entity struct.<br />Since it&#39;s uncommon to reverse the entire entity struct, people find just the values they need<br />and then pad the bytes between with <code>0x00</code>s.<br /><br />For example, here&#39;s my manually padded Entity struct for Assault Cube:<br /><div class="codebox"><div class="codebox">typedef&nbsp;struct&nbsp;_ENTITY&nbsp;{<br />	char&nbsp;unknown1[4];			//&nbsp;0x0000<br />	vec3&nbsp;head_position;		//&nbsp;0x0004<br />	char&nbsp;unknown2[0x24];		//&nbsp;0x0010<br />	vec3&nbsp;feet_position;		//&nbsp;0x0034<br />	float&nbsp;yaw;					//&nbsp;0x0040<br />	float&nbsp;pitch;				//&nbsp;0x0044<br />	char&nbsp;unknown3[0x1DC];	//&nbsp;0x0048<br />	bool&nbsp;is_attacking;		//&nbsp;0x0224<br />	char&nbsp;name[16];				//&nbsp;0x0225<br />	char&nbsp;unknown4[0xF7];		//&nbsp;0x0235<br />	int&nbsp;team;					//&nbsp;0x032C<br />	char&nbsp;unknown5[0x8];		//&nbsp;0x0330<br />	int&nbsp;dead;					//&nbsp;0x0338<br />}&nbsp;Entity;</div></div><br /><br /><strong><h2>## Union it</h2></strong><br />Not very good for external cheats.<br />First posted on UnknownCheats by Can1337.<br /><a href="https://guidedhacking.com/threads/auto-padding-for-class-recreation.13478/">https://guidedhacking.com/threads/auto-padding-for-class-recreation.13478/</a><br /><br />Padding structs can be prone to errors (maths is hard).<br />Instead, you can use a <code>union</code> and use just the offset to the struct member. No need to pad.<br /><br /><div class="codebox"><div class="codebox">//&nbsp;Structs<br />typedef&nbsp;struct&nbsp;_ENTITY&nbsp;{<br />	union&nbsp;{<br />		struct&nbsp;{&nbsp;char&nbsp;_pad1[0xED];&nbsp;bool&nbsp;is_dormant;&nbsp;};<br />		struct&nbsp;{&nbsp;char&nbsp;_pad2[0xF4];&nbsp;int&nbsp;team_num;&nbsp;};<br />		struct&nbsp;{&nbsp;char&nbsp;_pad3[0x100];&nbsp;int&nbsp;health;&nbsp;};<br />		struct&nbsp;{&nbsp;char&nbsp;_pad4[0x138];&nbsp;vec3&nbsp;position;&nbsp;};<br />		struct&nbsp;{&nbsp;char&nbsp;_pad5[0x26a8];&nbsp;int&nbsp;bone_matrix;&nbsp;};<br />		struct&nbsp;{&nbsp;char&nbsp;_pad6[0x302c];&nbsp;vec3&nbsp;aim_punch;&nbsp;};<br />		struct&nbsp;{&nbsp;char&nbsp;_pad7[0xb368];&nbsp;int&nbsp;armour;&nbsp;};<br />	};<br />}&nbsp;Entity;</div></div><br /><br />This works because all the members of a union share the same start address  (e.g. 0x0)<br /><a href="https://stackoverflow.com/questions/346536/difference-between-a-structure-and-a-union">https://stackoverflow.com/questions/346536/difference-between-a-structure-and-a-union</a><br /><br />So it&#39;s effectively doing<br /><code>0x0 + 0xED = is_dormant</code><br /><code>0x0 + 0xF4 = team_num</code><br /><code>0x0 + 0x100 = health</code><br />etc.<br /><br />Can1337&#39;s macro for it is <code>DEFINE_MEMBER_N</code>:<br /><div class="codebox"><div class="codebox">//&nbsp;Auto&nbsp;padding&nbsp;for&nbsp;structs<br />#define&nbsp;STR_MERGE_IMPL(a,&nbsp;b)&nbsp;a##b<br />#define&nbsp;STR_MERGE(a,&nbsp;b)&nbsp;STR_MERGE_IMPL(a,&nbsp;b)<br />#define&nbsp;MAKE_PAD(size)&nbsp;STR_MERGE(_pad,&nbsp;__COUNTER__)&nbsp;[size]<br />#define&nbsp;DEFINE_MEMBER_N(type,&nbsp;name,&nbsp;offset)&nbsp;struct&nbsp;{unsigned&nbsp;char&nbsp;MAKE_PAD(offset);&nbsp;type&nbsp;name;}<br /><br />//&nbsp;Structs<br />typedef&nbsp;struct&nbsp;_ENTITY&nbsp;{<br />	union&nbsp;{<br />		DEFINE_MEMBER_N(bool,&nbsp;is_dormant,&nbsp;0xED);<br />		DEFINE_MEMBER_N(int,&nbsp;team_num,&nbsp;0xF4);<br />		DEFINE_MEMBER_N(int,&nbsp;health,&nbsp;0x100);<br />		DEFINE_MEMBER_N(vec3,&nbsp;position,&nbsp;0x138);<br />		DEFINE_MEMBER_N(int,&nbsp;bone_matrix,&nbsp;0x26a8);<br />		DEFINE_MEMBER_N(vec3,&nbsp;aim_punch,&nbsp;0x302c);<br />		DEFINE_MEMBER_N(int,&nbsp;armour,&nbsp;0xb368);<br />	};<br />}&nbsp;Entity;</div></div><br /><br /></div>
</body>
</html>
