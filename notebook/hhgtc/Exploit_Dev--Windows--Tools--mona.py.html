<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>mona.py</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><strong><h1># Windows - mona.py</h1></strong><br />mona.py is available here - <a href="https://github.com/corelan/mona">https://github.com/corelan/mona</a><br /><br /><strong><h2>## Installation</h2></strong><br />1. Drop <code>mona.py</code> into the <code>PyCommands</code> folder inside the Immunity Debugger application folder - usually <code>C:\Program Files\Immunity Inc\Immunity Debugger\PyCommands</code><br />2. Install 32-bit Python 2.7.14 or higher<br /><br />Immunity Debugger, type the following to set a working directory for mona:<br /><code>!mona config -set workingfolder c:\mona\%p</code><br /><br /><strong><h2>## Commands</h2></strong><br /><code>!mona findmsp</code> - &quot;find metasploit pattern&quot; - find your cyclic pattern after you&#39;ve crashed the binary<br /><code>!mona jmp -r esp -b &quot;\x00\x0a\x0d&quot;</code> - find a &#39;jmp esp&#39; instruction<br />   ◇ jmp by default will ignore modules marked as ASLR or rebase<br />   ◇ can find a specific instruction with <code>-s</code><br />      ▪ <code>!mona find -s &#39;jmp esp&#39; -type instr -cm aslr=false,rebase=false,nx=false -b<br />&quot;\x00\x0a\x0d&quot;</code><br /><code>!mona seh</code> - find a pop;pop; ret instruction in memory<br /><br /><strong><h2>## Finding Bad Characters</h2></strong><br />Successfully crash the binary and overwrite EIP first.<br /><br />Generate a bytearray using mona and exclude the null byte (\x00):<br /><code>!mona bytearray -b &quot;\x00&quot;</code><br />Will generate a <code>bytearray.bin</code> file.<br /><br />Now generate a string of bad chars that is identical to the bytearray.<br />This python script will generate a a string of bad chars from \x01 to \xff:<br /><div class="codebox"><div class="codebox">#!/usr/bin/env&nbsp;python3<br />from&nbsp;__future__&nbsp;import&nbsp;print_function<br /><br />for&nbsp;x&nbsp;in&nbsp;range(1,&nbsp;256):<br />&nbsp;&nbsp;&nbsp;&nbsp;print(&quot;\\x&quot;&nbsp;+&nbsp;&quot;{:02x}&quot;.format(x),&nbsp;end=&#39;&#39;)<br /><br />print()</div></div><br /><br />Put the string of bad chars after your EIP overwrite in your exploit and crash the application.<br />Make a note of where ESP points to.<br /><br />Use mona.py&#39;s compare command to reference the bytearray you generated, and the address to<br />which ESP points:<br /><code>!mona compare -f C:\mona\&lt;appname&gt;\bytearray.bin -a &lt;address&gt;</code><br /></div>
</body>
</html>
