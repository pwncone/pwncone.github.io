<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Evade Userland Hooks with Syscalls</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><strong><h1># Evade Userland Hooks with Syscalls</h1></strong><br />The best place to install a userland hook is at the lowest possible level.<br />For functions that carry out privileged tasks (requiring interaction with the kernel), this location is usually the Native API.<br /><br />For example, <code>CreateFileA</code> calls <code>NtCreateFile</code> (because accessing the hard drive requries kernel access).<br />If a hook was installed on <code>CreateFileA</code>, it would fail to catch any calls to <code>NtCreateFile</code>.<br />However, if a hook was placed on <code>NtCreateFile</code>, it would catch calls to both <code>CreateFileA</code> and <code>NtCreateFile</code>.<br /><br />To evade hooks on Native API functions - <code>NtCreateFile</code>, <code>NtWriteVirtualMemory</code>, etc. - you can syscall the Native API functions yourself.<br /><br />Refer here for how to syscall:<br /><a href="Malware_Dev--Windows--Kernel_land--Techniques--Injection--Executing_Injected_Code--APC_Execution.html">Syscalls &gt; 64bit How-to</a></div>
</body>
</html>
