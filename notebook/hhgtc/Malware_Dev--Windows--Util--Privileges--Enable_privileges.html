<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Enable privileges</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><strong><h1># Enable Privilege</h1></strong><br />â€¢ <a href="https://docs.microsoft.com/en-us/windows/win32/secauthz/enabling-and-disabling-privileges-in-c--">https://docs.microsoft.com/en-us/windows/win32/secauthz/enabling-and-disabling-privileges-in-c--</a><br /><br /><div class="codebox"><div class="codebox">#include&nbsp;&lt;stdio.h&gt;<br />#include&nbsp;&lt;Windows.h&gt;<br /><br />BOOL&nbsp;EnablePrivilege(char*&nbsp;privilege)<br />{<br />	BOOL&nbsp;okay&nbsp;=&nbsp;TRUE;<br />	BOOL&nbsp;b_ret&nbsp;=&nbsp;TRUE;<br />	HANDLE&nbsp;h_token&nbsp;=&nbsp;NULL;<br />	LUID&nbsp;luid&nbsp;=&nbsp;{&nbsp;0&nbsp;};<br />	TOKEN_PRIVILEGES&nbsp;token_privs&nbsp;=&nbsp;{&nbsp;0&nbsp;};<br /><br />	printf(&quot;[*]&nbsp;enabling:&nbsp;%s&nbsp;\n&quot;,&nbsp;privilege);<br /><br />	//&nbsp;get&nbsp;access&nbsp;token&nbsp;of&nbsp;current&nbsp;process&nbsp;(which&nbsp;we&#39;ll&nbsp;adjust&nbsp;privileges&nbsp;of)<br />	b_ret&nbsp;=&nbsp;OpenProcessToken(GetCurrentProcess(),&nbsp;TOKEN_ADJUST_PRIVILEGES&nbsp;|&nbsp;TOKEN_QUERY,&nbsp;&amp;h_token);<br />	if&nbsp;(b_ret&nbsp;==&nbsp;FALSE)<br />	{<br />		fprintf(stderr,&nbsp;&quot;[-]&nbsp;failed&nbsp;to&nbsp;open&nbsp;process&nbsp;token:&nbsp;%d&nbsp;\n&quot;,&nbsp;GetLastError());<br />		okay&nbsp;=&nbsp;FALSE;<br />		goto&nbsp;cleanup;<br />	}<br /><br />	//&nbsp;grab&nbsp;LUID&nbsp;of&nbsp;requested&nbsp;privilege<br />	b_ret&nbsp;=&nbsp;LookupPrivilegeValueA(NULL,&nbsp;privilege,&nbsp;&amp;luid);<br />	if&nbsp;(b_ret&nbsp;==&nbsp;FALSE)<br />	{<br />		fprintf(stderr,&nbsp;&quot;[-]&nbsp;failed&nbsp;to&nbsp;grab&nbsp;LUID&nbsp;of&nbsp;requested&nbsp;privilege:&nbsp;%d&nbsp;\n&quot;,&nbsp;GetLastError());<br />		okay&nbsp;=&nbsp;FALSE;<br />		goto&nbsp;cleanup;<br />	}<br /><br />	//&nbsp;enable&nbsp;the&nbsp;privilege<br />	token_privs.PrivilegeCount&nbsp;=&nbsp;1;<br />	token_privs.Privileges[0].Luid&nbsp;=&nbsp;luid;<br />	token_privs.Privileges[0].Attributes&nbsp;=&nbsp;SE_PRIVILEGE_ENABLED;<br /><br />	b_ret&nbsp;=&nbsp;AdjustTokenPrivileges(h_token,&nbsp;FALSE,&nbsp;&amp;token_privs,&nbsp;sizeof(token_privs),&nbsp;NULL,&nbsp;NULL);<br />	if&nbsp;(b_ret&nbsp;==&nbsp;FALSE)<br />	{<br />		fprintf(stderr,&nbsp;&quot;[-]&nbsp;failed&nbsp;to&nbsp;enable&nbsp;privilege:&nbsp;%d&nbsp;\n&quot;,&nbsp;GetLastError());<br />		okay&nbsp;=&nbsp;FALSE;<br />		goto&nbsp;cleanup;<br />	}<br /><br />	printf(&quot;[+]&nbsp;%s&nbsp;enabled!&nbsp;\n&quot;,&nbsp;privilege);<br /><br />cleanup:<br />	if&nbsp;(h_token)&nbsp;CloseHandle(h_token);<br /><br />	return&nbsp;okay;<br />}<br /><br />int&nbsp;main(void)<br /><span style="color:#000000;font-weight:400">{</span><br />	//EnablePrivilege(SE_DEBUG_NAME);<br />	EnablePrivilege(&quot;SeDebugPrivilege&quot;);<br />	<br />	return&nbsp;0;<br /><span style="color:#000000;font-weight:400">}</span></div></div><br /><br /><br /><br /><br /></div>
</body>
</html>
