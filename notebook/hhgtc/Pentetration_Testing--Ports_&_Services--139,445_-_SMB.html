<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>139,445 - SMB</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><strong><h1># Port 139,445 - Netbios/smb/Samba</h1></strong><br />Sharing is caring!<br /><br /><strong>Links</strong><br />• <a href="https://www.hackingarticles.in/smb-penetration-testing-port-445/">https://www.hackingarticles.in/smb-penetration-testing-port-445/</a><br />• <a href="https://0xdf.gitlab.io/2018/12/02/pwk-notes-smb-enumeration-checklist-update1.html">https://0xdf.gitlab.io/2018/12/02/pwk-notes-smb-enumeration-checklist-update1.html</a> - 0xdf is a beast<br /><br /><strong>NetBIOS - Port 139</strong><br />NetBIOS stands for <em>Network Basic Input Output System</em><br />It&#39;s a software protocol that allows computers in a LAN to share data across the network.<br />NetBIOS is port 139.<br /><br /><strong>SMB - Port 445</strong><br />SMB stands for <em>Server Message Block</em><br />In modern languages it&#39;s also known as CIFS - <em>Common Internet File System</em><br />SMB offers shared access to files, printers, and serial ports within a LAN.<br /><br /><strong><h2>## Checklist</h2></strong><br /><strong><h3>### Initial</h3></strong><br />• Scan entire network for NetBIOS<br />   ◇ <code>nbtscan -r 10.11.0.1/24</code><br />• Find SMB server version<br />   ◇ Nmap - <code>nmap -p 139,445 --script smb* 192.168.11.236</code><br />   ◇ Metasploit - <code>auxiliary/scanner/smb/smb_version</code><br />   ◇ Linux 2.2.8 &amp; below? - RCE<br />• Check version for exploits (common ones below)<br />   ◇ <code>nmap --script smb-vuln* -p 139,445 10.10.10.152</code><br />   ◇ Linux<br />      ▪ Samba &lt; 2.2.8 - RCE<br />   ◇ Windows<br />      ▪ MS08-067<br />      ▪ MS09-050<br />      ▪ Windows XP? - Try dropping a MOF file into <code>C:\Windows\system32\wbem\mof</code><br />• List available shares<br />   ◇ <code>smbclient -L 10.11.0.4</code><br />   ◇ <code>smbmap -H 10.11.0.4</code><br /><br /><strong><h3>### Gain Access</h3></strong><br />• Try NULL authentication to a share<br />   ◇ <code>smbclient &quot;//192.168.1.106/My Share&quot;</code><br />   ◇ <code>crackmapexec smb &lt;IP&gt; -u &#39;&#39; -p &#39;&#39; --shares</code><br />• Try Guest authentication<br />   ◇ <code>smbmap -H 10.11.1.128 -u Guest</code><br />   ◇ <code>smbclient //192.168.1.105/ipc$ -U Guest</code><br />• Try authenticating with user/passwords that you know<br />   ◇ <code>smbmap -H 10.10.10.59 -u Finance -p Acc0unting</code><br />   ◇ <code>smbclient //192.168.1.105/ipc$ -U Finance</code><br />• Try authenticating by passing hash<br />   ◇ <code>smbmap -u &quot;bob&quot; -p &quot;&lt;NT&gt;:&lt;LM&gt;&quot; -H 10.11.0.4</code><br />   ◇ <code>smbclient //192.168.1.105/ipc$ -U Finance --pw-nt-hash</code><br />• Try authenticating using Kerberos<br />   ◇ <code>smbclient --kerberos //ws01win10.domain.com/C$</code><br />   ◇ <code>rpcclient -k ws01win10.domain.com</code><br />• Try common credentials<br />   ◇ refer below<br />• Try bruteforcing<br />   ◇ Generally not recommended as you can lock out accounts<br /><br /><strong><h3>### Have Access?</h3></strong><br />• Try executing code (refer below)<br />   ◇ crackmapexec<br />   ◇ psexec.py<br />   ◇ wmiexec.py<br />   ◇ atexec.py<br /><br /><strong><h3>### Exploiting SMB whilst on the network?</h3></strong><br />• Try an SMB relay attack<br />   ◇ Responder.py → Query your responder SMB server from a host → Relay the hash to another host and hopefully gain access<br /><br /><strong><h3>### Having problems connecting? Try mounting the shared folder</h3></strong><br />• <code>mount -t cifs -o username=user,password=password //x.x.x.x/share /mnt/share</code><br /><br /><strong><h2>## Commands</h2></strong><br /><div class="codebox"><div class="codebox">#&nbsp;Download&nbsp;a&nbsp;file<br />get&nbsp;&lt;file&gt;<br />#&nbsp;Upload&nbsp;a&nbsp;file<br />put&nbsp;&lt;file&gt;<br />#&nbsp;To&nbsp;recursively&nbsp;list/download&nbsp;directories/files:<br />recurse&nbsp;ON<br />prompt&nbsp;OFF<br />mget&nbsp;*<br /><br />#&nbsp;Search&nbsp;for&nbsp;a&nbsp;file&nbsp;and&nbsp;download<br />smbmap&nbsp;-R&nbsp;Folder&nbsp;-H&nbsp;&lt;IP&gt;&nbsp;-A&nbsp;&lt;FileName&gt;&nbsp;-q</div></div><br /><br /><strong><h2>## Common Credentials</h2></strong><br /><table class="table"><tr><th>Usernames</th><th>Passwords</th></tr><tr><td>(blank)</td><td>(blank)</td></tr><tr><td>guest</td><td>(blank)</td></tr><tr><td>Administrator, admin</td><td>(blank), password, administrator, admin</td></tr><tr><td>arcserve</td><td>arcserve, backup</td></tr><tr><td>tivoli, tmersrvd</td><td>tivoli, tmersrvd, admin</td></tr><tr><td>backupexec, backup</td><td>backupexec, backup, arcada</td></tr><tr><td>test, lab, demo</td><td>password, test, lab, demo</td></tr></table><br /><br /><br /></div>
</body>
</html>
