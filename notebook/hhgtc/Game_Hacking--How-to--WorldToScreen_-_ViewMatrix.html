<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>WorldToScreen / ViewMatrix</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><strong><h1># WorldToScreen</h1></strong><br />Explanation and lots of WorldToScreen functions here:<br /><a href="https://guidedhacking.com/threads/world2screen-direct3d-and-opengl-worldtoscreen-functions.8044/">https://guidedhacking.com/threads/world2screen-direct3d-and-opengl-worldtoscreen-functions.8044/</a><br /><br /><strong>Links</strong><br />• <a href="https://www.youtube.com/watch?v=-WL1Gpe9VRo">https://www.youtube.com/watch?v=-WL1hitGpe9VRo</a> - How to Find the View Matrix (Any game)<br />• <a href="https://guidedhacking.com/threads/how-to-find-the-view-matrix-offset.7903/">https://guidedhacking.com/threads/how-to-find-the-view-matrix-offset.7903/</a> - Accompanying post<br /><br /><strong><h2>## DirectX</h2></strong><br />In DirectX, the view matrix is row major:<br />the 1st row is X<br />the 2nd row is Y<br />the 3rd row is Z<br />and the 4th row is W<br /><br /><div class="codebox"><div class="codebox">int&nbsp;gamewindow_width&nbsp;=&nbsp;0;<br />int&nbsp;gamewindow_height&nbsp;=&nbsp;0;<br />float*&nbsp;view_matrix&nbsp;=&nbsp;0x4d96b34;		//&nbsp;Make&nbsp;sure&nbsp;to&nbsp;calculate&nbsp;the&nbsp;offset&nbsp;to&nbsp;the&nbsp;view&nbsp;matrix<br /><br />BOOL&nbsp;WorldToScreen(vec3&nbsp;world_position,&nbsp;OUT&nbsp;vec2*&nbsp;screen_position,&nbsp;float&nbsp;matrix[16])<br /><span style="color:#000000;font-weight:400">{</span><br />	vec4&nbsp;clip_coordinates&nbsp;=&nbsp;{&nbsp;0&nbsp;};<br /><br />	//&nbsp;Do&nbsp;matrix&nbsp;multiplication&nbsp;(convert&nbsp;from&nbsp;matrix&nbsp;to&nbsp;vector)<br />	//&nbsp;View&nbsp;matrix&nbsp;in&nbsp;DirectX&nbsp;is&nbsp;row&nbsp;major&nbsp;(1st&nbsp;row&nbsp;=&nbsp;x,&nbsp;2nd&nbsp;row&nbsp;=&nbsp;y,&nbsp;etc.)<br />	clip_coordinates.x&nbsp;=&nbsp;world_position.x&nbsp;*&nbsp;matrix[0]&nbsp;+&nbsp;world_position.y&nbsp;*&nbsp;matrix[1]&nbsp;+&nbsp;world_position.z&nbsp;*&nbsp;matrix[2]&nbsp;+&nbsp;matrix[3];<br />	clip_coordinates.y&nbsp;=&nbsp;world_position.x&nbsp;*&nbsp;matrix[4]&nbsp;+&nbsp;world_position.y&nbsp;*&nbsp;matrix[5]&nbsp;+&nbsp;world_position.z&nbsp;*&nbsp;matrix[6]&nbsp;+&nbsp;matrix[7];<br />	clip_coordinates.z&nbsp;=&nbsp;world_position.x&nbsp;*&nbsp;matrix[8]&nbsp;+&nbsp;world_position.y&nbsp;*&nbsp;matrix[9]&nbsp;+&nbsp;world_position.z&nbsp;*&nbsp;matrix[10]&nbsp;+&nbsp;matrix[11];<br />	clip_coordinates.w&nbsp;=&nbsp;world_position.x&nbsp;*&nbsp;matrix[12]&nbsp;+&nbsp;world_position.y&nbsp;*&nbsp;matrix[13]&nbsp;+&nbsp;world_position.z&nbsp;*&nbsp;matrix[14]&nbsp;+&nbsp;matrix[15];		<br /><br />	//&nbsp;If&nbsp;player&nbsp;is&nbsp;inside&nbsp;or&nbsp;behind&nbsp;us,&nbsp;return&nbsp;FALSE&nbsp;for&nbsp;not&nbsp;on&nbsp;screen<br />	if&nbsp;(clip_coordinates.w&nbsp;&lt;&nbsp;0.1f)<br />		return&nbsp;FALSE;<br /><br />	//&nbsp;Calculate&nbsp;Normalized&nbsp;Device&nbsp;Coordinates&nbsp;to&nbsp;check&nbsp;if&nbsp;player&nbsp;is&nbsp;on&nbsp;screen<br />	vec3&nbsp;ndc&nbsp;=&nbsp;{&nbsp;0&nbsp;};<br />	ndc.x&nbsp;=&nbsp;clip_coordinates.x&nbsp;/&nbsp;clip_coordinates.w;<br />	ndc.y&nbsp;=&nbsp;clip_coordinates.y&nbsp;/&nbsp;clip_coordinates.w;<br />	ndc.z&nbsp;=&nbsp;clip_coordinates.z&nbsp;/&nbsp;clip_coordinates.w;<br /><br />	/*&nbsp;<br />	Convert&nbsp;3d&nbsp;world&nbsp;space&nbsp;to&nbsp;2d&nbsp;screen&nbsp;coordinates.<br />	Top&nbsp;left&nbsp;of&nbsp;game&nbsp;window&nbsp;is&nbsp;x0y0.<br />	screen_position.y&nbsp;is&nbsp;`-(gamewindow_height&nbsp;/&nbsp;2&nbsp;*&nbsp;ndc.y)`&nbsp;otherwise&nbsp;y0&nbsp;is&nbsp;bottom&nbsp;left&nbsp;of&nbsp;window&nbsp;(not&nbsp;top&nbsp;left&nbsp;like&nbsp;we&nbsp;want&nbsp;it)<br />	*/<br />	screen_position-&gt;x&nbsp;=&nbsp;(gamewindow_width&nbsp;/&nbsp;2&nbsp;*&nbsp;ndc.x)&nbsp;+&nbsp;(ndc.x&nbsp;+&nbsp;gamewindow_width&nbsp;/&nbsp;2);<br />	screen_position-&gt;y&nbsp;=&nbsp;-(gamewindow_height&nbsp;/&nbsp;2&nbsp;*&nbsp;ndc.y)&nbsp;+&nbsp;(ndc.y&nbsp;+&nbsp;gamewindow_height&nbsp;/&nbsp;2);<br /><br />	return&nbsp;TRUE;<br /><span style="color:#000000;font-weight:400">}</span></div></div><br /><br /><strong><h2>## OpenGL</h2></strong><br />In OpenGL, the view matrix is column major:<br />the 1st column is X<br />the 2nd column is Y<br />the 3rd column is Z<br />and the 4th column is W<br /><br /><div class="codebox"><div class="codebox">BOOL&nbsp;WorldToScreen(vec3&nbsp;world_position,&nbsp;OUT&nbsp;vec2*&nbsp;screen_position,&nbsp;float&nbsp;matrix[16])<br /><span style="color:#000000;font-weight:400">{</span><br />	vec4&nbsp;clip_coordinates&nbsp;=&nbsp;{&nbsp;0&nbsp;};<br /><br />	//&nbsp;Do&nbsp;matrix&nbsp;multiplication&nbsp;(convert&nbsp;from&nbsp;matrix&nbsp;to&nbsp;vector)<br />	//&nbsp;ViewMatrix&nbsp;in&nbsp;OpenGL&nbsp;is&nbsp;column&nbsp;major&nbsp;(1st&nbsp;column&nbsp;=&nbsp;x,&nbsp;2nd&nbsp;column&nbsp;=&nbsp;y,&nbsp;etc.)<br />	clip_coordinates.x&nbsp;=&nbsp;world_position.x&nbsp;*&nbsp;matrix[0]&nbsp;+&nbsp;world_position.y&nbsp;*&nbsp;matrix[4]&nbsp;+&nbsp;world_position.z&nbsp;*&nbsp;matrix[8]&nbsp;+&nbsp;matrix[12];<br />	clip_coordinates.y&nbsp;=&nbsp;world_position.x&nbsp;*&nbsp;matrix[1]&nbsp;+&nbsp;world_position.y&nbsp;*&nbsp;matrix[5]&nbsp;+&nbsp;world_position.z&nbsp;*&nbsp;matrix[9]&nbsp;+&nbsp;matrix[13];<br />	clip_coordinates.z&nbsp;=&nbsp;world_position.x&nbsp;*&nbsp;matrix[2]&nbsp;+&nbsp;world_position.y&nbsp;*&nbsp;matrix[6]&nbsp;+&nbsp;world_position.z&nbsp;*&nbsp;matrix[10]&nbsp;+&nbsp;matrix[14];<br />	clip_coordinates.w&nbsp;=&nbsp;world_position.x&nbsp;*&nbsp;matrix[3]&nbsp;+&nbsp;world_position.y&nbsp;*&nbsp;matrix[7]&nbsp;+&nbsp;world_position.z&nbsp;*&nbsp;matrix[11]&nbsp;+&nbsp;matrix[15];<br /><br />	//&nbsp;If&nbsp;player&nbsp;is&nbsp;inside&nbsp;of&nbsp;or&nbsp;behind&nbsp;you,&nbsp;return&nbsp;FALSE&nbsp;for&nbsp;not&nbsp;on&nbsp;screen<br />	if&nbsp;(clip_coordinates.w&nbsp;&lt;&nbsp;0.1f)<br />		return&nbsp;FALSE;<br /><br />	//&nbsp;Calculate&nbsp;Normalized&nbsp;Device&nbsp;Coordinates&nbsp;to&nbsp;check&nbsp;if&nbsp;player&nbsp;is&nbsp;on&nbsp;screen<br />	vec3&nbsp;ndc&nbsp;=&nbsp;{&nbsp;0&nbsp;};<br />	ndc.x&nbsp;=&nbsp;clip_coordinates.x&nbsp;/&nbsp;clip_coordinates.w;<br />	ndc.y&nbsp;=&nbsp;clip_coordinates.y&nbsp;/&nbsp;clip_coordinates.w;<br />	ndc.z&nbsp;=&nbsp;clip_coordinates.z&nbsp;/&nbsp;clip_coordinates.w;<br /><br />	/*<br />	Convert&nbsp;3d&nbsp;world&nbsp;space&nbsp;to&nbsp;2d&nbsp;screen&nbsp;coordinates.<br />	Top&nbsp;left&nbsp;of&nbsp;game&nbsp;window&nbsp;is&nbsp;x0y0.<br />	y&nbsp;is&nbsp;`-(gamewindow_height&nbsp;/&nbsp;2&nbsp;*&nbsp;ndc.y)`&nbsp;otherwise&nbsp;y0&nbsp;is&nbsp;bottom&nbsp;left&nbsp;of&nbsp;game&nbsp;window&nbsp;(not&nbsp;top&nbsp;left&nbsp;where&nbsp;we&nbsp;want&nbsp;it).<br />	*/<br />	screen_position-&gt;x&nbsp;=&nbsp;(gamewindow_width&nbsp;/&nbsp;2&nbsp;*&nbsp;ndc.x)&nbsp;+&nbsp;(ndc.x&nbsp;+&nbsp;gamewindow_width&nbsp;/&nbsp;2);<br />	screen_position-&gt;y&nbsp;=&nbsp;-(gamewindow_height&nbsp;/&nbsp;2&nbsp;*&nbsp;ndc.y)&nbsp;+&nbsp;(ndc.y&nbsp;+&nbsp;gamewindow_height&nbsp;/&nbsp;2);<br /><br />	return&nbsp;TRUE;<br /><span style="color:#000000;font-weight:400">}</span></div></div></div>
</body>
</html>
