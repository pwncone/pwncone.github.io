<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>SQL Injection</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><strong><h1># SQL Injection</h1></strong><br />SQL Injection is where you inject a malicious SQL query into a target application.<br />Depending on your query, SQL injection has the possiblity to dump the database, leak passwords, or log you into a web application without a password; among other possiblities.<br /><br />SQL Injection is typically found on websites, but it can be used to attack any type of SQL database, and exploits a vulnerabiltity where user input is incorrectly filtered for malicious characters.<br /><br /><strong>Links</strong><br />• <a href="https://devhints.io/mysql">https://devhints.io/mysql</a> ← normal sql commands<br /><br /><em>About SQL Injection</em><br />• <a href="https://websec.ca/kb/sql_injection">https://websec.ca/kb/sql_injection</a> ← the best<br />• <a href="https://vulp3cula.gitbook.io/hackers-grimoire/exploitation/web-application/sql-injection">https://vulp3cula.gitbook.io/hackers-grimoire/exploitation/web-application/sql-injection</a><br />• <a href="https://xapax.gitbooks.io/security/sql-injections.html">https://xapax.gitbooks.io/security/sql-injections.html</a><br />• <a href="https://attack.samsclass.info/sqlol-raw/search-raw.htm">https://attack.samsclass.info/sqlol-raw/search-raw.htm</a> - Introduction to SQL + SQL Injection<br />• <a href="https://support.portswigger.net/customer/portal/articles/2791005-using-burp-to-find-sql-injection-flaws">https://support.portswigger.net/customer/portal/articles/2791005-using-burp-to-find-sql-injection-flaws</a> - SQL Injection with Burpsuite <br /><br /><em>Defenses</em><br />• <a href="https://www.red-gate.com/simple-talk/sql/learn-sql-server/sql-injection-defense-in-depth/">https://www.red-gate.com/simple-talk/sql/learn-sql-server/sql-injection-defense-in-depth/</a> - Good article on defenses<br />• <a href="http://www.sqlservercentral.com/articles/Security/updatedsqlinjection/2065/">http://www.sqlservercentral.com/articles/Security/updatedsqlinjection/2065/</a> - Also a good article on defense<br /><br /><strong><h2>## About SQL Injection</h2></strong><br />Think of a login form on a website.<br />A user might login with the details:<br /><code>jimmy / p4ssword</code><br /><br />The website will then send a SQL query to the SQL database for those details to check whether they&#39;re correct:<br /><code>SELECT * FROM users WHERE username = &#39;jimmy&#39; AND password=&#39;p4ssword&#39;;</code><br /><br />There are 2 potential places for SQL injection here: the username and the password.<br /><code>SELECT * FROM users WHERE username = &#39;POINT 1&#39; AND password=&#39;POINT 2&#39;;</code><br /><br />If there is no input filtereing, we can potentially break the existing SQL query and insert our own.<br /><br />For example, we submit another set of login details:<br /><code>admin / p4ssword&#39; OR &#39;1</code><br /><br />By inserting <code>&#39; OR &#39;1</code>, we&#39;ve now:<br />• escaped the original SQL query with <code>&#39;</code><br />• and extended it with our own SQL code - <code>OR &#39;1</code><br /><br />Our query now becomes: <br /><code>SELECT * FROM users WHERE username = &#39;admin&#39; AND password=&#39;p4ssword&#39; OR &#39;1&#39;;</code><br /><br />This query above will now log us in regardless of whether the password we submitted is correct or not.<br />This is because <code>1</code> always returns <code>TRUE</code>.<br /><br />The correct login credentials for the website are:<br /><code>jimmy / iloveyou</code><br /><br />In the original statement, we would only be logged in if the password was correct.<br /><code>SELECT * FROM users WHERE username = &#39;jimmy&#39; AND password=&#39;p4ssword&#39;;</code><br />This SQL query would return FALSE, because there isn&#39;t an entry in the database where the username is <code>jimmy</code> and the password is <code>p4ssword</code> (the real password is <code>iloveyou</code>).<br /><br />In our modified query, we will be logged in regardless of whether the password is correct or not.<br /><code>SELECT * FROM users WHERE username = &#39;admin&#39; AND password=&#39;p4ssword&#39; OR &#39;1&#39;;</code><br />This SQL query would return TRUE.<br />This is because of the <code>OR &#39;1&#39;</code>.<br />1 is equal to TRUE.<br />Therefore, the SQL query searches the database for an entry where the username is <code>jimmy</code> and its password is <code>p4ssword OR TRUE</code>. The password field has now evaluated to TRUE, therfore this SQL query will return TRUE and log us in.<br /><br /><strong><h2>## Potential places for SQL Injection</h2></strong><br />• Login forms<br />• Look at URLs that might be querying a SQL databse (id=1 or photo=20) e.g.<br />   ◇ photo galleries<br />   ◇ address/location info<br />   ◇ <a href="http://www.example.com/index.php?id=1">http://www.example.com/index.php?id=1</a><br />   ◇ <a href="http://www.example.com/gallery.php?photo=12242">http://www.example.com/gallery.php?photo=12242</a><br />   ◇ Check drop down menus for potential URL paramters that might be SQL injectable<br />      ▪ e.g. sort by data, size etc. these are good places to find URL parameters<br />• POST parameters<br />   ◇ You can also attempt to inject parameters passed using POST requests<br />   ◇ e.g. <code>lang=en&#39;</code><br />• If you were the developer of this site, what might you store in a database?<br /><br /><strong><h2>## SQL Syntax</h2></strong><br /><code>#</code> 	- Hash comment<br /><code>/*</code> - C-style comment<br /><code>-- -</code> - SQL comment<br /><code>;%00</code> - Nullbyte comment out<br /><code>`</code> - Backtick comment out<br /><code>@@version</code> or <code>version()</code> - get version<br /><code>@@hostname</code> or <code>hostname()</code> - get hostname<br /><code>@@datadir</code> - get directory of where database is<br /><br /><strong><h2>## Test for SQL Injection</h2></strong><br />SQL injection can be found throughout websites, but the 2 most common places are in login forms and in URLs.<br />For details on attacking each of these, refer to the subnodes.<br /><br /><strong><h3>### Generate an error</h3></strong><br />The first step in testing for SQL injection is generating an error.<br />If you can cause a SQL error, you&#39;ve found a spot for SQL injection.<br /><br />Input a <code>&#39;</code> or <code>&quot;</code> into the URL parameter or login form and see if it throws a database error/blank page/any kind of error.<br />If something weird happens, you&#39;ve found a potential point of sql injection.<br /><br />The best advice I&#39;ve read for SQL injection:<br />• make an educated guess as to what the SQL statement is<br />• write it out in a notepad/by hand<br />• insert your SQL inject into it and check that the syntax is correct/makes sense after with the inject in place<br />• test the inject<br />   ◇ If the inject doesn&#39;t work, modify what you guessed the SQL statement is depening on the result/error you got and try again<br /><br /><strong><h2>## Blind SQL Injection</h2></strong><br />Blind injection is where the output of the SQL query isn&#39;t printed to the screen.<br />This is much more difficult to exploit, but is still do-able.<br /><br /><strong><h3>### Detecting Blind Injection</h3></strong><br /><strong>#### Time Delay</strong><br />In most SQL databases there&#39;s a <code>sleep()</code>command.<br />You can use this command to cause a time delay in the response from your SQL query.<br />For example, you insert <code>sleep(10)</code>.<br /><br />If the query takes 10 seconds to respond, you&#39;ve found a blind SQL injection spot<br /><br />Example:<br /><code>http://example.com/photoalbum.php?id=1-sleep(4)</code><br /><br /></div>
</body>
</html>
