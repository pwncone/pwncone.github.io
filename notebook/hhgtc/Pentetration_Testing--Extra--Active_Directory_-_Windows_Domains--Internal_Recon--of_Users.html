<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>of Users</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><strong><h1># Internal Recon - of Users</h1></strong><br />Hunt for specific users or privileges to achieve lateral movement.<br /><br /><strong>BE CAREFUL - commands here can be noisy:</strong><br />• Create huge network spikes by querying the domain controller for all computers in a domain<br />   ◇ Try run the commands in chunks instead -&gt; e.g. 200 machines at a time<br />• Creates a <code>4624 Logon Event</code> on every machine <br /><br /><strong><h2>## GetADUsers.py</h2></strong><br />From Impacket:<br />• Try without creds - &quot;successful bind must be completed&quot; means authentication required<br />• If creds, any Domain User credentials will work (doesn&#39;t need Administrator/Domain Admin/whatever)<br /><br /><code>GetADUsers.py -all -dc-ip 192.168.88.11 tokyo.umbrella.local/</code><br /><code>GetADUsers.py -all -dc-ip 192.168.88.11 tokyo.umbrella.local/marcusj:suit123!</code><br /><br /><strong><h2>## PowerView</h2></strong><br /><strong><h3>### Find all machines on the current domain where the current user has local admin access</h3></strong><br /><code>Find-LocalAdminAccess -Verbose</code><br />   ◇ Works by:<br />      ▪ Querying the domain controller for a list of computers in the domain - <code>Get-NetComputer</code><br />      ▪ Multithreads <code>Invoke-CheckLocalAdminAccess</code> on each machine<br />         - uses RPC and SMB ports to check (which might be blocked)<br /><br /><strong>Script - Find-WMILocalAdminAccess.ps1</strong><br />If PowerView is blocked, can also use - <code>Find-WMILocalAdminAccess.ps1</code><br />1. Run <code>Get-NetComputer</code> to get list of machines on the current domain<br />2. Save output to a text file<br /><br /><code>.\Find-WMILocalAdminAccess.ps1 -ComputerFile .\get-netcomputer.txt -Verbose</code><br />   ◇ Works by:  <br />      ▪ Script goes to each machine and runs a WMI query<br />         - WMI needs local admin privileges<br />         - If error -&gt; user doesn&#39;t have local admin privileges<br /><br /><strong><h3>### Find all local admins on all machines</h3></strong><br /><code>Invoke-EnumerateLocalAdmin -Verbose</code><br />   ◇ Needs Administrator privs to run on non-DC machines <br />   ◇ Works by:<br />      ▪ Querying the domain controller for a list of computers in the domain - <code>Get-NetComputer</code><br />      ▪ Multithreads <code>Get-NetLocalGroup</code> on each machine<br /><br /><strong><h3>### Find computers where a domain admin or specified user/group currently has a session</h3></strong><br />THIS IS A COMMON PRIV-ESC TECHNIQUE.<br />   ◇ Look for machine where Domain Admin token/session is available.<br />   ◇ We can extract credentials of the Domain Admin - TGPs, NTLM, AES keys, etc. <br /><br /><code>Invoke-UserHunter</code><br /><code>Invoke-UserHunter -GroupName &quot;RDPUsers&quot;</code><br /><code>Invoke-UserHunter -CheckAccess</code> - confirm admin access<br />   ◇ Works by:<br />      ▪ Querying the domain controller for the members in a group (Domain Admins by default) - <code>Get-NetGroupMember</code><br />      ▪ Gets a list of computers - <code>Get-NetComputer</code><br />      ▪ Lists the sesions and logged on users on each machine - <code>Get-NetSession</code> and <code>Get-NetLoggedon</code><br /><br /><strong>Stealth version:</strong><br /><code>Invoke-UserHunter -Stealth</code><br />   ◇ Why stealthy?<br />      ▪ Works same as above<br />      ▪ But only goes for high value targets - Domain Controller, File Servers, etc.<br />      ▪ which generates less traffic<br /><br /></div>
</body>
</html>
