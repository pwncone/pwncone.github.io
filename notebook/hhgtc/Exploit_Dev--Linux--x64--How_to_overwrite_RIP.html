<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>How to overwrite RIP</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><strong><h1># Linux - x64 - Overwrite RIP</h1></strong><br />With 64bit binaries, you&#39;ll never get an RIP overwrite like you would with 32bit buffer overflows.<br />Instead, you&#39;ll see that RIP crashes pointing to a return address<br /><code>RIP: 0x401618 (&lt;auth+261&gt;:	ret)</code><br /><br />• The maximum address size on 64-bit machines is <code>0x00007FFFFFFFFFFF</code><br />• We can&#39;t overwrite RIP because our cyclic pattern creates a value much higher than the maximum address size - e.g. <code>0x4141414141414141</code><br />• In order to control RIP, we would need to write an address that&#39;s within the maximum 64-bit address size - 6 <code>B</code>s - e.g. <code>0x0000424242424242</code><br /><br />You can examine the value which RSP points to (the value of the top of the stack), to determine the offset to overwrite RIP.<br /><br /><code>x/</code> to examine memory<br /><code>x</code> to examine the data in hex format<br /><code>g</code> to set the data type to <em>giant words</em> (64 bits)<br /><code>$rsp</code> to examine data from where RSP is pointing to<br /><div class="codebox"><div class="codebox">gdb-peda$&nbsp;x/xg&nbsp;$rsp<br />0x7ffeaacd67d8:	0x41416d4141514141</div></div><br /><br />And use <code>pattern offset &lt;value&gt;</code> to find the offset of the hex value <code>0x41416d4141514141</code><br /><div class="codebox"><div class="codebox">gdb-peda$&nbsp;pattern&nbsp;offset&nbsp;0x41416d4141514141<br />4702159612987654465&nbsp;found&nbsp;at&nbsp;offset:&nbsp;136</div></div><br /><br /><strong><h2>## Notes</h2></strong><br /><strong><h3>### gets() and fgets()</h3></strong><br />If the overflow is occurring because of a gets() function - i.e. it&#39;s taking user input - then check whether it&#39;s gets() or fgets().<br /><br /><code>fgets()</code> will append a <code>\n</code> byte to the user input, meaning that to overwrite RIP successfully you should only write 5 bytes to RIP, not the usual 6.</div>
</body>
</html>
