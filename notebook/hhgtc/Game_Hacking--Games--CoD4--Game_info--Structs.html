<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Structs</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><strong><h1># CoD4 Structs</h1></strong><br />CoD4 is weird. <br />It&#39;s based off the Quake engine, which is well-made but complex<br />(uses virtual machines, uses snapshots of player information to accomodate for lost packets, etc.)<br />but the C code is pretty difficult to read (poorly written imo).<br /><br />For game hacking the engine is a pain:<br />structs contain other structs, <br />and there&#39;s multiple copies of data all over the place which makes it difficult to know which piece of data to use<br />e.g. player origin can be found in multiple different structs.<br /><br />As a result it&#39;s much more confusing to do simple things like loop through the players in this game<br />compared to something simple and well-made like CSGO.<br /><br />TLDR version of below.<br />• <code>cg_t</code> is game info. It contains your local client number<br />• <code>cgs_t</code> is server info (server name, gamemode, map, etc.)<br />• <code>refdef</code> - stores local players origin, view axis, etc. Used for WorldToScreen &amp; player&#39;s origin<br />• <code>centity_t</code> contains 1 half of the entity info (origin, client number, alive, etc.)<br />• <code>clientInfo_t</code> contains the other half (name, weapon info, etc.)<br /><br />Upon connection to a game server, every player is given a client number.<br />The first connected player is client number 0, etc.<br /><br /><strong><h2>## Core Structs</h2></strong><br />These are the structs you need to know about and will most likely end up using.<br /><br /><h3>### cg_t</h3><br />cg_t is the Client&#39;s Game.<br />It can be found in the Quake engine here:<br /><a href="https://github.com/id-Software/Quake-III-Arena/blob/dbe4ddb10315479fc00086f08e25d968b4b43c49/code/cgame/cg_local.h#L454">https://github.com/id-Software/Quake-III-Arena/blob/dbe4ddb10315479fc00086f08e25d968b4b43c49/code/cgame/cg_local.h#L454</a><br /><br />Members include:<br />• <code>client_number</code> - Your local player&#39;s client number assigned by the server<br />• <code>current_snapshot</code> - The current snapshot of the game&#39;s state<br />• <code>next_snapshot</code> - The next snapshot of the game&#39;s state it&#39;s going to send to the server<br />• etc.<br /><br /><h3>### cgs_t</h3><br />cgs_t stands for Client Game Static. <br />It stores everything about the game state.<br />It&#39;s easier to think of it as game server info, because that&#39; mostly what it contains.<br /><br />Found in Quake Engine at:<br /><a href="https://github.com/id-Software/Quake-III-Arena/blob/dbe4ddb10315479fc00086f08e25d968b4b43c49/code/cgame/cg_local.h#L984">https://github.com/id-Software/Quake-III-Arena/blob/dbe4ddb10315479fc00086f08e25d968b4b43c49/code/cgame/cg_local.h#L984</a><br /><br />It contains a bunch of information about the game &amp; server:<br />• <code>gamemode</code><br />• <code>server_name</code><br />• <code>max_clients</code> - Max number of players allowed in the server<br />• <code>map_name</code><br />• etc.<br /><br /><h3>### refdef_t</h3><br />CoD4 doesn&#39;t use a typical view matrix for its WorldToScreen calculation.<br />Instead, it uses the values in this refdef struct to render the player&#39;s view.<br /><br /><span style="text-decoration:underline;">All information in here is about the local player</span>.<br /><br />Can be found in the Quake Engine here:<br /><a href="https://github.com/id-Software/Quake-III-Arena/blob/dbe4ddb10315479fc00086f08e25d968b4b43c49/code/cgame/tr_types.h#L113">https://github.com/id-Software/Quake-III-Arena/blob/dbe4ddb10315479fc00086f08e25d968b4b43c49/code/cgame/tr_types.h#L113</a><br /><br />Members:<br />• <code>fov</code> - Player&#39;s field of view<br />• <code>origin</code> - Player origin<br />• <code>view_axis</code> - Used for transformation matrix<br />• etc.<br /><br /><h3>### centity_t</h3><br />This is the entity struct.<br />In CoD games, information about an entity is split between 2 structs - <code>centity_t</code> and <code>clientInfo_t</code><br />centity_t is part #1 of information about an entity.<br /><br />Found in the Quake Engine at:<br /><a href="https://github.com/id-Software/Quake-III-Arena/blob/dbe4ddb10315479fc00086f08e25d968b4b43c49/code/cgame/cg_local.h#L167">https://github.com/id-Software/Quake-III-Arena/blob/dbe4ddb10315479fc00086f08e25d968b4b43c49/code/cgame/cg_local.h#L167</a><br />NOTE: The CoD4 version is pretty different from the Quake version of this struct<br /><br />Useful members include:<br />• <code>is_valid</code> - Whether the entity is valid<br />• <code>origin</code> - The entity&#39;s position<br />• <code>client_number</code> - The entity&#39;s client number<br />• <code>is_alive</code> - Wheter the entity is alive<br />• etc.<br /><br /><h3>### clientInfo_t</h3><br />This is info about a client connected to a server, <br />and is part #2 of information about an entity.<br /><br />In Quake Engine at:<br /><a href="https://github.com/id-Software/Quake-III-Arena/blob/dbe4ddb10315479fc00086f08e25d968b4b43c49/code/cgame/cg_local.h#L306">https://github.com/id-Software/Quake-III-Arena/blob/dbe4ddb10315479fc00086f08e25d968b4b43c49/code/cgame/cg_local.h#L306</a><br /><br />Useful members include:<br />• <code>name</code> - Name of player<br />• <code>team</code> - Player&#39;s team (1 = Axis, 2 = Allies, 3 = Spectator, etc.)<br />• <code>rank</code> - Player&#39;s rank<br />• <code>teammate_health</code> - Can only see teammate&#39;s health in cod4, not enemy&#39;s. Will be 0 if enemy<br />• <code>view_angles</code> - The player&#39;s view angles<br />• etc.<br /><br /><h3>### weaponInfo_t</h3><br />Stores a pointer to the weapon name<br />followed by a bunch of unknown data about the gun (guessing it&#39;s gun characteristics).<br /><br />In Quake Engine at:<br /><a href="https://github.com/id-Software/Quake-III-Arena/blob/dbe4ddb10315479fc00086f08e25d968b4b43c49/code/game/be_ai_weap.h#L61">https://github.com/id-Software/Quake-III-Arena/blob/dbe4ddb10315479fc00086f08e25d968b4b43c49/code/game/be_ai_weap.h#L61</a><br />Doesn&#39;t match up with CoD4 version I&#39;ve found.<br /><br />Members:<br />• <code>char* weapon_name</code><br />• <code>char unknown[64];</code><br /><br /><strong><h2>## Extra Structs</h2></strong><br />Extra structs you don&#39;t really need <br />but that you should probably know about because they&#39;re referenced elsewhere.<br /><br /><h3>### snapshot_t</h3><br />snapshot_t is a snapshot of a client&#39;s gamestate at a current time.<br />The game server stores the last 32 gamestates for every client (player) on the server, called snapshots.<br />To minimise the amount of data sent from server to client, the server will compare<br />the last snapshot sent to the newest snapshot for each player, and only send the data that&#39;s changed <br />e.g. player is in same position (so no data is sent) but player&#39;s health has decreased to 50 (so new health value is sent from server to client).<br /><br />It can be found in the Quake engine here:<br /><a href="https://github.com/id-Software/Quake-III-Arena/blob/dbe4ddb10315479fc00086f08e25d968b4b43c49/code/cgame/cg_public.h#L36">https://github.com/id-Software/Quake-III-Arena/blob/dbe4ddb10315479fc00086f08e25d968b4b43c49/code/cgame/cg_public.h#L36</a><br />And an explanation of it can be found here:<br /><a href="https://fabiensanglard.net/quake3/network.php">https://fabiensanglard.net/quake3/network.php</a><br /><br />Not really needed, but is good to know about and is referenced in <code>cg_t</code>.<br /><br /><h3>### playerState_t</h3><br />playerState_t stores information about a player.<br />It&#39;s used by both the client and server to predict player movement and actions.<br /><br />It&#39;s a supserset of entityState_t (contains everything that entityState_t does) plus more.<br />entityState_t is derived from playerState_t.<br /><br />In the Quake Engine at:<br /><a href="https://github.com/id-Software/Quake-III-Arena/blob/dbe4ddb10315479fc00086f08e25d968b4b43c49/code/game/q_shared.h#L1138">https://github.com/id-Software/Quake-III-Arena/blob/dbe4ddb10315479fc00086f08e25d968b4b43c49/code/game/q_shared.h#L1138</a><br /><br />Members include:<br />• <code>origin</code> - Player position<br />• <code>velocity</code> - How fast the player is moving<br />• <code>entity_type</code> - 1 for human, 6 for vehicle, etc.<br />• <code>client_number</code> - Player&#39;s client number<br />• <code>ammo</code> - How much total ammo they have<br />• <code>ammo_in_clip</code> - How much ammo they have in their gun<br />• etc.<br /><br /><h3>### entityState_t</h3><br />entityState_t is information sent from the server about an entity.<br />It&#39;s used to render the entities on the screen.<br /><br />In the Quake Engine at:<br /><a href="https://github.com/id-Software/Quake-III-Arena/blob/dbe4ddb10315479fc00086f08e25d968b4b43c49/code/game/q_shared.h#L1278">https://github.com/id-Software/Quake-III-Arena/blob/dbe4ddb10315479fc00086f08e25d968b4b43c49/code/game/q_shared.h#L1278</a><br /><br />Members include:<br />• <code>entity_type</code> - 1 for human, 6 for vehicle, etc.<br />• <code>client_number</code><br />• <code>weapon_id</code><br />• etc.<br /></div>
</body>
</html>
