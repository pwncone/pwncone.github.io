<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Passwords & Hashes</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><strong><h1># Passwords &amp; Hashes</h1></strong><br />Windows has used a bunch of different hash formats over the years, so this stuff can get a little confusing.<br /><br /><code>LM</code> &gt; <code>NT</code><br /><code>Net-NTLM v1</code> and <code>Net-NTLM v2</code> used for network authentication.<br /><br />Hashes from a dump will look like this:<br /><code>username:UID:[ LM hash ]:[ NT hash]:::</code><br /><code>luigi:1004:aad3b435b51404eeaad3b435b51404ee:41fdea6cb0d9e64b4745fc8696b0e948:::</code><br /><br /><strong>Links</strong><br />• <a href="https://medium.com/@petergombos/lm-ntlm-net-ntlmv2-oh-my-a9b235c58ed4">https://medium.com/@petergombos/lm-ntlm-net-ntlmv2-oh-my-a9b235c58ed4</a><br />• <a href="https://byt3bl33d3r.github.io/practical-guide-to-ntlm-relaying-in-2017-aka-getting-a-foothold-in-under-5-minutes.html">https://byt3bl33d3r.github.io/practical-guide-to-ntlm-relaying-in-2017-aka-getting-a-foothold-in-under-5-minutes.html</a><br /><br /><strong><h2>## LM Hashes</h2></strong><br />• LM stands for LAN Manager<br />• Old<br />   ◇ Date back to the 1980s<br />   ◇ Only enabled in Windows XP and Server 2003<br />   ◇ Turned off by default starting in Windows Vista/Server 2008<br />• Very weak<br />   ◇ Passwords longer than 7 characters are split into 2 strings and individually hashed<br />   ◇ Password is converted to uppercase before being hashed<br />   ◇ No salting, so vulnerable to rainbow table attacks<br /><br /><strong>Crack?</strong> - Yes!<br /><strong>Pass the hash?</strong> - Not sure :/<br /><br /><code>luigi:1004:[ LM hash ]:41fdea6cb0d9e64b4745fc8696b0e948:::</code><br /><br />An LM hash of empty string (i.e LM isn&#39;t being used) is this:<br /><code>aad3b435b51404eeaad3b435b51404ee</code><br /><br /><strong>Encryption algorithm</strong><br /><div class="codebox"><div class="codebox">1.&nbsp;Convert&nbsp;all&nbsp;lower&nbsp;case&nbsp;to&nbsp;upper&nbsp;case<br />2.&nbsp;Pad&nbsp;password&nbsp;to&nbsp;14&nbsp;characters&nbsp;with&nbsp;NULL&nbsp;characters<br />3.&nbsp;Split&nbsp;the&nbsp;password&nbsp;to&nbsp;two&nbsp;7&nbsp;character&nbsp;chunks<br />4.&nbsp;Create&nbsp;two&nbsp;DES&nbsp;keys&nbsp;from&nbsp;each&nbsp;7&nbsp;character&nbsp;chunk<br />5.&nbsp;DES&nbsp;encrypt&nbsp;the&nbsp;string&nbsp;&quot;KGS!@#$%&quot;&nbsp;with&nbsp;these&nbsp;two&nbsp;chunks<br />6.&nbsp;Concatenate&nbsp;the&nbsp;two&nbsp;DES&nbsp;encrypted&nbsp;strings.&nbsp;This&nbsp;is&nbsp;the&nbsp;LM&nbsp;hash.</div></div><br /><br /><strong><h2>## NT Hashes</h2></strong><br />• NT stands for New Techonology<br />• Modern<br />   ◇ Used from Windows Vista and Windows Server 2008 onwards<br />• But still old<br />   ◇ First used on Windows NT 1993 and haven&#39;t been updated since<br />• Still weak<br />   ◇ 1 round of md4 with no salt<br /><br /><strong>Crack?</strong> - Yes!<br /><strong>Pass the hash?</strong> - Yes!<br /><br />From Windows Vista and Server 2008 onwards, only the NT hash is stored.<br />Therefore, a password dump has an empty LM hash - <code>aad3b4...</code> - followed by the NT hash<br /><code>luigi:1004:aad3b435b51404eeaad3b435b51404ee:[ NT hash]:::</code><br /><br />NT hashes get referred to as NTLM hashes,<br />because people use/crack them with the LM and NT hashes together, like this:<br /><code>luigi:1004:[ empty LM hash]:[ NT hash]:::</code><br /><code>luigi:1004:aad3b435b51404eeaad3b435b51404ee:41fdea6cb0d9e64b4745fc8696b0e948:::</code><br /><br /><strong>Encryption algorithm</strong><br /><div class="codebox"><div class="codebox">MD4(UTF-16-LE(password))</div></div><br /><br /><strong><h2>## Net-NTLM v1/v2</h2></strong><br />Net-NTLM hashes are used for network authentication.<br />The hashes are derived from a challenge/response algorithm against the NTLM protocol and are based on the user&#39;s NT hash.<br /><br />Documentation of NTLM challenge/response process available here:<br /><a href="https://book.hacktricks.xyz/windows/ntlm#basic-ntlm-domain-authentication-scheme">https://book.hacktricks.xyz/windows/ntlm#basic-ntlm-domain-authentication-scheme</a><br /><br /><strong>Crack?</strong> - Yes!<br /><strong>Pass the hash?</strong> - No!<br /><strong>Replay?</strong> - Yes!<br /><br /><strong><h3>### Net-NTLM v1</h3></strong><br />v1 of the protocol uses both the NT and LM hash, depending on configuration.<br /><br /><strong>Example</strong><br /><code>bob::kNS:338d08f8e26de93300000000000000000000000000000000:9526fb8c23a90751cdd619b6cea564742e1e4bf33006ba41:cb8086049ec4736c</code><br /><br /><strong>Encryption Algorithm</strong><br /><div class="codebox"><div class="codebox">C&nbsp;=&nbsp;8-byte&nbsp;server&nbsp;challenge,&nbsp;random<br />K1&nbsp;|&nbsp;K2&nbsp;|&nbsp;K3&nbsp;=&nbsp;LM/NT-hash&nbsp;|&nbsp;5-bytes-0<br />response&nbsp;=&nbsp;DES(K1,C)&nbsp;|&nbsp;DES(K2,C)&nbsp;|&nbsp;DES(K3,C)</div></div><br /><br /><strong><h3>### Net-NTLM v2</h3></strong><br />v2 was made to be hardened against spoofing attacks, but is still vulnerable.<br />The default in Windows 2000 and above.<br /><br /><strong>Example</strong><br /><code>admin::N46iSNekpT:08ca45b7d7ea58ee:88dcbe4446168966a153a0064958dac6:5c7830315c7830310000000000000b45c67103d07d7b95acd12ffa11230e0000000052920b85f78d013c31cdb3b92f5d765c783030</code><br /><br /><strong>Encryption Algorightm</strong><br /><div class="codebox"><div class="codebox">SC&nbsp;=&nbsp;8-byte&nbsp;server&nbsp;challenge,&nbsp;random<br />CC&nbsp;=&nbsp;8-byte&nbsp;client&nbsp;challenge,&nbsp;random<br />CC*&nbsp;=&nbsp;(X,&nbsp;time,&nbsp;CC2,&nbsp;domain&nbsp;name)<br />v2-Hash&nbsp;=&nbsp;HMAC-MD5(NT-Hash,&nbsp;user&nbsp;name,&nbsp;domain&nbsp;name)<br />LMv2&nbsp;=&nbsp;HMAC-MD5(v2-Hash,&nbsp;SC,&nbsp;CC)<br />NTv2&nbsp;=&nbsp;HMAC-MD5(v2-Hash,&nbsp;SC,&nbsp;CC*)<br />response&nbsp;=&nbsp;LMv2&nbsp;|&nbsp;CC&nbsp;|&nbsp;NTv2&nbsp;|&nbsp;CC*</div></div><br /></div>
</body>
</html>
