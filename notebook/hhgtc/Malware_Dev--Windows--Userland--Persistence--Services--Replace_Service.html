<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Replace Service</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><strong><h1># Replace a Service</h1></strong><br />Source is from Carberp <code>svc_fuckup.cpp</code>:<br />• <a href="http://docsresearch.com/research/Files/Progs/Malware/Carberp/Source/">http://docsresearch.com/research/Files/Progs/Malware/Carberp/Source/</a><br />• <a href="https://github.com/hryuk/Carberp/blob/master/source%20-%20absource/pro/all%20source/BJWJ/source/Common/svc_fuckup.cpp">https://github.com/hryuk/Carberp/blob/master/source%20-%20absource/pro/all%20source/BJWJ/source/Common/svc_fuckup.cpp</a><br /><br />Translation from file:<br /><div class="codebox"><div class="codebox">Brief&nbsp;algorithm&nbsp;of&nbsp;work:<br /><br />FuckupSvc&nbsp;()<br />-&nbsp;makes&nbsp;EnumServices<br />-&nbsp;for&nbsp;each&nbsp;service&nbsp;with&nbsp;the&nbsp;SERVICE_STOPPED&nbsp;status&nbsp;-&nbsp;makes&nbsp;TryToFuckup&nbsp;()<br />-&nbsp;if&nbsp;TryToFuckup&nbsp;()&nbsp;returns&nbsp;OK&nbsp;-&nbsp;stop&nbsp;running&nbsp;through&nbsp;the&nbsp;list<br /><br /><br />TryToFuckup&nbsp;()<br />1-&nbsp;gets&nbsp;information&nbsp;about&nbsp;the&nbsp;service&nbsp;by&nbsp;opening&nbsp;it&nbsp;with&nbsp;full&nbsp;rights<br /><br />2-&nbsp;if&nbsp;the&nbsp;rules&nbsp;are&nbsp;met&nbsp;for&nbsp;the&nbsp;service:<br />&nbsp;&nbsp;&nbsp;-&nbsp;StartType&nbsp;does&nbsp;not&nbsp;equal&nbsp;SERVICE_DISABLED<br />&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;path&nbsp;does&nbsp;not&nbsp;contain&nbsp;&quot;svchost.exe&quot;<br />&nbsp;&nbsp;&nbsp;-&nbsp;username&nbsp;contains&nbsp;LocalSystem<br />&nbsp;&nbsp;&nbsp;<br />do&nbsp;3,&nbsp;otherwise&nbsp;we&nbsp;leave<br /><br />3-&nbsp;lpBinaryPathName&nbsp;is&nbsp;supposed&nbsp;to&nbsp;have&nbsp;parameters,&nbsp;so<br />&nbsp;&nbsp;&nbsp;get&nbsp;the&nbsp;full&nbsp;path&nbsp;to&nbsp;the&nbsp;service&nbsp;executable&nbsp;file.<br /><br />4-&nbsp;add&nbsp;service&nbsp;file&nbsp;to&nbsp;SfcException<br /><br />5-&nbsp;rename&nbsp;the&nbsp;service&nbsp;file&nbsp;to&nbsp;&lt;path&gt;&nbsp;_&nbsp;(c:&nbsp;\&nbsp;d&nbsp;\&nbsp;e.exe&nbsp;-&gt;&nbsp;c:&nbsp;\&nbsp;d&nbsp;\&nbsp;e.exe_)<br /><br />6-&nbsp;copy&nbsp;ourselves&nbsp;to&nbsp;the&nbsp;place&nbsp;of&nbsp;the&nbsp;service&nbsp;file<br /><br />7&nbsp;-&nbsp;run&nbsp;and&nbsp;wait&nbsp;until&nbsp;it&nbsp;completes<br /><br />8&nbsp;-&nbsp;delete&nbsp;ourselves<br /><br />9&nbsp;-&nbsp;restore&nbsp;the&nbsp;service&nbsp;file&nbsp;to&nbsp;the&nbsp;old&nbsp;location&nbsp;</div></div><br /></div>
</body>
</html>
