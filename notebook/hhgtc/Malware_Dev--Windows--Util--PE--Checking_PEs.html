<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Checking PEs</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><div class="codebox"><div class="codebox">BOOL&nbsp;IsValidDOS(void*&nbsp;pe_buf)<br />{<br />	BOOL&nbsp;valid&nbsp;=&nbsp;FALSE;<br />	PIMAGE_DOS_HEADER&nbsp;dos_header&nbsp;=&nbsp;(PIMAGE_DOS_HEADER)pe_buf;<br />	if&nbsp;(dos_header-&gt;e_magic&nbsp;==&nbsp;IMAGE_DOS_SIGNATURE)<br />		valid&nbsp;=&nbsp;TRUE;<br /><br />	return&nbsp;valid;<br />}<br /><br />BOOL&nbsp;IsValidPE(void*&nbsp;pe_buf)<br />{<br />	BOOL&nbsp;valid&nbsp;=&nbsp;TRUE;<br />	PIMAGE_DOS_HEADER&nbsp;dos_header&nbsp;=&nbsp;(PIMAGE_DOS_HEADER)pe_buf;<br />	PIMAGE_NT_HEADERS&nbsp;pe_header&nbsp;=&nbsp;(PIMAGE_NT_HEADERS)((size_t)pe_buf&nbsp;+&nbsp;dos_header-&gt;e_lfanew);<br />	if&nbsp;(pe_header-&gt;Signature&nbsp;==&nbsp;IMAGE_NT_SIGNATURE)<br />		valid&nbsp;=&nbsp;TRUE;<br /><br />	return&nbsp;valid;<br />}<br /><br />BOOL&nbsp;IsPEValidForArch(void*&nbsp;pe_buf)<br /><span style="color:#000000;font-weight:400">{</span><br />	BOOL&nbsp;valid&nbsp;=&nbsp;TRUE;<br />	PIMAGE_DOS_HEADER&nbsp;dos_header&nbsp;=&nbsp;(PIMAGE_DOS_HEADER)pe_buf;<br />	PIMAGE_NT_HEADERS&nbsp;pe_header&nbsp;=&nbsp;(PIMAGE_NT_HEADERS)((size_t)pe_buf&nbsp;+&nbsp;dos_header-&gt;e_lfanew);<br /><br />	int&nbsp;this_arch&nbsp;=&nbsp;0;<br />#ifdef&nbsp;_WIN64<br />	this_arch&nbsp;=&nbsp;IMAGE_FILE_MACHINE_AMD64;<br />#else<br />	this_arch&nbsp;=&nbsp;IMAGE_FILE_MACHINE_I386;<br />#endif<br /><br />	if&nbsp;(pe_header-&gt;FileHeader.Machine&nbsp;==&nbsp;this_arch)<br />		valid&nbsp;=&nbsp;TRUE;<br /><br />	return&nbsp;valid;<br /><span style="color:#000000;font-weight:400">}</span></div></div></div>
</body>
</html>
