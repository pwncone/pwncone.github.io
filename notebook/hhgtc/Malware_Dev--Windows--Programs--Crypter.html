<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Crypter</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><strong><h1># Crypter</h1></strong><br />Crypters are tools which encrypt malware to evade signature based antivirus detection (becaus the payload is encrypted.)<br />Often, they go one step further and evade dynamic anlaysis by using a technique like process hollowing to execute the payload executable from memory.<br />Crypters encrypt.<br />And they usually put anti-analysis and anti-debugging tricks around the file too.<br /><br />Crypters only really exist within the malware sphere, and they&#39;re used as a means of rendering the payload executable contained within it (mimikatz, ransomware, whatever) as undetectable to antivirus. <br /><br /><strong><h2>## Examples</h2></strong><br /><strong><h3>Info</h3></strong><br />• <a href="https://ethanheilman.tumblr.com/post/128708937890/a-brief-examination-of-hacking-teams-crypter">https://ethanheilman.tumblr.com/post/128708937890/a-brief-examination-of-hacking-teams-crypter</a><br />• <a href="https://blog.malwarebytes.com/cybercrime/malware/2017/03/explained-packer-crypter-and-protector/">https://blog.malwarebytes.com/cybercrime/malware/2017/03/explained-packer-crypter-and-protector/</a><br /><br /><strong><h3>Tutorials &amp; Examples</h3></strong><br />• <a href="https://github.com/NYAN-x-CAT/Lime-Crypter">https://github.com/NYAN-x-CAT/Lime-Crypter</a><br />• <a href="https://github.com/aeshes/exe_crypter">https://github.com/aeshes/exe_crypter</a> - Very good example<br />• <a href="https://github.com/hackedteam/core-packer/tree/master/core-packer">https://github.com/hackedteam/core-packer/tree/master/core-packer</a><br />• <a href="https://github.com/phil993/PE-Crypter">https://github.com/phil993/PE-Crypter</a> - havent checked<br />• <a href="https://github.com/hMihaiDavid/addscn/tree/master/addscn">https://github.com/hMihaiDavid/addscn/tree/master/addscn</a> - add section to PE file<br />• <a href="https://iwantmore.pizza/posts/PEzor.html">https://iwantmore.pizza/posts/PEzor.html</a> - Not a packer as it says. Or even a crypter. It stores obfuscated shellcode, removes hooks to prevent detection of memory allocation, loads the shellcode into memory, and executes it. Also includes anti debug.<br /><br /><strong><h2>## Storing the Crypted File</h2></strong><br />There are many different ways to implement crypters and where to store the encrypted file.<br /><br /><strong><h3>### PE Resource Crypter</h3></strong><br />PE files have a Resource section - <code>.rsrc</code> - in which developers can store data for their program: a language pack, GUI icons, etc.<br />This is also a convenient place store an encrypted executable, and makes for createing an easy an crypter because the Windows API provides functions for adding and extracting these resources: <br /><br /><a href="https://docs.microsoft.com/en-us/windows/win32/menurc/using-resources">https://docs.microsoft.com/en-us/windows/win32/menurc/using-resources</a><br /><a href="https://docs.microsoft.com/en-us/windows/win32/menurc/adding-deleting-and-replacing-resources">https://docs.microsoft.com/en-us/windows/win32/menurc/adding-deleting-and-replacing-resources</a><br /><br /><strong><h3>### Using PE sections</h3></strong><br />You could add an extra PE section, like <code>.enc</code> - and store your encrypted executable in there.<br />There are several ways of doing this.<br /><br /><strong>#### Create a section at compile time</strong><br />This requires having access to the source code of the binary you want to encrypt.<br />Within your source code, you create 2 sections:<br />• <code>.hide</code> - which contains the code you want to encrypt (the main bulk of the program, presumably)<br />• <code>.stub</code> - which contains code to find the <code>.hide</code> sectoin and the decryption routine<br /><br />Using compiler flags, you can easily create these sections in your PE file.<br />This technique is outlined in Bill Blunden&#39;s book <code>The Rootkit Arsenal</code>. All credit goes there.<br /><br /><strong>#### Add a section to a PE file</strong><br />Add a section to an existing PE file.<br />There&#39;s 2 ways you can go with this:<br />attach a section to the original PE that decrypts and loads it<br />or attach a section containing the encrypted PE to a loader PE file which will decrypt and load the section.<br /><br />• <a href="https://github.com/hMihaiDavid/addscn/tree/master/addscn">https://github.com/hMihaiDavid/addscn/tree/master/addscn</a><br />• <a href="http://www.rohitab.com/discuss/topic/41911-pe-header-sections/">http://www.rohitab.com/discuss/topic/41911-pe-header-sections/</a><br />• <a href="http://www.rohitab.com/discuss/topic/41466-add-a-new-pe-section-code-inside-of-it/">http://www.rohitab.com/discuss/topic/41466-add-a-new-pe-section-code-inside-of-it/</a></div>
</body>
</html>
