<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Metasploit</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><strong><h1># Metasploit</h1></strong><br />• Metasploit is an all-in-one pentesting extravaganza<br />• It&#39;s an open-source platform written in Ruby and owned by Rapid7<br /><br /><strong>Links</strong><br />• <a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Metasploit%20-%20Cheatsheet.md">https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Metasploit%20-%20Cheatsheet.md</a><br /><br /><strong><h2>## Tips</h2></strong><br /><strong><h3>### Proxy traffic through Burp</h3></strong><br /><code>set Proxies HTTP:127.0.0.1:8080</code><br /><code>set ReverseAllowProxy true</code><br /><br /><strong><h2>## Commands</h2></strong><br /><strong><h3>### General</h3></strong><br /><code>msfconsole</code><br /><code>msfconsole -q</code><br /><br /><code>show options</code> - show options of module<br /><code>set &lt;option&gt; &lt;value&gt;</code> - set a value for an option<br /><code>setg &lt;option&gt; &lt;value&gt;</code> - set a global value for an option<br /><br /><strong><h3>### Logs</h3></strong><br />• Metasploit logs findings about discovered hosts in a database<br /><br /><code>hosts</code> - show discovered information about hosts<br /><br /><strong><h3>### Sessions</h3></strong><br /><code>Ctrl + z</code> - background  a session<br /><code>sessions</code> - list sessions<br /><code>sessions -i &lt;id&gt;</code> - interact with a session<br /><code>sessions -u &lt;id&gt;</code> - upgrade a session to a meterpreter<br /><code>sessions -u &lt;id&gt; LPORT=4444 PAYLOAD_OVERRIDE=meterpreter/reverse_tcp HANDLER=false</code> - upgrade session to a meterpreter<br /><br /><code>sessions -c &lt;command&gt;</code> - execute a commd on multiple sessions<br /><code>sessions -i 10-20 -c &lt;command&gt;</code> - execute a command on sessions 10 to 20<br /><br /><strong><h2>## Script Metasploit Commands</h2></strong><br />You can put metasploit commnds into a <code>.rc</code> file and execute them with:<br /><code>msfconsole -r ./file.rc</code><br /><br /><strong><h3>### Auto-Migrate</h3></strong><br />• You exploit a system → the connection dies immediately<br />   ◇ The process is most likey dying on you<br />• You can write an auto-migrate script to immediately migrate to a persistent process after the exploit completes<br /><br />1. First, create an <code>.rc</code> file:<br /><code>root@kali:~/hackthebox/chatterbox# cat automigrate.rc<br />run post/windows/manage/migrate<br /></code><br />2. Set it to run on connection:<br /><code>msf exploit(multi/handler) &gt; set AutoRunScript multi_console_command -r /root/automigrate.rc</code><br /><br /><strong><h2>## Payloads</h2></strong><br />Metasploit has 2 types of payload:<br />• non-staged<br />• staged<br /><br /><strong><h3>### Non-Staged Payloads</h3></strong><br />• Non-staged payloads are sent all in one go<br />• Denoted by a <code>_<br /></code>   ◇ e.g. <code>windows/shell_reverse_tcp</code><br /><br /><strong><h3>### Staged Payloads</h3></strong><br />• Staged payloads are sent in 2 parts<br />• Denoted by a <code>/</code><br />   ◇ e.g. <code>windows/shell/reverse_tcp</code><br />• With staged payloads, you HAVE to use metasploits <code>exploit/multi/handler</code> (because it handles the stager)<br /><br />• Part 1 - A small payload which connects back to the victim machine<br />• Part 2 - The rest of the payload gets downloaded and executed<br /><br /><strong>#### Why use staged payloads?</strong><br />• The vulnerability you&#39;re exploiting doesn&#39;t have a large enough buffer to hold a non-staged payload<br />• Antivirus software is detecting the malicious shellcode inside the non-staged payload.<br />  ◇ By using a staged payload instead, the downloader isn&#39;t detected as malicious and the exploit shellcode gets injected straight into memory, avoiding detection by antivirus<br />  <br /><strong><h2>## Modules</h2></strong><br />In metasploit, the modules are what do things.<br />I&#39;m keeping a list of useful ones.<br /><br /><strong><h3>### exploit/multi/script/web_delivery</h3></strong><br />Will produce payloads for delivering shells/exploits/files via the web.<br />Very useful.<br /><br /><code>use exploit/multi/script/web_delivery</code><br /></div>
</body>
</html>
