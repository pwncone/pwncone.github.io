<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Delete self</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><strong><h1># Delete self</h1></strong><br /><div class="codebox"><div class="codebox">/*<br />Deletes&nbsp;this&nbsp;current&nbsp;.exe&nbsp;by&nbsp;spawning&nbsp;a&nbsp;separate,&nbsp;hidden&nbsp;cmd&nbsp;prompt,&nbsp;sleeping&nbsp;N&nbsp;seconds,&nbsp;and&nbsp;then&nbsp;deleting.<br />You&nbsp;have&nbsp;N&nbsp;seconds&nbsp;to&nbsp;terminate&nbsp;your&nbsp;process&nbsp;after&nbsp;calling&nbsp;this&nbsp;function.<br /><br />N&nbsp;is&nbsp;currently&nbsp;set&nbsp;to&nbsp;20.<br /><br />Return&nbsp;value:<br />	In&nbsp;theory,&nbsp;one&nbsp;shouldn&#39;t&nbsp;be&nbsp;needed.&nbsp;But&nbsp;for&nbsp;the&nbsp;sake&nbsp;of&nbsp;error&nbsp;handling&nbsp;if&nbsp;the&nbsp;process&nbsp;fails&nbsp;to&nbsp;be&nbsp;created...<br />	Returns&nbsp;1&nbsp;if&nbsp;process&nbsp;failed&nbsp;to&nbsp;be&nbsp;created.<br />	Returns&nbsp;0&nbsp;on&nbsp;success.<br />*/<br />int&nbsp;delete_self()<br /><span style="color:#000000;font-weight:400">{</span><br />	//&nbsp;grab&nbsp;path&nbsp;of&nbsp;current&nbsp;.exe<br />	char&nbsp;exePath[225];<br />	GetModuleFileNameA(NULL,&nbsp;exePath,&nbsp;225);<br />	<br />	//&nbsp;concatenate&nbsp;command&nbsp;+&nbsp;path&nbsp;to&nbsp;this&nbsp;.exe<br />	char&nbsp;command[512]&nbsp;=&nbsp;&quot;C:\\Windows\\System32\\cmd.exe&nbsp;/c&nbsp;timeout&nbsp;10&nbsp;&gt;&nbsp;nul&nbsp;&amp;&nbsp;del&nbsp;&quot;;<br />	strcat_s(command,&nbsp;512,&nbsp;exePath);<br />	DBUG&nbsp;printf(&quot;[*]&nbsp;running&nbsp;%s&nbsp;\n&quot;,&nbsp;command);<br /><br />	//&nbsp;create&nbsp;process<br />	STARTUPINFOA&nbsp;startupInfo;<br />	PROCESS_INFORMATION&nbsp;processInfo;<br /><br />	ZeroMemory(&amp;startupInfo,&nbsp;sizeof(startupInfo));<br />	ZeroMemory(&amp;processInfo,&nbsp;sizeof(processInfo));<br /><br />	startupInfo.cb&nbsp;=&nbsp;sizeof(startupInfo);<br />	startupInfo.dwFlags&nbsp;=&nbsp;STARTF_USESTDHANDLES&nbsp;|&nbsp;STARTF_USESHOWWINDOW;<br />	startupInfo.wShowWindow&nbsp;=&nbsp;SW_HIDE;					//&nbsp;hide&nbsp;window&nbsp;of&nbsp;spawned&nbsp;process&nbsp;from&nbsp;showing&nbsp;up<br /><br />	if&nbsp;(CreateProcessA(NULL,&nbsp;command,&nbsp;NULL,&nbsp;NULL,&nbsp;TRUE,&nbsp;CREATE_NEW_CONSOLE,&nbsp;NULL,&nbsp;NULL,&nbsp;&amp;startupInfo,&nbsp;&amp;processInfo)&nbsp;==&nbsp;0)<br />	{<br />		fprintf(stderr,&nbsp;&quot;[error]&nbsp;failed&nbsp;to&nbsp;create&nbsp;process:&nbsp;%d&nbsp;\n&quot;,&nbsp;GetLastError());<br />		return&nbsp;1;<br />	}<br /><br />	return&nbsp;0;<br /><span style="color:#000000;font-weight:400">}</span></div></div><br /><br /></div>
</body>
</html>
