<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>KeePass</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><strong><h1># Password Cracking - KeePass</h1></strong><br />To open a KeePass database, the user can choose to require both a password <em>and</em> a key file, or just 1 of them.<br /><br /><strong><h2>## Extract KeePass Hash</h2></strong><br /><strong><h3>### keepass2john</h3></strong><br />You can extract/generate keepass hashes to be cracked with <code>john</code> using <code>keypass2john</code>, <br />and providing a key file and the database.<br /><div class="codebox"><div class="codebox">root@city64:~/ctf/safe/user#&nbsp;keepass2john<br />Usage:&nbsp;keepass2john&nbsp;[-k&nbsp;&lt;keyfile&gt;]&nbsp;&lt;.kdbx&nbsp;database(s)&gt;</div></div><br /><br /><code>keepass2john keypass-database.kdbx</code><br /><code>-k &lt;key file&gt;</code><br /><br />You can run <code>keepass2john</code> both with no key and a key file<br /><div class="codebox"><div class="codebox">root@city64:~/ctf/safe/user#&nbsp;keepass2john&nbsp;MyPasswords.kdbx&nbsp;&gt;&nbsp;hashes.txt<br />root@city64:~/ctf/safe/user#&nbsp;keepass2john&nbsp;-k&nbsp;IMG_0545.JPG&nbsp;MyPasswords.kdbx&nbsp;&gt;&gt;&nbsp;hashes.txt<br />...</div></div><br /><br /><strong><h2>## Crack</h2></strong><br /><strong><h3>### john</h3></strong><br />If you&#39;ve extracted a keepass hash with <code>keepass2john</code>, then you can crack the hash with <code>john</code><br /><code>john --wordlist=/usr/share/wordlists/rockyou.txt --format=KeePass hashes.txt</code><br /><br /><div class="codebox"><div class="codebox">root@city64:~/ctf/safe/user#&nbsp;john&nbsp;--wordlist=/usr/share/seclists/Passwords/darkweb2017-top10000.txt&nbsp;--format=KeePass&nbsp;hashes.txt<br />Using&nbsp;default&nbsp;input&nbsp;encoding:&nbsp;UTF-8<br />Loaded&nbsp;7&nbsp;password&nbsp;hashes&nbsp;with&nbsp;7&nbsp;different&nbsp;salts&nbsp;(KeePass&nbsp;[SHA256&nbsp;AES&nbsp;32/64&nbsp;OpenSSL])<br />Cost&nbsp;1&nbsp;(iteration&nbsp;count)&nbsp;is&nbsp;60000&nbsp;for&nbsp;all&nbsp;loaded&nbsp;hashes<br />Cost&nbsp;2&nbsp;(version)&nbsp;is&nbsp;2&nbsp;for&nbsp;all&nbsp;loaded&nbsp;hashes<br />Cost&nbsp;3&nbsp;(algorithm&nbsp;[0=AES,&nbsp;1=TwoFish,&nbsp;2=ChaCha])&nbsp;is&nbsp;0&nbsp;for&nbsp;all&nbsp;loaded&nbsp;hashes<br />Will&nbsp;run&nbsp;2&nbsp;OpenMP&nbsp;threads<br />Press&nbsp;&#39;q&#39;&nbsp;or&nbsp;Ctrl-C&nbsp;to&nbsp;abort,&nbsp;almost&nbsp;any&nbsp;other&nbsp;key&nbsp;for&nbsp;status<br />0g&nbsp;0:00:00:03&nbsp;0.31%&nbsp;(ETA:&nbsp;12:38:49)&nbsp;0g/s&nbsp;7.920p/s&nbsp;68.64c/s&nbsp;68.64C/s&nbsp;myspace1..target123<br />0g&nbsp;0:00:00:52&nbsp;4.94%&nbsp;(ETA:&nbsp;12:39:58)&nbsp;0g/s&nbsp;9.527p/s&nbsp;67.30c/s&nbsp;67.30C/s&nbsp;edward..135790<br />bullshit&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(MyPasswords47)<br />1g&nbsp;0:00:03:07&nbsp;21.91%&nbsp;(ETA:&nbsp;12:36:39)&nbsp;0.005345g/s&nbsp;11.84p/s&nbsp;77.49c/s&nbsp;77.49C/s&nbsp;marcos..22222<br />1g&nbsp;0:00:09:59&nbsp;DONE&nbsp;0.001668g/s&nbsp;16.68p/s&nbsp;102.0c/s&nbsp;102.0C/s&nbsp;21..starstar<br />Use&nbsp;the&nbsp;&quot;--show&quot;&nbsp;option&nbsp;to&nbsp;display&nbsp;all&nbsp;of&nbsp;the&nbsp;cracked&nbsp;passwords&nbsp;reliably<br />Session&nbsp;completed</div></div><br /><br /><strong><h2>## Navigate KeePass via Terminal wtih kpcli</h2></strong><br /><code>kpcli</code> can be used to open KeePass database via the command line on Linux.<br />In the example below there was no password to the database. <br />Only a key file was used to open the database, which was an image - <code>IMG_0547.jpg</code><br /><br />I could open the KeePass database with the key file - the image - and then found the <code>root</code>&#39;s password.<br /><br /><code>open &lt;file.kdb&gt; [&lt;file.key&gt;])</code> - opens a password database.<br /><code>show &lt;entry number&gt;</code> - displays an entry (password will be red text on red background - hidden)<br /><code>show -f &lt;entry number&gt;</code> - displays an entry&#39;s password in plaintext <br /><br /><strong><h3>### Password Is Hidden</h3></strong><br />When you <code>show</code> an entry, the password will be printed as red text on a red background.<br />This is to hide the password from terminal peekers.<br />(otherwise it prints it as red text on a red background)<br /><br />To bypass this, you can:<br />• <code>show -f</code> - will display the password in plaintext with no distortion<br />• copy/paste the red text on red background password into another source, and the password will show<br /><br /><div class="codebox"><div class="codebox">root@city64:~/ctf/safe/user#&nbsp;apt&nbsp;install&nbsp;kpcli<br />...<br />root@city64:~/ctf/safe/user#&nbsp;kpcli<br /><br />KeePass&nbsp;CLI&nbsp;(kpcli)&nbsp;v3.1&nbsp;is&nbsp;ready&nbsp;for&nbsp;operation.<br />Type&nbsp;&#39;help&#39;&nbsp;for&nbsp;a&nbsp;description&nbsp;of&nbsp;available&nbsp;commands.<br />Type&nbsp;&#39;help&nbsp;&lt;command&gt;&#39;&nbsp;for&nbsp;details&nbsp;on&nbsp;individual&nbsp;commands.<br /><br />kpcli:/&gt;&nbsp;help<br />&nbsp;&nbsp;...<br />&nbsp;&nbsp;&nbsp;&nbsp;open&nbsp;--&nbsp;Open&nbsp;a&nbsp;KeePass&nbsp;database&nbsp;file&nbsp;(open&nbsp;&lt;file.kdb&gt;&nbsp;[&lt;file.key&gt;])<br />&nbsp;&nbsp;&nbsp;...<br />&nbsp;&nbsp;&nbsp;&nbsp;show&nbsp;--&nbsp;Show&nbsp;an&nbsp;entry:&nbsp;show&nbsp;[-f]&nbsp;[-a]&nbsp;&lt;entry&nbsp;path|entry&nbsp;number&gt;<br />&nbsp;&nbsp;&nbsp;...<br /><br />kpcli:/&gt;&nbsp;open&nbsp;MyPasswords.kdbx&nbsp;IMG_0547.JPG<br />Please&nbsp;provide&nbsp;the&nbsp;master&nbsp;password:&nbsp;*************************<br />kpcli:/&gt;&nbsp;ls<br />===&nbsp;Groups&nbsp;===<br />MyPasswords/<br />kpcli:/&gt;&nbsp;cd&nbsp;MyPasswords<br />kpcli:/MyPasswords&gt;&nbsp;ls<br />===&nbsp;Groups&nbsp;===<br />eMail/<br />General/<br />Homebanking/<br />Internet/<br />Network/<br />Recycle&nbsp;Bin/<br />Windows/<br />===&nbsp;Entries&nbsp;===<br />0.&nbsp;Root&nbsp;password&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br /><br />kpcli:/MyPasswords&gt;&nbsp;show&nbsp;-f&nbsp;0<br /><br />Title:&nbsp;Root&nbsp;password<br />Uname:&nbsp;root<br />&nbsp;Pass:&nbsp;u3v2249dl9ptv465cogl3cnpo3fyhk<br />&nbsp;&nbsp;URL:&nbsp;<br />Notes:&nbsp;</div></div><br /><br /></div>
</body>
</html>
