<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>NtQueryInformationProcess</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><strong><h1># NtQueryInformationProcess</h1></strong><br /><a href="https://docs.microsoft.com/en-us/windows/win32/api/winternl/nf-winternl-ntqueryinformationprocess">https://docs.microsoft.com/en-us/windows/win32/api/winternl/nf-winternl-ntqueryinformationprocess</a><br /><br />There are 2 things you can check:<br />• <code>ProcessDebugPort</code><br />• <code>ProcessDebugFlags</code><br /><br /><strong><h2>## Code</h2></strong><br /><div class="codebox"><div class="codebox">/*<br />Doesn&#39;t&nbsp;work&nbsp;in&nbsp;x64dbg.&nbsp;<br />Haven&#39;t&nbsp;fully&nbsp;tested&nbsp;because&nbsp;I&#39;m&nbsp;getting&nbsp;complacement.<br />*/<br />#include&nbsp;&lt;stdio.h&gt;<br />#include&nbsp;&lt;Windows.h&gt;<br />#include&nbsp;&lt;winternl.h&gt;<br /><br />#pragma&nbsp;comment(lib,&nbsp;&quot;Ntdll.lib&quot;)<br /><br />int&nbsp;main(void)<br /><span style="color:#000000;font-weight:400">{</span><br />	DWORD&nbsp;debugger_present&nbsp;=&nbsp;0;<br /><br />	//&nbsp;query&nbsp;ProcessDebugPort&nbsp;-&nbsp;returns&nbsp;port&nbsp;number&nbsp;if&nbsp;being&nbsp;debugged&nbsp;by&nbsp;ring3&nbsp;debugger<br />	//NtQueryInformationProcess(GetCurrentProcess(),&nbsp;ProcessDebugPort,&nbsp;&amp;debugger_present,&nbsp;sizeof(DWORD),&nbsp;NULL);<br />	//&nbsp;query&nbsp;ProcessDebugFlags&nbsp;-&nbsp;0x1F&nbsp;-&nbsp;value&nbsp;is&nbsp;undocumented&nbsp;-&nbsp;i&nbsp;assume&nbsp;it&nbsp;returns&nbsp;&gt;&nbsp;0&nbsp;if&nbsp;debugging&nbsp;is&nbsp;happening,&nbsp;i.e.&nbsp;there&#39;s&nbsp;debug&nbsp;flags&nbsp;set<br />	NtQueryInformationProcess(GetCurrentProcess(),&nbsp;0x1F,&nbsp;&amp;debugger_present,&nbsp;sizeof(DWORD),&nbsp;NULL);<br /><br />	if&nbsp;(debugger_present&nbsp;&gt;&nbsp;0)<br />		return&nbsp;1;<br /><br />	printf(&quot;hey&nbsp;:)&nbsp;\n&quot;);<br /><br />	return&nbsp;0;<br /><span style="color:#000000;font-weight:400">}</span></div></div></div>
</body>
</html>
