<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>53 - DNS</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><strong><h1># Port 53 - DNS</h1></strong><br />DNS stands for Domain Name System.<br />DNS resolves domain names - <code>google.com</code> - to IP addresses - <code>8.8.8.8</code><br /><br /><strong><h2>## Checklist</h2></strong><br />• Grab version<br />• Check for exploits<br />• Perform recon<br />   ◇ <a href="https://dnsdumpster.com/">https://dnsdumpster.com/</a><br />• Attempt zone transfer<br />• Grab info<br /><br /><strong><h2>## Grab version</h2></strong><br />There&#39;s no DNS &quot;banner&quot; to grab, but you might be able to retrieve the version using a request that works on most BIND nameservers<br /><code>dig version.bind CHAOS TXT @DNS</code><br /><br />Can also use fingerprinting techniques via tools:<br /><code>fpdns</code><br /><code>nmap -p 53 -sV --script dns-nsid 10.11.0.4</code><br /><br /><strong>Find Microsoft OS based on Version</strong><br />   ◇ 7601 = Microsoft Server 2008 R2 or Windows 7 SP1<br />   ◇ 9000 = Server 2012 or Windows 8<br />   ◇ 9000+ = Server 2016<br /><br /><strong><h2>## DNS Zone Transfer</h2></strong><br />The DNS zone file contains a list of all the DNS names configured for that zone.<br />Admins often misconfigure their DNS servers. As a result, anyone asking for a copy of the DNS server zone will receive one (this is the equivalent of handing a hacker the corporate network layout on a silver platter)<br /><br /><strong>Tools</strong><br />• DNSRecon (python script)<br />   ◇ <code>dnsrecon -d active.htb -a -n &lt;IP_DNS&gt;</code><br />• DNSenum (some kind of script)<br />• fierce<br />   ◇ Will try toperform a zone transfer against every authoritative name server and if this doesn&#39;t work, will launch a dictionary attack<br />   ◇ <code>fierce -dns &lt;DOMAIN&gt;</code><br /><br /><strong>Manually</strong><br />• <strong>host</strong><br />   ◇ -l is the List mode. This makes the host perform a zone transfer<br />   ◇ <code>host -l &lt;domain name&gt; &lt;dns server address&gt;</code><br />      ▪ e.g. <code>host -l megacorpone.com ns1.megacorpone.com</code><br />      ▪ e.g. <code>host -l friendzone.red 10.10.10.123</code><br />• <strong>dig</strong><br />   ◇ <code>@</code> specifies a DNS server<br />   ◇ Try zone transfer wihtout domain<br />      ▪ <code>dig AXFR @&lt;dns ip&gt;</code><br />   ◇ Try zone transfer with guessing the domain<br />      ▪ <code>dig AXFR friendzone.red @10.10.10.123 -p &lt;port&gt;</code><br /><br /><strong><h3>### Zone Transfer - Bash script</h3></strong><br /><div class="codebox"><div class="codebox">#/bin/bash&nbsp;<br />#&nbsp;Simple&nbsp;Zone&nbsp;Transfer&nbsp;Bash&nbsp;Script&nbsp;<br />#&nbsp;$1&nbsp;is&nbsp;the&nbsp;first&nbsp;argument&nbsp;given&nbsp;after&nbsp;the&nbsp;bash&nbsp;script<br />#&nbsp;Check&nbsp;if&nbsp;argument&nbsp;was&nbsp;given,&nbsp;if&nbsp;not,&nbsp;print&nbsp;usage&nbsp;<br />if&nbsp;[&nbsp;-z&nbsp;&quot;$1&quot;&nbsp;];&nbsp;then&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;&quot;[*]&nbsp;Simple&nbsp;Zone&nbsp;transfer&nbsp;script&quot;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;&quot;[*]&nbsp;Usage&nbsp;:&nbsp;$0&nbsp;&lt;domain&nbsp;name&gt;&nbsp;&quot;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;&quot;[*]&nbsp;Example&nbsp;:&nbsp;$0&nbsp;aeoi.org.ir&nbsp;&quot;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exit&nbsp;0<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fi<br /><br />#&nbsp;if&nbsp;argument&nbsp;was&nbsp;given,&nbsp;identify&nbsp;the&nbsp;DNS&nbsp;servers&nbsp;for&nbsp;the&nbsp;domain&nbsp;<br />echo&nbsp;$1<br />#&nbsp;For&nbsp;each&nbsp;of&nbsp;these&nbsp;servers,&nbsp;attempt&nbsp;a&nbsp;zone&nbsp;transfer&nbsp;<br />for&nbsp;server&nbsp;in&nbsp;$(host&nbsp;-t&nbsp;ns&nbsp;$1&nbsp;|cut&nbsp;-d&quot;&nbsp;&quot;&nbsp;-f4);do&nbsp;<br />host&nbsp;-l&nbsp;$1&nbsp;$server&nbsp;|grep&nbsp;&quot;has&nbsp;address&quot;&nbsp;<br />done</div></div><br /><br /><strong><h2>## Grab info</h2></strong><br /><strong><h3>### dig</h3></strong><br /><div class="codebox"><div class="codebox">dig&nbsp;ANY&nbsp;@&lt;DNS_IP&gt;&nbsp;&lt;DOMAIN&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Any&nbsp;information<br />dig&nbsp;A&nbsp;@&lt;DNS_IP&gt;&nbsp;&lt;DOMAIN&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Regular&nbsp;DNS&nbsp;request<br />dig&nbsp;AAAA&nbsp;@&lt;DNS_IP&gt;&nbsp;&lt;DOMAIN&gt;&nbsp;&nbsp;&nbsp;&nbsp;#IPv6&nbsp;DNS&nbsp;request<br />dig&nbsp;TXT&nbsp;@&lt;DNS_IP&gt;&nbsp;&lt;DOMAIN&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Information<br />dig&nbsp;MX&nbsp;@&lt;DNS_IP&gt;&nbsp;&lt;DOMAIN&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Emails&nbsp;related<br />dig&nbsp;NS&nbsp;@&lt;DNS_IP&gt;&nbsp;&lt;DOMAIN&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#DNS&nbsp;that&nbsp;resolves&nbsp;that&nbsp;name<br />dig&nbsp;-x&nbsp;192.168.0.2&nbsp;@&lt;DNS_IP&gt;&nbsp;&nbsp;&nbsp;#Reverse&nbsp;lookup<br />dig&nbsp;-x&nbsp;2a00:1450:400c:c06::93&nbsp;@&lt;DNS_IP&gt;&nbsp;#reverse&nbsp;IPv6&nbsp;lookup<br /><br />#Use&nbsp;[-p&nbsp;PORT]&nbsp;&nbsp;or&nbsp;&nbsp;-6&nbsp;(to&nbsp;use&nbsp;ivp6&nbsp;address&nbsp;of&nbsp;dns)</div></div><br /><br /><strong><h3>### nslookup</h3></strong><br /><div class="codebox"><div class="codebox">nslookup<br />&gt;&nbsp;SERVER&nbsp;&lt;IP_DNS&gt;&nbsp;#Select&nbsp;dns&nbsp;server<br />&gt;&nbsp;127.0.0.1&nbsp;#Reverse&nbsp;lookup&nbsp;of&nbsp;127.0.0.1,&nbsp;maybe...<br />&gt;&nbsp;&lt;IP_MACHINE&gt;&nbsp;#Reverse&nbsp;lookup&nbsp;of&nbsp;a&nbsp;machine,&nbsp;maybe...</div></div><br /><br /><strong><h3>### Metasploit</h3></strong><br /><code>use auxiliary/gather/enum_dns</code><br /><br /><strong><h3>### Nmap</h3></strong><br /><code>nmap -n --script &quot;(default and *dns*) or fcrdns or dns-srv-enum or dns-random-txid or dns-random-srcport&quot; &lt;IP&gt;</code><br /><br /><br /></div>
</body>
</html>
