<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>wmic</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><strong><h1># wmic</h1></strong><br /><code>wmic</code> is command line tool to interact with WMI.<br /><br /><strong><h2>## Local WMI</h2></strong><br />Run WMI queries against the local system.<br /><br /><code>wmic</code> - drops you into an interactive session<br /><code>/?</code> - list commands<br /><code>wmic &lt;command&gt;</code> - run WMI commands<br />   ◇ use <code>list brief</code> for less detail, <code>list full</code> for more detail<br />   ◇ use <code>/format:list</code> for formatted output<br /><br /><strong><h3>### Execute Commands on Local Host</h3></strong><br /><code>ReturnValue = 0</code> means successfull<br /><br />Launch process locally<br /><div class="codebox"><div class="codebox">wmic&nbsp;path&nbsp;win32_process&nbsp;call&nbsp;create&nbsp;&quot;calc.exe&quot;</div></div><br /><br /><strong><h2>## Remote WMI</h2></strong><br />Run WMI queries against remote systems.<br /><br /><code>/node</code> - specify which host to query<br />    <code>/node:&quot;192.168.88.10&quot;</code> - If you have errors hostname, try using IP<br />    <code>/node:&quot;cdc-tokyo.umbrella.local&quot;</code><br />    <code>/node:@hosts.txt</code> - read nodes from a text file and execute against all of them<br /><code>/user</code> - specify credentials to use<br />• If already in cmdprompt as specific user, you don&#39;t need to specify /user<br />• (but do it anyway because problems might occur)<br /><br /><strong><h3>### Requires</h3></strong><strong><br /></strong>Port 135 - DCOM:<br />• DCOM/RPC been around forever<br />• 100% listening on domain controllers, not 100% on workstations<br />• Port 135 is used to establish an initial connection<br />• All subsequent data is then passed to a secondary port dictated by a registry key<br />   ◇ <code>HKEY_LOCAL_MACHINE\Software\Microsoft\Rpc\Internet - Ports (REG_MULTI_SZ)</code><br />      ▪ can modify this registry entry directly<br />      ▪ or use <code>dcomcnfg.exe</code><br /><br /><strong><h3>### Using Credentials</h3></strong><br />Creds used need to have the permissions to log into the remote machine<br />• Enterprise Admins -&gt; can query everything<br />• Local Administrators on Domain Controllers-&gt; take priveleges of the DC they&#39;re in - Enterprise Admin or Domain Admin<br />• Domain Admins -&gt; can query Domain Controllers they&#39;re admins of (and workstations?)<br />• Domain Users -&gt; can query workstations? (not sure, can&#39;t test because RPC not available on workstations in lab)<br /><br /><div class="codebox"><div class="codebox">wmic&nbsp;/node:&quot;root-dc.umbrella.local&quot;&nbsp;/user:UMBRELLA\Administrator&nbsp;/password:&quot;Password123!&quot;&nbsp;computersystem&nbsp;list&nbsp;brief&nbsp;/format:list<br /><br />wmic&nbsp;/node:&quot;192.168.88.10&quot;&nbsp;/user:UMBRELLA\Administrator&nbsp;/password:&quot;Password123!&quot;&nbsp;computersystem&nbsp;list&nbsp;brief&nbsp;/format:list</div></div><br /><br /><strong><h3>### Use WMI Classes via path</h3></strong><br />Can also interact with WMI classes via <code>path</code><br /><a href="https://docs.microsoft.com/en-us/windows/win32/cimwin32prov/win32-provider">https://docs.microsoft.com/en-us/windows/win32/cimwin32prov/win32-provider</a><br /><br />Find local admins on remote machine (domain = computer hostname)<br /><div class="codebox"><div class="codebox">wmic&nbsp;/node:&quot;root-dc.umbrella.local&quot;&nbsp;/user:UMBRELLA\Administrator&nbsp;/password:&quot;Password123!&quot;&nbsp;path&nbsp;win32_groupuser&nbsp;where&nbsp;(groupcomponent=&quot;win32_group.name=\&quot;administrators\&quot;,domain=\&quot;ROOT-DC\&quot;&quot;)</div></div><br /><br />Who is currently logged in on remote machine?<br /><div class="codebox"><div class="codebox">wmic&nbsp;/node:&quot;root-dc.umbrella.local&quot;&nbsp;/user:UMBRELLA\Administrator&nbsp;/password:&quot;Password123!&quot;&nbsp;path&nbsp;win32_loggedonuser&nbsp;get&nbsp;antecedent</div></div><br /><br /><strong><h3>### Execute Commands on Remote Hosts</h3></strong><br />The WMI <code>win32_process</code> class can be used to query, modify, terminate and create processes.<br /><a href="https://docs.microsoft.com/en-gb/windows/win32/cimwin32prov/win32-process?redirectedfrom=MSDN">https://docs.microsoft.com/en-gb/windows/win32/cimwin32prov/win32-process?redirectedfrom=MSDN</a><br /><br /><code>ReturnValue = 0</code> means successfull<br /><br />Launch process remotely (like reverse shells etc.)<br /><div class="codebox"><div class="codebox">wmic&nbsp;/node:&quot;root-dc.umbrella.local&quot;&nbsp;/user:UMBRELLA\Administrator&nbsp;/password:&quot;Password123!&quot;&nbsp;path&nbsp;win32_process&nbsp;call&nbsp;create&nbsp;&quot;powershell.exe&nbsp;&lt;reverse&nbsp;shell&gt;&quot;<br /></div></div><br /><br /></div>
</body>
</html>
