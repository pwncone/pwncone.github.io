<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Registry</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><strong><h1># Registry</h1></strong><br />The registry is actually a pain to work with.<br /><br />• <a href="https://superuser.com/questions/1032828/where-is-the-runservicesonce-registry-key">https://superuser.com/questions/1032828/where-is-the-runservicesonce-registry-key</a> - Really good breakdown of registry keys / search order<br />• <a href="https://blogs.blackberry.com/en/2013/08/windows-registry-persistence-part-1-introduction-attack-phases-and-windows-services">https://blogs.blackberry.com/en/2013/08/windows-registry-persistence-part-1-introduction-attack-phases-and-windows-services</a><br />• <a href="https://blogs.blackberry.com/en/2013/09/windows-registry-persistence-part-2-the-run-keys-and-search-order">https://blogs.blackberry.com/en/2013/09/windows-registry-persistence-part-2-the-run-keys-and-search-order</a><br /><br /><strong><h2>## Things to know about the registry</h2></strong><br /><strong><h3>### HKLM and HKCU</h3></strong><br />There are 7 root keys in the registry. The 2 most useful ones are:<br />• <code>HKEY_LOCAL_MACHINE</code> - writing here will create a system-wide registry key that will apply to all users<br />• <code>HKEY_CURRENT_USER</code> - writing here will create a registry key for just the current user<br /><br />These are often shortened to <code>HKLM</code> and <code>HKCU</code><br />Not all registry keys will have both a <code>HKLM</code> and <code>HKCU</code> version, it might be just be one or the other.<br /><br />Administrator privileges are required to write to <code>HKEY_LOCAL_MACHINE</code>.<br /><code>HKEY_CURRENT_USER</code> is writeable by the current user.<br /><br /><strong><h3>### The 32bit registry on a 64bit machine</h3></strong><br /><a href="https://docs.microsoft.com/en-us/troubleshoot/windows-client/deployment/view-system-registry-with-64-bit-windows">https://docs.microsoft.com/en-us/troubleshoot/windows-client/deployment/view-system-registry-with-64-bit-windows</a><br /><a href="https://docs.microsoft.com/en-gb/windows/win32/sysinfo/32-bit-and-64-bit-application-data-in-the-registry?redirectedfrom=MSDN">https://docs.microsoft.com/en-gb/windows/win32/sysinfo/32-bit-and-64-bit-application-data-in-the-registry?redirectedfrom=MSDN</a><br /><br />If you run a 32bit application on a 64bit machine, it will most likely write to the 32bit portion of the registry.<br />This is usually in:<br /><code>HKEY_LOCAL_MACHINE\SOFTWARE\WOW6432Node\hello</code><br /><br />For example, the 64bit registry address might be:<br /><code>HKEY_LOCAL_MACHINE\SOFTWARE\hello</code><br />If a 32bit process tried to write to this location, it would be<br /><code>HKEY_LOCAL_MACHINE\SOFTWARE\WOW6432Node\hello</code><br /><br /><a href="https://docs.microsoft.com/en-us/windows/win32/winprog64/accessing-an-alternate-registry-view">https://docs.microsoft.com/en-us/windows/win32/winprog64/accessing-an-alternate-registry-view</a><br />With <code>RegCreateKeyEx</code>, <code>RegDeleteKeyEx</code>, and <code>RegOpenKeyEx</code>, you can use the parameters:<br />• <code>KEY_WOW64_64KEY</code>  - to access the 64bit registry from a 32bit process<br />• <code>KEY_WOW64_32KEY</code> - to access the 32bit registry from a 32bit or 64bit process<br /><br /></div>
</body>
</html>
