<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Return error & exit</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><strong><h1># Return error &amp; exit</h1></strong><br /><br /><strong><h2>## General</h2></strong><br /><strong><h3>### die() function</h3></strong><br />Source: <a href="https://github.com/torvalds/test-tlb/blob/master/test-tlb.c">https://github.com/torvalds/test-tlb/blob/master/test-tlb.c</a><br /><div class="codebox"><div class="codebox">static&nbsp;void&nbsp;die(const&nbsp;char&nbsp;*fmt,&nbsp;...)<br /><span style="color:#000000;font-weight:400">{</span><br />	va_list&nbsp;params;<br />	va_start(params,&nbsp;fmt);<br />	vfprintf(stderr,&nbsp;fmt,&nbsp;params);<br />	va_end(params);<br />	fputc(&#39;\n&#39;,&nbsp;stderr);<br />	exit(1);<br /><span style="color:#000000;font-weight:400">}</span></div></div><br /><br /><strong><h2>## WindowsAPI</h2></strong><br /><strong><h3>### Macro</h3></strong><br />Source: <a href="https://stackoverflow.com/questions/51839466/winapi-cryptdecrypt-not-working-properly-in-aes-256">https://stackoverflow.com/questions/51839466/winapi-cryptdecrypt-not-working-properly-in-aes-256</a><br /><div class="codebox"><div class="codebox">#define&nbsp;PRINT_FUNC_ERR_AND_RETURN(FUNC)&nbsp;\<br />&nbsp;&nbsp;&nbsp;&nbsp;printf(&quot;%s&nbsp;(line&nbsp;%d)&nbsp;failed:&nbsp;%d\n&quot;,&nbsp;##FUNC,&nbsp;__LINE__,&nbsp;GetLastError());&nbsp;\<br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;-1</div></div><br /><br />Source: <a href="https://github.com/can1357/ByePg/blob/cc698e79fc7aa11d3aff79af545e26a93fa104d6/ExceptionHookingDemo/main.cpp">https://github.com/can1357/ByePg/blob/cc698e79fc7aa11d3aff79af545e26a93fa104d6/ExceptionHookingDemo/main.cpp</a><br /><div class="codebox"><div class="codebox">#define&nbsp;Log(...)&nbsp;DbgPrintEx<span style="color:#000000;font-weight:400">(</span>&nbsp;DPFLTR_SYSTEM_ID,&nbsp;DPFLTR_ERROR_LEVEL,&nbsp;&quot;[ByePg]&nbsp;&quot;&nbsp;__VA_ARGS__&nbsp;<span style="color:#000000;font-weight:400">)</span></div></div><br /><br /><strong><h3>### OutputDebugString</h3></strong><br />Source: <a href="https://github.com/microsoft/Detours/blob/7b7977d964195b6378788dcfcba270d030bc7a1a/samples/dtest/dtest.cpp#L87">https://github.com/microsoft/Detours/blob/7b7977d964195b6378788dcfcba270d030bc7a1a/samples/dtest/dtest.cpp#L87</a><br /><div class="codebox"><div class="codebox">VOID&nbsp;dprintf(const&nbsp;char&nbsp;*&nbsp;fmt,&nbsp;...)<br /><span style="color:#000000;font-weight:400">{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;CHAR&nbsp;szBuf[1024];<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;va_list&nbsp;args;<br />&nbsp;&nbsp;&nbsp;&nbsp;va_start(args,&nbsp;fmt);<br />&nbsp;&nbsp;&nbsp;&nbsp;StringCchPrintfA(szBuf,&nbsp;sizeof(szBuf),&nbsp;fmt,&nbsp;args);<br />&nbsp;&nbsp;&nbsp;&nbsp;va_end(args);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;OutputDebugStringA(szBuf);<br /><span style="color:#000000;font-weight:400">}</span></div></div><br /><br /><strong><h3>### FormatMessage</h3></strong><br /><a href="https://docs.microsoft.com/en-us/windows/win32/debug/retrieving-the-last-error-code">https://docs.microsoft.com/en-us/windows/win32/debug/retrieving-the-last-error-code</a><br /><br /><div class="codebox"><div class="codebox">#include&nbsp;&lt;windows.h&gt;<br />#include&nbsp;&lt;strsafe.h&gt;<br /><br />void&nbsp;ErrorExit(LPTSTR&nbsp;lpszFunction)&nbsp;<br />{&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Retrieve&nbsp;the&nbsp;system&nbsp;error&nbsp;message&nbsp;for&nbsp;the&nbsp;last-error&nbsp;code<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;LPVOID&nbsp;lpMsgBuf;<br />&nbsp;&nbsp;&nbsp;&nbsp;LPVOID&nbsp;lpDisplayBuf;<br />&nbsp;&nbsp;&nbsp;&nbsp;DWORD&nbsp;dw&nbsp;=&nbsp;GetLastError();&nbsp;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;FormatMessage(<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FORMAT_MESSAGE_ALLOCATE_BUFFER&nbsp;|&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FORMAT_MESSAGE_FROM_SYSTEM&nbsp;|<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FORMAT_MESSAGE_IGNORE_INSERTS,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NULL,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dw,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MAKELANGID(LANG_NEUTRAL,&nbsp;SUBLANG_DEFAULT),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(LPTSTR)&nbsp;&amp;lpMsgBuf,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0,&nbsp;NULL&nbsp;);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Display&nbsp;the&nbsp;error&nbsp;message&nbsp;and&nbsp;exit&nbsp;the&nbsp;process<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;lpDisplayBuf&nbsp;=&nbsp;(LPVOID)LocalAlloc(LMEM_ZEROINIT,&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(lstrlen((LPCTSTR)lpMsgBuf)&nbsp;+&nbsp;lstrlen((LPCTSTR)lpszFunction)&nbsp;+&nbsp;40)&nbsp;*&nbsp;sizeof(TCHAR));&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;StringCchPrintf((LPTSTR)lpDisplayBuf,&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LocalSize(lpDisplayBuf)&nbsp;/&nbsp;sizeof(TCHAR),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TEXT(&quot;%s&nbsp;failed&nbsp;with&nbsp;error&nbsp;%d:&nbsp;%s&quot;),&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lpszFunction,&nbsp;dw,&nbsp;lpMsgBuf);&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;MessageBox(NULL,&nbsp;(LPCTSTR)lpDisplayBuf,&nbsp;TEXT(&quot;Error&quot;),&nbsp;MB_OK);&nbsp;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;LocalFree(lpMsgBuf);<br />&nbsp;&nbsp;&nbsp;&nbsp;LocalFree(lpDisplayBuf);<br />&nbsp;&nbsp;&nbsp;&nbsp;ExitProcess(dw);&nbsp;<br />}<br /><br />void&nbsp;main()<br /><span style="color:#000000;font-weight:400">{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Generate&nbsp;an&nbsp;error<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;if(!GetProcessId(NULL))<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ErrorExit(TEXT(&quot;GetProcessId&quot;));<br /><span style="color:#000000;font-weight:400">}</span></div></div></div>
</body>
</html>
