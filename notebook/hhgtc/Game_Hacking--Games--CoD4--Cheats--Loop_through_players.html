<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Loop through players</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><strong><h1># Loop through players</h1></strong><strong><br /></strong>Entities are stored as a list of <code>centity_t</code> structs one after the other.<br />This is the same with <code>clientInfo_t</code> too.<br /><br />When you connect to a server, you&#39;re given a client number.<br />The 1st player in the server is client number 0, 2nd player is 1, 3rd player is 2, etc.<br /><br />Your local player&#39;s client number is stored in the <code>cg</code> struct.<br /><br />A simple way to loop through the players in the game is to do <br /><code>centityt_t start address + (client_number * centity_t_size)</code><br />This will get the address of the client number&#39;s entity struct.<br /><br />The Quake Engine does using an array of structs and accesses them by index.<br />You can see it in <code>cg_main.c</code>:<br /><a href="https://github.com/id-Software/Quake-III-Arena/blob/dbe4ddb10315479fc00086f08e25d968b4b43c49/code/cgame/cg_main.c#L85">https://github.com/id-Software/Quake-III-Arena/blob/dbe4ddb10315479fc00086f08e25d968b4b43c49/code/cgame/cg_main.c#L85</a><br /><br />Example of looping using index can be seen here:<br /><a href="https://www.unknowncheats.me/forum/509101-post4.html">https://www.unknowncheats.me/forum/509101-post4.html</a><strong><br /><br /></strong><strong><h2>## Loop through players - Simple Way - i * struct_size</h2></strong><br />â€¢ <a href="https://www.unknowncheats.me/forum/559302-post13.html">https://www.unknowncheats.me/forum/559302-post13.html</a> - Demonstrated here<br /><br />Here&#39;s my code:<br /><div class="codebox"><div class="codebox">unsigned&nbsp;int&nbsp;cg_t_addr&nbsp;=&nbsp;0x0074E338;<br />unsigned&nbsp;int&nbsp;cgs_t_addr&nbsp;=&nbsp;0x0074A908;<br />unsigned&nbsp;int&nbsp;clientInfo_t_addr&nbsp;=&nbsp;0x00839270;	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;clientInfo_t&nbsp;struct<br />unsigned&nbsp;int&nbsp;centity_t_addr&nbsp;=&nbsp;0x0084F2D8;		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;centity_t&nbsp;struct<br />unsigned&nbsp;int&nbsp;weaponInfo_t_addr&nbsp;=&nbsp;0x007486d4;	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;weaponInfo_t&nbsp;struct<br />unsigned&nbsp;int&nbsp;refdef_t_addr&nbsp;=&nbsp;0x797600;			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;refdef_t&nbsp;struct&nbsp;(cg_t_addr&nbsp;+&nbsp;0x492C8)<br /><br />unsigned&nbsp;int&nbsp;clientInfo_t_size&nbsp;=&nbsp;0x4cc;<br />unsigned&nbsp;int&nbsp;centity_t_size&nbsp;=&nbsp;0x1dc;<br />unsigned&nbsp;int&nbsp;weaponInfo_t_size&nbsp;=&nbsp;0x44;<br />unsigned&nbsp;int&nbsp;trace_t_size&nbsp;=&nbsp;0x2c;<br /><br /><br />//&nbsp;Globals<br />//&nbsp;Game&nbsp;and&nbsp;server<br />cg_t*&nbsp;cg&nbsp;=&nbsp;NULL;<br />cgs_t*&nbsp;server&nbsp;=&nbsp;NULL;<br /><br />//&nbsp;Local&nbsp;player<br />centity_t*&nbsp;local_entity&nbsp;=&nbsp;NULL;<br />clientInfo_t*&nbsp;local_client&nbsp;=&nbsp;NULL;<br />refdef_t*&nbsp;refdef&nbsp;=&nbsp;NULL;<br /><br />/*<br />From&nbsp;the&nbsp;start&nbsp;address&nbsp;of&nbsp;the&nbsp;list&nbsp;of&nbsp;entities,<br />do&nbsp;(i&nbsp;*&nbsp;entity_struct_size)&nbsp;to&nbsp;reach&nbsp;the&nbsp;desired&nbsp;entity.<br />*/<br />centity_t*&nbsp;GetEntityByIndex(int&nbsp;index)<br />{<br />	centity_t*&nbsp;entity&nbsp;=&nbsp;NULL;<br />	entity&nbsp;=&nbsp;(centity_t*)(centity_t_addr&nbsp;+&nbsp;(index&nbsp;*&nbsp;centity_t_size));<br /><br />	return&nbsp;entity;<br />}<br /><br />/*<br />From&nbsp;the&nbsp;start&nbsp;address&nbsp;of&nbsp;the&nbsp;list&nbsp;of&nbsp;clientInfo&nbsp;structs,<br />do&nbsp;(i&nbsp;*&nbsp;clientInfo_struct_size)&nbsp;to&nbsp;reach&nbsp;the&nbsp;desired&nbsp;clientInfo&nbsp;struct.<br />*/<br />clientInfo_t*&nbsp;GetClientInfoByIndex(int&nbsp;index)<br />{<br />	clientInfo_t*&nbsp;client_info&nbsp;=&nbsp;NULL;<br />	client_info&nbsp;=&nbsp;(clientInfo_t*)(clientInfo_t_addr&nbsp;+&nbsp;(index&nbsp;*&nbsp;clientInfo_t_size));<br />	return&nbsp;client_info;<br />}<br /><br />HRESULT&nbsp;WINAPI&nbsp;hooked_EndScene(LPDIRECT3DDEVICE9&nbsp;orig_d3dDevice)<br /><span style="color:#000000;font-weight:400">{</span><br />	//&nbsp;...<br /><br />	//&nbsp;Grab&nbsp;game&nbsp;and&nbsp;server&nbsp;structs<br />	cg&nbsp;=&nbsp;(cg_t*)cg_t_addr;<br />	server&nbsp;=&nbsp;(cgs_t*)cgs_t_addr;<br /><br />	//&nbsp;Grab&nbsp;local&nbsp;player&nbsp;(local&nbsp;player&nbsp;client&nbsp;number&nbsp;is&nbsp;in&nbsp;cg)<br />	local_entity&nbsp;=&nbsp;GetEntityByIndex(cg-&gt;client_number);<br />	local_client&nbsp;=&nbsp;GetClientInfoByIndex(cg-&gt;client_number);<br />	refdef&nbsp;=&nbsp;(refdef_t*)refdef_t_addr;<br /><br />	//&nbsp;Loop&nbsp;through&nbsp;the&nbsp;maximum&nbsp;number&nbsp;of&nbsp;players&nbsp;allowed&nbsp;in&nbsp;the&nbsp;server<br />	for&nbsp;(int&nbsp;i&nbsp;=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;server-&gt;max_clients;&nbsp;i++)<br />	{<br />		//&nbsp;...<br />	}<br />	<br />	//&nbsp;...<br /><br />	return&nbsp;orig_EndScene(my_d3dDevice);<br /><span style="color:#000000;font-weight:400">}</span></div></div><br /><br /><strong><h2>## Loop through players - &quot;Proper&quot; way - struct_array[client_number]</h2></strong><br />The Quake Engine uses an array of structs and accesses them by index.<br />This can be seen in <code>cg_main.c</code>:<br /><a href="https://github.com/id-Software/Quake-III-Arena/blob/dbe4ddb10315479fc00086f08e25d968b4b43c49/code/cgame/cg_main.c#L85">https://github.com/id-Software/Quake-III-Arena/blob/dbe4ddb10315479fc00086f08e25d968b4b43c49/code/cgame/cg_main.c#L85</a><br /><br />Example of looping using index can be seen here:<br /><a href="https://www.unknowncheats.me/forum/509101-post4.html">https://www.unknowncheats.me/forum/509101-post4.html</a><br /></div>
</body>
</html>
