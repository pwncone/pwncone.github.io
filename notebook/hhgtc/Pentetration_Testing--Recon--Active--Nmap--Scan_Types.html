<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Scan Types</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><strong><h1># Scan Types</h1></strong><br />Nmap can scan in different ways.<br />• <a href="https://nmap.org/book/scan-methods.html">https://nmap.org/book/scan-methods.html</a><br /><br /><strong><h2>## TCP SYN (Stealth) Scan (-sS)</h2></strong><br />• <a href="https://nmap.org/book/synscan.html">https://nmap.org/book/synscan.html</a><br /><br />A SYN scan is the default Nmap scan.<br />SYN is fast and stealthy because it never completes the full TCP connection.<br /><br /><strong>Example</strong><br />• Nmap sends a <code>SYN</code> to port 22<br />• Port 22 replies with <code>SYN/ACK</code> (i.e. it&#39;s open, go ahead and connect)<br />• Nmap sends <code>RST</code> (because we now know that port 22 is open)<br /><br /><a href=""><img src="images/79-1.png" alt="images/79-1.png" /></a><br /><br /><strong>Open/Closed/Filtered</strong><br />Nmap will return a state (open, closed, or filtered) for each port it queries.<br /><br />Nmap sends out a SYN packet.<br />It receives a:<br />• <code>SYN/ACK</code> - means the port is <code>open</code><br />• <code>RST/ACK</code> - means theh port is <code>closed</code><br />• No response (even after retries) - nmap labels the port as <code>filtered</code><br />• ICMP type 3 unreachable error (codes 1, 2, 3, 9, 10, or 13) - nmap labels the port as <code>filtered</code><br />   ◇ firewalls and routers usually return these<br /><br />Common ICMP type 3 message codes:<br /><span style="text-decoration:underline;">Code</span>            <span style="text-decoration:underline;">Description</span><br />0                  Network uncreachable<br />1                  Host unreachable<br />2                  Protocol unreachable<br />3                  Port unreachable<br />6                  Destination network unknown<br />7                  Destination host unknown<br />9                  Communication administratively prohibited (network)<br />10                Communication administratively prohibited (host)<br />13                Communication administratively prohibited (general)<br /><br /><strong><h2>## TCP Connect Scan (-sT)</h2></strong><br />A TCP Connect scan will connect directly to the target if the port is open.<br /><br />Target machines are likely to log this connection, and a decent IDS will probably pick up on the TCP connect packets.<br /><br /><strong>Example</strong><br />• Nmap sends a <code>SYN</code> to <code>port 22</code><br />• Port 22 replies with <code>SYN/ACK</code> (i.e. it&#39;s open, go ahead and connect)<br />• Nmap sends <code>ACK</code> (and connects)<br />• Port 22 sends SSH banner<br />• Nmap sends <code>RST</code> (and closes the connection without sending any data)<br /><br /><a href=""><img src="images/79-2.png" alt="images/79-2.png" /></a><br /><br /><strong><h2>## UDP Scan (-sU)</h2></strong><br />Because UDP is stateless (sent packets aren&#39;t verified as received), services are identified either through:<br /><br />• Negative scanning<br />   ◇ Using ICMP ‘unreachable’ responses from closed ports to infer which ports are open<br /><br />• Payload scanning<br />   ◇ Sending correctly formated datagrams of common UDP services to elicit a response<br />   ◇ e.g. DNS, DHCP, TFTP<br />   ◇ Payloads listed here - <a href="https://svn.nmap.org/nmap/nmap-payloads">https://svn.nmap.org/nmap/nmap-payloads</a><br /><br />Using only ICMP is unreliable.<br />Security-conscious organisations often filter ICMP messages, and most operating systems rate-limit ICMP responses by default.<br /><br /><code>-sU</code> uses a combination of both negative and payload scanning.<br />This means that output is often cloudy (both <em>open</em> and <em>open|filtered</em> states are returned).<br /><div class="codebox"><div class="codebox">root@kali:~#&nbsp;nmap&nbsp;-sU&nbsp;10.10.10.45<br />...<br />111/udp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;open|filtered&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rpcbind<br />120/udp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;open|filtered&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cfdptkt<br />123/udp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;open&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ntp<br />135/udp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;open|filtered&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;msrpc<br />136/udp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;open|filtered&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;profile<br />137/udp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;open&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;netbios-ns<br />138/udp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;open|filtered&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;netbios-dgm</div></div><br /><br /><strong>Thorough UDP port check with -sV</strong><br /><code>-sV</code> attempts to determine service/version info.<br />Running <code>-sU -sV</code> will have nmap actively probe each UDP port to see which respond.<br />This mean ports that were originally listed as <code>open|filtered</code> or <code>closed</code> might be identified as <code>open</code>.<br /><br /><code>nmap -sU -sV 10.10.10.45</code><br /><br />Running Nmap in this fashion is, however, very slow against ambiguous open|filtered ports, and impractical when testing large networks.<br />e.g. testing 100 UDP ports with <code>-sU -sV</code> often takes more than 10 minutes<br /><br /><strong><h2>## ICMP</h2></strong><br />Nmap sends an ICMP type 8 (echo request) packet and expects a type 0 (echo reply) response.<br />Ping requests are usually blocked nowadays, so it&#39;s not necessarily useful, but could useful on internal networks.<br /><br />• <code>-PE</code> - send echo request (standard, use this)<br />• <code>-PP</code> - timestamp request<br />• <code>-PM</code> - subnet mask request<br /><br /><code>nmap -sn -PEPM 10.12.5.0/24</code></div>
</body>
</html>
