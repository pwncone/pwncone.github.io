<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>OpenSSH</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><strong><h1># OpenSSH</h1></strong><br /><br /><strong><h2>## OpenSSH creates 2 processes when a user connects</h2></strong><br />For the sake of privilege separation, <br />OpenSSH (the <em>sshd</em> service) creates 2 processes when an SSH connection starts:<br />• 1 process retains root privileges (only used to do root things)<br />• the other process does everything else<br /><br /><strong><h3>### Example from hackthebox Writeup</h3></strong><br />Take this output from <code>pspy</code> <br /><div class="codebox"><div class="codebox">jkr@writeup:~$&nbsp;./pspy64s&nbsp;<br />...<br />2019/06/26&nbsp;12:11:45&nbsp;CMD:&nbsp;UID=0&nbsp;&nbsp;&nbsp;&nbsp;PID=1962&nbsp;&nbsp;&nbsp;|&nbsp;sshd:&nbsp;[accepted]<br />2019/06/26&nbsp;12:11:46&nbsp;CMD:&nbsp;UID=0&nbsp;&nbsp;&nbsp;&nbsp;PID=1963&nbsp;&nbsp;&nbsp;|&nbsp;sshd:&nbsp;[accepted]&nbsp;&nbsp;<br />2019/06/26&nbsp;12:11:48&nbsp;CMD:&nbsp;UID=0&nbsp;&nbsp;&nbsp;&nbsp;PID=1964&nbsp;&nbsp;&nbsp;|&nbsp;sshd:&nbsp;jkr&nbsp;[priv]&nbsp;&nbsp;<br />2019/06/26&nbsp;12:11:48&nbsp;CMD:&nbsp;UID=0&nbsp;&nbsp;&nbsp;&nbsp;PID=1965&nbsp;&nbsp;&nbsp;|&nbsp;sh&nbsp;-c&nbsp;/usr/bin/env&nbsp;-i&nbsp;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&nbsp;run-parts&nbsp;--lsbsysinit&nbsp;/etc/update-motd.d&nbsp;&gt;&nbsp;/run/motd.dynamic.new&nbsp;<br />2019/06/26&nbsp;12:11:48&nbsp;CMD:&nbsp;UID=0&nbsp;&nbsp;&nbsp;&nbsp;PID=1966&nbsp;&nbsp;&nbsp;|&nbsp;run-parts&nbsp;--lsbsysinit&nbsp;/etc/update-motd.d&nbsp;<br />2019/06/26&nbsp;12:11:48&nbsp;CMD:&nbsp;UID=0&nbsp;&nbsp;&nbsp;&nbsp;PID=1967&nbsp;&nbsp;&nbsp;|&nbsp;/bin/sh&nbsp;/etc/update-motd.d/10-uname&nbsp;<br />2019/06/26&nbsp;12:11:48&nbsp;CMD:&nbsp;UID=0&nbsp;&nbsp;&nbsp;&nbsp;PID=1968&nbsp;&nbsp;&nbsp;|&nbsp;sshd:&nbsp;jkr&nbsp;[priv]&nbsp;&nbsp;<br />2019/06/26&nbsp;12:11:48&nbsp;CMD:&nbsp;UID=1000&nbsp;PID=1969&nbsp;&nbsp;&nbsp;|&nbsp;sshd:&nbsp;jkr@pts/1&nbsp;&nbsp;&nbsp;</div></div><br /><br />The 2 different <em>root</em> and <em>user</em> processes are what we&#39;re seeing here (I think)<br /><code>2019/06/26 12:11:46 CMD: UID=0    PID=1963   | sshd: [accepted]  <br />2019/06/26 12:11:48 CMD: UID=0    PID=1964   | sshd: jkr [priv]  </code><br /><br />There might also be some commands that run when a user connects via ssh.<br /><code>2019/06/26 12:11:48 CMD: UID=0    PID=1965   | sh -c /usr/bin/env -i PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin run-parts --lsbsysinit /etc/update-motd.d &gt; /run/motd.dynamic.new</code><br /><br />These can potentially be exploited if they&#39;re running as the <em>root privileges</em> process of OpenSSH <br />(as done in hackthebox Writeup).<br /></div>
</body>
</html>
