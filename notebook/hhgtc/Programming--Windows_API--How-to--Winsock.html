<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Winsock</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><strong><h1># How-to - Windows Sockets</h1></strong><br /><a href="https://docs.microsoft.com/en-us/windows/win32/winsock/about-clients-and-servers">https://docs.microsoft.com/en-us/windows/win32/winsock/about-clients-and-servers</a><br /><br /><strong><h2>Notes</h2></strong><br />• Don&#39;t bother using wide character strings and functions for network programming, just use <code>char</code> and <code>A</code> functions<br />   ◇ because it complicates things, network data is raw data and can be tricky -&gt; make it as easy/simple as possible<br /><br /><strong><h3>Old vs New Functions</h3></strong><br />Windows has 2 sets of socket functions.<br />Winsock was written early 90s, attempted to model off of BSD sockets, so names are the same:<br /><code>socket()</code>, <code>connect()</code>, <code>send()</code><br /><br />WinSock2.h includes newer Winsock API functions:<br /><code>WSASocket()</code>, <code>WSAConnect()</code>, <code>WSASend()</code><br />These are extended versions of the original functions, with the same paramaters + potential extras.<br />Explained here:<br /><a href="https://stackoverflow.com/questions/3255899/why-are-there-wsa-pendants-for-socket-connect-send-and-so-on-but-not-fo">https://stackoverflow.com/questions/3255899/why-are-there-wsa-pendants-for-socket-connect-send-and-so-on-but-not-fo</a><br /><br /><code>socket()</code> -&gt; <code>WSASocket()<br />connect()</code> -&gt; <code>WSAConnect()</code><br /><code>send()</code> -&gt; <code>WSASend()</code><br /><code>sendto()</code> -&gt; <code>WSASendTo()</code><br /><code>recv()</code> -&gt; <code>WSARecv()</code><br /><code>recvfrom()</code> -&gt; <code>WSARecvFrom()</code><br /><br />Advice?<br />Use the old ones :)<br />They work fine on Unix, so they work fine on Windows too unless you super extra important new parameters etc.<br />I PERSONALLY can&#39;t see any reason to use the new ones.<br /><br /><strong><h2>General Model</h2></strong><br /><strong><h3>Server</h3></strong><br />1. Initialize Winsock - <code>WSAStartup()</code><br />2. Create a socket - <code>socket()</code><br />3. Bind the socket - <code>bind()</code><br />4. Listen on the socket for a client - <code>listen()</code><br />5. Accept a connection from a client - <code>accept()</code><br />6. Receive and send data - <code>recv()</code> and <code>send()</code><br />7. Disconnect - <code>closesocket()</code><br /><br /><strong><h3>Client</h3></strong><br />1. Initialize Winsock - <code>WSAStartup()</code><br />2. Get address info from server - <code>GetAddrInfoW()</code><br />   - MSDN documented way -&gt; can skip this stage by just creating a <code>struct sockaddr_in remoteHost</code><br />3. Create a socket - <code>socket()</code><br />4. Connect to the server - <code>connect()</code><br />5. Send and receive data - <code>send()</code> and <code>recv()</code><br />6. Disconnect - <code>closesocket()</code><br /><br /><strong><h2>Libraries</h2></strong><br /><a href="https://docs.microsoft.com/en-us/windows/win32/winsock/creating-a-basic-winsock-application">https://docs.microsoft.com/en-us/windows/win32/winsock/creating-a-basic-winsock-application</a><br /><code>#include &lt;winsock.h&gt;</code> - old library<br /><code>#include &lt;WinSock2.h&gt;</code> - newer library &lt;- use this<br /><br />The build environment has to be linked to the Winsock LIbrary file - <code>Ws2_32.lib</code><br /><code>#pragma comment(lib, &quot;Ws2_32.lib&quot;)</code><br /><br /><code>#include &lt;WS2tcpip.h&gt;</code> - contains new functions/structs to retrieve IP addresses<br /><br /><div class="codebox"><div class="codebox">#include&nbsp;&lt;stdio.h&gt;<br />#include&nbsp;&lt;WinSock2.h&gt;<br />#include&nbsp;&lt;WS2tcpip.h&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;new&nbsp;functions/structs&nbsp;to&nbsp;retrieve&nbsp;IP&nbsp;addresses<br /><br />#pragma&nbsp;comment(lib,&nbsp;&quot;Ws2_32.lib&quot;)<br /><br />int&nbsp;main()<br /><span style="color:#000000;font-weight:400">{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;0;<br /><span style="color:#000000;font-weight:400">}</span></div></div><br /><br /><strong>Using Windows.h as well?</strong><br /><code>WinSock2.h</code> includes core elements from <code>Windows.h</code> - so including Windows.h not necessary.<br />If using <code>Windows.h</code> in your program, you should precede includes with <code>WIN32_LEAN_AND_MEAN</code> - this stops <code>winsock.h</code> from being included via <code>Windows.h</code><br /><br /><div class="codebox"><div class="codebox">#define&nbsp;WIN32_LEAN_AND_MEAN<br /><br />#include&nbsp;&lt;stdio.h&gt;<br />#include&nbsp;&lt;Windows.h&gt;<br />#include&nbsp;&lt;WinSock2.h&gt;<br />#include&nbsp;&lt;WS2tcpip.h&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;new&nbsp;functions/structs&nbsp;to&nbsp;retrieve&nbsp;IP&nbsp;addresses<br /><br />#pragma&nbsp;comment(lib,&nbsp;&quot;Ws2_32.lib&quot;)<br /><br />int&nbsp;main()<br /><span style="color:#000000;font-weight:400">{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;0;<br /><span style="color:#000000;font-weight:400">}</span></div></div><br /><br /><strong><h2>Client Model</h2></strong><br />blah<br />blah<br />blah<br /><br /><code>WSAStartup()</code> initiates the use of <code>WS2_32.dll</code>.<br /><code>WSACleanup()</code> terminates the use of the Winsock 2 DLL (<code>Ws2_32.dll</code>).<br /></div>
</body>
</html>
