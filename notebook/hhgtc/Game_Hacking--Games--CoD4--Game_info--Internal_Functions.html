<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Internal Functions</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><strong><h1># Internal Functions</h1></strong><br />There are quite a few useful internal functions in CoD4.<br />The leaked CoD4 IDB is useful for investigating these and getting their parameters.<br /><br />Others include:<br />â€¢ CG_GetPlayerViewOrigin - <code>0x456580</code><br /><br /><strong><h2>## RegisterTag</h2></strong><br />Registers a tag on an entity (if not already) and returns the tag number.<br />Mainly used for grabbing the tag number.<br /><div class="codebox"><div class="codebox">unsigned&nbsp;int&nbsp;RegisterTag_addr&nbsp;=&nbsp;0x00518290;<br /><br />/*<br />Registers&nbsp;a&nbsp;tag&nbsp;on&nbsp;an&nbsp;entity&nbsp;(if&nbsp;not&nbsp;already)&nbsp;and&nbsp;returns&nbsp;the&nbsp;tag&nbsp;number.<br />Mainly&nbsp;used&nbsp;for&nbsp;grabbing&nbsp;the&nbsp;tag&nbsp;number.<br />Code&nbsp;from&nbsp;Rave.waveLight&#39;s&nbsp;CoD4&nbsp;base.&nbsp;How&nbsp;it&nbsp;returns&nbsp;a&nbsp;value&nbsp;I&nbsp;don&#39;t&nbsp;know&nbsp;:shrug:<br />*/<br />WORD&nbsp;Intrnl_RegisterTag(char*&nbsp;tag_name,&nbsp;int&nbsp;entity_type,&nbsp;size_t&nbsp;tag_name_len)<br /><span style="color:#000000;font-weight:400">{</span><br />	__asm<br />	{<br />		push&nbsp;tag_name_len;<br />		push&nbsp;entity_type;<br />		push&nbsp;tag_name;<br />		mov&nbsp;eax,&nbsp;RegisterTag_addr;<br />		call&nbsp;eax;<br />		add&nbsp;esp,&nbsp;0xC;<br />	}<br /><span style="color:#000000;font-weight:400">}</span></div></div><br /><br /><strong><h2>## GetTagPos</h2></strong><br />Get the 3d coordinates of a tag on an entity.<br /><div class="codebox"><div class="codebox">unsigned&nbsp;int&nbsp;GetTagPos_addr&nbsp;=&nbsp;0x004024B0;<br /><br />/*<br />Grabs&nbsp;the&nbsp;bone&nbsp;position&nbsp;of&nbsp;a&nbsp;tag&nbsp;on&nbsp;an&nbsp;entity.<br />From&nbsp;Rave.waveLight&#39;s&nbsp;CoD4&nbsp;base&nbsp;on&nbsp;UnknownCheats.<br />*/<br />void&nbsp;Intrnl_GetTagPos(short&nbsp;tag,&nbsp;centity_t*&nbsp;entity,&nbsp;OUT&nbsp;vec3*&nbsp;position)<br /><span style="color:#000000;font-weight:400">{</span><br />	__asm<br />	{<br />		push	position;<br />		movzx	esi,&nbsp;tag;<br />		mov	ecx,&nbsp;entity;<br />		movzx	eax,&nbsp;byte&nbsp;ptr[ecx&nbsp;+&nbsp;4];<br />		mov	edi,&nbsp;GetTagPos_addr;<br />		call	edi;<br />		add	esp,&nbsp;4;<br />	}<br /><br />	return;<br /><span style="color:#000000;font-weight:400">}</span></div></div><br /><br /><strong><h2>## CG_Trace</h2></strong><br />Traces a line between a start coordinate and an end coordinate.<br />Uses a mask (a flag) to know what you&#39;re looking for.<br />If you hit an object you&#39;re looking for, it will return the entity ID in the trace struct e.g. <code>trace.hitID</code><br /><div class="codebox"><div class="codebox">unsigned&nbsp;int&nbsp;CG_Trace_addr&nbsp;=&nbsp;0x00459EF0;<br /><br />/*<br />Check&nbsp;if&nbsp;looking&nbsp;at&nbsp;something.<br />Function&nbsp;definition&nbsp;from&nbsp;CoD4&nbsp;leaked&nbsp;IDB.<br />ASM&nbsp;code&nbsp;from:&nbsp;https://www.unknowncheats.me/wiki/IsVisible_CoD4<br />In&nbsp;Quake&nbsp;Engine&nbsp;at:&nbsp;https://github.com/id-Software/Quake-III-Arena/blob/dbe4ddb10315479fc00086f08e25d968b4b43c49/code/cgame/cg_predict.c#L145<br />Parameters:<br />	start&nbsp;-&nbsp;Where&nbsp;to&nbsp;start&nbsp;tracing&nbsp;from&nbsp;(your&nbsp;player&nbsp;origin)<br />	end&nbsp;-&nbsp;End&nbsp;is&nbsp;the&nbsp;max&nbsp;range&nbsp;of&nbsp;where&nbsp;to&nbsp;look&nbsp;to&nbsp;(e.g.&nbsp;origin&nbsp;+&nbsp;(forward&nbsp;*&nbsp;distance))<br />	min,&nbsp;max&nbsp;-&nbsp;Don&#39;t&nbsp;know.&nbsp;Can&nbsp;both&nbsp;be&nbsp;0.<br />	pass_entity_num&nbsp;-&nbsp;What&nbsp;entity&nbsp;to&nbsp;skip&nbsp;(skip&nbsp;yourself)<br />	content_mask&nbsp;-&nbsp;The&nbsp;mask&nbsp;determines&nbsp;what&nbsp;to&nbsp;check&nbsp;e.g.&nbsp;0x2803001&nbsp;is&nbsp;a&nbsp;body<br />Return:<br />	Returns&nbsp;a&nbsp;trace_t&nbsp;struct&nbsp;in&nbsp;trace_result.<br />*/<br />void&nbsp;Intrnl_CG_Trace(OUT&nbsp;trace_t*&nbsp;trace_result,&nbsp;float*&nbsp;start,&nbsp;float*&nbsp;min,&nbsp;float*&nbsp;max,&nbsp;float*&nbsp;end,&nbsp;int&nbsp;pass_entity_num,&nbsp;int&nbsp;content_mask)<br /><span style="color:#000000;font-weight:400">{</span><br />	__asm<br />	{<br />		push&nbsp;0;<br />		push&nbsp;0;<br />		push&nbsp;content_mask;<br />		push&nbsp;pass_entity_num;<br />		push&nbsp;end;<br />		push&nbsp;max;<br />		push&nbsp;start;<br />		mov&nbsp;edi,&nbsp;trace_result;<br />		mov&nbsp;eax,&nbsp;min;<br />		call&nbsp;CG_Trace_addr;<br />		add&nbsp;esp,&nbsp;0x1c;<br />	}<br /><span style="color:#000000;font-weight:400">}</span></div></div><br /><br /><strong><h2>## IsEntityVisible</h2></strong><br />Checks if you can see an entity. <br />Don&#39;t fully understand this one or what its internal function name is.<br /><br /><a href="https://www.unknowncheats.me/forum/442728-post12.html?s=390d201373e22bda008047d24c9157fa">https://www.unknowncheats.me/forum/442728-post12.html?s=390d201373e22bda008047d24c9157fa</a><br /><br /><div class="codebox"><div class="codebox">unsigned&nbsp;int&nbsp;IsVisible_addr&nbsp;=&nbsp;0x0042DE90;<br /><br />bool&nbsp;Intrnl_IsEntityVisible(centity_t*&nbsp;entity)<br /><span style="color:#000000;font-weight:400">{</span><br />	__asm<br />	{<br />		xor&nbsp;eax,&nbsp;eax;<br />		mov&nbsp;esi,&nbsp;entity;<br />		push&nbsp;esi;<br />		mov&nbsp;edi,&nbsp;dword&nbsp;ptr[IsVisible_addr];<br />		test&nbsp;edi,&nbsp;edi;<br />		call&nbsp;edi;<br />		add&nbsp;esp,&nbsp;4;<br />		test&nbsp;al,&nbsp;al;<br />	}<br /><span style="color:#000000;font-weight:400">}</span></div></div><br /><br /><strong><h2>## Cmd_ExecuteSingleCommand</h2></strong><br />You&#39;ll see this called <code>CG_trap_SendCommand</code> on forums.<br />The internal name is Cmd_ExecuteSingleCommand.<br /><br />Executes commands in the console.<br />You don&#39;t have to use asm for this one, you can just call it.<br />Typedef seen here: <a href="https://www.unknowncheats.me/forum/449606-post5.html">https://www.unknowncheats.me/forum/449606-post5.html</a><br />ASM version also found here: <a href="https://progamercity.net/call-of-duty/705-snippet-cod4-sendconsole-command.html">https://progamercity.net/call-of-duty/705-snippet-cod4-sendconsole-command.html</a><br /><br /><div class="codebox"><div class="codebox">typedef&nbsp;void(__cdecl*&nbsp;t_Cmd_ExecuteSingleCommand)(int&nbsp;x,&nbsp;int&nbsp;x2,&nbsp;char*&nbsp;cvar);<br />t_Cmd_ExecuteSingleCommand&nbsp;Cmd_ExecuteSingleCommand&nbsp;=&nbsp;(t_Cmd_ExecuteSingleCommand)0x004F9AB0;<br />Cmd_ExecuteSingleCommand(1,&nbsp;1,&nbsp;&quot;+attack\n&quot;);</div></div><br /><br /></div>
</body>
</html>
