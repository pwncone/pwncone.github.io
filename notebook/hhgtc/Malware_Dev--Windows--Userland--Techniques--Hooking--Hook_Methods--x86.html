<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>x86</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><strong><h1># x86 Hooks</h1></strong><br />Ways / instructions to hook functions on x86.<br /><br />More here:<br />â€¢ <a href="https://github.com/rdbo/DX11-BaseHook/blob/c77091b7c204b50f721342d10380fee6b5e49826/include/libmem%2B%2B/libmem.hpp#L121">https://github.com/rdbo/DX11-BaseHook/blob/c77091b7c204b50f721342d10380fee6b5e49826/include/libmem%2B%2B/libmem.hpp#L121</a><br /><br />Mid-function hooking:<br /><a href="https://www.youtube.com/playlist?list=PLt9cUwGw6CYEKUSdrN2JYDirH_1o6ZXQN">https://www.youtube.com/playlist?list=PLt9cUwGw6CYEKUSdrN2JYDirH_1o6ZXQN</a><br /><br /><strong><h2>## 5 bytes - E9 jmp relative</h2></strong><br />Jump to an address relative to your current location (the value in EIP).<br />The formula for calculating the relative jump is <code>(target_address - current_address)</code><br /><br /><div class="codebox"><div class="codebox">/*<br />Calculate&nbsp;E9&nbsp;relative&nbsp;jumps.<br />Formula&nbsp;is:&nbsp;(target&nbsp;-&nbsp;current_addr)<br />*/<br />DWORD&nbsp;jmp_originalfunction&nbsp;=&nbsp;(DWORD)orig_func&nbsp;-&nbsp;((DWORD)trampoline&nbsp;+&nbsp;5);<br />DWORD&nbsp;jmp_hook&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;(DWORD)detour&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;((DWORD)trampoline&nbsp;+&nbsp;15);<br />DWORD&nbsp;jmp_trampoline&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;((DWORD)trampoline&nbsp;+&nbsp;10)&nbsp;-&nbsp;((DWORD)orig_func&nbsp;+&nbsp;5);<br /><br />memcpy_s((BYTE*)trampoline,&nbsp;5,&nbsp;orig_func,&nbsp;5);<br />*(BYTE*)((DWORD)trampoline&nbsp;&nbsp;+&nbsp;5)&nbsp;&nbsp;=&nbsp;0xE9;<br />*(DWORD*)((DWORD)trampoline&nbsp;+&nbsp;6)&nbsp;&nbsp;=&nbsp;jmp_originalfunction;<br />*(BYTE*)((DWORD)trampoline&nbsp;&nbsp;+&nbsp;10)&nbsp;=&nbsp;0xE9;<br />*(DWORD*)((DWORD)trampoline&nbsp;+&nbsp;11)&nbsp;=&nbsp;jmp_hook;</div></div><br /><br /><a href=""><img src="images/1672-1.png" alt="images/1672-1.png" /></a><br /><br /><strong><h2>## 6 bytes - push &lt;addr&gt;; ret</h2></strong><br />This is a 6 byte instruction<br />You push the address you want to jump to on the stack, and then return.<br />The return will cause you to jump to the address you pushed.<br /><br />Only tested on x86 binaries.<br /><br /><div class="codebox"><div class="codebox">ADDRESS:&nbsp;&nbsp;&nbsp;BYTES:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INSTRUCTION:<br />0	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;68&nbsp;84&nbsp;13&nbsp;13&nbsp;00			push&nbsp;offset&nbsp;my_function&nbsp;(0131384h)<br />6	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;C3						ret<br />7	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CC						//&nbsp;padding<br />8	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CC						//&nbsp;padding</div></div><br /></div>
</body>
</html>
