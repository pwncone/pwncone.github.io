<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>WMI</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><strong><h1># WMI - Windows Management Instrumentation</h1></strong><br />From MSDN:<br /><code>Windows Management Instrumentation (WMI) is the infrastructure for management data and operations on Windows-based operating systems.</code><br /><br />In short, WMI allows you to collect information about local and remote computers.<br />You can also execute commands.<br /><br /><strong>Links</strong><br />• About<br />   ◇ <a href="https://blog.ropnop.com/using-credentials-to-own-windows-boxes-part-3-wmi-and-winrm/">https://blog.ropnop.com/using-credentials-to-own-windows-boxes-part-3-wmi-and-winrm/</a><br />• Pwn<br />   ◇ <a href="https://www.youtube.com/watch?v=0SjMgnGwpq8">https://www.youtube.com/watch?v=0SjMgnGwpq8</a> <br />      ▪ - BlackHat 2015 - Abusing Windows Management Instrumentation (WMI)<br />   ◇ <a href="https://www.youtube.com/watch?v=JCJl2uV8u1c">There’s Something About WMI</a> - Sans DFIR 2015<br /><br /><strong><h2>## About</h2></strong><br />WMI allows for querying and administration of local and remote Windows devices.<br />Think of it like SNMP for Windows infrastructure. <br />You manage your Windows network through WMI.<br /><br />• Been around since Win98 and NT4<br />• It&#39;s a SysAdmin tool &quot; to obtain management data from remote computers&quot;<br />• WMI connections are made via<br />   ◇ Port 135 - DCOM<br />• Can be used to<br />   ◇ Obtain system information<br />      ▪ registry<br />      ▪ file system<br />      ▪ etc.<br />   ◇ Execute commands<br />   ◇ Subscribe to events <br />      ▪ e.g. subscribe to writes to a log file<br /><br /><strong><h3>### Architecture</h3></strong><br />• WMI Objects are stored <br />   ◇ in the WMI repository - <code>%SystemRoot%\System32\wbem\Repository\OBJECTS.DATA</code><br />• WMI Settings are stored<br />   ◇ in the registry - <code>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\WBEM</code><br />   ◇ via the Win32_WMI class instance - <code>Win32_WmiSetting</code> class<br />      ▪ no idea what this means<br /><br /><strong><h3>### Interacting with WMI</h3></strong><br />• PowerShell<br />   ◇ <code>Get-Command -Noun Wmi*</code> - WMI cmdlets available since Win98/NT4<br />   ◇ <code>Get-Command -Noun Cim*</code> - CIM cmdlets introduced in PowerShell version 3<br />      ▪ they do the same as the WMI cmdlets but talk to both protocols - DCOM (old OSs) and WinRM (most new OSs)<br />• wmic.exe<br />• winrm.exe<br />   ◇ If WinRM is listening but powershell is blocked, can use winrm.exe instead<br />• wbemtest.exe<br />   ◇ Crappy GUI interface<br />   ◇ Good if can&#39;t run wmic.exe or winrm.exe<br />• From Linux<br />   ◇ wmic<br />   ◇ wmis - wrapper for Win32 ProcessCreate method<br />   ◇ wmis-pth - modified version of wmis that accepts NTLM hashes<br /><br /><a href=""><img src="images/554-1.png" alt="images/554-1.png" /></a><br /><br /><br /><strong><h2>## Execute Commands</h2></strong><br />The WMI <code>win32_process</code> class can be used to query, modify, terminate and create processes.<br /><a href="https://docs.microsoft.com/en-gb/windows/win32/cimwin32prov/win32-process?redirectedfrom=MSDN">https://docs.microsoft.com/en-gb/windows/win32/cimwin32prov/win32-process?redirectedfrom=MSDN</a><br /><br /><strong><h3>### Advantages</h3></strong><br />• No window gets opened on remote machine (so spawning calc.exe won&#39;t show up) - silent<br />• WMI command doesn&#39;t get logged by default<br />• Doesn&#39;t write to disk<br /><br /></div>
</body>
</html>
