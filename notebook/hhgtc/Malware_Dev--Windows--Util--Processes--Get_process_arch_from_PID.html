<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Get process arch from PID</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><strong><h1># Get process arch from PID</h1></strong><br /><code>OpenProcess</code> to get a handle to the process.<br /><code>IsWow64Process</code> to check if it&#39;s a 32bit exe running on a 64bit machine.<br /><br />There are more complications to this than initially seems.<br />e.g. <code>IsWow64Process</code> doesn&#39;t exist on some systems, so should be dynamically imported with <code>GetProcAddress</code><br /><br /><code>IsWow64Process2</code> is probably better to use - it&#39;ll return both the machine arch and the process arch.<br />But alas I&#39;m lazy and this isn&#39;t that interesting, so I haven&#39;t done it. The code isn&#39;t very good as a result.<br /><br /><div class="codebox"><div class="codebox">/*<br />Return:<br />	0&nbsp;if&nbsp;unknown&nbsp;or&nbsp;error.<br />	32&nbsp;if&nbsp;32bit.<br />	64&nbsp;if&nbsp;64bit.<br />*/<br />DWORD&nbsp;GetProcessArchitecture(DWORD&nbsp;pid)<br /><span style="color:#000000;font-weight:400">{</span><br />	DWORD&nbsp;arch&nbsp;=&nbsp;0;<br />	BOOL&nbsp;b_ret&nbsp;=&nbsp;TRUE;<br />	HANDLE&nbsp;h_process&nbsp;=&nbsp;NULL;<br />	BOOL&nbsp;b_IsWow64Process&nbsp;=&nbsp;FALSE;<br /><br />	h_process&nbsp;=&nbsp;OpenProcess(PROCESS_QUERY_INFORMATION,&nbsp;FALSE,&nbsp;pid);<br />	if&nbsp;(h_process&nbsp;==&nbsp;NULL)<br />	{<br />		arch&nbsp;=&nbsp;0;<br />		goto&nbsp;cleanup;<br />	}<br /><br />	b_ret&nbsp;=&nbsp;IsWow64Process(h_process,&nbsp;&amp;b_IsWow64Process);<br />	if&nbsp;(b_ret&nbsp;==&nbsp;FALSE)<br />	{<br />		arch&nbsp;=&nbsp;0;<br />		goto&nbsp;cleanup;<br />	}<br />	<br />	if&nbsp;(b_IsWow64Process&nbsp;==&nbsp;TRUE)<br />		arch&nbsp;=&nbsp;32;<br />	else<br />		arch&nbsp;=&nbsp;64;<br /><br />cleanup:<br />	if&nbsp;(h_process)&nbsp;CloseHandle(h_process);<br /><br />	return&nbsp;arch;<br /><span style="color:#000000;font-weight:400">}</span></div></div></div>
</body>
</html>
