<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>gdb</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><strong><h1># How-to - Find Function/String Addresses - gdb</h1></strong><br />The binary first has to be run so that it can load in libraries.<br />Set a breakpoint on main and run the binary.<br /><code>(gdb) break main<br />(gdb) run</code><br /><br /><strong><h2>## libc Base</h2></strong><br /><code>(gdb) info proc mapping</code><br /><br />• Look for the first instance of libc in the <code>objfile</code> list<br />   ◇ That should be your libc base address<br />   ◇ it&#39;s also (probably) at offset 0<br />   ◇ In the example below, the libc base address is <code>0xb7e97000</code> <br /><br /><div class="codebox"><div class="codebox">	Start&nbsp;Addr&nbsp;&nbsp;&nbsp;End&nbsp;Addr&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Size&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Offset&nbsp;objfile<br />	&nbsp;0x8048000&nbsp;&nbsp;0x8049000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x1000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/opt/protostar/bin/stack6<br />	&nbsp;0x8049000&nbsp;&nbsp;0x804a000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x1000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/opt/protostar/bin/stack6<br />	0xb7e96000&nbsp;0xb7e97000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x1000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />	0xb7e97000&nbsp;0xb7fd5000&nbsp;&nbsp;&nbsp;0x13e000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/lib/libc-2.11.2.so&nbsp;&nbsp;&lt;--&nbsp;THIS<br />	0xb7fd5000&nbsp;0xb7fd6000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x1000&nbsp;&nbsp;&nbsp;0x13e000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/lib/libc-2.11.2.so<br />	0xb7fd6000&nbsp;0xb7fd8000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x2000&nbsp;&nbsp;&nbsp;0x13e000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/lib/libc-2.11.2.so<br />	0xb7fd8000&nbsp;0xb7fd9000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x1000&nbsp;&nbsp;&nbsp;0x140000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/lib/libc-2.11.2.so</div></div><br /><br /><strong><h3>### Calculate libc base address manually</h3></strong><br />Print the address of a function in libc - <code>0xb7ecffb0</code> <br />e.g. system()<br /><div class="codebox"><div class="codebox">(gdb)&nbsp;break&nbsp;main<br />(gdb)&nbsp;run<br />(gdb)&nbsp;print&nbsp;system<br />$1&nbsp;=&nbsp;{&lt;text&nbsp;variable,&nbsp;no&nbsp;debug&nbsp;info&gt;}&nbsp;0xb7ecffb0&nbsp;&lt;__libc_system&gt;</div></div><br /><br />Now read libc to find the offset to system() - <code>0x00038fb0</code><br /><div class="codebox"><div class="codebox">$&nbsp;readelf&nbsp;-s&nbsp;/lib/libc-2.11.2.so&nbsp;|&nbsp;grep&nbsp;system<br />&nbsp;&nbsp;&nbsp;238:&nbsp;000f29d0&nbsp;&nbsp;&nbsp;&nbsp;66&nbsp;FUNC&nbsp;&nbsp;&nbsp;&nbsp;GLOBAL&nbsp;DEFAULT&nbsp;&nbsp;&nbsp;12&nbsp;svcerr_systemerr@@GLIBC_2.0<br />&nbsp;&nbsp;&nbsp;606:&nbsp;00038fb0&nbsp;&nbsp;&nbsp;125&nbsp;FUNC&nbsp;&nbsp;&nbsp;&nbsp;GLOBAL&nbsp;DEFAULT&nbsp;&nbsp;&nbsp;12&nbsp;__libc_system@@GLIBC_PRIVATE<br />&nbsp;&nbsp;1399:&nbsp;00038fb0&nbsp;&nbsp;&nbsp;125&nbsp;FUNC&nbsp;&nbsp;&nbsp;&nbsp;WEAK&nbsp;&nbsp;&nbsp;DEFAULT&nbsp;&nbsp;&nbsp;12&nbsp;system@@GLIBC_2.0</div></div><br /><br />Subtract the system() offset from the system() address to find libc&#39;s base address.<br />(use Google)<br /><code>0xb7ecffb0</code> - <code>0x00038fb0</code> = <code>0xb7e97000</code><br /><br /><strong><h2>## Functions</h2></strong><br /><code>(gdb) print system<br />(gdb) print exit</code><br /><br /><strong><h2>## Strings</h2></strong><br />• NOTE THAT THIS DOESN&#39;T ALWAYS WORK<br />• MAKE SURE TO VERY WHAT&#39;S AT THE MEMORY ADDRESS<br /><br /><code>(gdb) break main<br />(gbd) run</code><br /><br />First, print the memory map<br /><code>(gdb) info proc mapping</code><br /><div class="codebox"><div class="codebox">(gdb)&nbsp;info&nbsp;proc&nbsp;mapping<br />process&nbsp;3128<br />cmdline&nbsp;=&nbsp;&#39;/opt/protostar/bin/stack6&#39;<br />cwd&nbsp;=&nbsp;&#39;/opt/protostar/bin&#39;<br />exe&nbsp;=&nbsp;&#39;/opt/protostar/bin/stack6&#39;<br />Mapped&nbsp;address&nbsp;spaces:<br /><br />	Start&nbsp;Addr&nbsp;&nbsp;&nbsp;End&nbsp;Addr&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Size&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Offset&nbsp;objfile<br />	&nbsp;0x8048000&nbsp;&nbsp;0x8049000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x1000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/opt/protostar/bin/stack6<br />	&nbsp;0x8049000&nbsp;&nbsp;0x804a000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x1000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/opt/protostar/bin/stack6<br />	0xb7e96000&nbsp;0xb7e97000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x1000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />	0xb7e97000&nbsp;0xb7fd5000&nbsp;&nbsp;&nbsp;0x13e000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/lib/libc-2.11.2.so<br />	0xb7fd5000&nbsp;0xb7fd6000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x1000&nbsp;&nbsp;&nbsp;0x13e000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/lib/libc-2.11.2.so<br />	0xb7fd6000&nbsp;0xb7fd8000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x2000&nbsp;&nbsp;&nbsp;0x13e000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/lib/libc-2.11.2.so<br />	0xb7fd8000&nbsp;0xb7fd9000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x1000&nbsp;&nbsp;&nbsp;0x140000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/lib/libc-2.11.2.so<br />	0xb7fd9000&nbsp;0xb7fdc000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x3000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />[...]</div></div><br /><br />Find the memory address range of the section of memory you want to search<br />e.g. libc:<br />    start address = <code>0xb7e97000</code><br />    end address = <code>0xb7fd5000</code><br />    <br />Search that memory range for a string<br />e.g. /bin/sh<br /><code>(gdb) find 0xb7e97000, 0xb7fd5000, &quot;/bin/sh&quot;<br />0xb7fba23f<br />1 pattern found.</code><br /><br />Verify what&#39;s at that memory address<br /><code>(gdb) x /s 0xb7fba23f</code><br /><code>0xb7fba23f:	 &quot;/bin/sh&quot;</code><br /><br /></div>
</body>
</html>
