<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Roasting AS-REPs</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><strong><h1># Kerberoasting the AS-REP</h1></strong><br />If you&#39;re kerberoasting an AS-REP, you&#39;re attacking a user&#39;s NTLM hash.<br />With the hash, you now have multiple options:<br />• pass the hash (RDP. SMB, browse shares, etc.)<br />• crack it<br /><br /><strong>Links</strong><br />• <a href="https://www.harmj0y.net/blog/activedirectory/roasting-as-reps/">https://www.harmj0y.net/blog/activedirectory/roasting-as-reps/</a><br /><br /><strong><h2>## About AS-REP</h2></strong><br />Kerberos authentication can be divided into 3 parts:<br />• Part 1 - Getting a TGT (to request a TGS)<br />• Part 2 - Getting a TGS (to access a service)<br />• Part 3 - Use TGS to Access Service<br /><br />The <code>AS-REP</code> section of the Kerberos authentication process can be found in <code>Part 1 - Getting a TGT</code>.<br />For more information refer to <a href="Pentetration_Testing--Extra--Active_Directory_-_Windows_Domains--About--Kerberos--Authentication_Process.html">Kerberos &gt; Authentication Process</a><br /><br /><strong>TDLR:</strong><br />A user requests a TGT.<br />The <code>AS-REP</code> reply provides the user with their requested TGT.<br />To protect the TGT, a session key is is also given which says the TGT is valid for 20 minutes.<br />This session key is encrypted with the user&#39;s NTLM hash. &lt;-- This is where you extract the user&#39;s password hash and crack it.<br /><br /><strong><h2>## How to Kerberoast AS-REPs</h2></strong><br />Outlined here are methods to kerberoast AS-REPs.<br />For commands, refer to the sub-nodes.<br /><br /><strong><h3>### Option #1 - Pre-Auth already disabled</h3></strong><br />If a user on the Domain Controller has <em>“Do not require Kerberos preauthentication”</em> enabled, you will be able to send a <code>AS_REQ</code> as that user and receive a TGT_REP / AS_REP containing their NTLM password hash.<br /><br /><a href=""><img src="images/446-1.png" alt="images/446-1.png" /></a><br /><br />Users that might have Kerberos Pre-Auth disabled (it&#39;s not common)<br />• VPN users<br />• Linux machines connected to the Windows Active Directory<br /><br /><strong><h3>### Option #2 - Disable Pre-Auth on a user, then Kerberoast them</h3></strong><br />If there aren&#39;t any users with Pre-Auth disabled, you might be able to find users that have permissions to disable Pre-Auth<br /><br /><strong><h3>### Cracking</h3></strong><br /><code>hashcat -m 18200 -a 0 &lt;AS_REP_responses_file&gt; &lt;passwords_file&gt;</code><br /><code>john --wordlist=&lt;passwords_file&gt; &lt;AS_REP_responses_file&gt;</code><br /><br /></div>
</body>
</html>
